<div id="var_system_drawer" class="drawer">
  <div class="drawer-toggle">
    <div
      id="var_system_drawer_icon"
      class="drawer-icon fa-solid fa-diagram-project fa-fw closedIcon interactable"
      title="变量系统"
      data-i18n="[title]Variable system"
      tabindex="0"
    ></div>
  </div>
  <div
    id="var_system_drawer_content"
    class="drawer-content closedDrawer"
    data-slide-toggle="hidden"
  >
    <div
      class="inline-drawer"
      style="padding: 10px; gap: 10px; display: flex; flex-direction: column"
    >
      <div
        class="inline-drawer-header"
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
        "
      >
        <b data-i18n="Variable System">变量系统</b>
        <span class="drawer-subtitle" data-i18n="Manage snapshots and templates"
          >管理快照与模板</span
        >
      </div>

      <!-- 标签页导航 -->
      <div
        id="var_system_tabs"
        style="
          display: flex;
          gap: 4px;
          border-bottom: 1px solid var(--SmartThemeBorderColor, #333);
          padding: 0 10px;
        "
      >
        <button
          id="var_system_tab_character"
          class="var-system-tab active"
          data-tab="character"
          style="
            padding: 8px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
          "
        >
          <span data-i18n="Character Template">角色模板</span>
        </button>
        <button
          id="var_system_tab_global"
          class="var-system-tab"
          data-tab="global"
          style="
            padding: 8px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
          "
        >
          <span data-i18n="Global Snapshots">全局快照</span>
        </button>
        <button
          id="var_system_tab_functions"
          class="var-system-tab"
          data-tab="functions"
          style="
            padding: 8px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
          "
        >
          <span data-i18n="Function Library">函数库</span>
        </button>
        <button
          id="var_system_tab_messages"
          class="var-system-tab"
          data-tab="messages"
          style="
            padding: 8px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
          "
        >
          <span data-i18n="Message Snapshots">楼层快照</span>
        </button>
        <button
          id="var_system_tab_settings"
          class="var-system-tab"
          data-tab="settings"
          style="
            padding: 8px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
          "
        >
          <span data-i18n="Settings">设置</span>
        </button>
      </div>

      <div
        class="inline-drawer-content"
        style="
          display: flex;
          flex-direction: column;
          gap: 10px;
          max-height: calc(100vh - 200px);
          overflow-y: auto;
        "
      >
        <!-- 角色模板标签页 -->
        <div
          id="var_system_template_section"
          class="var-system-tab-content"
          data-tab="character"
          style="
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--SmartThemeBorderColor, #333);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            min-height: 0;
          "
        >
          <div style="display: flex; flex-direction: column; gap: 6px">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div style="display: flex; align-items: center; gap: 8px">
                <b data-i18n="Template Editor">模板编辑器</b>
                <label
                  for="var_system_template_enabled"
                  style="display: flex; align-items: center; gap: 4px"
                >
                  <input
                    id="var_system_template_enabled"
                    type="checkbox"
                    style="width: 14px; height: 14px"
                  />
                  <span data-i18n="Enable variable system">启用变量系统</span>
                </label>
              </div>
              <div style="display: flex; gap: 6px; flex-wrap: wrap">
                <button
                  id="var_system_template_reload"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px"
                >
                  <span data-i18n="Reload">重新加载</span>
                </button>
                <button
                  id="var_system_template_discard"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px"
                >
                  <span data-i18n="Reset changes">重置更改</span>
                </button>
                <button
                  id="var_system_template_clear"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px; white-space: nowrap"
                >
                  <span data-i18n="Clear template">清空模板</span>
                </button>
                <button
                  id="var_system_template_reset"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px; white-space: nowrap"
                >
                  <span data-i18n="Reset to default">重置为默认骨架</span>
                </button>
                <button
                  id="var_system_template_save"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px; white-space: nowrap"
                >
                  <span data-i18n="Save template">保存模板</span>
                </button>
                <button
                  id="var_system_template_save_as_global"
                  class="menu_button interactable"
                  type="button"
                  style="padding: 4px 8px; white-space: nowrap"
                  title="将当前角色模板保存为全局快照"
                  data-i18n="[title]Save template as global snapshot"
                >
                  <i class="fa-solid fa-cloud-arrow-up fa-fw"></i>
                  <span data-i18n="Save as global">保存为全局</span>
                </button>
              </div>
            </div>
            <div
              id="var_system_template_status"
              style="font-size: 12px; color: var(--SmartThemeBodyColor, #aaa)"
            >
              <span data-i18n="Template status idle">尚未加载模板</span>
            </div>
          </div>
          <div
            id="var_system_template_editor"
            style="
              height: 500px;
              border: 1px solid var(--SmartThemeBorderColor, #333);
              border-radius: 4px;
              overflow: hidden;
            "
          ></div>
        </div>

        <!-- 全局快照标签页 -->
        <div
          id="var_system_snapshots_section"
          class="var-system-tab-content"
          data-tab="global"
          style="
            display: none;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--SmartThemeBorderColor, #333);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            min-height: 0;
          "
        >
          <!-- 列表视图 -->
          <div
            id="var_system_snapshots_list_view"
            style="display: flex; flex-direction: column; gap: 12px"
          >
            <!-- 工具栏 -->
            <div
              style="
                display: grid;
                grid-template-columns: 1fr auto auto auto;
                gap: 8px;
                align-items: center;
              "
            >
              <input
                id="var_system_snapshot_search"
                type="text"
                placeholder="搜索快照..."
                data-i18n="[placeholder]Search snapshots"
                style="
                  padding: 8px 12px;
                  border: 1px solid var(--SmartThemeBorderColor, #333);
                  border-radius: 6px;
                  background: var(--SmartThemeBlurTintColor, transparent);
                  font-size: 13px;
                "
              />
              <select
                id="var_system_snapshot_tag_filter"
                style="
                  padding: 8px 12px;
                  border: 1px solid var(--SmartThemeBorderColor, #333);
                  border-radius: 6px;
                  background: var(--SmartThemeBlurTintColor, transparent);
                  font-size: 13px;
                  min-width: 120px;
                "
              >
                <option value="" data-i18n="All tags">所有标签</option>
              </select>
              <button
                id="var_system_snapshot_new"
                class="menu_button interactable"
                type="button"
                style="padding: 8px 14px; white-space: nowrap; font-size: 13px"
              >
                <i class="fa-solid fa-plus fa-fw"></i>
                <span data-i18n="New snapshot">新建</span>
              </button>
              <button
                id="var_system_snapshot_refresh"
                class="menu_button interactable"
                type="button"
                style="padding: 8px 14px; white-space: nowrap; font-size: 13px"
              >
                <i class="fa-solid fa-rotate fa-fw"></i>
                <span data-i18n="Refresh">刷新</span>
              </button>
            </div>

            <!-- 快照列表 -->
            <div
              id="var_system_snapshots_list"
              style="
                display: flex;
                flex-direction: column;
                gap: 8px;
                max-height: 400px;
                overflow-y: auto;
                padding: 4px;
              "
            >
              <div
                id="var_system_snapshots_empty"
                style="
                  text-align: center;
                  padding: 40px 20px;
                  color: var(--SmartThemeBodyColor, #888);
                "
              >
                <i
                  class="fa-solid fa-inbox fa-3x"
                  style="margin-bottom: 10px; opacity: 0.5"
                ></i>
                <p data-i18n="No snapshots yet">暂无全局快照</p>
                <p style="font-size: 12px" data-i18n="Click New to create one">
                  点击"新建快照"创建第一个快照
                </p>
              </div>
            </div>
          </div>

          <!-- 编辑视图 -->
          <div
            id="var_system_snapshot_editor_view"
            style="
              display: none;
              flex-direction: column;
              gap: 10px;
              flex: 1;
              min-height: 0;
            "
          >
            <!-- 标题栏 -->
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--SmartThemeBorderColor, #333);
              "
            >
              <h4 id="var_system_snapshot_editor_title" style="margin: 0">
                <span data-i18n="New snapshot">新建快照</span>
              </h4>
              <button
                id="var_system_snapshot_editor_back"
                class="menu_button interactable"
                type="button"
                style="
                  padding: 6px 12px;
                  white-space: nowrap;
                  font-size: 13px;
                  color: var(--SmartThemeBodyColor, #ccc);
                "
              >
                <i class="fa-solid fa-arrow-left fa-fw"></i>
                <span data-i18n="Back to list">返回列表</span>
              </button>
            </div>

            <!-- 表单字段 -->
            <div style="display: flex; flex-direction: column; gap: 8px">
              <div>
                <label
                  for="var_system_snapshot_name"
                  style="display: block; margin-bottom: 4px"
                >
                  <span data-i18n="Snapshot name">快照名称</span>
                  <span style="color: #f00">*</span>
                </label>
                <input
                  id="var_system_snapshot_name"
                  type="text"
                  class="text_pole"
                  placeholder="输入快照名称..."
                  data-i18n="[placeholder]Enter snapshot name"
                  required
                  style="width: 100%; padding: 6px 10px"
                />
              </div>

              <div>
                <label
                  for="var_system_snapshot_description"
                  style="display: block; margin-bottom: 4px"
                >
                  <span data-i18n="Description">描述</span>
                </label>
                <textarea
                  id="var_system_snapshot_description"
                  class="text_pole"
                  rows="2"
                  placeholder="快照的用途说明（可选）..."
                  data-i18n="[placeholder]Snapshot description (optional)"
                  style="width: 100%; padding: 6px 10px; resize: vertical"
                ></textarea>
              </div>

              <div>
                <label
                  for="var_system_snapshot_tags"
                  style="display: block; margin-bottom: 4px"
                >
                  <span data-i18n="Tags">标签</span>
                  <small
                    style="
                      color: var(--SmartThemeBodyColor, #888);
                      font-weight: normal;
                    "
                  >
                    （逗号分隔）
                  </small>
                </label>
                <input
                  id="var_system_snapshot_tags"
                  type="text"
                  class="text_pole"
                  placeholder="战斗, 角色, 系统"
                  data-i18n="[placeholder]battle, character, system"
                  style="width: 100%; padding: 6px 10px"
                />
              </div>
            </div>

            <!-- 状态显示 -->
            <div
              id="var_system_snapshot_editor_status"
              style="font-size: 12px; color: var(--SmartThemeBodyColor, #aaa)"
            >
              <span data-i18n="Snapshot editor ready">快照编辑器就绪</span>
            </div>

            <!-- JSON 编辑器 -->
            <div
              id="var_system_snapshot_body_editor"
              style="
                height: 500px;
                border: 1px solid var(--SmartThemeBorderColor, #333);
                border-radius: 4px;
                overflow: hidden;
              "
            ></div>

            <!-- 操作按钮 -->
            <div
              style="
                display: flex;
                gap: 8px;
                justify-content: flex-end;
                padding-top: 8px;
                border-top: 1px solid var(--SmartThemeBorderColor, #333);
              "
            >
              <button
                id="var_system_snapshot_editor_cancel"
                class="menu_button interactable"
                type="button"
                style="
                  padding: 8px 16px;
                  white-space: nowrap;
                  font-size: 13px;
                  color: var(--SmartThemeBodyColor, #ccc);
                "
              >
                <span data-i18n="Cancel">取消</span>
              </button>
              <button
                id="var_system_snapshot_editor_save"
                class="menu_button interactable"
                type="button"
                style="
                  padding: 8px 16px;
                  white-space: nowrap;
                  font-size: 13px;
                  font-weight: 500;
                "
              >
                <i class="fa-solid fa-save fa-fw"></i>
                <span data-i18n="Save snapshot">保存</span>
              </button>
            </div>
          </div>
        </div>

        <!-- 函数库标签页 -->
        <div
          id="var_system_functions_section"
          class="var-system-tab-content"
          data-tab="functions"
          style="
            display: none;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--SmartThemeBorderColor, #333);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            min-height: 0;
          "
        >
          <!-- 函数库内容将通过 JavaScript 动态加载 -->
        </div>

        <!-- 楼层快照标签页 -->
        <div
          id="var_system_messages_section"
          class="var-system-tab-content"
          data-tab="messages"
          style="
            display: none;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--SmartThemeBorderColor, #333);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            min-height: 0;
          "
        >
          <!-- 楼层快照内容将通过 JavaScript 动态加载 -->
        </div>

        <!-- 设置标签页 -->
        <div
          id="var_system_settings_section"
          class="var-system-tab-content"
          data-tab="settings"
          style="
            display: none;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--SmartThemeBorderColor, #333);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            min-height: 0;
          "
        >
          <!-- 设置内容将通过 JavaScript 动态加载 -->
        </div>
      </div>
    </div>
  </div>
</div>
