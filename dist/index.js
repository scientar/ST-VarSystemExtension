import{getContext as t,extension_settings as e,writeExtensionField as n,renderExtensionTemplateAsync as r}from'../../../../../scripts/extensions.js';import{getRequestHeaders as o,eventSource as s,event_types as i,saveSettingsDebounced as a,saveChat as c}from'../../../../../script.js';import{callGenericPopup as l,POPUP_TYPE as u}from'../../../../../scripts/popup.js';import{createJSONEditor as f}from'../lib/jsoneditor.js';import'../../../../../scripts/i18n.js';var p='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{};function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,'default')?t.default:t}var h,v={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var g,y,m=(h||(h=1,g=v,y=v.exports,function(){var t,e='Expected a function',n='__lodash_hash_undefined__',r='__lodash_placeholder__',o=32,s=128,i=256,a=1/0,c=9007199254740991,l=NaN,u=4294967295,f=[['ary',s],['bind',1],['bindKey',2],['curry',8],['curryRight',16],['flip',512],['partial',o],['partialRight',64],['rearg',i]],d='[object Arguments]',h='[object Array]',v='[object Boolean]',m='[object Date]',w='[object Error]',b='[object Function]',x='[object GeneratorFunction]',S='[object Map]',E='[object Number]',T='[object Object]',C='[object Promise]',I='[object RegExp]',k='[object Set]',F='[object String]',A='[object Symbol]',j='[object WeakMap]',O='[object ArrayBuffer]',L='[object DataView]',B='[object Float32Array]',R='[object Float64Array]',D='[object Int8Array]',M='[object Int16Array]',P='[object Int32Array]',N='[object Uint8Array]',V='[object Uint8ClampedArray]',U='[object Uint16Array]',H='[object Uint32Array]',W=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,J=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,X=/[&<>"']/g,K=RegExp(q.source),Z=RegExp(X.source),Y=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,st=RegExp(ot.source),it=/^\s+/,at=/\s/,ct=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ft=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pt=/[()=,{}\[\]\/\s]/,dt=/\\(\\)?/g,ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,yt=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,wt=/^(?:0|[1-9]\d*)$/,bt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Et='\\ud800-\\udfff',$t='\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff',Tt='\\u2700-\\u27bf',Ct='a-z\\xdf-\\xf6\\xf8-\\xff',It='A-Z\\xc0-\\xd6\\xd8-\\xde',kt='\\ufe0e\\ufe0f',Ft='\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000',At='[\'’]',jt='['+Et+']',Ot='['+Ft+']',Lt='['+$t+']',Bt='\\d+',Rt='['+Tt+']',Dt='['+Ct+']',Mt='[^'+Et+Ft+Bt+Tt+Ct+It+']',Pt='\\ud83c[\\udffb-\\udfff]',Nt='[^'+Et+']',Vt='(?:\\ud83c[\\udde6-\\uddff]){2}',Ut='[\\ud800-\\udbff][\\udc00-\\udfff]',zt='['+It+']',Ht='\\u200d',Wt='(?:'+Dt+'|'+Mt+')',Gt='(?:'+zt+'|'+Mt+')',Jt='(?:[\'’](?:d|ll|m|re|s|t|ve))?',qt='(?:[\'’](?:D|LL|M|RE|S|T|VE))?',Xt='(?:'+Lt+'|'+Pt+')?',Kt='['+kt+']?',Zt=Kt+Xt+'(?:'+Ht+'(?:'+[Nt,Vt,Ut].join('|')+')'+Kt+Xt+')*',Yt='(?:'+[Rt,Vt,Ut].join('|')+')'+Zt,Qt='(?:'+[Nt+Lt+'?',Lt,Vt,Ut,jt].join('|')+')',te=RegExp(At,'g'),ee=RegExp(Lt,'g'),ne=RegExp(Pt+'(?='+Pt+')|'+Qt+Zt,'g'),re=RegExp([zt+'?'+Dt+'+'+Jt+'(?='+[Ot,zt,'$'].join('|')+')',Gt+'+'+qt+'(?='+[Ot,zt+Wt,'$'].join('|')+')',zt+'?'+Wt+'+'+Jt,zt+'+'+qt,'\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])','\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])',Bt,Yt].join('|'),'g'),oe=RegExp('['+Ht+Et+$t+kt+']'),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=['Array','Buffer','DataView','Date','Error','Float32Array','Float64Array','Function','Int8Array','Int16Array','Int32Array','Map','Math','Object','Promise','RegExp','Set','String','Symbol','TypeError','Uint8Array','Uint8ClampedArray','Uint16Array','Uint32Array','WeakMap','_','clearTimeout','isFinite','parseInt','setTimeout'],ae=-1,ce={};ce[B]=ce[R]=ce[D]=ce[M]=ce[P]=ce[N]=ce[V]=ce[U]=ce[H]=!0,ce[d]=ce[h]=ce[O]=ce[v]=ce[L]=ce[m]=ce[w]=ce[b]=ce[S]=ce[E]=ce[T]=ce[I]=ce[k]=ce[F]=ce[j]=!1;var le={};le[d]=le[h]=le[O]=le[L]=le[v]=le[m]=le[B]=le[R]=le[D]=le[M]=le[P]=le[S]=le[E]=le[T]=le[I]=le[k]=le[F]=le[A]=le[N]=le[V]=le[U]=le[H]=!0,le[w]=le[b]=le[j]=!1;var ue={'\\':'\\','\'':'\'','\n':'n','\r':'r','\u2028':'u2028','\u2029':'u2029'},fe=parseFloat,pe=parseInt,de='object'==typeof p&&p&&p.Object===Object&&p,he='object'==typeof self&&self&&self.Object===Object&&self,ve=de||he||Function('return this')(),ge=y&&!y.nodeType&&y,ye=ge&&g&&!g.nodeType&&g,_e=ye&&ye.exports===ge,me=_e&&de.process,we=function(){try{var t=ye&&ye.require&&ye.require('util').types;return t||me&&me.binding&&me.binding('util')}catch(e){}}(),be=we&&we.isArrayBuffer,xe=we&&we.isDate,Se=we&&we.isMap,Ee=we&&we.isRegExp,$e=we&&we.isSet,Te=we&&we.isTypedArray;function Ce(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ie(t,e,n,r){for(var o=-1,s=null==t?0:t.length;++o<s;){var i=t[o];e(r,i,n(i),t)}return r}function ke(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Fe(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ae(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function je(t,e){for(var n=-1,r=null==t?0:t.length,o=0,s=[];++n<r;){var i=t[n];e(i,n,t)&&(s[o++]=i)}return s}function Oe(t,e){return!(null==t||!t.length)&&ze(t,e,0)>-1}function Le(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1}function Be(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}function Re(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}function De(t,e,n,r){var o=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++o]);++o<s;)n=e(n,t[o],o,t);return n}function Me(t,e,n,r){var o=null==t?0:t.length;for(r&&o&&(n=t[--o]);o--;)n=e(n,t[o],o,t);return n}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Ne=Je('length');function Ve(t,e,n){var r;return n(t,function(t,n,o){if(e(t,n,o))return r=n,!1}),r}function Ue(t,e,n,r){for(var o=t.length,s=n+(r?1:-1);r?s--:++s<o;)if(e(t[s],s,t))return s;return-1}function ze(t,e,n){return e==e?function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}(t,e,n):Ue(t,We,n)}function He(t,e,n,r){for(var o=n-1,s=t.length;++o<s;)if(r(t[o],e))return o;return-1}function We(t){return t!=t}function Ge(t,e){var n=null==t?0:t.length;return n?Ke(t,e)/n:l}function Je(e){return function(n){return null==n?t:n[e]}}function qe(e){return function(n){return null==e?t:e[n]}}function Xe(t,e,n,r,o){return o(t,function(t,o,s){n=r?(r=!1,t):e(n,t,o,s)}),n}function Ke(e,n){for(var r,o=-1,s=e.length;++o<s;){var i=n(e[o]);i!==t&&(r=r===t?i:r+i)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ye(t){return t?t.slice(0,gn(t)+1).replace(it,''):t}function Qe(t){return function(e){return t(e)}}function tn(t,e){return Be(e,function(e){return t[e]})}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&ze(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&ze(e,t[n],0)>-1;);return n}var on=qe({'À':'A','Á':'A','Â':'A','Ã':'A','Ä':'A','Å':'A','à':'a','á':'a','â':'a','ã':'a','ä':'a','å':'a','Ç':'C','ç':'c','Ð':'D','ð':'d','È':'E','É':'E','Ê':'E','Ë':'E','è':'e','é':'e','ê':'e','ë':'e','Ì':'I','Í':'I','Î':'I','Ï':'I','ì':'i','í':'i','î':'i','ï':'i','Ñ':'N','ñ':'n','Ò':'O','Ó':'O','Ô':'O','Õ':'O','Ö':'O','Ø':'O','ò':'o','ó':'o','ô':'o','õ':'o','ö':'o','ø':'o','Ù':'U','Ú':'U','Û':'U','Ü':'U','ù':'u','ú':'u','û':'u','ü':'u','Ý':'Y','ý':'y','ÿ':'y','Æ':'Ae','æ':'ae','Þ':'Th','þ':'th','ß':'ss','Ā':'A','Ă':'A','Ą':'A','ā':'a','ă':'a','ą':'a','Ć':'C','Ĉ':'C','Ċ':'C','Č':'C','ć':'c','ĉ':'c','ċ':'c','č':'c','Ď':'D','Đ':'D','ď':'d','đ':'d','Ē':'E','Ĕ':'E','Ė':'E','Ę':'E','Ě':'E','ē':'e','ĕ':'e','ė':'e','ę':'e','ě':'e','Ĝ':'G','Ğ':'G','Ġ':'G','Ģ':'G','ĝ':'g','ğ':'g','ġ':'g','ģ':'g','Ĥ':'H','Ħ':'H','ĥ':'h','ħ':'h','Ĩ':'I','Ī':'I','Ĭ':'I','Į':'I','İ':'I','ĩ':'i','ī':'i','ĭ':'i','į':'i','ı':'i','Ĵ':'J','ĵ':'j','Ķ':'K','ķ':'k','ĸ':'k','Ĺ':'L','Ļ':'L','Ľ':'L','Ŀ':'L','Ł':'L','ĺ':'l','ļ':'l','ľ':'l','ŀ':'l','ł':'l','Ń':'N','Ņ':'N','Ň':'N','Ŋ':'N','ń':'n','ņ':'n','ň':'n','ŋ':'n','Ō':'O','Ŏ':'O','Ő':'O','ō':'o','ŏ':'o','ő':'o','Ŕ':'R','Ŗ':'R','Ř':'R','ŕ':'r','ŗ':'r','ř':'r','Ś':'S','Ŝ':'S','Ş':'S','Š':'S','ś':'s','ŝ':'s','ş':'s','š':'s','Ţ':'T','Ť':'T','Ŧ':'T','ţ':'t','ť':'t','ŧ':'t','Ũ':'U','Ū':'U','Ŭ':'U','Ů':'U','Ű':'U','Ų':'U','ũ':'u','ū':'u','ŭ':'u','ů':'u','ű':'u','ų':'u','Ŵ':'W','ŵ':'w','Ŷ':'Y','ŷ':'y','Ÿ':'Y','Ź':'Z','Ż':'Z','Ž':'Z','ź':'z','ż':'z','ž':'z','Ĳ':'IJ','ĳ':'ij','Œ':'Oe','œ':'oe','ŉ':'\'n','ſ':'s'}),sn=qe({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'});function an(t){return'\\'+ue[t]}function cn(t){return oe.test(t)}function ln(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function un(t,e){return function(n){return t(e(n))}}function fn(t,e){for(var n=-1,o=t.length,s=0,i=[];++n<o;){var a=t[n];a!==e&&a!==r||(t[n]=r,i[s++]=n)}return i}function pn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function dn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function hn(t){return cn(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Ne(t)}function vn(t){return cn(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split('')}(t)}function gn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var yn=qe({'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#39;':'\''}),_=function p(g){var y=(g=null==g?ve:_.defaults(ve.Object(),g,_.pick(ve,ie))).Array,at=g.Date,Et=g.Error,$t=g.Function,Tt=g.Math,Ct=g.Object,It=g.RegExp,kt=g.String,Ft=g.TypeError,At=y.prototype,jt=$t.prototype,Ot=Ct.prototype,Lt=g['__core-js_shared__'],Bt=jt.toString,Rt=Ot.hasOwnProperty,Dt=0,Mt=function(){var t=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||'');return t?'Symbol(src)_1.'+t:''}(),Pt=Ot.toString,Nt=Bt.call(Ct),Vt=ve._,Ut=It('^'+Bt.call(Rt).replace(ot,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),zt=_e?g.Buffer:t,Ht=g.Symbol,Wt=g.Uint8Array,Gt=zt?zt.allocUnsafe:t,Jt=un(Ct.getPrototypeOf,Ct),qt=Ct.create,Xt=Ot.propertyIsEnumerable,Kt=At.splice,Zt=Ht?Ht.isConcatSpreadable:t,Yt=Ht?Ht.iterator:t,Qt=Ht?Ht.toStringTag:t,ne=function(){try{var t=ps(Ct,'defineProperty');return t({},'',{}),t}catch(e){}}(),oe=g.clearTimeout!==ve.clearTimeout&&g.clearTimeout,ue=at&&at.now!==ve.Date.now&&at.now,de=g.setTimeout!==ve.setTimeout&&g.setTimeout,he=Tt.ceil,ge=Tt.floor,ye=Ct.getOwnPropertySymbols,me=zt?zt.isBuffer:t,we=g.isFinite,Ne=At.join,qe=un(Ct.keys,Ct),_n=Tt.max,mn=Tt.min,wn=at.now,bn=g.parseInt,xn=Tt.random,Sn=At.reverse,En=ps(g,'DataView'),$n=ps(g,'Map'),Tn=ps(g,'Promise'),Cn=ps(g,'Set'),In=ps(g,'WeakMap'),kn=ps(Ct,'create'),Fn=In&&new In,An={},jn=Ms(En),On=Ms($n),Ln=Ms(Tn),Bn=Ms(Cn),Rn=Ms(In),Dn=Ht?Ht.prototype:t,Mn=Dn?Dn.valueOf:t,Pn=Dn?Dn.toString:t;function Nn(t){if(ea(t)&&!Hi(t)&&!(t instanceof Hn)){if(t instanceof zn)return t;if(Rt.call(t,'__wrapped__'))return Ps(t)}return new zn(t)}var Vn=function(){function e(){}return function(n){if(!ta(n))return{};if(qt)return qt(n);e.prototype=n;var r=new e;return e.prototype=t,r}}();function Un(){}function zn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=t}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=u,this.__views__=[]}function Wn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Jn;++e<n;)this.add(t[e])}function Xn(t){var e=this.__data__=new Gn(t);this.size=e.size}function Kn(t,e){var n=Hi(t),r=!n&&zi(t),o=!n&&!r&&qi(t),s=!n&&!r&&!o&&la(t),i=n||r||o||s,a=i?Ze(t.length,kt):[],c=a.length;for(var l in t)!e&&!Rt.call(t,l)||i&&('length'==l||o&&('offset'==l||'parent'==l)||s&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||ms(l,c))||a.push(l);return a}function Zn(e){var n=e.length;return n?e[qr(0,n-1)]:t}function Yn(t,e){return Bs(Fo(t),ar(e,0,t.length))}function Qn(t){return Bs(Fo(t))}function tr(e,n,r){(r!==t&&!Ni(e[n],r)||r===t&&!(n in e))&&sr(e,n,r)}function er(e,n,r){var o=e[n];Rt.call(e,n)&&Ni(o,r)&&(r!==t||n in e)||sr(e,n,r)}function nr(t,e){for(var n=t.length;n--;)if(Ni(t[n][0],e))return n;return-1}function rr(t,e,n,r){return pr(t,function(t,o,s){e(r,t,n(t),s)}),r}function or(t,e){return t&&Ao(e,Aa(e),t)}function sr(t,e,n){'__proto__'==e&&ne?ne(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ir(e,n){for(var r=-1,o=n.length,s=y(o),i=null==e;++r<o;)s[r]=i?t:Ta(e,n[r]);return s}function ar(e,n,r){return e==e&&(r!==t&&(e=e<=r?e:r),n!==t&&(e=e>=n?e:n)),e}function cr(e,n,r,o,s,i){var a,c=1&n,l=2&n,u=4&n;if(r&&(a=s?r(e,o,s,i):r(e)),a!==t)return a;if(!ta(e))return e;var f=Hi(e);if(f){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&'string'==typeof t[0]&&Rt.call(t,'index')&&(n.index=t.index,n.input=t.input),n}(e),!c)return Fo(e,a)}else{var p=vs(e),h=p==b||p==x;if(qi(e))return Eo(e,c);if(p==T||p==d||h&&!s){if(a=l||h?{}:ys(e),!c)return l?function(t,e){return Ao(t,hs(t),e)}(e,function(t,e){return t&&Ao(e,ja(e),t)}(a,e)):function(t,e){return Ao(t,ds(t),e)}(e,or(a,e))}else{if(!le[p])return s?e:{};a=function(t,e,n){var r,o=t.constructor;switch(e){case O:return $o(t);case v:case m:return new o(+t);case L:return function(t,e){var n=e?$o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case B:case R:case D:case M:case P:case N:case V:case U:case H:return To(t,n);case S:return new o;case E:case F:return new o(t);case I:return function(t){var e=new t.constructor(t.source,vt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case k:return new o;case A:return r=t,Mn?Ct(Mn.call(r)):{}}}(e,p,c)}}i||(i=new Xn);var g=i.get(e);if(g)return g;i.set(e,a),ia(e)?e.forEach(function(t){a.add(cr(t,n,r,t,e,i))}):na(e)&&e.forEach(function(t,o){a.set(o,cr(t,n,r,o,e,i))});var y=f?t:(u?l?ss:os:l?ja:Aa)(e);return ke(y||e,function(t,o){y&&(t=e[o=t]),er(a,o,cr(t,n,r,o,e,i))}),a}function lr(e,n,r){var o=r.length;if(null==e)return!o;for(e=Ct(e);o--;){var s=r[o],i=n[s],a=e[s];if(a===t&&!(s in e)||!i(a))return!1}return!0}function ur(n,r,o){if('function'!=typeof n)throw new Ft(e);return As(function(){n.apply(t,o)},r)}function fr(t,e,n,r){var o=-1,s=Oe,i=!0,a=t.length,c=[],l=e.length;if(!a)return c;n&&(e=Be(e,Qe(n))),r?(s=Le,i=!1):e.length>=200&&(s=en,i=!1,e=new qn(e));t:for(;++o<a;){var u=t[o],f=null==n?u:n(u);if(u=r||0!==u?u:0,i&&f==f){for(var p=l;p--;)if(e[p]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}Nn.templateSettings={escape:Y,evaluate:Q,interpolate:tt,variable:'',imports:{_:Nn}},Nn.prototype=Un.prototype,Nn.prototype.constructor=Nn,zn.prototype=Vn(Un.prototype),zn.prototype.constructor=zn,Hn.prototype=Vn(Un.prototype),Hn.prototype.constructor=Hn,Wn.prototype.clear=function(){this.__data__=kn?kn(null):{},this.size=0},Wn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Wn.prototype.get=function(e){var r=this.__data__;if(kn){var o=r[e];return o===n?t:o}return Rt.call(r,e)?r[e]:t},Wn.prototype.has=function(e){var n=this.__data__;return kn?n[e]!==t:Rt.call(n,e)},Wn.prototype.set=function(e,r){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=kn&&r===t?n:r,this},Gn.prototype.clear=function(){this.__data__=[],this.size=0},Gn.prototype.delete=function(t){var e=this.__data__,n=nr(e,t);return!(n<0||(n==e.length-1?e.pop():Kt.call(e,n,1),--this.size,0))},Gn.prototype.get=function(e){var n=this.__data__,r=nr(n,e);return r<0?t:n[r][1]},Gn.prototype.has=function(t){return nr(this.__data__,t)>-1},Gn.prototype.set=function(t,e){var n=this.__data__,r=nr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Jn.prototype.clear=function(){this.size=0,this.__data__={hash:new Wn,map:new($n||Gn),string:new Wn}},Jn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Jn.prototype.get=function(t){return us(this,t).get(t)},Jn.prototype.has=function(t){return us(this,t).has(t)},Jn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},qn.prototype.add=qn.prototype.push=function(t){return this.__data__.set(t,n),this},qn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.clear=function(){this.__data__=new Gn,this.size=0},Xn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Xn.prototype.get=function(t){return this.__data__.get(t)},Xn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Gn){var r=n.__data__;if(!$n||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Jn(r)}return n.set(t,e),this.size=n.size,this};var pr=Lo(wr),dr=Lo(br,!0);function hr(t,e){var n=!0;return pr(t,function(t,r,o){return n=!!e(t,r,o)}),n}function vr(e,n,r){for(var o=-1,s=e.length;++o<s;){var i=e[o],a=n(i);if(null!=a&&(c===t?a==a&&!ca(a):r(a,c)))var c=a,l=i}return l}function gr(t,e){var n=[];return pr(t,function(t,r,o){e(t,r,o)&&n.push(t)}),n}function yr(t,e,n,r,o){var s=-1,i=t.length;for(n||(n=_s),o||(o=[]);++s<i;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,o):Re(o,a):r||(o[o.length]=a)}return o}var _r=Bo(),mr=Bo(!0);function wr(t,e){return t&&_r(t,e,Aa)}function br(t,e){return t&&mr(t,e,Aa)}function xr(t,e){return je(e,function(e){return Zi(t[e])})}function Sr(e,n){for(var r=0,o=(n=wo(n,e)).length;null!=e&&r<o;)e=e[Ds(n[r++])];return r&&r==o?e:t}function Er(t,e,n){var r=e(t);return Hi(t)?r:Re(r,n(t))}function $r(e){return null==e?e===t?'[object Undefined]':'[object Null]':Qt&&Qt in Ct(e)?function(e){var n=Rt.call(e,Qt),r=e[Qt];try{e[Qt]=t;var o=!0}catch(i){}var s=Pt.call(e);return o&&(n?e[Qt]=r:delete e[Qt]),s}(e):function(t){return Pt.call(t)}(e)}function Tr(t,e){return t>e}function Cr(t,e){return null!=t&&Rt.call(t,e)}function Ir(t,e){return null!=t&&e in Ct(t)}function kr(e,n,r){for(var o=r?Le:Oe,s=e[0].length,i=e.length,a=i,c=y(i),l=1/0,u=[];a--;){var f=e[a];a&&n&&(f=Be(f,Qe(n))),l=mn(f.length,l),c[a]=!r&&(n||s>=120&&f.length>=120)?new qn(a&&f):t}f=e[0];var p=-1,d=c[0];t:for(;++p<s&&u.length<l;){var h=f[p],v=n?n(h):h;if(h=r||0!==h?h:0,!(d?en(d,v):o(u,v,r))){for(a=i;--a;){var g=c[a];if(!(g?en(g,v):o(e[a],v,r)))continue t}d&&d.push(v),u.push(h)}}return u}function Fr(e,n,r){var o=null==(e=Is(e,n=wo(n,e)))?e:e[Ds(Ks(n))];return null==o?t:Ce(o,e,r)}function Ar(t){return ea(t)&&$r(t)==d}function jr(e,n,r,o,s){return e===n||(null==e||null==n||!ea(e)&&!ea(n)?e!=e&&n!=n:function(e,n,r,o,s,i){var a=Hi(e),c=Hi(n),l=a?h:vs(e),u=c?h:vs(n),f=(l=l==d?T:l)==T,p=(u=u==d?T:u)==T,g=l==u;if(g&&qi(e)){if(!qi(n))return!1;a=!0,f=!1}if(g&&!f)return i||(i=new Xn),a||la(e)?ns(e,n,r,o,s,i):function(t,e,n,r,o,s,i){switch(n){case L:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new Wt(t),new Wt(e)));case v:case m:case E:return Ni(+t,+e);case w:return t.name==e.name&&t.message==e.message;case I:case F:return t==e+'';case S:var a=ln;case k:var c=1&r;if(a||(a=pn),t.size!=e.size&&!c)return!1;var l=i.get(t);if(l)return l==e;r|=2,i.set(t,e);var u=ns(a(t),a(e),r,o,s,i);return i.delete(t),u;case A:if(Mn)return Mn.call(t)==Mn.call(e)}return!1}(e,n,l,r,o,s,i);if(!(1&r)){var y=f&&Rt.call(e,'__wrapped__'),b=p&&Rt.call(n,'__wrapped__');if(y||b){var x=y?e.value():e,C=b?n.value():n;return i||(i=new Xn),s(x,C,r,o,i)}}return!!g&&(i||(i=new Xn),function(e,n,r,o,s,i){var a=1&r,c=os(e),l=c.length,u=os(n),f=u.length;if(l!=f&&!a)return!1;for(var p=l;p--;){var d=c[p];if(!(a?d in n:Rt.call(n,d)))return!1}var h=i.get(e),v=i.get(n);if(h&&v)return h==n&&v==e;var g=!0;i.set(e,n),i.set(n,e);for(var y=a;++p<l;){var m=e[d=c[p]],w=n[d];if(o)var b=a?o(w,m,d,n,e,i):o(m,w,d,e,n,i);if(!(b===t?m===w||s(m,w,r,o,i):b)){g=!1;break}y||(y='constructor'==d)}if(g&&!y){var x=e.constructor,S=n.constructor;x==S||!('constructor'in e)||!('constructor'in n)||'function'==typeof x&&x instanceof x&&'function'==typeof S&&S instanceof S||(g=!1)}return i.delete(e),i.delete(n),g}(e,n,r,o,s,i))}(e,n,r,o,jr,s))}function Or(e,n,r,o){var s=r.length,i=s,a=!o;if(null==e)return!i;for(e=Ct(e);s--;){var c=r[s];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<i;){var l=(c=r[s])[0],u=e[l],f=c[1];if(a&&c[2]){if(u===t&&!(l in e))return!1}else{var p=new Xn;if(o)var d=o(u,f,l,e,n,p);if(!(d===t?jr(f,u,3,o,p):d))return!1}}return!0}function Lr(t){return!(!ta(t)||(e=t,Mt&&Mt in e))&&(Zi(t)?Ut:_t).test(Ms(t));var e}function Br(t){return'function'==typeof t?t:null==t?rc:'object'==typeof t?Hi(t)?Vr(t[0],t[1]):Nr(t):pc(t)}function Rr(t){if(!Es(t))return qe(t);var e=[];for(var n in Ct(t))Rt.call(t,n)&&'constructor'!=n&&e.push(n);return e}function Dr(t){if(!ta(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Es(t),n=[];for(var r in t)('constructor'!=r||!e&&Rt.call(t,r))&&n.push(r);return n}function Mr(t,e){return t<e}function Pr(t,e){var n=-1,r=Gi(t)?y(t.length):[];return pr(t,function(t,o,s){r[++n]=e(t,o,s)}),r}function Nr(t){var e=fs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Vr(e,n){return bs(e)&&$s(n)?Ts(Ds(e),n):function(r){var o=Ta(r,e);return o===t&&o===n?Ca(r,e):jr(n,o,3)}}function Ur(e,n,r,o,s){e!==n&&_r(n,function(i,a){if(s||(s=new Xn),ta(i))!function(e,n,r,o,s,i,a){var c=ks(e,r),l=ks(n,r),u=a.get(l);if(u)tr(e,r,u);else{var f=i?i(c,l,r+'',e,n,a):t,p=f===t;if(p){var d=Hi(l),h=!d&&qi(l),v=!d&&!h&&la(l);f=l,d||h||v?Hi(c)?f=c:Ji(c)?f=Fo(c):h?(p=!1,f=Eo(l,!0)):v?(p=!1,f=To(l,!0)):f=[]:oa(l)||zi(l)?(f=c,zi(c)?f=ya(c):ta(c)&&!Zi(c)||(f=ys(l))):p=!1}p&&(a.set(l,f),s(f,l,o,i,a),a.delete(l)),tr(e,r,f)}}(e,n,a,r,Ur,o,s);else{var c=o?o(ks(e,a),i,a+'',e,n,s):t;c===t&&(c=i),tr(e,a,c)}},ja)}function zr(e,n){var r=e.length;if(r)return ms(n+=n<0?r:0,r)?e[n]:t}function Hr(t,e,n){e=e.length?Be(e,function(t){return Hi(t)?function(e){return Sr(e,1===t.length?t[0]:t)}:t}):[rc];var r=-1;e=Be(e,Qe(ls()));var o=Pr(t,function(t,n,o){var s=Be(e,function(e){return e(t)});return{criteria:s,index:++r,value:t}});return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(o,function(t,e){return function(t,e,n){for(var r=-1,o=t.criteria,s=e.criteria,i=o.length,a=n.length;++r<i;){var c=Co(o[r],s[r]);if(c)return r>=a?c:c*('desc'==n[r]?-1:1)}return t.index-e.index}(t,e,n)})}function Wr(t,e,n){for(var r=-1,o=e.length,s={};++r<o;){var i=e[r],a=Sr(t,i);n(a,i)&&Qr(s,wo(i,t),a)}return s}function Gr(t,e,n,r){var o=r?He:ze,s=-1,i=e.length,a=t;for(t===e&&(e=Fo(e)),n&&(a=Be(t,Qe(n)));++s<i;)for(var c=0,l=e[s],u=n?n(l):l;(c=o(a,u,c,r))>-1;)a!==t&&Kt.call(a,c,1),Kt.call(t,c,1);return t}function Jr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var o=e[n];if(n==r||o!==s){var s=o;ms(o)?Kt.call(t,o,1):fo(t,o)}}return t}function qr(t,e){return t+ge(xn()*(e-t+1))}function Xr(t,e){var n='';if(!t||e<1||e>c)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t)}while(e);return n}function Kr(t,e){return js(Cs(t,e,rc),t+'')}function Zr(t){return Zn(Na(t))}function Yr(t,e){var n=Na(t);return Bs(n,ar(e,0,n.length))}function Qr(e,n,r,o){if(!ta(e))return e;for(var s=-1,i=(n=wo(n,e)).length,a=i-1,c=e;null!=c&&++s<i;){var l=Ds(n[s]),u=r;if('__proto__'===l||'constructor'===l||'prototype'===l)return e;if(s!=a){var f=c[l];(u=o?o(f,l,c):t)===t&&(u=ta(f)?f:ms(n[s+1])?[]:{})}er(c,l,u),c=c[l]}return e}var to=Fn?function(t,e){return Fn.set(t,e),t}:rc,eo=ne?function(t,e){return ne(t,'toString',{configurable:!0,enumerable:!1,value:tc(e),writable:!0})}:rc;function no(t){return Bs(Na(t))}function ro(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var s=y(o);++r<o;)s[r]=t[r+e];return s}function oo(t,e){var n;return pr(t,function(t,r,o){return!(n=e(t,r,o))}),!!n}function so(t,e,n){var r=0,o=null==t?r:t.length;if('number'==typeof e&&e==e&&o<=2147483647){for(;r<o;){var s=r+o>>>1,i=t[s];null!==i&&!ca(i)&&(n?i<=e:i<e)?r=s+1:o=s}return o}return io(t,e,rc,n)}function io(e,n,r,o){var s=0,i=null==e?0:e.length;if(0===i)return 0;for(var a=(n=r(n))!=n,c=null===n,l=ca(n),u=n===t;s<i;){var f=ge((s+i)/2),p=r(e[f]),d=p!==t,h=null===p,v=p==p,g=ca(p);if(a)var y=o||v;else y=u?v&&(o||d):c?v&&d&&(o||!h):l?v&&d&&!h&&(o||!g):!h&&!g&&(o?p<=n:p<n);y?s=f+1:i=f}return mn(i,4294967294)}function ao(t,e){for(var n=-1,r=t.length,o=0,s=[];++n<r;){var i=t[n],a=e?e(i):i;if(!n||!Ni(a,c)){var c=a;s[o++]=0===i?0:i}}return s}function co(t){return'number'==typeof t?t:ca(t)?l:+t}function lo(t){if('string'==typeof t)return t;if(Hi(t))return Be(t,lo)+'';if(ca(t))return Pn?Pn.call(t):'';var e=t+'';return'0'==e&&1/t==-1/0?'-0':e}function uo(t,e,n){var r=-1,o=Oe,s=t.length,i=!0,a=[],c=a;if(n)i=!1,o=Le;else if(s>=200){var l=e?null:Ko(t);if(l)return pn(l);i=!1,o=en,c=new qn}else c=e?[]:a;t:for(;++r<s;){var u=t[r],f=e?e(u):u;if(u=n||0!==u?u:0,i&&f==f){for(var p=c.length;p--;)if(c[p]===f)continue t;e&&c.push(f),a.push(u)}else o(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function fo(t,e){return null==(t=Is(t,e=wo(e,t)))||delete t[Ds(Ks(e))]}function po(t,e,n,r){return Qr(t,e,n(Sr(t,e)),r)}function ho(t,e,n,r){for(var o=t.length,s=r?o:-1;(r?s--:++s<o)&&e(t[s],s,t););return n?ro(t,r?0:s,r?s+1:o):ro(t,r?s+1:0,r?o:s)}function vo(t,e){var n=t;return n instanceof Hn&&(n=n.value()),De(e,function(t,e){return e.func.apply(e.thisArg,Re([t],e.args))},n)}function go(t,e,n){var r=t.length;if(r<2)return r?uo(t[0]):[];for(var o=-1,s=y(r);++o<r;)for(var i=t[o],a=-1;++a<r;)a!=o&&(s[o]=fr(s[o]||i,t[a],e,n));return uo(yr(s,1),e,n)}function yo(e,n,r){for(var o=-1,s=e.length,i=n.length,a={};++o<s;){var c=o<i?n[o]:t;r(a,e[o],c)}return a}function _o(t){return Ji(t)?t:[]}function mo(t){return'function'==typeof t?t:rc}function wo(t,e){return Hi(t)?t:bs(t,e)?[t]:Rs(_a(t))}var bo=Kr;function xo(e,n,r){var o=e.length;return r=r===t?o:r,!n&&r>=o?e:ro(e,n,r)}var So=oe||function(t){return ve.clearTimeout(t)};function Eo(t,e){if(e)return t.slice();var n=t.length,r=Gt?Gt(n):new t.constructor(n);return t.copy(r),r}function $o(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function To(t,e){var n=e?$o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Co(e,n){if(e!==n){var r=e!==t,o=null===e,s=e==e,i=ca(e),a=n!==t,c=null===n,l=n==n,u=ca(n);if(!c&&!u&&!i&&e>n||i&&a&&l&&!c&&!u||o&&a&&l||!r&&l||!s)return 1;if(!o&&!i&&!u&&e<n||u&&r&&s&&!o&&!i||c&&r&&s||!a&&s||!l)return-1}return 0}function Io(t,e,n,r){for(var o=-1,s=t.length,i=n.length,a=-1,c=e.length,l=_n(s-i,0),u=y(c+l),f=!r;++a<c;)u[a]=e[a];for(;++o<i;)(f||o<s)&&(u[n[o]]=t[o]);for(;l--;)u[a++]=t[o++];return u}function ko(t,e,n,r){for(var o=-1,s=t.length,i=-1,a=n.length,c=-1,l=e.length,u=_n(s-a,0),f=y(u+l),p=!r;++o<u;)f[o]=t[o];for(var d=o;++c<l;)f[d+c]=e[c];for(;++i<a;)(p||o<s)&&(f[d+n[i]]=t[o++]);return f}function Fo(t,e){var n=-1,r=t.length;for(e||(e=y(r));++n<r;)e[n]=t[n];return e}function Ao(e,n,r,o){var s=!r;r||(r={});for(var i=-1,a=n.length;++i<a;){var c=n[i],l=o?o(r[c],e[c],c,r,e):t;l===t&&(l=e[c]),s?sr(r,c,l):er(r,c,l)}return r}function jo(t,e){return function(n,r){var o=Hi(n)?Ie:rr,s=e?e():{};return o(n,t,ls(r,2),s)}}function Oo(e){return Kr(function(n,r){var o=-1,s=r.length,i=s>1?r[s-1]:t,a=s>2?r[2]:t;for(i=e.length>3&&'function'==typeof i?(s--,i):t,a&&ws(r[0],r[1],a)&&(i=s<3?t:i,s=1),n=Ct(n);++o<s;){var c=r[o];c&&e(n,c,o,i)}return n})}function Lo(t,e){return function(n,r){if(null==n)return n;if(!Gi(n))return t(n,r);for(var o=n.length,s=e?o:-1,i=Ct(n);(e?s--:++s<o)&&!1!==r(i[s],s,i););return n}}function Bo(t){return function(e,n,r){for(var o=-1,s=Ct(e),i=r(e),a=i.length;a--;){var c=i[t?a:++o];if(!1===n(s[c],c,s))break}return e}}function Ro(e){return function(n){var r=cn(n=_a(n))?vn(n):t,o=r?r[0]:n.charAt(0),s=r?xo(r,1).join(''):n.slice(1);return o[e]()+s}}function Do(t){return function(e){return De(Za(za(e).replace(te,'')),t,'')}}function Mo(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Vn(t.prototype),r=t.apply(n,e);return ta(r)?r:n}}function Po(e){return function(n,r,o){var s=Ct(n);if(!Gi(n)){var i=ls(r,3);n=Aa(n),r=function(t){return i(s[t],t,s)}}var a=e(n,r,o);return a>-1?s[i?n[a]:a]:t}}function No(n){return rs(function(r){var o=r.length,s=o,i=zn.prototype.thru;for(n&&r.reverse();s--;){var a=r[s];if('function'!=typeof a)throw new Ft(e);if(i&&!c&&'wrapper'==as(a))var c=new zn([],!0)}for(s=c?s:o;++s<o;){var l=as(a=r[s]),u='wrapper'==l?is(a):t;c=u&&xs(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?c[as(u[0])].apply(c,u[3]):1==a.length&&xs(a)?c[l]():c.thru(a)}return function(){var t=arguments,e=t[0];if(c&&1==t.length&&Hi(e))return c.plant(e).value();for(var n=0,s=o?r[n].apply(this,t):e;++n<o;)s=r[n].call(this,s);return s}})}function Vo(e,n,r,o,i,a,c,l,u,f){var p=n&s,d=1&n,h=2&n,v=24&n,g=512&n,m=h?t:Mo(e);return function s(){for(var w=arguments.length,b=y(w),x=w;x--;)b[x]=arguments[x];if(v)var S=cs(s),E=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(b,S);if(o&&(b=Io(b,o,i,v)),a&&(b=ko(b,a,c,v)),w-=E,v&&w<f){var T=fn(b,S);return qo(e,n,Vo,s.placeholder,r,b,T,l,u,f-w)}var C=d?r:this,I=h?C[e]:e;return w=b.length,l?b=function(e,n){for(var r=e.length,o=mn(n.length,r),s=Fo(e);o--;){var i=n[o];e[o]=ms(i,r)?s[i]:t}return e}(b,l):g&&w>1&&b.reverse(),p&&u<w&&(b.length=u),this&&this!==ve&&this instanceof s&&(I=m||Mo(I)),I.apply(C,b)}}function Uo(t,e){return function(n,r){return function(t,e,n,r){return wr(t,function(t,o,s){e(r,n(t),o,s)}),r}(n,t,e(r),{})}}function zo(e,n){return function(r,o){var s;if(r===t&&o===t)return n;if(r!==t&&(s=r),o!==t){if(s===t)return o;'string'==typeof r||'string'==typeof o?(r=lo(r),o=lo(o)):(r=co(r),o=co(o)),s=e(r,o)}return s}}function Ho(t){return rs(function(e){return e=Be(e,Qe(ls())),Kr(function(n){var r=this;return t(e,function(t){return Ce(t,r,n)})})})}function Wo(e,n){var r=(n=n===t?' ':lo(n)).length;if(r<2)return r?Xr(n,e):n;var o=Xr(n,he(e/hn(n)));return cn(n)?xo(vn(o),0,e).join(''):o.slice(0,e)}function Go(e){return function(n,r,o){return o&&'number'!=typeof o&&ws(n,r,o)&&(r=o=t),n=da(n),r===t?(r=n,n=0):r=da(r),function(t,e,n,r){for(var o=-1,s=_n(he((e-t)/(n||1)),0),i=y(s);s--;)i[r?s:++o]=t,t+=n;return i}(n,r,o=o===t?n<r?1:-1:da(o),e)}}function Jo(t){return function(e,n){return'string'==typeof e&&'string'==typeof n||(e=ga(e),n=ga(n)),t(e,n)}}function qo(e,n,r,s,i,a,c,l,u,f){var p=8&n;n|=p?o:64,4&(n&=~(p?64:o))||(n&=-4);var d=[e,n,i,p?a:t,p?c:t,p?t:a,p?t:c,l,u,f],h=r.apply(t,d);return xs(e)&&Fs(h,d),h.placeholder=s,Os(h,e,n)}function Xo(t){var e=Tt[t];return function(t,n){if(t=ga(t),(n=null==n?0:mn(ha(n),292))&&we(t)){var r=(_a(t)+'e').split('e');return+((r=(_a(e(r[0]+'e'+(+r[1]+n)))+'e').split('e'))[0]+'e'+(+r[1]-n))}return e(t)}}var Ko=Cn&&1/pn(new Cn([,-0]))[1]==a?function(t){return new Cn(t)}:cc;function Zo(t){return function(e){var n=vs(e);return n==S?ln(e):n==k?dn(e):function(t,e){return Be(e,function(e){return[e,t[e]]})}(e,t(e))}}function Yo(n,a,c,l,u,f,p,d){var h=2&a;if(!h&&'function'!=typeof n)throw new Ft(e);var v=l?l.length:0;if(v||(a&=-97,l=u=t),p=p===t?p:_n(ha(p),0),d=d===t?d:ha(d),v-=u?u.length:0,64&a){var g=l,m=u;l=u=t}var w=h?t:is(n),b=[n,a,c,l,u,g,m,f,p,d];if(w&&function(t,e){var n=t[1],o=e[1],a=n|o,c=a<131,l=o==s&&8==n||o==s&&n==i&&t[7].length<=e[8]||384==o&&e[7].length<=e[8]&&8==n;if(!c&&!l)return t;1&o&&(t[2]=e[2],a|=1&n?0:4);var u=e[3];if(u){var f=t[3];t[3]=f?Io(f,u,e[4]):u,t[4]=f?fn(t[3],r):e[4]}(u=e[5])&&(f=t[5],t[5]=f?ko(f,u,e[6]):u,t[6]=f?fn(t[5],r):e[6]),(u=e[7])&&(t[7]=u),o&s&&(t[8]=null==t[8]?e[8]:mn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=a}(b,w),n=b[0],a=b[1],c=b[2],l=b[3],u=b[4],!(d=b[9]=b[9]===t?h?0:n.length:_n(b[9]-v,0))&&24&a&&(a&=-25),a&&1!=a)x=8==a||16==a?function(e,n,r){var o=Mo(e);return function s(){for(var i=arguments.length,a=y(i),c=i,l=cs(s);c--;)a[c]=arguments[c];var u=i<3&&a[0]!==l&&a[i-1]!==l?[]:fn(a,l);return(i-=u.length)<r?qo(e,n,Vo,s.placeholder,t,a,u,t,t,r-i):Ce(this&&this!==ve&&this instanceof s?o:e,this,a)}}(n,a,d):a!=o&&33!=a||u.length?Vo.apply(t,b):function(t,e,n,r){var o=1&e,s=Mo(t);return function e(){for(var i=-1,a=arguments.length,c=-1,l=r.length,u=y(l+a),f=this&&this!==ve&&this instanceof e?s:t;++c<l;)u[c]=r[c];for(;a--;)u[c++]=arguments[++i];return Ce(f,o?n:this,u)}}(n,a,c,l);else var x=function(t,e,n){var r=1&e,o=Mo(t);return function e(){return(this&&this!==ve&&this instanceof e?o:t).apply(r?n:this,arguments)}}(n,a,c);return Os((w?to:Fs)(x,b),n,a)}function Qo(e,n,r,o){return e===t||Ni(e,Ot[r])&&!Rt.call(o,r)?n:e}function ts(e,n,r,o,s,i){return ta(e)&&ta(n)&&(i.set(n,e),Ur(e,n,t,ts,i),i.delete(n)),e}function es(e){return oa(e)?t:e}function ns(e,n,r,o,s,i){var a=1&r,c=e.length,l=n.length;if(c!=l&&!(a&&l>c))return!1;var u=i.get(e),f=i.get(n);if(u&&f)return u==n&&f==e;var p=-1,d=!0,h=2&r?new qn:t;for(i.set(e,n),i.set(n,e);++p<c;){var v=e[p],g=n[p];if(o)var y=a?o(g,v,p,n,e,i):o(v,g,p,e,n,i);if(y!==t){if(y)continue;d=!1;break}if(h){if(!Pe(n,function(t,e){if(!en(h,e)&&(v===t||s(v,t,r,o,i)))return h.push(e)})){d=!1;break}}else if(v!==g&&!s(v,g,r,o,i)){d=!1;break}}return i.delete(e),i.delete(n),d}function rs(e){return js(Cs(e,t,Ws),e+'')}function os(t){return Er(t,Aa,ds)}function ss(t){return Er(t,ja,hs)}var is=Fn?function(t){return Fn.get(t)}:cc;function as(t){for(var e=t.name+'',n=An[e],r=Rt.call(An,e)?n.length:0;r--;){var o=n[r],s=o.func;if(null==s||s==t)return o.name}return e}function cs(t){return(Rt.call(Nn,'placeholder')?Nn:t).placeholder}function ls(){var t=Nn.iteratee||oc;return t=t===oc?Br:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n,r,o=t.__data__;return('string'==(r=typeof(n=e))||'number'==r||'symbol'==r||'boolean'==r?'__proto__'!==n:null===n)?o['string'==typeof e?'string':'hash']:o.map}function fs(t){for(var e=Aa(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,$s(o)]}return e}function ps(e,n){var r=function(e,n){return null==e?t:e[n]}(e,n);return Lr(r)?r:t}var ds=ye?function(t){return null==t?[]:(t=Ct(t),je(ye(t),function(e){return Xt.call(t,e)}))}:vc,hs=ye?function(t){for(var e=[];t;)Re(e,ds(t)),t=Jt(t);return e}:vc,vs=$r;function gs(t,e,n){for(var r=-1,o=(e=wo(e,t)).length,s=!1;++r<o;){var i=Ds(e[r]);if(!(s=null!=t&&n(t,i)))break;t=t[i]}return s||++r!=o?s:!!(o=null==t?0:t.length)&&Qi(o)&&ms(i,o)&&(Hi(t)||zi(t))}function ys(t){return'function'!=typeof t.constructor||Es(t)?{}:Vn(Jt(t))}function _s(t){return Hi(t)||zi(t)||!!(Zt&&t&&t[Zt])}function ms(t,e){var n=typeof t;return!!(e=null==e?c:e)&&('number'==n||'symbol'!=n&&wt.test(t))&&t>-1&&t%1==0&&t<e}function ws(t,e,n){if(!ta(n))return!1;var r=typeof e;return!!('number'==r?Gi(n)&&ms(e,n.length):'string'==r&&e in n)&&Ni(n[e],t)}function bs(t,e){if(Hi(t))return!1;var n=typeof t;return!('number'!=n&&'symbol'!=n&&'boolean'!=n&&null!=t&&!ca(t))||nt.test(t)||!et.test(t)||null!=e&&t in Ct(e)}function xs(t){var e=as(t),n=Nn[e];if('function'!=typeof n||!(e in Hn.prototype))return!1;if(t===n)return!0;var r=is(n);return!!r&&t===r[0]}(En&&vs(new En(new ArrayBuffer(1)))!=L||$n&&vs(new $n)!=S||Tn&&vs(Tn.resolve())!=C||Cn&&vs(new Cn)!=k||In&&vs(new In)!=j)&&(vs=function(e){var n=$r(e),r=n==T?e.constructor:t,o=r?Ms(r):'';if(o)switch(o){case jn:return L;case On:return S;case Ln:return C;case Bn:return k;case Rn:return j}return n});var Ss=Lt?Zi:gc;function Es(t){var e=t&&t.constructor;return t===('function'==typeof e&&e.prototype||Ot)}function $s(t){return t==t&&!ta(t)}function Ts(e,n){return function(r){return null!=r&&r[e]===n&&(n!==t||e in Ct(r))}}function Cs(e,n,r){return n=_n(n===t?e.length-1:n,0),function(){for(var t=arguments,o=-1,s=_n(t.length-n,0),i=y(s);++o<s;)i[o]=t[n+o];o=-1;for(var a=y(n+1);++o<n;)a[o]=t[o];return a[n]=r(i),Ce(e,this,a)}}function Is(t,e){return e.length<2?t:Sr(t,ro(e,0,-1))}function ks(t,e){if(('constructor'!==e||'function'!=typeof t[e])&&'__proto__'!=e)return t[e]}var Fs=Ls(to),As=de||function(t,e){return ve.setTimeout(t,e)},js=Ls(eo);function Os(t,e,n){var r=e+'';return js(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?'& ':'')+e[r],e=e.join(n>2?', ':' '),t.replace(ct,'{\n/* [wrapped with '+e+'] */\n')}(r,function(t,e){return ke(f,function(n){var r='_.'+n[0];e&n[1]&&!Oe(t,r)&&t.push(r)}),t.sort()}(function(t){var e=t.match(lt);return e?e[1].split(ut):[]}(r),n)))}function Ls(e){var n=0,r=0;return function(){var o=wn(),s=16-(o-r);if(r=o,s>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(t,arguments)}}function Bs(e,n){var r=-1,o=e.length,s=o-1;for(n=n===t?o:n;++r<n;){var i=qr(r,s),a=e[i];e[i]=e[r],e[r]=a}return e.length=n,e}var Rs=function(t){var e=Li(t,function(t){return 500===n.size&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(''),t.replace(rt,function(t,n,r,o){e.push(r?o.replace(dt,'$1'):n||t)}),e});function Ds(t){if('string'==typeof t||ca(t))return t;var e=t+'';return'0'==e&&1/t==-1/0?'-0':e}function Ms(t){if(null!=t){try{return Bt.call(t)}catch(e){}try{return t+''}catch(e){}}return''}function Ps(t){if(t instanceof Hn)return t.clone();var e=new zn(t.__wrapped__,t.__chain__);return e.__actions__=Fo(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Ns=Kr(function(t,e){return Ji(t)?fr(t,yr(e,1,Ji,!0)):[]}),Vs=Kr(function(e,n){var r=Ks(n);return Ji(r)&&(r=t),Ji(e)?fr(e,yr(n,1,Ji,!0),ls(r,2)):[]}),Us=Kr(function(e,n){var r=Ks(n);return Ji(r)&&(r=t),Ji(e)?fr(e,yr(n,1,Ji,!0),t,r):[]});function zs(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=null==n?0:ha(n);return o<0&&(o=_n(r+o,0)),Ue(t,ls(e,3),o)}function Hs(e,n,r){var o=null==e?0:e.length;if(!o)return-1;var s=o-1;return r!==t&&(s=ha(r),s=r<0?_n(o+s,0):mn(s,o-1)),Ue(e,ls(n,3),s,!0)}function Ws(t){return null!=t&&t.length?yr(t,1):[]}function Gs(e){return e&&e.length?e[0]:t}var Js=Kr(function(t){var e=Be(t,_o);return e.length&&e[0]===t[0]?kr(e):[]}),qs=Kr(function(e){var n=Ks(e),r=Be(e,_o);return n===Ks(r)?n=t:r.pop(),r.length&&r[0]===e[0]?kr(r,ls(n,2)):[]}),Xs=Kr(function(e){var n=Ks(e),r=Be(e,_o);return(n='function'==typeof n?n:t)&&r.pop(),r.length&&r[0]===e[0]?kr(r,t,n):[]});function Ks(e){var n=null==e?0:e.length;return n?e[n-1]:t}var Zs=Kr(Ys);function Ys(t,e){return t&&t.length&&e&&e.length?Gr(t,e):t}var Qs=rs(function(t,e){var n=null==t?0:t.length,r=ir(t,e);return Jr(t,Be(e,function(t){return ms(t,n)?+t:t}).sort(Co)),r});function ti(t){return null==t?t:Sn.call(t)}var ei=Kr(function(t){return uo(yr(t,1,Ji,!0))}),ni=Kr(function(e){var n=Ks(e);return Ji(n)&&(n=t),uo(yr(e,1,Ji,!0),ls(n,2))}),ri=Kr(function(e){var n=Ks(e);return n='function'==typeof n?n:t,uo(yr(e,1,Ji,!0),t,n)});function oi(t){if(!t||!t.length)return[];var e=0;return t=je(t,function(t){if(Ji(t))return e=_n(t.length,e),!0}),Ze(e,function(e){return Be(t,Je(e))})}function si(e,n){if(!e||!e.length)return[];var r=oi(e);return null==n?r:Be(r,function(e){return Ce(n,t,e)})}var ii=Kr(function(t,e){return Ji(t)?fr(t,e):[]}),ai=Kr(function(t){return go(je(t,Ji))}),ci=Kr(function(e){var n=Ks(e);return Ji(n)&&(n=t),go(je(e,Ji),ls(n,2))}),li=Kr(function(e){var n=Ks(e);return n='function'==typeof n?n:t,go(je(e,Ji),t,n)}),ui=Kr(oi),fi=Kr(function(e){var n=e.length,r=n>1?e[n-1]:t;return r='function'==typeof r?(e.pop(),r):t,si(e,r)});function pi(t){var e=Nn(t);return e.__chain__=!0,e}function di(t,e){return e(t)}var hi=rs(function(e){var n=e.length,r=n?e[0]:0,o=this.__wrapped__,s=function(t){return ir(t,e)};return!(n>1||this.__actions__.length)&&o instanceof Hn&&ms(r)?((o=o.slice(r,+r+(n?1:0))).__actions__.push({func:di,args:[s],thisArg:t}),new zn(o,this.__chain__).thru(function(e){return n&&!e.length&&e.push(t),e})):this.thru(s)}),vi=jo(function(t,e,n){Rt.call(t,n)?++t[n]:sr(t,n,1)}),gi=Po(zs),yi=Po(Hs);function _i(t,e){return(Hi(t)?ke:pr)(t,ls(e,3))}function mi(t,e){return(Hi(t)?Fe:dr)(t,ls(e,3))}var wi=jo(function(t,e,n){Rt.call(t,n)?t[n].push(e):sr(t,n,[e])}),bi=Kr(function(t,e,n){var r=-1,o='function'==typeof e,s=Gi(t)?y(t.length):[];return pr(t,function(t){s[++r]=o?Ce(e,t,n):Fr(t,e,n)}),s}),xi=jo(function(t,e,n){sr(t,n,e)});function Si(t,e){return(Hi(t)?Be:Pr)(t,ls(e,3))}var Ei=jo(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),$i=Kr(function(t,e){if(null==t)return[];var n=e.length;return n>1&&ws(t,e[0],e[1])?e=[]:n>2&&ws(e[0],e[1],e[2])&&(e=[e[0]]),Hr(t,yr(e,1),[])}),Ti=ue||function(){return ve.Date.now()};function Ci(e,n,r){return n=r?t:n,n=e&&null==n?e.length:n,Yo(e,s,t,t,t,t,n)}function Ii(n,r){var o;if('function'!=typeof r)throw new Ft(e);return n=ha(n),function(){return--n>0&&(o=r.apply(this,arguments)),n<=1&&(r=t),o}}var ki=Kr(function(t,e,n){var r=1;if(n.length){var s=fn(n,cs(ki));r|=o}return Yo(t,r,e,n,s)}),Fi=Kr(function(t,e,n){var r=3;if(n.length){var s=fn(n,cs(Fi));r|=o}return Yo(e,r,t,n,s)});function Ai(n,r,o){var s,i,a,c,l,u,f=0,p=!1,d=!1,h=!0;if('function'!=typeof n)throw new Ft(e);function v(e){var r=s,o=i;return s=i=t,f=e,c=n.apply(o,r)}function g(e){var n=e-u;return u===t||n>=r||n<0||d&&e-f>=a}function y(){var t=Ti();if(g(t))return m(t);l=As(y,function(t){var e=r-(t-u);return d?mn(e,a-(t-f)):e}(t))}function m(e){return l=t,h&&s?v(e):(s=i=t,c)}function w(){var e=Ti(),n=g(e);if(s=arguments,i=this,u=e,n){if(l===t)return function(t){return f=t,l=As(y,r),p?v(t):c}(u);if(d)return So(l),l=As(y,r),v(u)}return l===t&&(l=As(y,r)),c}return r=ga(r)||0,ta(o)&&(p=!!o.leading,a=(d='maxWait'in o)?_n(ga(o.maxWait)||0,r):a,h='trailing'in o?!!o.trailing:h),w.cancel=function(){l!==t&&So(l),f=0,s=u=i=l=t},w.flush=function(){return l===t?c:m(Ti())},w}var ji=Kr(function(t,e){return ur(t,1,e)}),Oi=Kr(function(t,e,n){return ur(t,ga(e)||0,n)});function Li(t,n){if('function'!=typeof t||null!=n&&'function'!=typeof n)throw new Ft(e);var r=function(){var e=arguments,o=n?n.apply(this,e):e[0],s=r.cache;if(s.has(o))return s.get(o);var i=t.apply(this,e);return r.cache=s.set(o,i)||s,i};return r.cache=new(Li.Cache||Jn),r}function Bi(t){if('function'!=typeof t)throw new Ft(e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Li.Cache=Jn;var Ri=bo(function(t,e){var n=(e=1==e.length&&Hi(e[0])?Be(e[0],Qe(ls())):Be(yr(e,1),Qe(ls()))).length;return Kr(function(r){for(var o=-1,s=mn(r.length,n);++o<s;)r[o]=e[o].call(this,r[o]);return Ce(t,this,r)})}),Di=Kr(function(e,n){var r=fn(n,cs(Di));return Yo(e,o,t,n,r)}),Mi=Kr(function(e,n){var r=fn(n,cs(Mi));return Yo(e,64,t,n,r)}),Pi=rs(function(e,n){return Yo(e,i,t,t,t,n)});function Ni(t,e){return t===e||t!=t&&e!=e}var Vi=Jo(Tr),Ui=Jo(function(t,e){return t>=e}),zi=Ar(function(){return arguments}())?Ar:function(t){return ea(t)&&Rt.call(t,'callee')&&!Xt.call(t,'callee')},Hi=y.isArray,Wi=be?Qe(be):function(t){return ea(t)&&$r(t)==O};function Gi(t){return null!=t&&Qi(t.length)&&!Zi(t)}function Ji(t){return ea(t)&&Gi(t)}var qi=me||gc,Xi=xe?Qe(xe):function(t){return ea(t)&&$r(t)==m};function Ki(t){if(!ea(t))return!1;var e=$r(t);return e==w||'[object DOMException]'==e||'string'==typeof t.message&&'string'==typeof t.name&&!oa(t)}function Zi(t){if(!ta(t))return!1;var e=$r(t);return e==b||e==x||'[object AsyncFunction]'==e||'[object Proxy]'==e}function Yi(t){return'number'==typeof t&&t==ha(t)}function Qi(t){return'number'==typeof t&&t>-1&&t%1==0&&t<=c}function ta(t){var e=typeof t;return null!=t&&('object'==e||'function'==e)}function ea(t){return null!=t&&'object'==typeof t}var na=Se?Qe(Se):function(t){return ea(t)&&vs(t)==S};function ra(t){return'number'==typeof t||ea(t)&&$r(t)==E}function oa(t){if(!ea(t)||$r(t)!=T)return!1;var e=Jt(t);if(null===e)return!0;var n=Rt.call(e,'constructor')&&e.constructor;return'function'==typeof n&&n instanceof n&&Bt.call(n)==Nt}var sa=Ee?Qe(Ee):function(t){return ea(t)&&$r(t)==I},ia=$e?Qe($e):function(t){return ea(t)&&vs(t)==k};function aa(t){return'string'==typeof t||!Hi(t)&&ea(t)&&$r(t)==F}function ca(t){return'symbol'==typeof t||ea(t)&&$r(t)==A}var la=Te?Qe(Te):function(t){return ea(t)&&Qi(t.length)&&!!ce[$r(t)]},ua=Jo(Mr),fa=Jo(function(t,e){return t<=e});function pa(t){if(!t)return[];if(Gi(t))return aa(t)?vn(t):Fo(t);if(Yt&&t[Yt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Yt]());var e=vs(t);return(e==S?ln:e==k?pn:Na)(t)}function da(t){return t?(t=ga(t))===a||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ha(t){var e=da(t),n=e%1;return e==e?n?e-n:e:0}function va(t){return t?ar(ha(t),0,u):0}function ga(t){if('number'==typeof t)return t;if(ca(t))return l;if(ta(t)){var e='function'==typeof t.valueOf?t.valueOf():t;t=ta(e)?e+'':e}if('string'!=typeof t)return 0===t?t:+t;t=Ye(t);var n=yt.test(t);return n||mt.test(t)?pe(t.slice(2),n?2:8):gt.test(t)?l:+t}function ya(t){return Ao(t,ja(t))}function _a(t){return null==t?'':lo(t)}var ma=Oo(function(t,e){if(Es(e)||Gi(e))Ao(e,Aa(e),t);else for(var n in e)Rt.call(e,n)&&er(t,n,e[n])}),wa=Oo(function(t,e){Ao(e,ja(e),t)}),ba=Oo(function(t,e,n,r){Ao(e,ja(e),t,r)}),xa=Oo(function(t,e,n,r){Ao(e,Aa(e),t,r)}),Sa=rs(ir),Ea=Kr(function(e,n){e=Ct(e);var r=-1,o=n.length,s=o>2?n[2]:t;for(s&&ws(n[0],n[1],s)&&(o=1);++r<o;)for(var i=n[r],a=ja(i),c=-1,l=a.length;++c<l;){var u=a[c],f=e[u];(f===t||Ni(f,Ot[u])&&!Rt.call(e,u))&&(e[u]=i[u])}return e}),$a=Kr(function(e){return e.push(t,ts),Ce(La,t,e)});function Ta(e,n,r){var o=null==e?t:Sr(e,n);return o===t?r:o}function Ca(t,e){return null!=t&&gs(t,e,Ir)}var Ia=Uo(function(t,e,n){null!=e&&'function'!=typeof e.toString&&(e=Pt.call(e)),t[e]=n},tc(rc)),ka=Uo(function(t,e,n){null!=e&&'function'!=typeof e.toString&&(e=Pt.call(e)),Rt.call(t,e)?t[e].push(n):t[e]=[n]},ls),Fa=Kr(Fr);function Aa(t){return Gi(t)?Kn(t):Rr(t)}function ja(t){return Gi(t)?Kn(t,!0):Dr(t)}var Oa=Oo(function(t,e,n){Ur(t,e,n)}),La=Oo(function(t,e,n,r){Ur(t,e,n,r)}),Ba=rs(function(t,e){var n={};if(null==t)return n;var r=!1;e=Be(e,function(e){return e=wo(e,t),r||(r=e.length>1),e}),Ao(t,ss(t),n),r&&(n=cr(n,7,es));for(var o=e.length;o--;)fo(n,e[o]);return n}),Ra=rs(function(t,e){return null==t?{}:function(t,e){return Wr(t,e,function(e,n){return Ca(t,n)})}(t,e)});function Da(t,e){if(null==t)return{};var n=Be(ss(t),function(t){return[t]});return e=ls(e),Wr(t,n,function(t,n){return e(t,n[0])})}var Ma=Zo(Aa),Pa=Zo(ja);function Na(t){return null==t?[]:tn(t,Aa(t))}var Va=Do(function(t,e,n){return e=e.toLowerCase(),t+(n?Ua(e):e)});function Ua(t){return Ka(_a(t).toLowerCase())}function za(t){return(t=_a(t))&&t.replace(bt,on).replace(ee,'')}var Ha=Do(function(t,e,n){return t+(n?'-':'')+e.toLowerCase()}),Wa=Do(function(t,e,n){return t+(n?' ':'')+e.toLowerCase()}),Ga=Ro('toLowerCase'),Ja=Do(function(t,e,n){return t+(n?'_':'')+e.toLowerCase()}),qa=Do(function(t,e,n){return t+(n?' ':'')+Ka(e)}),Xa=Do(function(t,e,n){return t+(n?' ':'')+e.toUpperCase()}),Ka=Ro('toUpperCase');function Za(e,n,r){return e=_a(e),(n=r?t:n)===t?function(t){return se.test(t)}(e)?function(t){return t.match(re)||[]}(e):function(t){return t.match(ft)||[]}(e):e.match(n)||[]}var Ya=Kr(function(e,n){try{return Ce(e,t,n)}catch(r){return Ki(r)?r:new Et(r)}}),Qa=rs(function(t,e){return ke(e,function(e){e=Ds(e),sr(t,e,ki(t[e],t))}),t});function tc(t){return function(){return t}}var ec=No(),nc=No(!0);function rc(t){return t}function oc(t){return Br('function'==typeof t?t:cr(t,1))}var sc=Kr(function(t,e){return function(n){return Fr(n,t,e)}}),ic=Kr(function(t,e){return function(n){return Fr(t,n,e)}});function ac(t,e,n){var r=Aa(e),o=xr(e,r);null!=n||ta(e)&&(o.length||!r.length)||(n=e,e=t,t=this,o=xr(e,Aa(e)));var s=!(ta(n)&&'chain'in n&&!n.chain),i=Zi(t);return ke(o,function(n){var r=e[n];t[n]=r,i&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Fo(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Re([this.value()],arguments))})}),t}function cc(){}var lc=Ho(Be),uc=Ho(Ae),fc=Ho(Pe);function pc(t){return bs(t)?Je(Ds(t)):function(t){return function(e){return Sr(e,t)}}(t)}var dc=Go(),hc=Go(!0);function vc(){return[]}function gc(){return!1}var yc,_c=zo(function(t,e){return t+e},0),mc=Xo('ceil'),wc=zo(function(t,e){return t/e},1),bc=Xo('floor'),xc=zo(function(t,e){return t*e},1),Sc=Xo('round'),Ec=zo(function(t,e){return t-e},0);return Nn.after=function(t,n){if('function'!=typeof n)throw new Ft(e);return t=ha(t),function(){if(--t<1)return n.apply(this,arguments)}},Nn.ary=Ci,Nn.assign=ma,Nn.assignIn=wa,Nn.assignInWith=ba,Nn.assignWith=xa,Nn.at=Sa,Nn.before=Ii,Nn.bind=ki,Nn.bindAll=Qa,Nn.bindKey=Fi,Nn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Hi(t)?t:[t]},Nn.chain=pi,Nn.chunk=function(e,n,r){n=(r?ws(e,n,r):n===t)?1:_n(ha(n),0);var o=null==e?0:e.length;if(!o||n<1)return[];for(var s=0,i=0,a=y(he(o/n));s<o;)a[i++]=ro(e,s,s+=n);return a},Nn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,o=[];++e<n;){var s=t[e];s&&(o[r++]=s)}return o},Nn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Re(Hi(n)?Fo(n):[n],yr(e,1))},Nn.cond=function(t){var n=null==t?0:t.length,r=ls();return t=n?Be(t,function(t){if('function'!=typeof t[1])throw new Ft(e);return[r(t[0]),t[1]]}):[],Kr(function(e){for(var r=-1;++r<n;){var o=t[r];if(Ce(o[0],this,e))return Ce(o[1],this,e)}})},Nn.conforms=function(t){return function(t){var e=Aa(t);return function(n){return lr(n,t,e)}}(cr(t,1))},Nn.constant=tc,Nn.countBy=vi,Nn.create=function(t,e){var n=Vn(t);return null==e?n:or(n,e)},Nn.curry=function e(n,r,o){var s=Yo(n,8,t,t,t,t,t,r=o?t:r);return s.placeholder=e.placeholder,s},Nn.curryRight=function e(n,r,o){var s=Yo(n,16,t,t,t,t,t,r=o?t:r);return s.placeholder=e.placeholder,s},Nn.debounce=Ai,Nn.defaults=Ea,Nn.defaultsDeep=$a,Nn.defer=ji,Nn.delay=Oi,Nn.difference=Ns,Nn.differenceBy=Vs,Nn.differenceWith=Us,Nn.drop=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,(n=r||n===t?1:ha(n))<0?0:n,o):[]},Nn.dropRight=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,0,(n=o-(n=r||n===t?1:ha(n)))<0?0:n):[]},Nn.dropRightWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!0,!0):[]},Nn.dropWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!0):[]},Nn.fill=function(e,n,r,o){var s=null==e?0:e.length;return s?(r&&'number'!=typeof r&&ws(e,n,r)&&(r=0,o=s),function(e,n,r,o){var s=e.length;for((r=ha(r))<0&&(r=-r>s?0:s+r),(o=o===t||o>s?s:ha(o))<0&&(o+=s),o=r>o?0:va(o);r<o;)e[r++]=n;return e}(e,n,r,o)):[]},Nn.filter=function(t,e){return(Hi(t)?je:gr)(t,ls(e,3))},Nn.flatMap=function(t,e){return yr(Si(t,e),1)},Nn.flatMapDeep=function(t,e){return yr(Si(t,e),a)},Nn.flatMapDepth=function(e,n,r){return r=r===t?1:ha(r),yr(Si(e,n),r)},Nn.flatten=Ws,Nn.flattenDeep=function(t){return null!=t&&t.length?yr(t,a):[]},Nn.flattenDepth=function(e,n){return null!=e&&e.length?yr(e,n=n===t?1:ha(n)):[]},Nn.flip=function(t){return Yo(t,512)},Nn.flow=ec,Nn.flowRight=nc,Nn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var o=t[e];r[o[0]]=o[1]}return r},Nn.functions=function(t){return null==t?[]:xr(t,Aa(t))},Nn.functionsIn=function(t){return null==t?[]:xr(t,ja(t))},Nn.groupBy=wi,Nn.initial=function(t){return null!=t&&t.length?ro(t,0,-1):[]},Nn.intersection=Js,Nn.intersectionBy=qs,Nn.intersectionWith=Xs,Nn.invert=Ia,Nn.invertBy=ka,Nn.invokeMap=bi,Nn.iteratee=oc,Nn.keyBy=xi,Nn.keys=Aa,Nn.keysIn=ja,Nn.map=Si,Nn.mapKeys=function(t,e){var n={};return e=ls(e,3),wr(t,function(t,r,o){sr(n,e(t,r,o),t)}),n},Nn.mapValues=function(t,e){var n={};return e=ls(e,3),wr(t,function(t,r,o){sr(n,r,e(t,r,o))}),n},Nn.matches=function(t){return Nr(cr(t,1))},Nn.matchesProperty=function(t,e){return Vr(t,cr(e,1))},Nn.memoize=Li,Nn.merge=Oa,Nn.mergeWith=La,Nn.method=sc,Nn.methodOf=ic,Nn.mixin=ac,Nn.negate=Bi,Nn.nthArg=function(t){return t=ha(t),Kr(function(e){return zr(e,t)})},Nn.omit=Ba,Nn.omitBy=function(t,e){return Da(t,Bi(ls(e)))},Nn.once=function(t){return Ii(2,t)},Nn.orderBy=function(e,n,r,o){return null==e?[]:(Hi(n)||(n=null==n?[]:[n]),Hi(r=o?t:r)||(r=null==r?[]:[r]),Hr(e,n,r))},Nn.over=lc,Nn.overArgs=Ri,Nn.overEvery=uc,Nn.overSome=fc,Nn.partial=Di,Nn.partialRight=Mi,Nn.partition=Ei,Nn.pick=Ra,Nn.pickBy=Da,Nn.property=pc,Nn.propertyOf=function(e){return function(n){return null==e?t:Sr(e,n)}},Nn.pull=Zs,Nn.pullAll=Ys,Nn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Gr(t,e,ls(n,2)):t},Nn.pullAllWith=function(e,n,r){return e&&e.length&&n&&n.length?Gr(e,n,t,r):e},Nn.pullAt=Qs,Nn.range=dc,Nn.rangeRight=hc,Nn.rearg=Pi,Nn.reject=function(t,e){return(Hi(t)?je:gr)(t,Bi(ls(e,3)))},Nn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,o=[],s=t.length;for(e=ls(e,3);++r<s;){var i=t[r];e(i,r,t)&&(n.push(i),o.push(r))}return Jr(t,o),n},Nn.rest=function(n,r){if('function'!=typeof n)throw new Ft(e);return Kr(n,r=r===t?r:ha(r))},Nn.reverse=ti,Nn.sampleSize=function(e,n,r){return n=(r?ws(e,n,r):n===t)?1:ha(n),(Hi(e)?Yn:Yr)(e,n)},Nn.set=function(t,e,n){return null==t?t:Qr(t,e,n)},Nn.setWith=function(e,n,r,o){return o='function'==typeof o?o:t,null==e?e:Qr(e,n,r,o)},Nn.shuffle=function(t){return(Hi(t)?Qn:no)(t)},Nn.slice=function(e,n,r){var o=null==e?0:e.length;return o?(r&&'number'!=typeof r&&ws(e,n,r)?(n=0,r=o):(n=null==n?0:ha(n),r=r===t?o:ha(r)),ro(e,n,r)):[]},Nn.sortBy=$i,Nn.sortedUniq=function(t){return t&&t.length?ao(t):[]},Nn.sortedUniqBy=function(t,e){return t&&t.length?ao(t,ls(e,2)):[]},Nn.split=function(e,n,r){return r&&'number'!=typeof r&&ws(e,n,r)&&(n=r=t),(r=r===t?u:r>>>0)?(e=_a(e))&&('string'==typeof n||null!=n&&!sa(n))&&!(n=lo(n))&&cn(e)?xo(vn(e),0,r):e.split(n,r):[]},Nn.spread=function(t,n){if('function'!=typeof t)throw new Ft(e);return n=null==n?0:_n(ha(n),0),Kr(function(e){var r=e[n],o=xo(e,0,n);return r&&Re(o,r),Ce(t,this,o)})},Nn.tail=function(t){var e=null==t?0:t.length;return e?ro(t,1,e):[]},Nn.take=function(e,n,r){return e&&e.length?ro(e,0,(n=r||n===t?1:ha(n))<0?0:n):[]},Nn.takeRight=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,(n=o-(n=r||n===t?1:ha(n)))<0?0:n,o):[]},Nn.takeRightWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!1,!0):[]},Nn.takeWhile=function(t,e){return t&&t.length?ho(t,ls(e,3)):[]},Nn.tap=function(t,e){return e(t),t},Nn.throttle=function(t,n,r){var o=!0,s=!0;if('function'!=typeof t)throw new Ft(e);return ta(r)&&(o='leading'in r?!!r.leading:o,s='trailing'in r?!!r.trailing:s),Ai(t,n,{leading:o,maxWait:n,trailing:s})},Nn.thru=di,Nn.toArray=pa,Nn.toPairs=Ma,Nn.toPairsIn=Pa,Nn.toPath=function(t){return Hi(t)?Be(t,Ds):ca(t)?[t]:Fo(Rs(_a(t)))},Nn.toPlainObject=ya,Nn.transform=function(t,e,n){var r=Hi(t),o=r||qi(t)||la(t);if(e=ls(e,4),null==n){var s=t&&t.constructor;n=o?r?new s:[]:ta(t)&&Zi(s)?Vn(Jt(t)):{}}return(o?ke:wr)(t,function(t,r,o){return e(n,t,r,o)}),n},Nn.unary=function(t){return Ci(t,1)},Nn.union=ei,Nn.unionBy=ni,Nn.unionWith=ri,Nn.uniq=function(t){return t&&t.length?uo(t):[]},Nn.uniqBy=function(t,e){return t&&t.length?uo(t,ls(e,2)):[]},Nn.uniqWith=function(e,n){return n='function'==typeof n?n:t,e&&e.length?uo(e,t,n):[]},Nn.unset=function(t,e){return null==t||fo(t,e)},Nn.unzip=oi,Nn.unzipWith=si,Nn.update=function(t,e,n){return null==t?t:po(t,e,mo(n))},Nn.updateWith=function(e,n,r,o){return o='function'==typeof o?o:t,null==e?e:po(e,n,mo(r),o)},Nn.values=Na,Nn.valuesIn=function(t){return null==t?[]:tn(t,ja(t))},Nn.without=ii,Nn.words=Za,Nn.wrap=function(t,e){return Di(mo(e),t)},Nn.xor=ai,Nn.xorBy=ci,Nn.xorWith=li,Nn.zip=ui,Nn.zipObject=function(t,e){return yo(t||[],e||[],er)},Nn.zipObjectDeep=function(t,e){return yo(t||[],e||[],Qr)},Nn.zipWith=fi,Nn.entries=Ma,Nn.entriesIn=Pa,Nn.extend=wa,Nn.extendWith=ba,ac(Nn,Nn),Nn.add=_c,Nn.attempt=Ya,Nn.camelCase=Va,Nn.capitalize=Ua,Nn.ceil=mc,Nn.clamp=function(e,n,r){return r===t&&(r=n,n=t),r!==t&&(r=(r=ga(r))==r?r:0),n!==t&&(n=(n=ga(n))==n?n:0),ar(ga(e),n,r)},Nn.clone=function(t){return cr(t,4)},Nn.cloneDeep=function(t){return cr(t,5)},Nn.cloneDeepWith=function(e,n){return cr(e,5,n='function'==typeof n?n:t)},Nn.cloneWith=function(e,n){return cr(e,4,n='function'==typeof n?n:t)},Nn.conformsTo=function(t,e){return null==e||lr(t,e,Aa(e))},Nn.deburr=za,Nn.defaultTo=function(t,e){return null==t||t!=t?e:t},Nn.divide=wc,Nn.endsWith=function(e,n,r){e=_a(e),n=lo(n);var o=e.length,s=r=r===t?o:ar(ha(r),0,o);return(r-=n.length)>=0&&e.slice(r,s)==n},Nn.eq=Ni,Nn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(X,sn):t},Nn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(ot,'\\$&'):t},Nn.every=function(e,n,r){var o=Hi(e)?Ae:hr;return r&&ws(e,n,r)&&(n=t),o(e,ls(n,3))},Nn.find=gi,Nn.findIndex=zs,Nn.findKey=function(t,e){return Ve(t,ls(e,3),wr)},Nn.findLast=yi,Nn.findLastIndex=Hs,Nn.findLastKey=function(t,e){return Ve(t,ls(e,3),br)},Nn.floor=bc,Nn.forEach=_i,Nn.forEachRight=mi,Nn.forIn=function(t,e){return null==t?t:_r(t,ls(e,3),ja)},Nn.forInRight=function(t,e){return null==t?t:mr(t,ls(e,3),ja)},Nn.forOwn=function(t,e){return t&&wr(t,ls(e,3))},Nn.forOwnRight=function(t,e){return t&&br(t,ls(e,3))},Nn.get=Ta,Nn.gt=Vi,Nn.gte=Ui,Nn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Nn.hasIn=Ca,Nn.head=Gs,Nn.identity=rc,Nn.includes=function(t,e,n,r){t=Gi(t)?t:Na(t),n=n&&!r?ha(n):0;var o=t.length;return n<0&&(n=_n(o+n,0)),aa(t)?n<=o&&t.indexOf(e,n)>-1:!!o&&ze(t,e,n)>-1},Nn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=null==n?0:ha(n);return o<0&&(o=_n(r+o,0)),ze(t,e,o)},Nn.inRange=function(e,n,r){return n=da(n),r===t?(r=n,n=0):r=da(r),function(t,e,n){return t>=mn(e,n)&&t<_n(e,n)}(e=ga(e),n,r)},Nn.invoke=Fa,Nn.isArguments=zi,Nn.isArray=Hi,Nn.isArrayBuffer=Wi,Nn.isArrayLike=Gi,Nn.isArrayLikeObject=Ji,Nn.isBoolean=function(t){return!0===t||!1===t||ea(t)&&$r(t)==v},Nn.isBuffer=qi,Nn.isDate=Xi,Nn.isElement=function(t){return ea(t)&&1===t.nodeType&&!oa(t)},Nn.isEmpty=function(t){if(null==t)return!0;if(Gi(t)&&(Hi(t)||'string'==typeof t||'function'==typeof t.splice||qi(t)||la(t)||zi(t)))return!t.length;var e=vs(t);if(e==S||e==k)return!t.size;if(Es(t))return!Rr(t).length;for(var n in t)if(Rt.call(t,n))return!1;return!0},Nn.isEqual=function(t,e){return jr(t,e)},Nn.isEqualWith=function(e,n,r){var o=(r='function'==typeof r?r:t)?r(e,n):t;return o===t?jr(e,n,t,r):!!o},Nn.isError=Ki,Nn.isFinite=function(t){return'number'==typeof t&&we(t)},Nn.isFunction=Zi,Nn.isInteger=Yi,Nn.isLength=Qi,Nn.isMap=na,Nn.isMatch=function(t,e){return t===e||Or(t,e,fs(e))},Nn.isMatchWith=function(e,n,r){return r='function'==typeof r?r:t,Or(e,n,fs(n),r)},Nn.isNaN=function(t){return ra(t)&&t!=+t},Nn.isNative=function(t){if(Ss(t))throw new Et('Unsupported core-js use. Try https://npms.io/search?q=ponyfill.');return Lr(t)},Nn.isNil=function(t){return null==t},Nn.isNull=function(t){return null===t},Nn.isNumber=ra,Nn.isObject=ta,Nn.isObjectLike=ea,Nn.isPlainObject=oa,Nn.isRegExp=sa,Nn.isSafeInteger=function(t){return Yi(t)&&t>=-9007199254740991&&t<=c},Nn.isSet=ia,Nn.isString=aa,Nn.isSymbol=ca,Nn.isTypedArray=la,Nn.isUndefined=function(e){return e===t},Nn.isWeakMap=function(t){return ea(t)&&vs(t)==j},Nn.isWeakSet=function(t){return ea(t)&&'[object WeakSet]'==$r(t)},Nn.join=function(t,e){return null==t?'':Ne.call(t,e)},Nn.kebabCase=Ha,Nn.last=Ks,Nn.lastIndexOf=function(e,n,r){var o=null==e?0:e.length;if(!o)return-1;var s=o;return r!==t&&(s=(s=ha(r))<0?_n(o+s,0):mn(s,o-1)),n==n?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(e,n,s):Ue(e,We,s,!0)},Nn.lowerCase=Wa,Nn.lowerFirst=Ga,Nn.lt=ua,Nn.lte=fa,Nn.max=function(e){return e&&e.length?vr(e,rc,Tr):t},Nn.maxBy=function(e,n){return e&&e.length?vr(e,ls(n,2),Tr):t},Nn.mean=function(t){return Ge(t,rc)},Nn.meanBy=function(t,e){return Ge(t,ls(e,2))},Nn.min=function(e){return e&&e.length?vr(e,rc,Mr):t},Nn.minBy=function(e,n){return e&&e.length?vr(e,ls(n,2),Mr):t},Nn.stubArray=vc,Nn.stubFalse=gc,Nn.stubObject=function(){return{}},Nn.stubString=function(){return''},Nn.stubTrue=function(){return!0},Nn.multiply=xc,Nn.nth=function(e,n){return e&&e.length?zr(e,ha(n)):t},Nn.noConflict=function(){return ve._===this&&(ve._=Vt),this},Nn.noop=cc,Nn.now=Ti,Nn.pad=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;if(!e||r>=e)return t;var o=(e-r)/2;return Wo(ge(o),n)+t+Wo(he(o),n)},Nn.padEnd=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;return e&&r<e?t+Wo(e-r,n):t},Nn.padStart=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;return e&&r<e?Wo(e-r,n)+t:t},Nn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),bn(_a(t).replace(it,''),e||0)},Nn.random=function(e,n,r){if(r&&'boolean'!=typeof r&&ws(e,n,r)&&(n=r=t),r===t&&('boolean'==typeof n?(r=n,n=t):'boolean'==typeof e&&(r=e,e=t)),e===t&&n===t?(e=0,n=1):(e=da(e),n===t?(n=e,e=0):n=da(n)),e>n){var o=e;e=n,n=o}if(r||e%1||n%1){var s=xn();return mn(e+s*(n-e+fe('1e-'+((s+'').length-1))),n)}return qr(e,n)},Nn.reduce=function(t,e,n){var r=Hi(t)?De:Xe,o=arguments.length<3;return r(t,ls(e,4),n,o,pr)},Nn.reduceRight=function(t,e,n){var r=Hi(t)?Me:Xe,o=arguments.length<3;return r(t,ls(e,4),n,o,dr)},Nn.repeat=function(e,n,r){return n=(r?ws(e,n,r):n===t)?1:ha(n),Xr(_a(e),n)},Nn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Nn.result=function(e,n,r){var o=-1,s=(n=wo(n,e)).length;for(s||(s=1,e=t);++o<s;){var i=null==e?t:e[Ds(n[o])];i===t&&(o=s,i=r),e=Zi(i)?i.call(e):i}return e},Nn.round=Sc,Nn.runInContext=p,Nn.sample=function(t){return(Hi(t)?Zn:Zr)(t)},Nn.size=function(t){if(null==t)return 0;if(Gi(t))return aa(t)?hn(t):t.length;var e=vs(t);return e==S||e==k?t.size:Rr(t).length},Nn.snakeCase=Ja,Nn.some=function(e,n,r){var o=Hi(e)?Pe:oo;return r&&ws(e,n,r)&&(n=t),o(e,ls(n,3))},Nn.sortedIndex=function(t,e){return so(t,e)},Nn.sortedIndexBy=function(t,e,n){return io(t,e,ls(n,2))},Nn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=so(t,e);if(r<n&&Ni(t[r],e))return r}return-1},Nn.sortedLastIndex=function(t,e){return so(t,e,!0)},Nn.sortedLastIndexBy=function(t,e,n){return io(t,e,ls(n,2),!0)},Nn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=so(t,e,!0)-1;if(Ni(t[n],e))return n}return-1},Nn.startCase=qa,Nn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:ar(ha(n),0,t.length),e=lo(e),t.slice(n,n+e.length)==e},Nn.subtract=Ec,Nn.sum=function(t){return t&&t.length?Ke(t,rc):0},Nn.sumBy=function(t,e){return t&&t.length?Ke(t,ls(e,2)):0},Nn.template=function(e,n,r){var o=Nn.templateSettings;r&&ws(e,n,r)&&(n=t),e=_a(e),n=ba({},n,o,Qo);var s,i,a=ba({},n.imports,o.imports,Qo),c=Aa(a),l=tn(a,c),u=0,f=n.interpolate||xt,p='__p += \'',d=It((n.escape||xt).source+'|'+f.source+'|'+(f===tt?ht:xt).source+'|'+(n.evaluate||xt).source+'|$','g'),h='//# sourceURL='+(Rt.call(n,'sourceURL')?(n.sourceURL+'').replace(/\s/g,' '):'lodash.templateSources['+ ++ae+']')+'\n';e.replace(d,function(t,n,r,o,a,c){return r||(r=o),p+=e.slice(u,c).replace(St,an),n&&(s=!0,p+='\' +\n__e('+n+') +\n\''),a&&(i=!0,p+='\';\n'+a+';\n__p += \''),r&&(p+='\' +\n((__t = ('+r+')) == null ? \'\' : __t) +\n\''),u=c+t.length,t}),p+='\';\n';var v=Rt.call(n,'variable')&&n.variable;if(v){if(pt.test(v))throw new Et('Invalid `variable` option passed into `_.template`')}else p='with (obj) {\n'+p+'\n}\n';p=(i?p.replace(W,''):p).replace(G,'$1').replace(J,'$1;'),p='function('+(v||'obj')+') {\n'+(v?'':'obj || (obj = {});\n')+'var __t, __p = \'\''+(s?', __e = _.escape':'')+(i?', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, \'\') }\n':';\n')+p+'return __p\n}';var g=Ya(function(){return $t(c,h+'return '+p).apply(t,l)});if(g.source=p,Ki(g))throw g;return g},Nn.times=function(t,e){if((t=ha(t))<1||t>c)return[];var n=u,r=mn(t,u);e=ls(e),t-=u;for(var o=Ze(r,e);++n<t;)e(n);return o},Nn.toFinite=da,Nn.toInteger=ha,Nn.toLength=va,Nn.toLower=function(t){return _a(t).toLowerCase()},Nn.toNumber=ga,Nn.toSafeInteger=function(t){return t?ar(ha(t),-9007199254740991,c):0===t?t:0},Nn.toString=_a,Nn.toUpper=function(t){return _a(t).toUpperCase()},Nn.trim=function(e,n,r){if((e=_a(e))&&(r||n===t))return Ye(e);if(!e||!(n=lo(n)))return e;var o=vn(e),s=vn(n);return xo(o,nn(o,s),rn(o,s)+1).join('')},Nn.trimEnd=function(e,n,r){if((e=_a(e))&&(r||n===t))return e.slice(0,gn(e)+1);if(!e||!(n=lo(n)))return e;var o=vn(e);return xo(o,0,rn(o,vn(n))+1).join('')},Nn.trimStart=function(e,n,r){if((e=_a(e))&&(r||n===t))return e.replace(it,'');if(!e||!(n=lo(n)))return e;var o=vn(e);return xo(o,nn(o,vn(n))).join('')},Nn.truncate=function(e,n){var r=30,o='...';if(ta(n)){var s='separator'in n?n.separator:s;r='length'in n?ha(n.length):r,o='omission'in n?lo(n.omission):o}var i=(e=_a(e)).length;if(cn(e)){var a=vn(e);i=a.length}if(r>=i)return e;var c=r-hn(o);if(c<1)return o;var l=a?xo(a,0,c).join(''):e.slice(0,c);if(s===t)return l+o;if(a&&(c+=l.length-c),sa(s)){if(e.slice(c).search(s)){var u,f=l;for(s.global||(s=It(s.source,_a(vt.exec(s))+'g')),s.lastIndex=0;u=s.exec(f);)var p=u.index;l=l.slice(0,p===t?c:p)}}else if(e.indexOf(lo(s),c)!=c){var d=l.lastIndexOf(s);d>-1&&(l=l.slice(0,d))}return l+o},Nn.unescape=function(t){return(t=_a(t))&&K.test(t)?t.replace(q,yn):t},Nn.uniqueId=function(t){var e=++Dt;return _a(t)+e},Nn.upperCase=Xa,Nn.upperFirst=Ka,Nn.each=_i,Nn.eachRight=mi,Nn.first=Gs,ac(Nn,(yc={},wr(Nn,function(t,e){Rt.call(Nn.prototype,e)||(yc[e]=t)}),yc),{chain:!1}),Nn.VERSION='4.17.21',ke(['bind','bindKey','curry','curryRight','partial','partialRight'],function(t){Nn[t].placeholder=Nn}),ke(['drop','take'],function(e,n){Hn.prototype[e]=function(r){r=r===t?1:_n(ha(r),0);var o=this.__filtered__&&!n?new Hn(this):this.clone();return o.__filtered__?o.__takeCount__=mn(r,o.__takeCount__):o.__views__.push({size:mn(r,u),type:e+(o.__dir__<0?'Right':'')}),o},Hn.prototype[e+'Right']=function(t){return this.reverse()[e](t).reverse()}}),ke(['filter','map','takeWhile'],function(t,e){var n=e+1,r=1==n||3==n;Hn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:ls(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),ke(['head','last'],function(t,e){var n='take'+(e?'Right':'');Hn.prototype[t]=function(){return this[n](1).value()[0]}}),ke(['initial','tail'],function(t,e){var n='drop'+(e?'':'Right');Hn.prototype[t]=function(){return this.__filtered__?new Hn(this):this[n](1)}}),Hn.prototype.compact=function(){return this.filter(rc)},Hn.prototype.find=function(t){return this.filter(t).head()},Hn.prototype.findLast=function(t){return this.reverse().find(t)},Hn.prototype.invokeMap=Kr(function(t,e){return'function'==typeof t?new Hn(this):this.map(function(n){return Fr(n,t,e)})}),Hn.prototype.reject=function(t){return this.filter(Bi(ls(t)))},Hn.prototype.slice=function(e,n){e=ha(e);var r=this;return r.__filtered__&&(e>0||n<0)?new Hn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(n=ha(n))<0?r.dropRight(-n):r.take(n-e)),r)},Hn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Hn.prototype.toArray=function(){return this.take(u)},wr(Hn.prototype,function(e,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),o=/^(?:head|last)$/.test(n),s=Nn[o?'take'+('last'==n?'Right':''):n],i=o||/^find/.test(n);s&&(Nn.prototype[n]=function(){var n=this.__wrapped__,a=o?[1]:arguments,c=n instanceof Hn,l=a[0],u=c||Hi(n),f=function(t){var e=s.apply(Nn,Re([t],a));return o&&p?e[0]:e};u&&r&&'function'==typeof l&&1!=l.length&&(c=u=!1);var p=this.__chain__,d=!!this.__actions__.length,h=i&&!p,v=c&&!d;if(!i&&u){n=v?n:new Hn(this);var g=e.apply(n,a);return g.__actions__.push({func:di,args:[f],thisArg:t}),new zn(g,p)}return h&&v?e.apply(this,a):(g=this.thru(f),h?o?g.value()[0]:g.value():g)})}),ke(['pop','push','shift','sort','splice','unshift'],function(t){var e=At[t],n=/^(?:push|sort|unshift)$/.test(t)?'tap':'thru',r=/^(?:pop|shift)$/.test(t);Nn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var o=this.value();return e.apply(Hi(o)?o:[],t)}return this[n](function(n){return e.apply(Hi(n)?n:[],t)})}}),wr(Hn.prototype,function(t,e){var n=Nn[e];if(n){var r=n.name+'';Rt.call(An,r)||(An[r]=[]),An[r].push({name:e,func:n})}}),An[Vo(t,2).name]=[{name:'wrapper',func:t}],Hn.prototype.clone=function(){var t=new Hn(this.__wrapped__);return t.__actions__=Fo(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Fo(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Fo(this.__views__),t},Hn.prototype.reverse=function(){if(this.__filtered__){var t=new Hn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Hn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Hi(t),r=e<0,o=n?t.length:0,s=function(t,e,n){for(var r=-1,o=n.length;++r<o;){var s=n[r],i=s.size;switch(s.type){case'drop':t+=i;break;case'dropRight':e-=i;break;case'take':e=mn(e,t+i);break;case'takeRight':t=_n(t,e-i)}}return{start:t,end:e}}(0,o,this.__views__),i=s.start,a=s.end,c=a-i,l=r?a:i-1,u=this.__iteratees__,f=u.length,p=0,d=mn(c,this.__takeCount__);if(!n||!r&&o==c&&d==c)return vo(t,this.__actions__);var h=[];t:for(;c--&&p<d;){for(var v=-1,g=t[l+=e];++v<f;){var y=u[v],m=y.iteratee,w=y.type,b=m(g);if(2==w)g=b;else if(!b){if(1==w)continue t;break t}}h[p++]=g}return h},Nn.prototype.at=hi,Nn.prototype.chain=function(){return pi(this)},Nn.prototype.commit=function(){return new zn(this.value(),this.__chain__)},Nn.prototype.next=function(){this.__values__===t&&(this.__values__=pa(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?t:this.__values__[this.__index__++]}},Nn.prototype.plant=function(e){for(var n,r=this;r instanceof Un;){var o=Ps(r);o.__index__=0,o.__values__=t,n?s.__wrapped__=o:n=o;var s=o;r=r.__wrapped__}return s.__wrapped__=e,n},Nn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Hn){var n=e;return this.__actions__.length&&(n=new Hn(this)),(n=n.reverse()).__actions__.push({func:di,args:[ti],thisArg:t}),new zn(n,this.__chain__)}return this.thru(ti)},Nn.prototype.toJSON=Nn.prototype.valueOf=Nn.prototype.value=function(){return vo(this.__wrapped__,this.__actions__)},Nn.prototype.first=Nn.prototype.head,Yt&&(Nn.prototype[Yt]=function(){return this}),Nn}();ye?((ye.exports=_)._=_,ge._=_):ve._=_}.call(v.exports)),v.exports);const w=d(m),b=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,x=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,S=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function E(t,e){if(!('__proto__'===t||'constructor'===t&&e&&'object'==typeof e&&'prototype'in e))return e;!function(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}(t)}function T(t,e={}){if('string'!=typeof t)return t;if('"'===t[0]&&'"'===t[t.length-1]&&-1===t.indexOf('\\'))return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case'true':return!0;case'false':return!1;case'undefined':return;case'null':return null;case'nan':return Number.NaN;case'infinity':return Number.POSITIVE_INFINITY;case'-infinity':return Number.NEGATIVE_INFINITY}if(!S.test(t)){if(e.strict)throw new SyntaxError('[destr] Invalid JSON');return t}try{if(b.test(t)||x.test(t)){if(e.strict)throw new Error('[destr] Possible prototype pollution');return JSON.parse(t,E)}return JSON.parse(t)}catch(L){if(e.strict)throw L;return t}}function C(t,e={}){return T(t,{...e,strict:!0})}function I(t={}){const{container:e,containerId:n,initialValue:r,readOnly:o=!1,onChange:s,onFallback:i,onReady:a,defaultMode:c=null}=t;let l=w(e,n),u=null,p=null,d=!1,h=b(r??{}),v=null,g=!1;let y=localStorage.getItem('varSystemEditorMode')||c||'text';function w(t,e){return t instanceof HTMLElement?t:'string'==typeof t?document.getElementById(t):'string'==typeof e?document.getElementById(e):null}function b(t){if(null==t)return t;if('function'==typeof structuredClone)try{return structuredClone(t)}catch(e){return JSON.parse(JSON.stringify(t))}return JSON.parse(JSON.stringify(t))}function x(t,{silent:e=!1}={}){const n=null==t?{}:t;if(h=b(n),d&&(u||p)){e&&(g=!0);try{const t=u||p;t?.set({json:b(n)})}catch(L){console.error('[VariableBlockEditor] 设置编辑内容失败',L)}e&&(g=!1)}else v=b(n)}const S={ensureReady:async function(){if(u)return u;if(l=l||w(e,n),!l)return null;try{let t=function(t,e,n){g||(void 0===t?.text?void 0!==t?.json&&(h=b(t.json),'function'==typeof s&&s(t,e,n)):u?.validate&&void 0===u.validate()&&(h=b(T(t.text)),'function'==typeof s&&s({json:h,text:t.text},e,n)))};const e=m.debounce(t,300);if(u=f({target:l,props:{content:{json:h??{}},mode:y,readOnly:o,language:'zh',parser:{parse:C,stringify:JSON.stringify},onChangeMode:t=>{y=t,localStorage.setItem('varSystemEditorMode',t)},onChange:(n,r,o)=>{'text'===y?e(n,r,o):t(n,r,o)}}}),d=!0,!u||'function'!=typeof u.set)throw new Error('JSON 编辑器实例缺少 set 方法');return u.isFallback=!1,null!==v&&(x(v,{silent:!0}),v=null),u}catch(L){return console.error('[VariableBlockEditor] 初始化 JSON 编辑器失败',L),function(){if(l=l||w(e,n),!l)return null;if(p)return p;l.innerHTML='',l.style.display='flex',l.style.flexDirection='column',l.style.alignItems='stretch';const r=document.createElement('div');r.style.fontSize='12px',r.style.padding='6px',r.style.background='rgba(255, 255, 255, 0.05)',r.style.borderBottom='1px solid var(--SmartThemeBorderColor, #333)',r.textContent='JSON 编辑器资源加载失败,已降级为纯文本模式。';const a=document.createElement('textarea');a.style.width='100%',a.style.height='calc(100% - 32px)',a.style.minHeight='220px',a.style.background='transparent',a.style.color='inherit',a.style.border='none',a.style.padding='10px',a.style.resize='vertical',a.style.fontFamily='var(--monospaceFont, monospace)',a.style.fontSize='13px',a.style.lineHeight='1.4',a.style.borderRadius='0',a.readOnly=Boolean(o),l.appendChild(r),l.appendChild(a);const c=()=>{if(g)return;let e;const n=[];if(0===a.value.trim().length)e={};else try{e=JSON.parse(a.value)}catch(t){n.push({message:t instanceof Error?t.message:String(t)})}const r=n.length>0?{json:void 0}:{json:e};h=b(r?.json??h??{}),'function'==typeof s&&s(r,null,{contentErrors:n})};a.addEventListener('input',c),p={isFallback:!0,set({json:t}){g=!0;try{const e=null==t?{}:t;a.value=JSON.stringify(e,null,2)}catch(e){a.value='{}'}g=!1},get(){try{return{json:a.value.trim().length?JSON.parse(a.value):{}}}catch(t){return{json:void 0}}},destroy(){a.removeEventListener('input',c),l.innerHTML=''}},d=!0;const u=null!==v?v:h??{};p.set({json:u}),v=null,'function'==typeof i&&i();return p}()}},setValue:x,getValue:function(){const t=u||p;if(!t)return b(h??{});try{const e=t.get();if(e&&'object'==typeof e&&'json'in e&&void 0!==e.json)return b(e.json)}catch(L){console.error('[VariableBlockEditor] 读取编辑内容失败',L)}return b(h??{})},set:function(t){const e=u||p;if(e&&'function'==typeof e.set){const n={json:t?.json??{}};return void e.set(n)}void 0!==t?.json&&x(t.json)},get:function(){const t=u||p;if(t&&'function'==typeof t.get){const e=t.get();if(e&&'object'==typeof e&&'text'in e&&void 0!==e.text&&(!('json'in e)||void 0===e.json)){if(u?.validate&&'function'==typeof u.validate){if(void 0===u.validate())return{json:T(e.text),text:e.text}}return e}return e}return{json:b(h??{})}},setMode:function(t){u&&'function'==typeof u.updateProps?(localStorage.setItem('varSystemEditorMode',t),u.updateProps({mode:t})):console.warn('[VariableBlockEditor] 编辑器未初始化或不支持 updateProps')},getMode:function(){return localStorage.getItem('varSystemEditorMode')},destroy:function(){if(d){try{u?.destroy?.(),p?.destroy?.()}catch(L){console.error('[VariableBlockEditor] 销毁编辑器失败',L)}u=null,p=null,d=!1,l&&(l.innerHTML=''),l=null}},isFallback:function(){return Boolean(p)&&!u},setContainer:function(t){l=w(t,n)}};return'function'==typeof a&&S.ensureReady().then(()=>{a(S)}),S}const k={},F=function(t,e,n){let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName('link');const t=document.querySelector('meta[property=csp-nonce]'),n=t?.nonce||t?.getAttribute('nonce');o=e.map(t=>{if((t=function(t){return'/'+t}(t))in k)return;k[t]=!0;const e=t.endsWith('.css'),r=e?'[rel="stylesheet"]':'';if(document.querySelector(`link[href="${t}"]${r}`))return;const o=document.createElement('link');return o.rel=e?'stylesheet':'modulepreload',e||(o.as='script'),o.crossOrigin='',o.href=t,n&&o.setAttribute('nonce',n),document.head.appendChild(o),e?new Promise((e,n)=>{o.addEventListener('load',e),o.addEventListener('error',()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}),r=Promise.all(o.map(t=>Promise.resolve(t).then(t=>({status:'fulfilled',value:t}),t=>({status:'rejected',reason:t}))))}var o;function s(t){const e=new Event('vite:preloadError',{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then(e=>{for(const t of e||[])'rejected'===t.status&&s(t.reason);return t().catch(s)})},A='[ST-VarSystemExtension]',j=(...t)=>console.log(A,...t),O=(...t)=>console.warn(A,...t),L=(...t)=>console.error(A,...t),B='[ST-VarSystemExtension]';const R=new class{constructor(){this.safeGlobals={_:window._,Object:Object,Array:Array,String:String,Number:Number,Boolean:Boolean,Math:Math,Date:Date,JSON:JSON,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,console:{log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)}}}compileExecutor(t){try{const e=['snapshot','args','context',...Object.keys(this.safeGlobals)];return new Function(...e,t)}catch(e){return L(`${B} 编译函数失败:`,e),null}}executeFunction(t,e,n=[],r={}){try{const o=this.compileExecutor(t.executor);if(!o)return{success:!1,snapshot:e,error:'函数编译失败'};const s=structuredClone(e),i=o(...[s,n,r,...Object.values(this.safeGlobals)]);return null==i?(O(`${B} 函数 ${t.name} 未返回快照，使用原快照`),{success:!0,snapshot:s}):{success:!0,snapshot:i}}catch(o){return L(`${B} 执行函数 ${t.name} 失败:`,o),{success:!1,snapshot:e,error:o.message||String(o)}}}executeAll(t,e,n,r){let o=JSON.parse(JSON.stringify(t));const s=[];j(`${B} 执行 ${n.before.length} 个前置被动函数`);for(const i of n.before){const t=this.executeFunction(i,o,[],r);t.success?o=t.snapshot:s.push({functionName:i.name,error:t.error||'未知错误'})}j(`${B} 执行 ${e.length} 个主动函数调用`);for(const i of e){const t=this.executeFunction(i.functionDef,o,i.args,r);t.success?o=t.snapshot:s.push({functionName:i.functionDef.name,error:t.error||'未知错误'})}j(`${B} 执行 ${n.after.length} 个后置被动函数`);for(const i of n.after){const t=this.executeFunction(i,o,[],r);t.success?o=t.snapshot:s.push({functionName:i.name,error:t.error||'未知错误'})}return s.length>0&&(O(`${B} 有 ${s.length} 个函数调用失败:`,s),window.toastr&&window.toastr.warning(`本次解析有 ${s.length} 个函数调用失败，请检查控制台日志`,'变量系统')),{snapshot:o,errors:s}}};async function D(t,e){const{functionRegistry:n}=await F(async()=>{const{functionRegistry:t}=await Promise.resolve().then(()=>V);return{functionRegistry:t}},void 0),r=n.getPassiveFunctions(),o={timestamp:Date.now()};return R.executeAll(e,t,r,o).snapshot}const M='[ST-VarSystemExtension]';class P{constructor(){this.globalFunctions=new Map,this.localFunctions=new Map}loadGlobalFunctions(t){if(this.globalFunctions.clear(),Array.isArray(t)){for(const n of t)if(this.validateFunction(n)){if('active'===n.type&&n.pattern&&!n._compiledRegex)try{n._compiledRegex=new RegExp(n.pattern,'g')}catch(e){O(`${M} 预编译正则失败:`,n.name,e)}this.globalFunctions.set(n.id,n)}else O(`${M} 跳过无效的全局函数:`,n);j(`${M} 已加载 ${this.globalFunctions.size} 个全局函数`)}else O(`${M} 全局函数库格式错误，应为数组`)}loadLocalFunctions(t){if(this.localFunctions.clear(),Array.isArray(t)){for(const n of t)if(this.validateFunction(n)){if('active'===n.type&&n.pattern&&!n._compiledRegex)try{n._compiledRegex=new RegExp(n.pattern,'g')}catch(e){O(`${M} 预编译正则失败:`,n.name,e)}this.localFunctions.set(n.id,n)}else O(`${M} 跳过无效的本地函数:`,n);j(`${M} 已加载 ${this.localFunctions.size} 个本地函数`)}}validateFunction(t){if(!t||'object'!=typeof t)return!1;if(!t.id||'string'!=typeof t.id)return!1;if(!t.name||'string'!=typeof t.name)return!1;if(!['active','passive'].includes(t.type))return!1;if('boolean'!=typeof t.enabled)return!1;if('number'!=typeof t.order)return!1;if(!t.executor||'string'!=typeof t.executor)return!1;if('active'===t.type){if(!t.pattern||'string'!=typeof t.pattern)return!1;try{new RegExp(t.pattern)}catch(e){return L(`${M} 函数 ${t.name} 的正则表达式无效:`,e),!1}}return!('passive'===t.type&&!['before_active','after_active'].includes(t.timing))}getEnabledFunctions(){const t=new Map;for(const[e,n]of this.globalFunctions)n.enabled&&t.set(e,n);for(const[e,n]of this.localFunctions)n.enabled&&t.set(e,n);return Array.from(t.values())}getActiveFunctions(){return this.getEnabledFunctions().filter(t=>'active'===t.type).sort((t,e)=>t.order-e.order)}getPassiveFunctions(){const t=this.getEnabledFunctions().filter(t=>'passive'===t.type);return{before:t.filter(t=>'before_active'===t.timing).sort((t,e)=>t.order-e.order),after:t.filter(t=>'after_active'===t.timing).sort((t,e)=>t.order-e.order)}}parseFunctionCalls(t){const e=this.getActiveFunctions(),n=[];for(const o of e)try{const e=o._compiledRegex||new RegExp(o.pattern,'g');let r=e.exec(t);for(;null!==r;)n.push({functionDef:o,args:r.slice(1),index:r.index,fullMatch:r[0]}),r=e.exec(t)}catch(r){L(`${M} 函数 ${o.name} 匹配失败:`,r)}return n.sort((t,e)=>t.index-e.index),j(`${M} 从消息中解析到 ${n.length} 个函数调用`),n}getFunction(t){return this.localFunctions.get(t)||this.globalFunctions.get(t)||null}upsertGlobalFunction(t){if(!this.validateFunction(t))throw new Error('函数定义无效');const e=this.globalFunctions.get(t.id);e&&t.builtin&&e.builtin&&(t={...t,enabled:e.enabled}),this.globalFunctions.set(t.id,t)}upsertLocalFunction(t){if(!this.validateFunction(t))throw new Error('函数定义无效');const e=this.localFunctions.get(t.id);e&&t.builtin&&e.builtin&&(t={...t,enabled:e.enabled}),this.localFunctions.set(t.id,t)}deleteFunction(t,e){'global'===e?this.globalFunctions.delete(t):'local'===e&&this.localFunctions.delete(t)}exportGlobalFunctions(){return Array.from(this.globalFunctions.values())}exportLocalFunctions(){return Array.from(this.localFunctions.values())}}const N=new P,V=Object.freeze(Object.defineProperty({__proto__:null,FunctionRegistry:P,functionRegistry:N},Symbol.toStringTag,{value:'Module'}));function U(t){return!!t&&(!1===t.is_user||'assistant'===t.role)}function H(t){return t?t.swipe_id??0:0}const W='st_var_system_snapshot_id';function G(t){if(!t)return null;const e=H(t);if(!Array.isArray(t.swipes_info))return null;const n=t.swipes_info[e];if(!n)return null;const r=n[W];return'string'==typeof r?r:null}async function J(t){if(!t)return console.error('[ST-VarSystemExtension] loadSnapshot: identifier 为空'),null;try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`,{method:'GET',headers:{'Content-Type':'application/json'}});if(!e.ok){if(404===e.status)return console.warn(`[ST-VarSystemExtension] 快照不存在: ${t}`),null;throw new Error(`HTTP ${e.status}: ${e.statusText}`)}return await e.json()}catch(L){return console.error(`[ST-VarSystemExtension] 加载快照失败: ${t}`,L),null}}async function q(e,n,r){try{const s=t(),i=s.getCurrentChatId?.()||s.chatId;if(!i)return console.warn('[ST-VarSystemExtension] saveSnapshotToPlugin: 无法获取聊天文件名'),null;const a=s.chat;if(!a||e>=a.length)return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 消息 ID 无效',{messageId:e,chatLength:a?.length}),null;const c=a[e];if(!c)return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 消息不存在',e),null;const l='undefined'!=typeof crypto&&'function'==typeof crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substring(2,15)}`,u=await async function(t){const{chatFile:e,messageId:n,payload:r,identifier:s}=t;if(!e||void 0===n||!r)return console.error('[ST-VarSystemExtension] saveSnapshot: 缺少必要参数',t),null;try{const t=await fetch('/api/plugins/var-manager/var-manager/snapshots',{method:'POST',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({chatFile:e,messageId:String(n),payload:r,identifier:s})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(L){return console.error('[ST-VarSystemExtension] 保存快照失败',t,L),null}}({chatFile:i,messageId:e,payload:r,identifier:l});if(!u)return console.warn('[ST-VarSystemExtension] saveSnapshotToPlugin: 插件保存失败（插件可能不可用）'),null;if(!function(t,e,n=null){if(!t||'string'!=typeof e)return!1;const r=null!==n?n:H(t);return Array.isArray(t.swipes_info)||(t.swipes_info=[]),t.swipes_info[r]||(t.swipes_info[r]={}),t.swipes_info[r][W]=e,!0}(c,l,n))return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 写入快照标识符失败',{messageId:e,swipeId:n}),null;const f=null!==n?n:H(c);return console.log(`[ST-VarSystemExtension] 快照已保存: 消息 #${e}, swipe=${f}, ID=${l}`),l}catch(L){return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin 失败:',L),null}}const X='[ST-VarSystemExtension/variableInjector]';async function K(t){if(t&&'object'==typeof t)if('undefined'!=typeof window&&window.TavernHelper&&'function'==typeof window.TavernHelper.updateVariablesWith)try{await window.TavernHelper.updateVariablesWith(e=>(e.vs_stat_data=t,e),{type:'chat'}),console.log(X,'快照已注入到 vs_stat_data 变量')}catch(L){console.error(X,'注入快照变量时发生错误:',L)}else console.error(X,'酒馆助手 (JS-Slash-Runner) 未安装或 API 不可用。','变量系统依赖酒馆助手提供的 updateVariablesWith API。','请安装扩展: https://github.com/ShinoKana/JS-Slash-Runner');else console.warn(X,'快照数据无效，跳过注入:',t)}const Z='[ST-VarSystemExtension/statusPlaceholder]',Y='<VarSystemStatusPlaceholder/>';const Q='[ST-VarSystemExtension/processor]';function tt(){try{const e=t(),n=e.characters[e.characterId];if(!n?.data?.extensions?.st_var_system)return console.log(Q,'角色未配置变量模板'),null;const{enabled:r,templateBody:o}=n.data.extensions.st_var_system;return r?o&&'object'==typeof o?(console.log(Q,'使用角色模板作为初始快照:',Object.keys(o)),structuredClone(o)):(console.warn(Q,'角色模板格式无效:',o),null):(console.log(Q,'角色变量模板未启用'),null)}catch(L){return console.error(Q,'读取角色模板时发生错误:',L),null}}async function et(t){try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`);if(404===e.status)return console.warn(Q,`快照不存在: ${t}`),null;if(!e.ok)return console.error(Q,`读取快照失败 (${e.status}): ${t}`),null;return(await e.json()).payload}catch(L){return console.error(Q,'从插件读取快照时发生错误:',L),null}}async function nt(e,n=null){console.log(Q,`开始处理消息 #${e}, swipe=${n??'current'}`);const r=t().chat;if(!r||0===r.length)return console.warn(Q,'当前无聊天记录'),null;const o=await async function(e,n=null){const r=t().chat;if(!r||e>=r.length)return console.error(Q,'checkExistingSnapshot: 消息 ID 无效',{messageId:e,chatLength:r?.length}),null;const o=r[e];if(!o)return console.error(Q,'checkExistingSnapshot: 消息不存在',e),null;const s=G(o);if(!s)return null;console.log(Q,`消息 #${e} swipe=${n??'current'} 已有快照: ${s}`);const i=await et(s);return i?{snapshotId:s,snapshot:i}:(console.warn(Q,`快照 ID 存在但无法从插件读取，将重新生成: ${s}`),null)}(e,n);if(o?.snapshot)return await K(o.snapshot),console.log(Q,'消息已有快照，直接注入'),o.snapshot;const s=await async function(t,e){if(!Array.isArray(e)||t<0||t>=e.length)return console.error('[ST-VarSystemExtension] findSnapshotAnchor: 参数无效',{startMessageId:t,chatLength:e?.length}),null;for(let n=t;n>=0;n--){const t=e[n];if(!U(t))continue;const r=G(t);if(!r)continue;console.log(`[ST-VarSystemExtension] 找到快照锚点: 第 ${n} 层, ID: ${r}`);const o=await J(r);if(o)return{anchorMessageId:n,snapshotId:r,snapshot:o.payload};console.warn(`[ST-VarSystemExtension] 快照标识符存在但数据丢失: ${r}, 将清除该标识符`)}return console.log('[ST-VarSystemExtension] 未找到快照锚点,需要使用角色模板'),null}(e,r);let i,a;s?(console.log(Q,`找到快照锚点: 消息 #${s.anchorMessageId}, ID: ${s.snapshotId}`),i=await et(s.snapshotId),i?a=s.anchorMessageId+1:(console.warn(Q,`锚点快照读取失败，将从角色模板重新开始: ${s.snapshotId}`),i=tt()||{},a=0)):(console.log(Q,'未找到快照锚点，使用角色模板'),i=tt(),i||(console.warn(Q,'无角色模板且无快照锚点，使用空快照'),i={}),a=0);const c=function(t,e,n){if(!Array.isArray(n))return console.error('[ST-VarSystemExtension] getAIMessageRange: chat 不是数组'),[];if(t<0||e>=n.length||t>e)return console.error('[ST-VarSystemExtension] getAIMessageRange: 范围无效',{startId:t,endId:e,chatLength:n.length}),[];const r=[];for(let o=t;o<=e;o++){const t=n[o];if(!U(t))continue;const e=t.swipe_id??0,s=Array.isArray(t.swipes)?t.swipes[e]:t.mes||'';r.push({messageId:o,message:t,content:s})}return r}(a,e,r);if(0===c.length)return console.log(Q,'无需处理的 AI 消息，直接使用基础快照'),await K(i),i;console.log(Q,`需要处理 ${c.length} 条 AI 消息`);let l=structuredClone(i);for(let t=0;t<c.length;t++){const e=c[t],r=t===c.length-1;console.log(Q,`处理第 ${t+1}/${c.length} 层: 消息 #${e.messageId}`);const o=e.content||e.mes||'',s=N.parseFunctionCalls(o);if(s.length>0){console.log(Q,`消息 #${e.messageId} 解析到 ${s.length} 个函数调用`);try{l=await D(s,l),console.log(Q,`消息 #${e.messageId} 函数执行完成`)}catch(L){console.error(Q,`消息 #${e.messageId} 执行函数时发生错误:`,L)}}else console.log(Q,`消息 #${e.messageId} 无函数调用，快照不变`);const i=r?n:e.message?.swipe_id??null,a=await q(e.messageId,i,l);a?console.log(Q,`消息 #${e.messageId} 快照已保存，ID: ${a}`):console.warn(Q,`消息 #${e.messageId} 保存快照到插件失败（插件可能不可用）`)}return await K(l),console.log(Q,'处理完成，已注入快照变量'),await async function(t){try{const e=window.TavernHelper.getChatMessages(t);if(!e||0===e.length)return console.warn(Z,`消息 #${t} 不存在`),!1;const n=e[0];if('user'===n.role)return console.log(Z,`消息 #${t} 是用户消息，跳过添加占位符`),!1;if(n.message.includes(Y))return console.log(Z,`消息 #${t} 已包含占位符`),!1;const r=n.message+`\n\n${Y}`;return await window.TavernHelper.setChatMessages([{message_id:t,message:r}],{refresh:'affected'}),console.log(Z,`已为消息 #${t} 添加状态栏占位符`),!0}catch(L){return console.error(Z,'添加占位符时发生错误:',L),!1}}(e),l}async function rt(e){const n=t().chat;if(!n||0===n.length)return void console.warn(Q,'当前无聊天记录，无法重新处理');const r=n.length-1;console.log(Q,`重新处理消息 #${e} 到 #${r}`);for(let t=e;t<=r;t++){const e=n[t];!1!==e.is_user&&'assistant'!==e.role||await nt(t)}console.log(Q,'重新处理完成')}const ot='[ST-VarSystemExtension/listeners]';let st=null;function it(){try{const e=t(),n=e.characters?.[e.characterId];return!0===n?.data?.extensions?.st_var_system?.enabled}catch(L){return console.error(ot,'检查启用状态时发生错误:',L),!1}}async function at(t){if(console.log(ot,`MESSAGE_RECEIVED: 消息 #${t}`),it())try{await nt(t);try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(ot,'刷新楼层快照列表失败:',e)}}catch(L){console.error(ot,'MESSAGE_RECEIVED 处理失败:',L)}else{console.log(ot,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(ot,'刷新楼层快照列表失败:',e)}}}async function ct(e){if(console.log(ot,`MESSAGE_SWIPED: 消息 #${e}`),it())try{const r=t().chat[e],o=r?.swipe_id??null;console.log(ot,`当前 swipe ID: ${o}`),await nt(e,o);try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}}catch(L){console.error(ot,'MESSAGE_SWIPED 处理失败:',L)}else{console.log(ot,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}}}async function lt(e){console.log(ot,`CHAT_CHANGED: ${e}`);try{if(!it()){console.log(ot,'新角色未启用变量系统');try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}return}const e=t().chat;if(!e||0===e.length)return void console.log(ot,'新聊天无消息');for(let t=e.length-1;t>=0;t--){const r=e[t];if(!1===r.is_user||'assistant'===r.role){console.log(ot,`处理最后一条 AI 消息: #${t}`),await nt(t);try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}break}}}catch(L){console.error(ot,'CHAT_CHANGED 处理失败:',L)}}async function ut(e){if(console.log(ot,`MESSAGE_DELETED: 消息 #${e}`),it())try{const r=t().chat;if(!r||0===r.length)return void console.log(ot,'聊天已清空，无需重新处理');console.log(ot,`从消息 #${e} 开始重新处理`),await rt(e);try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}}catch(L){console.error(ot,'MESSAGE_DELETED 处理失败:',L)}else{console.log(ot,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await F(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>jt);return{loadFloorList:t}},void 0);await t()}catch(n){console.warn(ot,'刷新楼层快照列表失败:',n)}}}async function ft(t){console.log(ot,`CHAT_DELETED: ${t}`);try{if(!t)return void console.warn(ot,'聊天文件名为空，无法删除快照');const e=await async function(){if(window.token||globalThis.token)return window.token||globalThis.token;if(st)return st;try{const t=await fetch('/csrf-token');if(t.ok){const e=await t.json();return st=e.token,st}}catch(L){console.error(ot,'获取 CSRF token 失败:',L)}return null}();if(!e)return void console.warn(ot,'无法获取 CSRF Token，跳过插件删除');const n=`/api/plugins/var-manager/var-manager/snapshots/by-chat/${encodeURIComponent(t)}`,r=await fetch(n,{method:'DELETE',headers:{'X-CSRF-Token':e}});if(404===r.status)return void console.log(ot,'插件不可用或快照不存在，跳过数据库清理');if(!r.ok)return void console.error(ot,`删除聊天快照失败 (${r.status}): ${t}`);const o=await r.json();console.log(ot,`已删除聊天 "${t}" 的 ${o.deletedCount??0} 条快照`)}catch(L){console.error(ot,'CHAT_DELETED 处理失败:',L)}}class pt{$searchInput;$clearBtn;$typeFilter;$statusFilter;$resultsInfo=null;currentFilters={searchTerm:'',type:'',status:''};onFilterChange;constructor(t){this.$searchInput=$('#var-system-function-search'),this.$clearBtn=$('#var-system-clear-search'),this.$typeFilter=$('#var-system-type-filter'),this.$statusFilter=$('#var-system-status-filter'),this.onFilterChange=t,this.bindEvents()}bindEvents(){this.$searchInput.on('input',()=>{const t=this.$searchInput.val();this.currentFilters.searchTerm=t.trim().toLowerCase(),this.updateClearButton(),this.applyFilters()}),this.$clearBtn.on('click',()=>{this.$searchInput.val(''),this.currentFilters.searchTerm='',this.updateClearButton(),this.applyFilters(),this.$searchInput.focus()}),this.$typeFilter.on('change',()=>{this.currentFilters.type=this.$typeFilter.val(),this.applyFilters()}),this.$statusFilter.on('change',()=>{this.currentFilters.status=this.$statusFilter.val(),this.applyFilters()})}updateClearButton(){this.currentFilters.searchTerm?this.$clearBtn.fadeIn(150):this.$clearBtn.fadeOut(150)}applyFilters(){this.onFilterChange(this.currentFilters)}getFilters(){return{...this.currentFilters}}showResultsInfo(t,e){if(!(this.currentFilters.searchTerm||this.currentFilters.type||this.currentFilters.status)||e===t)return void this.hideResultsInfo();this.$resultsInfo||(this.$resultsInfo=$('<div class="var-system-search-results-info"></div>'),this.$resultsInfo.insertBefore('#var-system-function-list'));let n=`显示 <strong>${e}</strong> / ${t} 个函数`;if(this.currentFilters.searchTerm&&(n+=`，搜索: "${this.currentFilters.searchTerm}"`),this.currentFilters.type){n+=`，类型: ${'active'===this.currentFilters.type?'主动函数':'被动函数'}`}if(this.currentFilters.status){n+=`，状态: ${{enabled:'已启用',disabled:'已禁用',builtin:'内置'}[this.currentFilters.status]}`}this.$resultsInfo.html(n),this.$resultsInfo.show()}hideResultsInfo(){this.$resultsInfo&&this.$resultsInfo.hide()}reset(){this.$searchInput.val(''),this.$typeFilter.val(''),this.$statusFilter.val(''),this.currentFilters={searchTerm:'',type:'',status:''},this.updateClearButton(),this.hideResultsInfo()}}const dt='[ST-VarSystemExtension/FunctionLibrary]',ht='st_var_system';let vt='global',gt=null;async function yt(){console.log(dt,'初始化函数库界面'),await async function(){try{const n=e[ht]?.functions||[];N.loadGlobalFunctions(n);const r=t();if(void 0!==r.characterId){const t=r.characters[r.characterId],e=t?.data?.extensions?.[ht]?.functions||[];N.loadLocalFunctions(e)}}catch(L){console.error(dt,'加载函数失败:',L)}}();const{initBuiltinFunctions:n}=await F(async()=>{const{initBuiltinFunctions:t}=await import('./builtins.BxMRpWB9.chunk.js');return{initBuiltinFunctions:t}},[]);n(N),console.log(dt,'内置函数已注册'),$('input[name="function-scope"]').on('change',async t=>{vt=t.target.value,await _t()}),$('#var-system-new-function-btn').on('click',async()=>{await wt()}),$('#var-system-import-functions-btn').on('click',async()=>{await async function(){const t=$('<input type="file" accept=".json">');t.on('change',async t=>{const e=t.target.files[0];if(e)try{const t=await e.text(),n=JSON.parse(t);if(!n.version||!Array.isArray(n.functions))return void toastr.error('无效的函数库文件格式');let r=0;for(const e of n.functions){const t={...e,id:St(),enabled:!1};'global'===vt?N.upsertGlobalFunction(t):N.upsertLocalFunction(t),r++}await bt(),await _t(),toastr.success(`成功导入 ${r} 个函数到${'global'===vt?'全局函数库':'当前角色的局域函数'}`)}catch(L){console.error(dt,'导入函数失败:',L),toastr.error(`导入失败：${L.message}`)}}),t.trigger('click')}()}),$('#var-system-export-functions-btn').on('click',async()=>{await async function(){const t=('global'===vt?N.exportGlobalFunctions():N.exportLocalFunctions()).filter(t=>t.enabled&&!t.builtin);if(0===t.length)return void toastr.warning(`当前${'global'===vt?'全局':'局域'}作用域没有已启用的非内置函数可导出`);const e=t.map(t=>{const{_compiledRegex:e,...n}=t;return n}),n={version:'1.0',scope:vt,functions:e},r=JSON.stringify(n,null,2),o=new Blob([r],{type:'application/json'}),s=URL.createObjectURL(o),i=$('<a>');i.attr('href',s),i.attr('download',`var-system-functions-${vt}-${Date.now()}.json`),i[0].click(),URL.revokeObjectURL(s),toastr.success(`已导出 ${t.length} 个${'global'===vt?'全局':'局域'}函数`)}()}),$('#var-system-generate-prompt-btn').on('click',async()=>{await async function(){const t=await N.getEnabledFunctions('active');if(!t||0===t.length)return void toastr.warning('没有启用的主动函数');let e='<variable_system_functions>\n你可以使用以下函数来更新游戏状态：\n\n';for(const o of t)if(e+=`${o.name} // ${o.description||'无说明'}\n`,o.pattern){const t=xt(o.pattern,o.name);e+=`示例：${t}\n\n`}e+='</variable_system_functions>';const n=$('#var-system-prompt-generator-template').html(),r=$(n);r.find('#generated-prompt-content').text(e),r.find('#copy-prompt-btn').on('click',()=>{navigator.clipboard.writeText(e),toastr.success('已复制到剪贴板')}),await l(r,u.DISPLAY,'函数调用提示词',{wide:!0})}()}),gt=new pt(t=>{!function(t){const e=$('.var-system-function-card'),n=e.length;if(0===n)return;const{visible:r,hidden:o}=function(t,e){let n=0,r=0;return t.each((_,t)=>{const o=$(t),s=o.find('.var-system-function-name').text().toLowerCase(),i=o.find('.var-system-function-description').text().toLowerCase(),a=o.data('function-type'),c=o.find('.function-enabled-checkbox').is(':checked'),l=!0===o.data('builtin'),u=!e.searchTerm||s.includes(e.searchTerm)||i.includes(e.searchTerm),f=!e.type||a===e.type;let p=!0;e.status&&('enabled'===e.status?p=c:'disabled'===e.status?p=!c:'builtin'===e.status&&(p=l)),u&&f&&p?(o.is(':hidden')&&o.css({opacity:0,display:'block'}).animate({opacity:1},300),n++):(o.is(':visible')&&o.animate({opacity:0},200,function(){$(this).hide()}),r++)}),{visible:n,hidden:r}}(e,t);$('.var-system-no-results').remove(),0===r&&o>0&&function(){const t=$('<div class="var-system-no-results"></div>');t.html('\n    <i class="fa-solid fa-search"></i>\n    <p>没有找到匹配的函数</p>\n    <p class="var-system-hint">尝试调整搜索条件或过滤器</p>\n  '),$('#var-system-function-list').append(t)}(),gt&&gt.showResultsInfo(n,r)}(t)}),await _t()}async function _t(){const t=$('#var-system-function-list');t.empty();const e='global'===vt?N.exportGlobalFunctions():N.exportLocalFunctions();if(!e||0===e.length){const e='global'===vt?'全局':'局域';return void t.html(`\n      <div class="var-system-empty-state">\n        <i class="fa-solid fa-inbox fa-3x"></i>\n        <p>暂无${e}函数</p>\n        <p class="var-system-hint">点击下方按钮创建你的第一个${e}函数</p>\n        <button class="menu_button" onclick="$('#var-system-new-function-btn').click()">\n          <i class="fa-solid fa-plus"></i>\n          <span>立即创建</span>\n        </button>\n      </div>\n    `)}for(const n of e){const e=mt(n);t.append(e)}!function(){const t=$('#var-system-function-list');t.sortable('instance')&&t.sortable('destroy');t.sortable({items:'.var-system-function-card',handle:'.drag-handle',cursor:'move',tolerance:'pointer',placeholder:'var-system-sortable-placeholder',stop:async()=>{await async function(){const t=$('#var-system-function-list .var-system-function-card'),e=[];t.each(function(t){const n=$(this).attr('data-function-id');e.push({id:n,order:t})});const n='global'===vt?N.exportGlobalFunctions():N.exportLocalFunctions(),r=[];for(const o of e){const t=n.find(t=>t.id===o.id);t&&(t.order=o.order,r.push(t))}'global'===vt?N.loadGlobalFunctions(r):N.loadLocalFunctions(r);await bt(),console.log(dt,'函数顺序已更新')}()}})}()}function mt(t){const e=$('#var-system-function-card-template').html(),n=$(e);n.attr('data-function-id',t.id),n.attr('data-function-type',t.type),n.attr('data-builtin',t.builtin||!1),n.find('.function-enabled-checkbox').prop('checked',t.enabled),n.find('.function-enabled-checkbox').on('change',async e=>{t.enabled=e.target.checked,await bt()}),n.find('.var-system-function-name').text(t.name);const r=n.find('.var-system-badge');if('active'===t.type?r.removeClass('var-system-badge-passive').addClass('var-system-badge-active').text('主动'):r.removeClass('var-system-badge-active').addClass('var-system-badge-passive').text('被动'),n.find('.var-system-function-description').text(t.description||'无说明'),'passive'===t.type){const e='before_active'===t.timing?'主动函数前执行':'主动函数后执行';n.find('.var-system-function-order').text(e)}else n.find('.var-system-function-order').remove();return n.find('.function-edit-btn').on('click',async()=>{await wt(t)}),t.builtin?n.find('.function-delete-btn').hide():n.find('.function-delete-btn').on('click',async()=>{await async function(t){const e=await l(`确定要删除函数"${t.name}"吗？`,u.CONFIRM,'',{okButton:'删除',cancelButton:'取消'});if(e!==Et.AFFIRMATIVE)return;N.deleteFunction(t.id,vt),await bt(),await _t(),toastr.success(`函数"${t.name}"已删除`)}(t)}),n}async function wt(t=null){const e=$('#var-system-function-editor-template').html(),n=$(e);t&&(n.find('#function-name-input').val(t.name),n.find('#function-type-select').val(t.type),n.find('#function-enabled-checkbox').prop('checked',t.enabled),n.find('#function-description-textarea').val(t.description||''),n.find('#function-pattern-input').val(t.pattern||''),n.find('#function-timing-select').val(t.timing||'before_active'),n.find('#function-executor-textarea').val(t.executor||''),t.builtin&&(n.find('input:not(#function-enabled-checkbox), select, textarea').prop('readonly',!0).prop('disabled',!0).css('background-color','#f5f5f5'),n.prepend('\n        <div class="var-system-hint" style="background: #fff3cd; padding: 10px; margin-bottom: 15px; border-left: 4px solid #ffc107;">\n          <i class="fa-solid fa-info-circle"></i>\n          <strong>这是内置函数</strong>，只能查看实现和控制启用状态，不能修改其他内容。\n        </div>\n      ')));const r=()=>{'active'===n.find('#function-type-select').val()?(n.find('.var-system-active-only').show(),n.find('.var-system-passive-only').hide()):(n.find('.var-system-active-only').hide(),n.find('.var-system-passive-only').show())};n.find('#function-type-select').on('change',r),r();const o=await l(n,u.CONFIRM,t?.builtin?'查看内置函数':t?'编辑函数':'新增函数',{okButton:t?.builtin?'关闭':'保存',...!t?.builtin&&{cancelButton:'取消'}});if(t?.builtin)return;if(o!==Et.AFFIRMATIVE)return;const s={id:t?.id||St(),name:n.find('#function-name-input').val().trim(),type:n.find('#function-type-select').val(),enabled:n.find('#function-enabled-checkbox').prop('checked'),description:n.find('#function-description-textarea').val().trim(),executor:n.find('#function-executor-textarea').val().trim()};if('active'===s.type?s.pattern=n.find('#function-pattern-input').val().trim():s.timing=n.find('#function-timing-select').val(),s.name)if(s.executor)if('active'!==s.type||s.pattern)try{t?Object.assign(t,s):'global'===vt?N.upsertGlobalFunction(s):N.upsertLocalFunction(s),await bt(),await _t(),toastr.success(`函数"${s.name}"已${t?'更新':'创建'}`)}catch(L){console.error('[FunctionLibrary] 保存函数失败:',L),toastr.error(`保存函数失败: ${L.message||'未知错误'}`)}else toastr.error('主动函数需要填写正则表达式');else toastr.error('请填写函数实现代码');else toastr.error('请填写函数名称')}async function bt(){try{if('global'===vt)e[ht]||(e[ht]={}),e[ht].functions=N.exportGlobalFunctions(),await a();else{const e=t();if(void 0===e.characterId)return void console.warn(dt,'当前无角色，无法保存局域函数');const r=e.characters[e.characterId];if(!r)return void console.warn(dt,'角色数据不存在');r.data.extensions||(r.data.extensions={}),r.data.extensions[ht]||(r.data.extensions[ht]={}),r.data.extensions[ht].functions=N.exportLocalFunctions(),await n(e.characterId,ht,r.data.extensions[ht])}console.log(dt,`${vt} 函数已保存`)}catch(L){console.error(dt,'保存函数失败:',L),toastr.error(`保存失败：${L.message}`)}}function xt(t,e){return`@.${e}("path.to.var", value);`}function St(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,t=>{const e=16*Math.random()|0;return('x'===t?e:3&e|8).toString(16)})}const Et={AFFIRMATIVE:1},$t='[ST-VarSystemExtension/MessageSnapshots]';let Tt=null;const Ct={currentFloor:null,currentSwipeId:null,currentSnapshotId:null,draftBody:null,dirty:!1,hasErrors:!1};async function It(){console.log($t,'初始化楼层快照界面'),$('#var-system-floor-select').on('change',async t=>{const e=parseInt(t.target.value,10);Number.isNaN(e)||await Ft(e)}),$('#var-system-jump-btn').on('click',async()=>{const e=parseInt($('#var-system-jump-input').val()||'',10);if(Number.isNaN(e))return void toastr.error('请输入有效的层号');const n=await async function(e){const n=t().chat;if(!n||e>=n.length)return!1;const r=n[e];if(r.is_user)return!1;const o=r.swipe_id||0,s=r.swipes_info?.[o]?.st_var_system_snapshot_id;return!!s}(e);n?$('#var-system-floor-select').val(e).trigger('change'):toastr.error(`第 ${e} 层没有绑定快照`)}),$('#var-system-refresh-snapshot-btn').on('click',async()=>{null!==Ct.currentFloor&&(await Ft(Ct.currentFloor),toastr.info('已刷新快照'))}),$('#var-system-save-snapshot-btn').on('click',async()=>{await async function(){if(Ct.hasErrors)toastr.error('快照数据有错误，无法保存');else if(Ct.dirty)try{if(!Tt)return void toastr.error('编辑器未初始化');const e=Tt.get();if(void 0===e?.json)return void toastr.error('快照数据格式错误，请检查 JSON');const n=t(),r=n.getCurrentChatId?.()||n.chatId;if(!r)return void toastr.error('无法获取当前聊天文件名');const s=await fetch('/api/plugins/var-manager/var-manager/snapshots',{method:'POST',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({identifier:Ct.currentSnapshotId,chatFile:r,payload:e.json})});if(!s.ok)throw new Error(`更新快照失败 (${s.status})`);Ct.dirty=!1,$('#var-system-save-snapshot-btn').prop('disabled',!0),toastr.success('快照已保存');try{if(!function(){try{const e=t(),n=e.characters?.[e.characterId];return!0===n?.data?.extensions?.st_var_system?.enabled}catch(L){return console.error($t,'检查启用状态时发生错误:',L),!1}}())return console.log($t,'变量系统未启用，仅刷新列表'),void(await kt());const e=t().chat;if(!e||0===e.length)return console.log($t,'当前无聊天记录'),void(await kt());for(let t=e.length-1;t>=0;t--){const n=e[t];if(!1===n.is_user||'assistant'===n.role){console.log($t,`重新处理最后一条 AI 消息: #${t}`),await nt(t),await kt();break}}}catch(L){console.error($t,'处理流程执行失败:',L)}}catch(L){console.error($t,'保存快照失败:',L);const e=L instanceof Error?L.message:String(L);toastr.error(`保存失败：${e}`)}else toastr.info('快照未修改')}()}),$('#var-system-save-as-global-btn').on('click',async()=>{await async function(){if(!Tt)return void toastr.error('编辑器未初始化');const t=Tt.get();if(void 0===t?.json)return void toastr.error('快照数据格式错误，请检查 JSON');const e=await l('请输入标签（用逗号分隔）：',u.INPUT,'',{rows:1});if(!e)return;const n='string'==typeof e?e.split(',').map(t=>t.trim()).filter(t=>t):[];try{const e=await fetch('/api/plugins/var-manager/var-manager/global-snapshots',{method:'POST',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({snapshot:t.json,tags:n})});if(!e.ok)throw new Error(`保存失败 (${e.status})`);toastr.success('已保存为全局快照')}catch(L){console.error($t,'保存全局快照失败:',L);const e=L instanceof Error?L.message:String(L);toastr.error(`保存失败：${e}`)}}()}),$('#var-system-export-snapshot-btn').on('click',async()=>{await async function(){if(!Tt)return void toastr.error('编辑器未初始化');const t=Tt.get(),e=JSON.stringify(t,null,2),n=new Blob([e],{type:'application/json'}),r=URL.createObjectURL(n),o=$('<a>');o.attr('href',r),o.attr('download',`snapshot-floor-${Ct.currentFloor}-${Date.now()}.json`),o[0].click(),URL.revokeObjectURL(r),toastr.success('快照已导出')}()}),$('#var-system-import-snapshot-btn').on('click',async()=>{await async function(){const t=$('<input>');return t.attr('type','file'),t.attr('accept','.json'),new Promise(e=>{t.on('change',async t=>{const n=t.target.files?.[0];if(n)try{const t=await n.text(),r=JSON.parse(t);Tt?.set(r),Ct.draftBody=r,Ct.dirty=!0,$('#var-system-save-snapshot-btn').prop('disabled',!1),toastr.success('快照已导入（未保存）'),e(void 0)}catch(L){console.error($t,'导入快照失败:',L);const n=L instanceof Error?L.message:String(L);toastr.error(`导入失败：${n}`),e(void 0)}else e(void 0)}),t.click()})}()}),$('#var-system-strip-schema-btn').on('click',async()=>{await async function(){if(Tt)try{const t=At(Tt.get());Tt.set({json:t}),Ct.draftBody=t,Ct.dirty=!0,$('#var-system-save-snapshot-btn').prop('disabled',!1),toastr.success('已移除 MVU Schema 字段')}catch(L){console.error($t,'分离 Schema 失败:',L);const e=L instanceof Error?L.message:String(L);toastr.error(`分离 Schema 失败：${e}`)}else toastr.error('编辑器尚未初始化')}()}),await kt()}async function kt(){const e=t().chat;if(!e||0===e.length)return void $('#var-system-floor-select').html('<option value="">当前无聊天记录</option>');const n=$('#var-system-floor-select');n.empty();let r=!1,o=-1;for(let t=0;t<e.length;t++){const s=e[t];if(s.is_user)continue;const i=s.swipe_id||0,a=s.swipes_info?.[i]?.st_var_system_snapshot_id;if(a){r=!0,o=t;const e=$('<option>');e.val(t),e.text(`第 ${t} 层 - AI 消息 (Swipe ${i})`),n.append(e)}}r?o>=0&&(n.val(o),await Ft(o)):n.html('<option value="">暂无快照楼层</option>')}async function Ft(e){const n=t().chat;if(!n||e>=n.length)return void toastr.error('无效的楼层号');const r=n[e],s=r.swipe_id||0,i=r.swipes_info?.[s]?.st_var_system_snapshot_id;if(!i)return void toastr.error(`第 ${e} 层没有绑定快照`);const a=await async function(t){try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`,{method:'GET',headers:{...o(),'Content-Type':'application/json'}});if(!e.ok)return 404===e.status?console.warn($t,`快照不存在: ${t}`):console.error($t,`读取快照失败 (${e.status}): ${t}`),null;return(await e.json()).payload}catch(L){return console.error($t,'从插件读取快照时发生错误:',L),null}}(i);if(!a)return void toastr.error('加载快照失败');Ct.currentFloor=e,Ct.currentSwipeId=s,Ct.currentSnapshotId=i,Ct.draftBody=a,Ct.dirty=!1,Ct.hasErrors=!1,$('#var-system-current-floor-info').show(),$('#current-floor-number').text(e),$('#current-swipe-id').text(s),$('#current-snapshot-id').text(i);const c=r.send_date?new Date(r.send_date).toLocaleString('zh-CN'):'未知';$('#current-message-time').text(c),await async function(t){const e=document.getElementById('var-system-snapshot-editor-container');if(!e)return void console.error($t,'找不到编辑器容器');$(e).find('.var-system-empty-state').remove(),Tt&&(Tt.destroy(),Tt=null);Tt=I({container:e,onChange:(t,e,n)=>{console.log('[MessageSnapshots] Editor change:',{hasContent:!!t,hasJson:void 0!==t?.json,jsonType:typeof t?.json,hasContentErrors:!!n?.contentErrors?.length,contentErrors:n?.contentErrors});const r=void 0===t?.json;Ct.hasErrors=r,Ct.dirty=!0,r||(Ct.draftBody=t.json),$('#var-system-save-snapshot-btn').prop('disabled',r)},onFallback:()=>{console.warn($t,'JSON 编辑器资源加载失败，已降级为纯文本模式')}}),await Tt.ensureReady(),Tt.set({json:t})}(a),$('#var-system-snapshot-actions').show(),$('#var-system-save-snapshot-btn').prop('disabled',!0)}function At(t){if(Array.isArray(t))return t.filter(t=>'$__META_EXTENSIBLE__$'!==t).map(t=>At(t));if(_.isObject(t)&&!_.isDate(t)){const e={};for(const n in t)n.startsWith('$')||(e[n]=At(t[n]));return e}return t}const jt=Object.freeze(Object.defineProperty({__proto__:null,initMessageSnapshots:It,loadFloorList:kt},Symbol.toStringTag,{value:'Module'})),Ot='[ST-VarSystemExtension/settings]';async function Lt(){console.log(Ot,'开始清理未使用的快照');if(await callGenericPopup('此操作会删除数据库中不对应任何现存聊天记录的快照。\n\n已删除的快照无法恢复，确定要继续吗？',POPUP_TYPE.CONFIRM,'',{okButton:'确定',cancelButton:'取消'})===POPUP_RESULT.AFFIRMATIVE)try{$('#var-system-cleanup-snapshots-btn').prop('disabled',!0),$('#var-system-cleanup-progress').show(),$('#var-system-cleanup-result').hide(),Bt(0,'正在扫描聊天记录文件...');const t=await async function(){try{const t=await fetch('/api/characters/chats',{method:'POST',headers:{'Content-Type':'application/json'}});if(!t.ok)throw new Error(`获取聊天记录失败: ${t.statusText}`);const e=await t.json();console.log(Ot,'聊天记录数据:',e);const n=[];for(const r in e){const t=e[r];if(Array.isArray(t))for(const e of t){const t=e.replace(/\.jsonl$/,'');n.push(t)}}return n}catch(L){throw console.error(Ot,'获取聊天记录文件失败:',L),new Error('无法获取聊天记录列表')}}();console.log(Ot,`找到 ${t.length} 个聊天记录文件`),Bt(50,`找到 ${t.length} 个聊天记录文件，正在清理...`);const e=await async function(t){try{const e=await fetch('/api/plugins/var-manager/var-manager/snapshots/cleanup',{method:'POST',headers:{'Content-Type':'application/json','X-CSRF-Token':await Rt()},body:JSON.stringify({activeChatFiles:t})});if(404===e.status)throw new Error('插件未安装或未启用');if(!e.ok){const t=await e.text();throw new Error(`插件 API 错误: ${e.status} - ${t}`)}return await e.json()}catch(L){throw console.error(Ot,'清理孤立快照失败:',L),L}}(t);Bt(100,'清理完成'),setTimeout(()=>{$('#var-system-cleanup-progress').hide(),function(t){const{deletedCount:e,totalScanned:n,deletedChatFiles:r}=t;if($('#var-system-cleanup-result').show(),0===e)$('#var-system-cleanup-result-summary').html('<strong>未发现需要清理的快照</strong>'),$('#var-system-cleanup-result-details').text(`扫描了 ${n} 个快照，全部关联到现存的聊天记录。`);else{$('#var-system-cleanup-result-summary').html(`<strong>成功清理 ${e} 个孤立快照</strong>`);const t=`扫描了 ${n} 个快照，清理了 ${r.length} 个已删除聊天记录的快照。\n`+(r.length>0?`\n已清理的聊天文件：\n${r.slice(0,5).join('\n')}`+(r.length>5?`\n... 及其他 ${r.length-5} 个文件`:''):'');$('#var-system-cleanup-result-details').text(t)}toastr.success(`清理完成，删除了 ${e} 个孤立快照`,'变量系统')}(e)},500),console.log(Ot,'清理完成',e)}catch(L){console.error(Ot,'清理失败:',L),$('#var-system-cleanup-progress').hide(),toastr.error(`清理失败：${L.message}`,'变量系统')}finally{$('#var-system-cleanup-snapshots-btn').prop('disabled',!1)}}function Bt(t,e){$('#var-system-cleanup-progress-fill').css('width',`${t}%`),$('#var-system-cleanup-progress-text').text(e)}async function Rt(){if(window.token)return window.token;try{const t=await fetch('/csrf-token'),e=await t.json();return window.token=e.token,e.token}catch(L){return console.warn(Ot,'获取 CSRF Token 失败，使用空字符串',L),''}}
/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Dt(t){const e=Object.create(null);for(const n of t.split(','))e[n]=1;return t=>t in e}const Mt={},Pt=[],Nt=()=>{},Vt=()=>!1,Ut=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),zt=t=>t.startsWith('onUpdate:'),Ht=Object.assign,Wt=Object.prototype.hasOwnProperty,Gt=(t,e)=>Wt.call(t,e),Jt=Array.isArray,qt=t=>'[object Map]'===ee(t),Xt=t=>'function'==typeof t,Kt=t=>'string'==typeof t,Zt=t=>'symbol'==typeof t,Yt=t=>null!==t&&'object'==typeof t,Qt=t=>(Yt(t)||Xt(t))&&Xt(t.then)&&Xt(t.catch),te=Object.prototype.toString,ee=t=>te.call(t),ne=t=>Kt(t)&&'NaN'!==t&&'-'!==t[0]&&''+parseInt(t,10)===t,re=Dt(',key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted'),oe=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},se=/-\w/g,ie=oe(t=>t.replace(se,t=>t.slice(1).toUpperCase())),ae=/\B([A-Z])/g,ce=oe(t=>t.replace(ae,'-$1').toLowerCase()),le=oe(t=>t.charAt(0).toUpperCase()+t.slice(1)),ue=oe(t=>t?`on${le(t)}`:''),fe=(t,e)=>!Object.is(t,e),pe=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},de=(t,e,n,r=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:r,value:n})},he=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let ve;const ge=()=>ve||(ve='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:'undefined'!=typeof window?window:'undefined'!=typeof global?global:{});function ye(t){if(Jt(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],o=Kt(r)?be(r):ye(r);if(o)for(const t in o)e[t]=o[t]}return e}if(Kt(t)||Yt(t))return t}const _e=/;(?![^(]*\))/g,me=/:([^]+)/,we=/\/\*[^]*?\*\//g;function be(t){const e={};return t.replace(we,'').split(_e).forEach(t=>{if(t){const n=t.split(me);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function xe(t){let e='';if(Kt(t))e=t;else if(Jt(t))for(let n=0;n<t.length;n++){const r=xe(t[n]);r&&(e+=r+' ')}else if(Yt(t))for(const n in t)t[n]&&(e+=n+' ');return e.trim()}const Se=Dt('itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly');function Ee(t){return!!t||''===t}
/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let $e,Te;class Ce{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=$e,!t&&$e&&(this.index=($e.scopes||($e.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let t,e;if(this._isPaused=!0,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){let t,e;if(this._isPaused=!1,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=$e;try{return $e=this,t()}finally{$e=e}}}on(){1===++this._on&&(this.prevScope=$e,$e=this)}off(){this._on>0&&0===--this._on&&($e=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){let e,n;for(this._active=!1,e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(this.effects.length=0,e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0}}}const Ie=new WeakSet;class ke{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,$e&&$e.active&&$e.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,Ie.has(this)&&(Ie.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||Oe(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,Ge(this),Re(this);const t=Te,e=Ue;Te=this,Ue=!0;try{return this.fn()}finally{De(this),Te=t,Ue=e,this.flags&=-3}}stop(){if(1&this.flags){for(let t=this.deps;t;t=t.nextDep)Ne(t);this.deps=this.depsTail=void 0,Ge(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?Ie.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Me(this)&&this.run()}get dirty(){return Me(this)}}let Fe,Ae,je=0;function Oe(t,e=!1){if(t.flags|=8,e)return t.next=Ae,void(Ae=t);t.next=Fe,Fe=t}function Le(){je++}function Be(){if(--je>0)return;if(Ae){let t=Ae;for(Ae=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let t;for(;Fe;){let n=Fe;for(Fe=void 0;n;){const r=n.next;if(n.next=void 0,n.flags&=-9,1&n.flags)try{n.trigger()}catch(e){t||(t=e)}n=r}}if(t)throw t}function Re(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function De(t){let e,n=t.depsTail,r=n;for(;r;){const t=r.prevDep;-1===r.version?(r===n&&(n=t),Ne(r),Ve(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=t}t.deps=e,t.depsTail=n}function Me(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Pe(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function Pe(t){if(4&t.flags&&!(16&t.flags))return;if(t.flags&=-17,t.globalVersion===Je)return;if(t.globalVersion=Je,!t.isSSR&&128&t.flags&&(!t.deps&&!t._dirty||!Me(t)))return;t.flags|=2;const e=t.dep,n=Te,r=Ue;Te=t,Ue=!0;try{Re(t);const n=t.fn(t._value);(0===e.version||fe(n,t._value))&&(t.flags|=128,t._value=n,e.version++)}catch(o){throw e.version++,o}finally{Te=n,Ue=r,De(t),t.flags&=-3}}function Ne(t,e=!1){const{dep:n,prevSub:r,nextSub:o}=t;if(r&&(r.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=r,t.nextSub=void 0),n.subs===t&&(n.subs=r,!r&&n.computed)){n.computed.flags&=-5;for(let t=n.computed.deps;t;t=t.nextDep)Ne(t,!0)}e||--n.sc||!n.map||n.map.delete(n.key)}function Ve(t){const{prevDep:e,nextDep:n}=t;e&&(e.nextDep=n,t.prevDep=void 0),n&&(n.prevDep=e,t.nextDep=void 0)}let Ue=!0;const ze=[];function He(){ze.push(Ue),Ue=!1}function We(){const t=ze.pop();Ue=void 0===t||t}function Ge(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const t=Te;Te=void 0;try{e()}finally{Te=t}}}let Je=0;class qe{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Xe{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Te||!Ue||Te===this.computed)return;let e=this.activeLink;if(void 0===e||e.sub!==Te)e=this.activeLink=new qe(Te,this),Te.deps?(e.prevDep=Te.depsTail,Te.depsTail.nextDep=e,Te.depsTail=e):Te.deps=Te.depsTail=e,Ke(e);else if(-1===e.version&&(e.version=this.version,e.nextDep)){const t=e.nextDep;t.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=t),e.prevDep=Te.depsTail,e.nextDep=void 0,Te.depsTail.nextDep=e,Te.depsTail=e,Te.deps===e&&(Te.deps=t)}return e}trigger(t){this.version++,Je++,this.notify(t)}notify(t){Le();try{0;for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Be()}}}function Ke(t){if(t.dep.sc++,4&t.sub.flags){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let t=e.deps;t;t=t.nextDep)Ke(t)}const n=t.dep.subs;n!==t&&(t.prevSub=n,n&&(n.nextSub=t)),t.dep.subs=t}}const Ze=new WeakMap,Ye=Symbol(''),Qe=Symbol(''),tn=Symbol('');function en(t,e,n){if(Ue&&Te){let e=Ze.get(t);e||Ze.set(t,e=new Map);let r=e.get(n);r||(e.set(n,r=new Xe),r.map=e,r.key=n),r.track()}}function nn(t,e,n,r,o,s){const i=Ze.get(t);if(!i)return void Je++;const a=t=>{t&&t.trigger()};if(Le(),'clear'===e)i.forEach(a);else{const o=Jt(t),s=o&&ne(n);if(o&&'length'===n){const t=Number(r);i.forEach((e,n)=>{('length'===n||n===tn||!Zt(n)&&n>=t)&&a(e)})}else switch((void 0!==n||i.has(void 0))&&a(i.get(n)),s&&a(i.get(tn)),e){case'add':o?s&&a(i.get('length')):(a(i.get(Ye)),qt(t)&&a(i.get(Qe)));break;case'delete':o||(a(i.get(Ye)),qt(t)&&a(i.get(Qe)));break;case'set':qt(t)&&a(i.get(Ye))}}Be()}function rn(t){const e=Un(t);return e===t?e:(en(e,0,tn),Nn(t)?e:e.map(zn))}function on(t){return en(t=Un(t),0,tn),t}const sn={__proto__:null,[Symbol.iterator](){return an(this,Symbol.iterator,zn)},concat(...t){return rn(this).concat(...t.map(t=>Jt(t)?rn(t):t))},entries(){return an(this,'entries',t=>(t[1]=zn(t[1]),t))},every(t,e){return ln(this,'every',t,e,void 0,arguments)},filter(t,e){return ln(this,'filter',t,e,t=>t.map(zn),arguments)},find(t,e){return ln(this,'find',t,e,zn,arguments)},findIndex(t,e){return ln(this,'findIndex',t,e,void 0,arguments)},findLast(t,e){return ln(this,'findLast',t,e,zn,arguments)},findLastIndex(t,e){return ln(this,'findLastIndex',t,e,void 0,arguments)},forEach(t,e){return ln(this,'forEach',t,e,void 0,arguments)},includes(...t){return fn(this,'includes',t)},indexOf(...t){return fn(this,'indexOf',t)},join(t){return rn(this).join(t)},lastIndexOf(...t){return fn(this,'lastIndexOf',t)},map(t,e){return ln(this,'map',t,e,void 0,arguments)},pop(){return pn(this,'pop')},push(...t){return pn(this,'push',t)},reduce(t,...e){return un(this,'reduce',t,e)},reduceRight(t,...e){return un(this,'reduceRight',t,e)},shift(){return pn(this,'shift')},some(t,e){return ln(this,'some',t,e,void 0,arguments)},splice(...t){return pn(this,'splice',t)},toReversed(){return rn(this).toReversed()},toSorted(t){return rn(this).toSorted(t)},toSpliced(...t){return rn(this).toSpliced(...t)},unshift(...t){return pn(this,'unshift',t)},values(){return an(this,'values',zn)}};function an(t,e,n){const r=on(t),o=r[e]();return r===t||Nn(t)||(o._next=o.next,o.next=()=>{const t=o._next();return t.done||(t.value=n(t.value)),t}),o}const cn=Array.prototype;function ln(t,e,n,r,o,s){const i=on(t),a=i!==t&&!Nn(t),c=i[e];if(c!==cn[e]){const e=c.apply(t,s);return a?zn(e):e}let l=n;i!==t&&(a?l=function(e,r){return n.call(this,zn(e),r,t)}:n.length>2&&(l=function(e,r){return n.call(this,e,r,t)}));const u=c.call(i,l,r);return a&&o?o(u):u}function un(t,e,n,r){const o=on(t);let s=n;return o!==t&&(Nn(t)?n.length>3&&(s=function(e,r,o){return n.call(this,e,r,o,t)}):s=function(e,r,o){return n.call(this,e,zn(r),o,t)}),o[e](s,...r)}function fn(t,e,n){const r=Un(t);en(r,0,tn);const o=r[e](...n);return-1!==o&&!1!==o||!Vn(n[0])?o:(n[0]=Un(n[0]),r[e](...n))}function pn(t,e,n=[]){He(),Le();const r=Un(t)[e].apply(t,n);return Be(),We(),r}const dn=Dt('__proto__,__v_isRef,__isVue'),hn=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>'arguments'!==t&&'caller'!==t).map(t=>Symbol[t]).filter(Zt));function vn(t){Zt(t)||(t=String(t));const e=Un(this);return en(e,0,t),e.hasOwnProperty(t)}class gn{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){if('__v_skip'===e)return t.__v_skip;const r=this._isReadonly,o=this._isShallow;if('__v_isReactive'===e)return!r;if('__v_isReadonly'===e)return r;if('__v_isShallow'===e)return o;if('__v_raw'===e)return n===(r?o?On:jn:o?An:Fn).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const s=Jt(t);if(!r){let t;if(s&&(t=sn[e]))return t;if('hasOwnProperty'===e)return vn}const i=Reflect.get(t,e,Wn(t)?t:n);if(Zt(e)?hn.has(e):dn(e))return i;if(r||en(t,0,e),o)return i;if(Wn(i)){const t=s&&ne(e)?i:i.value;return r&&Yt(t)?Rn(t):t}return Yt(i)?r?Rn(i):Bn(i):i}}class yn extends gn{constructor(t=!1){super(!1,t)}set(t,e,n,r){let o=t[e];if(!this._isShallow){const e=Pn(o);if(Nn(n)||Pn(n)||(o=Un(o),n=Un(n)),!Jt(t)&&Wn(o)&&!Wn(n))return e||(o.value=n),!0}const s=Jt(t)&&ne(e)?Number(e)<t.length:Gt(t,e),i=Reflect.set(t,e,n,Wn(t)?t:r);return t===Un(r)&&(s?fe(n,o)&&nn(t,'set',e,n):nn(t,'add',e,n)),i}deleteProperty(t,e){const n=Gt(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&nn(t,'delete',e,void 0),r}has(t,e){const n=Reflect.has(t,e);return Zt(e)&&hn.has(e)||en(t,0,e),n}ownKeys(t){return en(t,0,Jt(t)?'length':Ye),Reflect.ownKeys(t)}}class _n extends gn{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const mn=new yn,wn=new _n,bn=new yn(!0),xn=t=>t,Sn=t=>Reflect.getPrototypeOf(t);function En(t){return function(...e){return'delete'!==t&&('clear'===t?void 0:this)}}function $n(t,e){const n={get(n){const r=this.__v_raw,o=Un(r),s=Un(n);t||(fe(n,s)&&en(o,0,n),en(o,0,s));const{has:i}=Sn(o),a=e?xn:t?Hn:zn;return i.call(o,n)?a(r.get(n)):i.call(o,s)?a(r.get(s)):void(r!==o&&r.get(n))},get size(){const e=this.__v_raw;return!t&&en(Un(e),0,Ye),e.size},has(e){const n=this.__v_raw,r=Un(n),o=Un(e);return t||(fe(e,o)&&en(r,0,e),en(r,0,o)),e===o?n.has(e):n.has(e)||n.has(o)},forEach(n,r){const o=this,s=o.__v_raw,i=Un(s),a=e?xn:t?Hn:zn;return!t&&en(i,0,Ye),s.forEach((t,e)=>n.call(r,a(t),a(e),o))}};Ht(n,t?{add:En('add'),set:En('set'),delete:En('delete'),clear:En('clear')}:{add(t){e||Nn(t)||Pn(t)||(t=Un(t));const n=Un(this);return Sn(n).has.call(n,t)||(n.add(t),nn(n,'add',t,t)),this},set(t,n){e||Nn(n)||Pn(n)||(n=Un(n));const r=Un(this),{has:o,get:s}=Sn(r);let i=o.call(r,t);i||(t=Un(t),i=o.call(r,t));const a=s.call(r,t);return r.set(t,n),i?fe(n,a)&&nn(r,'set',t,n):nn(r,'add',t,n),this},delete(t){const e=Un(this),{has:n,get:r}=Sn(e);let o=n.call(e,t);o||(t=Un(t),o=n.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return o&&nn(e,'delete',t,void 0),s},clear(){const t=Un(this),e=0!==t.size,n=t.clear();return e&&nn(t,'clear',void 0,void 0),n}});return['keys','values','entries',Symbol.iterator].forEach(r=>{n[r]=function(t,e,n){return function(...r){const o=this.__v_raw,s=Un(o),i=qt(s),a='entries'===t||t===Symbol.iterator&&i,c='keys'===t&&i,l=o[t](...r),u=n?xn:e?Hn:zn;return!e&&en(s,0,c?Qe:Ye),{next(){const{value:t,done:e}=l.next();return e?{value:t,done:e}:{value:a?[u(t[0]),u(t[1])]:u(t),done:e}},[Symbol.iterator](){return this}}}}(r,t,e)}),n}function Tn(t,e){const n=$n(t,e);return(e,r,o)=>'__v_isReactive'===r?!t:'__v_isReadonly'===r?t:'__v_raw'===r?e:Reflect.get(Gt(n,r)&&r in e?n:e,r,o)}const Cn={get:Tn(!1,!1)},In={get:Tn(!1,!0)},kn={get:Tn(!0,!1)},Fn=new WeakMap,An=new WeakMap,jn=new WeakMap,On=new WeakMap;function Ln(t){return t.__v_skip||!Object.isExtensible(t)?0:function(t){switch(t){case'Object':case'Array':return 1;case'Map':case'Set':case'WeakMap':case'WeakSet':return 2;default:return 0}}((t=>ee(t).slice(8,-1))(t))}function Bn(t){return Pn(t)?t:Dn(t,!1,mn,Cn,Fn)}function Rn(t){return Dn(t,!0,wn,kn,jn)}function Dn(t,e,n,r,o){if(!Yt(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=Ln(t);if(0===s)return t;const i=o.get(t);if(i)return i;const a=new Proxy(t,2===s?r:n);return o.set(t,a),a}function Mn(t){return Pn(t)?Mn(t.__v_raw):!(!t||!t.__v_isReactive)}function Pn(t){return!(!t||!t.__v_isReadonly)}function Nn(t){return!(!t||!t.__v_isShallow)}function Vn(t){return!!t&&!!t.__v_raw}function Un(t){const e=t&&t.__v_raw;return e?Un(e):t}const zn=t=>Yt(t)?Bn(t):t,Hn=t=>Yt(t)?Rn(t):t;function Wn(t){return!!t&&!0===t.__v_isRef}function Gn(t){return function(t,e){if(Wn(t))return t;return new Jn(t,e)}(t,!1)}class Jn{constructor(t,e){this.dep=new Xe,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:Un(t),this._value=e?t:zn(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,n=this.__v_isShallow||Nn(t)||Pn(t);t=n?t:Un(t),fe(t,e)&&(this._rawValue=t,this._value=n?t:zn(t),this.dep.trigger())}}const qn={get:(t,e,n)=>{return'__v_raw'===e?t:Wn(r=Reflect.get(t,e,n))?r.value:r;var r},set:(t,e,n,r)=>{const o=t[e];return Wn(o)&&!Wn(n)?(o.value=n,!0):Reflect.set(t,e,n,r)}};function Xn(t){return Mn(t)?t:new Proxy(t,qn)}class Kn{constructor(t,e,n){this.fn=t,this.setter=e,this._value=void 0,this.dep=new Xe(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Je-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=n}notify(){if(this.flags|=16,!(8&this.flags)&&Te!==this)return Oe(this,!0),!0}get value(){const t=this.dep.track();return Pe(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function Zn(t,e,n,r){try{return r?t(...r):t()}catch(o){Qn(o,e,n)}}function Yn(t,e,n,r){if(Xt(t)){const o=Zn(t,e,n,r);return o&&Qt(o)&&o.catch(t=>{Qn(t,e,n)}),o}if(Jt(t)){const o=[];for(let s=0;s<t.length;s++)o.push(Yn(t[s],e,n,r));return o}}function Qn(t,e,n,r=!0){e&&e.vnode;const{errorHandler:o,throwUnhandledErrorInProduction:s}=e&&e.appContext.config||Mt;if(e){let r=e.parent;const s=e.proxy,i=`https://vuejs.org/error-reference/#runtime-${n}`;for(;r;){const e=r.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,s,i))return;r=r.parent}if(o)return He(),Zn(o,null,10,[t,s,i]),void We()}!function(t,e,n,r=!0,o=!1){if(o)throw t;console.error(t)}(t,0,0,r,s)}const tr=[];let er=-1;const nr=[];let rr=null,or=0;const sr=Promise.resolve();let ir=null;function ar(t){const e=ir||sr;return t?e.then(this?t.bind(this):t):e}function cr(t){if(!(1&t.flags)){const e=pr(t),n=tr[tr.length-1];!n||!(2&t.flags)&&e>=pr(n)?tr.push(t):tr.splice(function(t){let e=er+1,n=tr.length;for(;e<n;){const r=e+n>>>1,o=tr[r],s=pr(o);s<t||s===t&&2&o.flags?e=r+1:n=r}return e}(e),0,t),t.flags|=1,lr()}}function lr(){ir||(ir=sr.then(dr))}function ur(t,e,n=er+1){for(;n<tr.length;n++){const e=tr[n];if(e&&2&e.flags){if(t&&e.id!==t.uid)continue;tr.splice(n,1),n--,4&e.flags&&(e.flags&=-2),e(),4&e.flags||(e.flags&=-2)}}}function fr(t){if(nr.length){const t=[...new Set(nr)].sort((t,e)=>pr(t)-pr(e));if(nr.length=0,rr)return void rr.push(...t);for(rr=t,or=0;or<rr.length;or++){const t=rr[or];4&t.flags&&(t.flags&=-2),8&t.flags||t(),t.flags&=-2}rr=null,or=0}}const pr=t=>null==t.id?2&t.flags?-1:1/0:t.id;function dr(t){try{for(er=0;er<tr.length;er++){const t=tr[er];!t||8&t.flags||(4&t.flags&&(t.flags&=-2),Zn(t,t.i,t.i?15:14),4&t.flags||(t.flags&=-2))}}finally{for(;er<tr.length;er++){const t=tr[er];t&&(t.flags&=-2)}er=-1,tr.length=0,fr(),ir=null,(tr.length||nr.length)&&dr()}}let hr,vr=[],gr=!1;function yr(t,...e){hr?hr.emit(t,...e):gr||vr.push({event:t,args:e})}function _r(t,e){var n,r;if(hr=t,hr)hr.enabled=!0,vr.forEach(({event:t,args:e})=>hr.emit(t,...e)),vr=[];else if('undefined'!=typeof window&&window.HTMLElement&&!(null==(r=null==(n=window.navigator)?void 0:n.userAgent)?void 0:r.includes('jsdom'))){(e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(t=>{_r(t,e)}),setTimeout(()=>{hr||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,gr=!0,vr=[])},3e3)}else gr=!0,vr=[]}const mr=xr('component:added'),wr=xr('component:updated'),br=xr('component:removed');function xr(t){return e=>{yr(t,e.appContext.app,e.uid,e.parent?e.parent.uid:void 0,e)}}let Sr=null,Er=null;function $r(t){const e=Sr;return Sr=t,Er=t&&t.type.__scopeId||null,e}function Tr(t,e,n,r){const o=t.dirs,s=e&&e.dirs;for(let i=0;i<o.length;i++){const a=o[i];s&&(a.oldValue=s[i].value);let c=a.dir[r];c&&(He(),Yn(c,n,8,[t.el,a,t,e]),We())}}const Cr=Symbol('_vte'),Ir=t=>t&&(t.disabled||''===t.disabled),kr=t=>t&&(t.defer||''===t.defer),Fr=t=>'undefined'!=typeof SVGElement&&t instanceof SVGElement,Ar=t=>'function'==typeof MathMLElement&&t instanceof MathMLElement,jr=(t,e)=>{const n=t&&t.to;if(Kt(n)){if(e){return e(n)}return null}return n},Or={name:'Teleport',__isTeleport:!0,process(t,e,n,r,o,s,i,a,c,l){const{mc:u,pc:f,pbc:p,o:{insert:d,querySelector:h,createText:v,createComment:g}}=l,y=Ir(e.props);let{shapeFlag:m,children:w,dynamicChildren:b}=e;if(null==t){const t=e.el=v(''),l=e.anchor=v('');d(t,n,r),d(l,n,r);const f=(t,e)=>{16&m&&u(w,t,e,o,s,i,a,c)},p=()=>{const t=e.target=jr(e.props,h),n=Dr(t,e,v,d);t&&('svg'!==i&&Fr(t)?i='svg':'mathml'!==i&&Ar(t)&&(i='mathml'),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(t),y||(f(t,n),Rr(e,!1)))};y&&(f(n,l),Rr(e,!0)),kr(e.props)?(e.el.__isMounted=!1,go(()=>{p(),delete e.el.__isMounted},s)):p()}else{if(kr(e.props)&&!1===t.el.__isMounted)return void go(()=>{Or.process(t,e,n,r,o,s,i,a,c,l)},s);e.el=t.el,e.targetStart=t.targetStart;const u=e.anchor=t.anchor,d=e.target=t.target,v=e.targetAnchor=t.targetAnchor,g=Ir(t.props),m=g?n:d,w=g?u:v;if('svg'===i||Fr(d)?i='svg':('mathml'===i||Ar(d))&&(i='mathml'),b?(p(t.dynamicChildren,b,m,o,s,i,a),wo(t,e,!0)):c||f(t,e,m,w,o,s,i,a,!1),y)g?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Lr(e,n,u,l,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const t=e.target=jr(e.props,h);t&&Lr(e,t,null,l,0)}else g&&Lr(e,d,v,l,1);Rr(e,y)}},remove(t,e,n,{um:r,o:{remove:o}},s){const{shapeFlag:i,children:a,anchor:c,targetStart:l,targetAnchor:u,target:f,props:p}=t;if(f&&(o(l),o(u)),s&&o(c),16&i){const t=s||!Ir(p);for(let o=0;o<a.length;o++){const s=a[o];r(s,e,n,t,!!s.dynamicChildren)}}},move:Lr,hydrate:function(t,e,n,r,o,s,{o:{nextSibling:i,parentNode:a,querySelector:c,insert:l,createText:u}},f){function p(t,e,c,l){e.anchor=f(i(t),e,a(t),n,r,o,s),e.targetStart=c,e.targetAnchor=l}const d=e.target=jr(e.props,c),h=Ir(e.props);if(d){const a=d._lpa||d.firstChild;if(16&e.shapeFlag)if(h)p(t,e,a,a&&i(a));else{e.anchor=i(t);let c=a;for(;c;){if(c&&8===c.nodeType)if('teleport start anchor'===c.data)e.targetStart=c;else if('teleport anchor'===c.data){e.targetAnchor=c,d._lpa=e.targetAnchor&&i(e.targetAnchor);break}c=i(c)}e.targetAnchor||Dr(d,e,u,l),f(a&&i(a),e,d,n,r,o,s)}Rr(e,h)}else h&&16&e.shapeFlag&&p(t,e,t,i(t));return e.anchor&&i(e.anchor)}};function Lr(t,e,n,{o:{insert:r},m:o},s=2){0===s&&r(t.targetAnchor,e,n);const{el:i,anchor:a,shapeFlag:c,children:l,props:u}=t,f=2===s;if(f&&r(i,e,n),(!f||Ir(u))&&16&c)for(let p=0;p<l.length;p++)o(l[p],e,n,2);f&&r(a,e,n)}const Br=Or;function Rr(t,e){const n=t.ctx;if(n&&n.ut){let r,o;for(e?(r=t.el,o=t.anchor):(r=t.targetStart,o=t.targetAnchor);r&&r!==o;)1===r.nodeType&&r.setAttribute('data-v-owner',n.uid),r=r.nextSibling;n.ut()}}function Dr(t,e,n,r){const o=e.targetStart=n(''),s=e.targetAnchor=n('');return o[Cr]=s,t&&(r(o,t),r(s,t)),s}const Mr=Symbol('_leaveCb');function Pr(t,e){6&t.shapeFlag&&t.component?(t.transition=e,Pr(t.component.subTree,e)):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Nr(t,e){return Xt(t)?(()=>Ht({name:t.name},e,{setup:t}))():t}const Vr=new WeakMap;function Ur(t,e,n,r,o=!1){if(Jt(t))return void t.forEach((t,s)=>Ur(t,e&&(Jt(e)?e[s]:e),n,r,o));if(Hr(r)&&!o)return void(512&r.shapeFlag&&r.type.__asyncResolved&&r.component.subTree.component&&Ur(t,e,n,r.component.subTree));const s=4&r.shapeFlag?hs(r.component):r.el,i=o?null:s,{i:a,r:c}=t,l=e&&e.r,u=a.refs===Mt?a.refs={}:a.refs,f=a.setupState,p=Un(f),d=f===Mt?Vt:t=>Gt(p,t);if(null!=l&&l!==c)if(zr(e),Kt(l))u[l]=null,d(l)&&(f[l]=null);else if(Wn(l)){l.value=null;const t=e;t.k&&(u[t.k]=null)}if(Xt(c))Zn(c,a,12,[i,u]);else{const e=Kt(c),r=Wn(c);if(e||r){const a=()=>{if(t.f){const n=e?d(c)?f[c]:u[c]:c.value;if(o)Jt(n)&&((t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)})(n,s);else if(Jt(n))n.includes(s)||n.push(s);else if(e)u[c]=[s],d(c)&&(f[c]=u[c]);else{const e=[s];c.value=e,t.k&&(u[t.k]=e)}}else e?(u[c]=i,d(c)&&(f[c]=i)):r&&(c.value=i,t.k&&(u[t.k]=i))};if(i){const e=()=>{a(),Vr.delete(t)};e.id=-1,Vr.set(t,e),go(e,n)}else zr(t),a()}}}function zr(t){const e=Vr.get(t);e&&(e.flags|=8,Vr.delete(t))}ge().requestIdleCallback,ge().cancelIdleCallback;const Hr=t=>!!t.type.__asyncLoader;const Wr=(Gr='um',(t,e=is)=>{us&&'sp'!==Gr||function(t,e,n=is,r=!1){if(n){const o=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...r)=>{He();const o=as(n),s=Yn(e,n,t,r);return o(),We(),s});r?o.unshift(s):o.push(s)}}(Gr,(...e)=>t(...e),e)});var Gr;const Jr=Symbol.for('v-ndc'),qr=t=>t?ls(t)?hs(t):qr(t.parent):null,Xr=Ht(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>qr(t.parent),$root:t=>qr(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>t.type,$forceUpdate:t=>t.f||(t.f=()=>{cr(t.update)}),$nextTick:t=>t.n||(t.n=ar.bind(t.proxy)),$watch:t=>Nt}),Kr=(t,e)=>t!==Mt&&!t.__isScriptSetup&&Gt(t,e),Zr={get({_:t},e){if('__v_skip'===e)return!0;const{ctx:n,setupState:r,data:o,props:s,accessCache:i,type:a,appContext:c}=t;let l;if('$'!==e[0]){const a=i[e];if(void 0!==a)switch(a){case 1:return r[e];case 2:return o[e];case 4:return n[e];case 3:return s[e]}else{if(Kr(r,e))return i[e]=1,r[e];if(o!==Mt&&Gt(o,e))return i[e]=2,o[e];if((l=t.propsOptions[0])&&Gt(l,e))return i[e]=3,s[e];if(n!==Mt&&Gt(n,e))return i[e]=4,n[e];i[e]=0}}const u=Xr[e];let f,p;return u?('$attrs'===e&&en(t.attrs,0,''),u(t)):(f=a.__cssModules)&&(f=f[e])?f:n!==Mt&&Gt(n,e)?(i[e]=4,n[e]):(p=c.config.globalProperties,Gt(p,e)?p[e]:void 0)},set({_:t},e,n){const{data:r,setupState:o,ctx:s}=t;return Kr(o,e)?(o[e]=n,!0):r!==Mt&&Gt(r,e)?(r[e]=n,!0):!Gt(t.props,e)&&(('$'!==e[0]||!(e.slice(1)in t))&&(s[e]=n,!0))},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:o,propsOptions:s,type:i}},a){let c,l;return!!(n[a]||t!==Mt&&'$'!==a[0]&&Gt(t,a)||Kr(e,a)||(c=s[0])&&Gt(c,a)||Gt(r,a)||Gt(Xr,a)||Gt(o.config.globalProperties,a)||(l=i.__cssModules)&&l[a])},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:Gt(n,'value')&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function Yr(){return{app:null,config:{isNativeTag:Vt,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Qr=0;function to(t,e){return function(e,n=null){Xt(e)||(e=Ht({},e)),null==n||Yt(n)||(n=null);const r=Yr(),o=new WeakSet,s=[];let i=!1;const a=r.app={_uid:Qr++,_component:e,_props:n,_container:null,_context:r,_instance:null,version:gs,get config(){return r.config},set config(t){},use:(t,...e)=>(o.has(t)||(t&&Xt(t.install)?(o.add(t),t.install(a,...e)):Xt(t)&&(o.add(t),t(a,...e))),a),mixin:t=>a,component:(t,e)=>e?(r.components[t]=e,a):r.components[t],directive:(t,e)=>e?(r.directives[t]=e,a):r.directives[t],mount(o,s,c){if(!i){const s=a._ceVNode||qo(e,n);return s.appContext=r,!0===c?c='svg':!1===c&&(c=void 0),t(s,o,c),i=!0,a._container=o,o.__vue_app__=a,a._instance=s.component,function(t,e){yr('app:init',t,e,{Fragment:jo,Text:Oo,Comment:Lo,Static:Bo})}(a,gs),hs(s.component)}},onUnmount(t){s.push(t)},unmount(){i&&(Yn(s,a._instance,16),t(null,a._container),a._instance=null,function(t){yr('app:unmount',t)}(a),delete a._container.__vue_app__)},provide:(t,e)=>(r.provides[t]=e,a),runWithContext(t){try{return t()}finally{}}};return a}}const eo={},no=()=>Object.create(eo),ro=t=>Object.getPrototypeOf(t)===eo;function oo(t,e,n,r=!1){const o={},s=no();t.propsDefaults=Object.create(null),so(t,e,o,s);for(const i in t.propsOptions[0])i in o||(o[i]=void 0);n?t.props=r?o:Dn(o,!1,bn,In,An):t.type.props?t.props=o:t.props=s,t.attrs=s}function so(t,e,n,r){const[o,s]=t.propsOptions;let i,a=!1;if(e)for(let c in e){if(re(c))continue;const l=e[c];let u;o&&Gt(o,u=ie(c))?s&&s.includes(u)?(i||(i={}))[u]=l:n[u]=l:To(t.emitsOptions,c)||c in r&&l===r[c]||(r[c]=l,a=!0)}if(s){const e=Un(n),r=i||Mt;for(let i=0;i<s.length;i++){const a=s[i];n[a]=io(o,e,a,r[a],t,!Gt(r,a))}}return a}function io(t,e,n,r,o,s){const i=t[n];if(null!=i){const t=Gt(i,'default');if(t&&void 0===r){const t=i.default;if(i.type!==Function&&!i.skipFactory&&Xt(t)){const{propsDefaults:s}=o;if(n in s)r=s[n];else{const i=as(o);r=s[n]=t.call(null,e),i()}}else r=t;o.ce&&o.ce._setProp(n,r)}i[0]&&(s&&!t?r=!1:!i[1]||''!==r&&r!==ce(n)||(r=!0))}return r}function ao(t,e,n=!1){const r=e.propsCache,o=r.get(t);if(o)return o;const s=t.props,i={},a=[];if(!s)return Yt(t)&&r.set(t,Pt),Pt;if(Jt(s))for(let l=0;l<s.length;l++){const t=ie(s[l]);co(t)&&(i[t]=Mt)}else if(s)for(const l in s){const t=ie(l);if(co(t)){const e=s[l],n=i[t]=Jt(e)||Xt(e)?{type:e}:Ht({},e),r=n.type;let o=!1,c=!0;if(Jt(r))for(let t=0;t<r.length;++t){const e=r[t],n=Xt(e)&&e.name;if('Boolean'===n){o=!0;break}'String'===n&&(c=!1)}else o=Xt(r)&&'Boolean'===r.name;n[0]=o,n[1]=c,(o||Gt(n,'default'))&&a.push(t)}}const c=[i,a];return Yt(t)&&r.set(t,c),c}function co(t){return'$'!==t[0]&&!re(t)}const lo=t=>'_'===t||'_ctx'===t||'$stable'===t,uo=t=>Jt(t)?t.map(Yo):[Yo(t)],fo=(t,e,n)=>{if(e._n)return e;const r=function(t,e=Sr){if(!e)return t;if(t._n)return t;const n=(...r)=>{n._d&&No(-1);const o=$r(e);let s;try{s=t(...r)}finally{$r(o),n._d&&No(1)}return wr(e),s};return n._n=!0,n._c=!0,n._d=!0,n}((...t)=>uo(e(...t)),n);return r._c=!1,r},po=(t,e,n)=>{const r=t._ctx;for(const o in t){if(lo(o))continue;const n=t[o];if(Xt(n))e[o]=fo(0,n,r);else if(null!=n){const t=uo(n);e[o]=()=>t}}},ho=(t,e)=>{const n=uo(e);t.slots.default=()=>n},vo=(t,e,n)=>{for(const r in e)!n&&lo(r)||(t[r]=e[r])},go=function(t,e){e&&e.pendingBranch?Jt(t)?e.effects.push(...t):e.effects.push(t):(Jt(n=t)?nr.push(...n):rr&&-1===n.id?rr.splice(or+1,0,n):1&n.flags||(nr.push(n),n.flags|=1),lr());var n};function yo(t){return function(t){const e=ge();e.__VUE__=!0,_r(e.__VUE_DEVTOOLS_GLOBAL_HOOK__,e);const{insert:n,remove:r,patchProp:o,createElement:s,createText:i,createComment:a,setText:c,setElementText:l,parentNode:u,nextSibling:f,setScopeId:p=Nt,insertStaticContent:d}=t,h=(t,e,n,r=null,o=null,s=null,i=void 0,a=null,c=!!e.dynamicChildren)=>{if(t===e)return;t&&!Ho(t,e)&&(r=W(t),P(t,o,s,!0),t=null),-2===e.patchFlag&&(c=!1,e.dynamicChildren=null);const{type:l,ref:u,shapeFlag:f}=e;switch(l){case Oo:v(t,e,n,r);break;case Lo:g(t,e,n,r);break;case Bo:null==t&&y(e,n,r,i);break;case jo:k(t,e,n,r,o,s,i,a,c);break;default:1&f?b(t,e,n,r,o,s,i,a,c):6&f?F(t,e,n,r,o,s,i,a,c):(64&f||128&f)&&l.process(t,e,n,r,o,s,i,a,c,q)}null!=u&&o?Ur(u,t&&t.ref,s,e||t,!e):null==u&&t&&null!=t.ref&&Ur(t.ref,null,s,t,!0)},v=(t,e,r,o)=>{if(null==t)n(e.el=i(e.children),r,o);else{const n=e.el=t.el;e.children!==t.children&&c(n,e.children)}},g=(t,e,r,o)=>{null==t?n(e.el=a(e.children||''),r,o):e.el=t.el},y=(t,e,n,r)=>{[t.el,t.anchor]=d(t.children,e,n,r,t.el,t.anchor)},m=({el:t,anchor:e},r,o)=>{let s;for(;t&&t!==e;)s=f(t),n(t,r,o),t=s;n(e,r,o)},w=({el:t,anchor:e})=>{let n;for(;t&&t!==e;)n=f(t),r(t),t=n;r(e)},b=(t,e,n,r,o,s,i,a,c)=>{'svg'===e.type?i='svg':'math'===e.type&&(i='mathml'),null==t?x(e,n,r,o,s,i,a,c):T(t,e,o,s,i,a,c)},x=(t,e,r,i,a,c,u,f)=>{let p,d;const{props:h,shapeFlag:v,transition:g,dirs:y}=t;if(p=t.el=s(t.type,c,h&&h.is,h),8&v?l(p,t.children):16&v&&E(t.children,p,null,i,a,_o(t,c),u,f),y&&Tr(t,null,i,'created'),S(p,t,t.scopeId,u,i),h){for(const t in h)'value'===t||re(t)||o(p,t,null,h[t],c,i);'value'in h&&o(p,'value',null,h.value,c),(d=h.onVnodeBeforeMount)&&es(d,i,t)}de(p,'__vnode',t,!0),de(p,'__vueParentComponent',i,!0),y&&Tr(t,null,i,'beforeMount');const m=function(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}(a,g);m&&g.beforeEnter(p),n(p,e,r),((d=h&&h.onVnodeMounted)||m||y)&&go(()=>{d&&es(d,i,t),m&&g.enter(p),y&&Tr(t,null,i,'mounted')},a)},S=(t,e,n,r,o)=>{if(n&&p(t,n),r)for(let s=0;s<r.length;s++)p(t,r[s]);if(o){let n=o.subTree;if(e===n||Ao(n.type)&&(n.ssContent===e||n.ssFallback===e)){const e=o.vnode;S(t,e,e.scopeId,e.slotScopeIds,o.parent)}}},E=(t,e,n,r,o,s,i,a,c=0)=>{for(let l=c;l<t.length;l++){const c=t[l]=a?Qo(t[l]):Yo(t[l]);h(null,c,e,n,r,o,s,i,a)}},T=(t,e,n,r,s,i,a)=>{const c=e.el=t.el;c.__vnode=e;let{patchFlag:u,dynamicChildren:f,dirs:p}=e;u|=16&t.patchFlag;const d=t.props||Mt,h=e.props||Mt;let v;if(n&&mo(n,!1),(v=h.onVnodeBeforeUpdate)&&es(v,n,e,t),p&&Tr(e,t,n,'beforeUpdate'),n&&mo(n,!0),(d.innerHTML&&null==h.innerHTML||d.textContent&&null==h.textContent)&&l(c,''),f?C(t.dynamicChildren,f,c,n,r,_o(e,s),i):a||B(t,e,c,null,n,r,_o(e,s),i,!1),u>0){if(16&u)I(c,d,h,n,s);else if(2&u&&d.class!==h.class&&o(c,'class',null,h.class,s),4&u&&o(c,'style',d.style,h.style,s),8&u){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const r=t[e],i=d[r],a=h[r];a===i&&'value'!==r||o(c,r,i,a,s,n)}}1&u&&t.children!==e.children&&l(c,e.children)}else a||null!=f||I(c,d,h,n,s);((v=h.onVnodeUpdated)||p)&&go(()=>{v&&es(v,n,e,t),p&&Tr(e,t,n,'updated')},r)},C=(t,e,n,r,o,s,i)=>{for(let a=0;a<e.length;a++){const c=t[a],l=e[a],f=c.el&&(c.type===jo||!Ho(c,l)||198&c.shapeFlag)?u(c.el):n;h(c,l,f,null,r,o,s,i,!0)}},I=(t,e,n,r,s)=>{if(e!==n){if(e!==Mt)for(const i in e)re(i)||i in n||o(t,i,e[i],null,s,r);for(const i in n){if(re(i))continue;const a=n[i],c=e[i];a!==c&&'value'!==i&&o(t,i,c,a,s,r)}'value'in n&&o(t,'value',e.value,n.value,s)}},k=(t,e,r,o,s,a,c,l,u)=>{const f=e.el=t?t.el:i(''),p=e.anchor=t?t.anchor:i('');let{patchFlag:d,dynamicChildren:h,slotScopeIds:v}=e;v&&(l=l?l.concat(v):v),null==t?(n(f,r,o),n(p,r,o),E(e.children||[],r,p,s,a,c,l,u)):d>0&&64&d&&h&&t.dynamicChildren?(C(t.dynamicChildren,h,r,s,a,c,l),(null!=e.key||s&&e===s.subTree)&&wo(t,e,!0)):B(t,e,r,p,s,a,c,l,u)},F=(t,e,n,r,o,s,i,a,c)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?o.ctx.activate(e,n,r,i,c):A(e,n,r,o,s,i,c):j(t,e,c)},A=(t,e,n,r,o,s,i)=>{const a=t.component=function(t,e,n){const r=t.type,o=(e?e.appContext:t.appContext)||ns,s={uid:rs++,vnode:t,type:r,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ce(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:['',0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ao(r,o),emitsOptions:$o(r,o),emit:null,emitted:null,propsDefaults:Mt,inheritAttrs:r.inheritAttrs,ctx:Mt,data:Mt,props:Mt,attrs:Mt,slots:Mt,refs:Mt,setupState:Mt,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};s.ctx={_:s},s.root=e?e.root:s,s.emit=Eo.bind(null,s),t.ce&&t.ce(s);return s}(t,r,o);if(t.type.__isKeepAlive&&(a.ctx.renderer=q),function(t,e=!1,n=!1){e&&ss(e);const{props:r,children:o}=t.vnode,s=ls(t);oo(t,r,s,e),((t,e,n)=>{const r=t.slots=no();if(32&t.vnode.shapeFlag){const t=e._;t?(vo(r,e,n),n&&de(r,'_',t,!0)):po(e,r)}else e&&ho(t,e)})(t,o,n||e);const i=s?function(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Zr);const{setup:r}=n;if(r){He();const n=t.setupContext=r.length>1?function(t){const e=e=>{t.exposed=e||{}};return{attrs:new Proxy(t.attrs,ds),slots:t.slots,emit:t.emit,expose:e}}(t):null,o=as(t),s=Zn(r,t,0,[t.props,n]),i=Qt(s);if(We(),o(),!i&&!t.sp||Hr(t)||function(t){t.ids=[t.ids[0]+t.ids[2]+++'-',0,0]}(t),i){if(s.then(cs,cs),e)return s.then(e=>{fs(t,e)}).catch(e=>{Qn(e,t,0)});t.asyncDep=s}else fs(t,s)}else ps(t)}(t,e):void 0;e&&ss(!1)}(a,!1,i),a.asyncDep){if(o&&o.registerDep(a,O,i),!t.el){const r=a.subTree=qo(Lo);g(null,r,e,n),t.placeholder=r.el}}else O(a,t,e,n,o,s,i)},j=(t,e,n)=>{const r=e.component=t.component;if(function(t,e,n){const{props:r,children:o,component:s}=t,{props:i,children:a,patchFlag:c}=e,l=s.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&c>=0))return!(!o&&!a||a&&a.$stable)||r!==i&&(r?!i||Fo(r,i,l):!!i);if(1024&c)return!0;if(16&c)return r?Fo(r,i,l):!!i;if(8&c){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(i[n]!==r[n]&&!To(l,n))return!0}}return!1}(t,e,n)){if(r.asyncDep&&!r.asyncResolved)return void L(r,e,n);r.next=e,r.update()}else e.el=t.el,r.vnode=e},O=(t,e,n,r,o,s,i)=>{const a=()=>{if(t.isMounted){let{next:e,bu:n,u:r,parent:c,vnode:l}=t;{const n=bo(t);if(n)return e&&(e.el=l.el,L(t,e,i)),void n.asyncDep.then(()=>{t.isUnmounted||a()})}let f,p=e;mo(t,!1),e?(e.el=l.el,L(t,e,i)):e=l,n&&pe(n),(f=e.props&&e.props.onVnodeBeforeUpdate)&&es(f,c,e,l),mo(t,!0);const d=Co(t),v=t.subTree;t.subTree=d,h(v,d,u(v.el),W(v),t,o,s),e.el=d.el,null===p&&function({vnode:t,parent:e},n){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===t&&(r.el=t.el),r!==t)break;(t=e.vnode).el=n,e=e.parent}}(t,d.el),r&&go(r,o),(f=e.props&&e.props.onVnodeUpdated)&&go(()=>es(f,c,e,l),o),wr(t)}else{let i;const{el:a,props:c}=e,{bm:l,m:u,parent:f,root:p,type:d}=t,v=Hr(e);mo(t,!1),l&&pe(l),!v&&(i=c&&c.onVnodeBeforeMount)&&es(i,f,e),mo(t,!0);{p.ce&&!1!==p.ce._def.shadowRoot&&p.ce._injectChildStyle(d);const i=t.subTree=Co(t);h(null,i,n,r,t,o,s),e.el=i.el}if(u&&go(u,o),!v&&(i=c&&c.onVnodeMounted)){const t=e;go(()=>es(i,f,t),o)}(256&e.shapeFlag||f&&Hr(f.vnode)&&256&f.vnode.shapeFlag)&&t.a&&go(t.a,o),t.isMounted=!0,mr(t),e=n=r=null}};t.scope.on();const c=t.effect=new ke(a);t.scope.off();const l=t.update=c.run.bind(c),f=t.job=c.runIfDirty.bind(c);f.i=t,f.id=t.uid,c.scheduler=()=>cr(f),mo(t,!0),l()},L=(t,e,n)=>{e.component=t;const r=t.vnode.props;t.vnode=e,t.next=null,function(t,e,n,r){const{props:o,attrs:s,vnode:{patchFlag:i}}=t,a=Un(o),[c]=t.propsOptions;let l=!1;if(!(r||i>0)||16&i){let r;so(t,e,o,s)&&(l=!0);for(const s in a)e&&(Gt(e,s)||(r=ce(s))!==s&&Gt(e,r))||(c?!n||void 0===n[s]&&void 0===n[r]||(o[s]=io(c,a,s,void 0,t,!0)):delete o[s]);if(s!==a)for(const t in s)e&&Gt(e,t)||(delete s[t],l=!0)}else if(8&i){const n=t.vnode.dynamicProps;for(let r=0;r<n.length;r++){let i=n[r];if(To(t.emitsOptions,i))continue;const u=e[i];if(c)if(Gt(s,i))u!==s[i]&&(s[i]=u,l=!0);else{const e=ie(i);o[e]=io(c,a,e,u,t,!1)}else u!==s[i]&&(s[i]=u,l=!0)}}l&&nn(t.attrs,'set','')}(t,e.props,r,n),((t,e,n)=>{const{vnode:r,slots:o}=t;let s=!0,i=Mt;if(32&r.shapeFlag){const t=e._;t?n&&1===t?s=!1:vo(o,e,n):(s=!e.$stable,po(e,o)),i=e}else e&&(ho(t,e),i={default:1});if(s)for(const a in o)lo(a)||null!=i[a]||delete o[a]})(t,e.children,n),He(),ur(t),We()},B=(t,e,n,r,o,s,i,a,c=!1)=>{const u=t&&t.children,f=t?t.shapeFlag:0,p=e.children,{patchFlag:d,shapeFlag:h}=e;if(d>0){if(128&d)return void D(u,p,n,r,o,s,i,a,c);if(256&d)return void R(u,p,n,r,o,s,i,a,c)}8&h?(16&f&&H(u,o,s),p!==u&&l(n,p)):16&f?16&h?D(u,p,n,r,o,s,i,a,c):H(u,o,s,!0):(8&f&&l(n,''),16&h&&E(p,n,r,o,s,i,a,c))},R=(t,e,n,r,o,s,i,a,c)=>{e=e||Pt;const l=(t=t||Pt).length,u=e.length,f=Math.min(l,u);let p;for(p=0;p<f;p++){const r=e[p]=c?Qo(e[p]):Yo(e[p]);h(t[p],r,n,null,o,s,i,a,c)}l>u?H(t,o,s,!0,!1,f):E(e,n,r,o,s,i,a,c,f)},D=(t,e,n,r,o,s,i,a,c)=>{let l=0;const u=e.length;let f=t.length-1,p=u-1;for(;l<=f&&l<=p;){const r=t[l],u=e[l]=c?Qo(e[l]):Yo(e[l]);if(!Ho(r,u))break;h(r,u,n,null,o,s,i,a,c),l++}for(;l<=f&&l<=p;){const r=t[f],l=e[p]=c?Qo(e[p]):Yo(e[p]);if(!Ho(r,l))break;h(r,l,n,null,o,s,i,a,c),f--,p--}if(l>f){if(l<=p){const t=p+1,f=t<u?e[t].el:r;for(;l<=p;)h(null,e[l]=c?Qo(e[l]):Yo(e[l]),n,f,o,s,i,a,c),l++}}else if(l>p)for(;l<=f;)P(t[l],o,s,!0),l++;else{const d=l,v=l,g=new Map;for(l=v;l<=p;l++){const t=e[l]=c?Qo(e[l]):Yo(e[l]);null!=t.key&&g.set(t.key,l)}let y,m=0;const w=p-v+1;let b=!1,x=0;const S=new Array(w);for(l=0;l<w;l++)S[l]=0;for(l=d;l<=f;l++){const r=t[l];if(m>=w){P(r,o,s,!0);continue}let u;if(null!=r.key)u=g.get(r.key);else for(y=v;y<=p;y++)if(0===S[y-v]&&Ho(r,e[y])){u=y;break}void 0===u?P(r,o,s,!0):(S[u-v]=l+1,u>=x?x=u:b=!0,h(r,e[u],n,null,o,s,i,a,c),m++)}const E=b?function(t){const e=t.slice(),n=[0];let r,o,s,i,a;const c=t.length;for(r=0;r<c;r++){const c=t[r];if(0!==c){if(o=n[n.length-1],t[o]<c){e[r]=o,n.push(r);continue}for(s=0,i=n.length-1;s<i;)a=s+i>>1,t[n[a]]<c?s=a+1:i=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}s=n.length,i=n[s-1];for(;s-- >0;)n[s]=i,i=e[i];return n}(S):Pt;for(y=E.length-1,l=w-1;l>=0;l--){const t=v+l,f=e[t],p=e[t+1],d=t+1<u?p.el||p.placeholder:r;0===S[l]?h(null,f,n,d,o,s,i,a,c):b&&(y<0||l!==E[y]?M(f,n,d,2):y--)}}},M=(t,e,o,s,i=null)=>{const{el:a,type:c,transition:l,children:u,shapeFlag:f}=t;if(6&f)return void M(t.component.subTree,e,o,s);if(128&f)return void t.suspense.move(e,o,s);if(64&f)return void c.move(t,e,o,q);if(c===jo){n(a,e,o);for(let t=0;t<u.length;t++)M(u[t],e,o,s);return void n(t.anchor,e,o)}if(c===Bo)return void m(t,e,o);if(2!==s&&1&f&&l)if(0===s)l.beforeEnter(a),n(a,e,o),go(()=>l.enter(a),i);else{const{leave:s,delayLeave:i,afterLeave:c}=l,u=()=>{t.ctx.isUnmounted?r(a):n(a,e,o)},f=()=>{a._isLeaving&&a[Mr](!0),s(a,()=>{u(),c&&c()})};i?i(a,u,f):f()}else n(a,e,o)},P=(t,e,n,r=!1,o=!1)=>{const{type:s,props:i,ref:a,children:c,dynamicChildren:l,shapeFlag:u,patchFlag:f,dirs:p,cacheIndex:d}=t;if(-2===f&&(o=!1),null!=a&&(He(),Ur(a,null,n,t,!0),We()),null!=d&&(e.renderCache[d]=void 0),256&u)return void e.ctx.deactivate(t);const h=1&u&&p,v=!Hr(t);let g;if(v&&(g=i&&i.onVnodeBeforeUnmount)&&es(g,e,t),6&u)U(t.component,n,r);else{if(128&u)return void t.suspense.unmount(n,r);h&&Tr(t,null,e,'beforeUnmount'),64&u?t.type.remove(t,e,n,q,r):l&&!l.hasOnce&&(s!==jo||f>0&&64&f)?H(l,e,n,!1,!0):(s===jo&&384&f||!o&&16&u)&&H(c,e,n),r&&N(t)}(v&&(g=i&&i.onVnodeUnmounted)||h)&&go(()=>{g&&es(g,e,t),h&&Tr(t,null,e,'unmounted')},n)},N=t=>{const{type:e,el:n,anchor:o,transition:s}=t;if(e===jo)return void V(n,o);if(e===Bo)return void w(t);const i=()=>{r(n),s&&!s.persisted&&s.afterLeave&&s.afterLeave()};if(1&t.shapeFlag&&s&&!s.persisted){const{leave:e,delayLeave:r}=s,o=()=>e(n,i);r?r(t.el,i,o):o()}else i()},V=(t,e)=>{let n;for(;t!==e;)n=f(t),r(t),t=n;r(e)},U=(t,e,n)=>{const{bum:r,scope:o,job:s,subTree:i,um:a,m:c,a:l}=t;var u;xo(c),xo(l),r&&pe(r),o.stop(),s&&(s.flags|=8,P(i,t,e,n)),a&&go(a,e),go(()=>{t.isUnmounted=!0},e),u=t,hr&&'function'==typeof hr.cleanupBuffer&&!hr.cleanupBuffer(u)&&br(u)},H=(t,e,n,r=!1,o=!1,s=0)=>{for(let i=s;i<t.length;i++)P(t[i],e,n,r,o)},W=t=>{if(6&t.shapeFlag)return W(t.component.subTree);if(128&t.shapeFlag)return t.suspense.next();const e=f(t.anchor||t.el),n=e&&e[Cr];return n?f(n):e};let G=!1;const J=(t,e,n)=>{null==t?e._vnode&&P(e._vnode,null,null,!0):h(e._vnode||null,t,e,null,null,null,n),e._vnode=t,G||(G=!0,ur(),fr(),G=!1)},q={p:h,um:P,m:M,r:N,mt:A,mc:E,pc:B,pbc:C,n:W,o:t};let X;return{render:J,hydrate:X,createApp:to(J)}}(t)}function _o({type:t,props:e},n){return'svg'===n&&'foreignObject'===t||'mathml'===n&&'annotation-xml'===t&&e&&e.encoding&&e.encoding.includes('html')?void 0:n}function mo({effect:t,job:e},n){n?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function wo(t,e,n=!1){const r=t.children,o=e.children;if(Jt(r)&&Jt(o))for(let s=0;s<r.length;s++){const t=r[s];let e=o[s];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=o[s]=Qo(o[s]),e.el=t.el),n||-2===e.patchFlag||wo(t,e)),e.type===Oo&&-1!==e.patchFlag&&(e.el=t.el),e.type!==Lo||e.el||(e.el=t.el)}}function bo(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:bo(e)}function xo(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const So=(t,e)=>'modelValue'===e||'model-value'===e?t.modelModifiers:t[`${e}Modifiers`]||t[`${ie(e)}Modifiers`]||t[`${ce(e)}Modifiers`];function Eo(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||Mt;let o=n;const s=e.startsWith('update:'),i=s&&So(r,e.slice(7));let a;i&&(i.trim&&(o=n.map(t=>Kt(t)?t.trim():t)),i.number&&(o=n.map(he))),function(t,e,n){yr('component:emit',t.appContext.app,t,e,n)}(t,e,o);let c=r[a=ue(e)]||r[a=ue(ie(e))];!c&&s&&(c=r[a=ue(ce(e))]),c&&Yn(c,t,6,o);const l=r[a+'Once'];if(l){if(t.emitted){if(t.emitted[a])return}else t.emitted={};t.emitted[a]=!0,Yn(l,t,6,o)}}function $o(t,e,n=!1){const r=e.emitsCache,o=r.get(t);if(void 0!==o)return o;const s=t.emits;let i={};return s?(Jt(s)?s.forEach(t=>i[t]=null):Ht(i,s),Yt(t)&&r.set(t,i),i):(Yt(t)&&r.set(t,null),null)}function To(t,e){return!(!t||!Ut(e))&&(e=e.slice(2).replace(/Once$/,''),Gt(t,e[0].toLowerCase()+e.slice(1))||Gt(t,ce(e))||Gt(t,e))}function Co(t){const{type:e,vnode:n,proxy:r,withProxy:o,propsOptions:[s],slots:i,attrs:a,emit:c,render:l,renderCache:u,props:f,data:p,setupState:d,ctx:h,inheritAttrs:v}=t,g=$r(t);let y,m;try{if(4&n.shapeFlag){const t=o||r,e=t;y=Yo(l.call(e,t,u,f,d,p,h)),m=a}else{const t=e;0,y=Yo(t.length>1?t(f,{attrs:a,slots:i,emit:c}):t(f,null)),m=e.props?a:Io(a)}}catch(b){Ro.length=0,Qn(b,t,1),y=qo(Lo)}let w=y;if(m&&!1!==v){const t=Object.keys(m),{shapeFlag:e}=w;t.length&&7&e&&(s&&t.some(zt)&&(m=ko(m,s)),w=Xo(w,m,!1,!0))}return n.dirs&&(w=Xo(w,null,!1,!0),w.dirs=w.dirs?w.dirs.concat(n.dirs):n.dirs),n.transition&&Pr(w,n.transition),y=w,$r(g),y}const Io=t=>{let e;for(const n in t)('class'===n||'style'===n||Ut(n))&&((e||(e={}))[n]=t[n]);return e},ko=(t,e)=>{const n={};for(const r in t)zt(r)&&r.slice(9)in e||(n[r]=t[r]);return n};function Fo(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let o=0;o<r.length;o++){const s=r[o];if(e[s]!==t[s]&&!To(n,s))return!0}return!1}const Ao=t=>t.__isSuspense;const jo=Symbol.for('v-fgt'),Oo=Symbol.for('v-txt'),Lo=Symbol.for('v-cmt'),Bo=Symbol.for('v-stc'),Ro=[];let Do=null;function Mo(t=!1){Ro.push(Do=t?null:[])}let Po=1;function No(t,e=!1){Po+=t,t<0&&Do&&e&&(Do.hasOnce=!0)}function Vo(t){return t.dynamicChildren=Po>0?Do||Pt:null,Ro.pop(),Do=Ro[Ro.length-1]||null,Po>0&&Do&&Do.push(t),t}function Uo(t,e,n,r,o){return Vo(qo(t,e,n,r,o,!0))}function zo(t){return!!t&&!0===t.__v_isVNode}function Ho(t,e){return t.type===e.type&&t.key===e.key}const Wo=({key:t})=>null!=t?t:null,Go=({ref:t,ref_key:e,ref_for:n})=>('number'==typeof t&&(t=''+t),null!=t?Kt(t)||Wn(t)||Xt(t)?{i:Sr,r:t,k:e,f:!!n}:t:null);function Jo(t,e=null,n=null,r=0,o=null,s=(t===jo?0:1),i=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Wo(e),ref:e&&Go(e),scopeId:Er,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Sr};return a?(ts(c,n),128&s&&t.normalize(c)):n&&(c.shapeFlag|=Kt(n)?8:16),Po>0&&!i&&Do&&(c.patchFlag>0||6&s)&&32!==c.patchFlag&&Do.push(c),c}const qo=function(t,e=null,n=null,r=0,o=null,s=!1){t&&t!==Jr||(t=Lo);if(zo(t)){const r=Xo(t,e,!0);return n&&ts(r,n),Po>0&&!s&&Do&&(6&r.shapeFlag?Do[Do.indexOf(t)]=r:Do.push(r)),r.patchFlag=-2,r}i=t,Xt(i)&&'__vccOpts'in i&&(t=t.__vccOpts);var i;if(e){e=function(t){return t?Vn(t)||ro(t)?Ht({},t):t:null}(e);let{class:t,style:n}=e;t&&!Kt(t)&&(e.class=xe(t)),Yt(n)&&(Vn(n)&&!Jt(n)&&(n=Ht({},n)),e.style=ye(n))}const a=Kt(t)?1:Ao(t)?128:(t=>t.__isTeleport)(t)?64:Yt(t)?4:Xt(t)?2:0;return Jo(t,e,n,r,o,a,s,!0)};function Xo(t,e,n=!1,r=!1){const{props:o,ref:s,patchFlag:i,children:a,transition:c}=t,l=e?function(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const t in r)if('class'===t)e.class!==r.class&&(e.class=xe([e.class,r.class]));else if('style'===t)e.style=ye([e.style,r.style]);else if(Ut(t)){const n=e[t],o=r[t];!o||n===o||Jt(n)&&n.includes(o)||(e[t]=n?[].concat(n,o):o)}else''!==t&&(e[t]=r[t])}return e}(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&Wo(l),ref:e&&e.ref?n&&s?Jt(s)?s.concat(Go(e)):[s,Go(e)]:Go(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==jo?-1===i?16:16|i:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:c,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Xo(t.ssContent),ssFallback:t.ssFallback&&Xo(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return c&&r&&Pr(u,c.clone(u)),u}function Ko(t=' ',e=0){return qo(Oo,null,t,e)}function Zo(t='',e=!1){return e?(Mo(),Uo(Lo,null,t)):qo(Lo,null,t)}function Yo(t){return null==t||'boolean'==typeof t?qo(Lo):Jt(t)?qo(jo,null,t.slice()):zo(t)?Qo(t):qo(Oo,null,String(t))}function Qo(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:Xo(t)}function ts(t,e){let n=0;const{shapeFlag:r}=t;if(null==e)e=null;else if(Jt(e))n=16;else if('object'==typeof e){if(65&r){const n=e.default;return void(n&&(n._c&&(n._d=!1),ts(t,n()),n._c&&(n._d=!0)))}{n=32;const r=e._;r||ro(e)?3===r&&Sr&&(1===Sr.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=Sr}}else Xt(e)?(e={default:e,_ctx:Sr},n=32):(e=String(e),64&r?(n=16,e=[Ko(e)]):n=8);t.children=e,t.shapeFlag|=n}function es(t,e,n,r=null){Yn(t,e,7,[n,r])}const ns=Yr();let rs=0;let os,ss,is=null;{const t=ge(),e=(e,n)=>{let r;return(r=t[e])||(r=t[e]=[]),r.push(n),t=>{r.length>1?r.forEach(e=>e(t)):r[0](t)}};os=e('__VUE_INSTANCE_SETTERS__',t=>is=t),ss=e('__VUE_SSR_SETTERS__',t=>us=t)}const as=t=>{const e=is;return os(t),t.scope.on(),()=>{t.scope.off(),os(e)}},cs=()=>{is&&is.scope.off(),os(null)};function ls(t){return 4&t.vnode.shapeFlag}let us=!1;function fs(t,e,n){Xt(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Yt(e)&&(t.devtoolsRawSetupState=e,t.setupState=Xn(e)),ps(t)}function ps(t,e,n){const r=t.type;t.render||(t.render=r.render||Nt)}const ds={get:(t,e)=>(en(t,0,''),t[e])};function hs(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Xn((e=t.exposed,!Gt(e,'__v_skip')&&Object.isExtensible(e)&&de(e,'__v_skip',!0),e)),{get:(e,n)=>n in e?e[n]:n in Xr?Xr[n](t):void 0,has:(t,e)=>e in t||e in Xr})):t.proxy;var e}const vs=(t,e)=>{const n=function(t,e,n=!1){let r,o;return Xt(t)?r=t:(r=t.get,o=t.set),new Kn(r,o,n)}
/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/(t,0,us);return n},gs='3.5.22';
/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
let ys;const _s='undefined'!=typeof window&&window.trustedTypes;if(_s)try{ys=_s.createPolicy('vue',{createHTML:t=>t})}catch(Di){}const ms=ys?t=>ys.createHTML(t):t=>t,ws='undefined'!=typeof document?document:null,bs=ws&&ws.createElement('template'),xs={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const o='svg'===e?ws.createElementNS('http://www.w3.org/2000/svg',t):'mathml'===e?ws.createElementNS('http://www.w3.org/1998/Math/MathML',t):n?ws.createElement(t,{is:n}):ws.createElement(t);return'select'===t&&r&&null!=r.multiple&&o.setAttribute('multiple',r.multiple),o},createText:t=>ws.createTextNode(t),createComment:t=>ws.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>ws.querySelector(t),setScopeId(t,e){t.setAttribute(e,'')},insertStaticContent(t,e,n,r,o,s){const i=n?n.previousSibling:e.lastChild;if(o&&(o===s||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),n),o!==s&&(o=o.nextSibling););else{bs.innerHTML=ms('svg'===r?`<svg>${t}</svg>`:'mathml'===r?`<math>${t}</math>`:t);const o=bs.content;if('svg'===r||'mathml'===r){const t=o.firstChild;for(;t.firstChild;)o.appendChild(t.firstChild);o.removeChild(t)}e.insertBefore(o,n)}return[i?i.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},Ss=Symbol('_vtc');const Es=Symbol('_vod'),$s=Symbol('_vsh'),Ts=Symbol(''),Cs=/(?:^|;)\s*display\s*:/;const Is=/\s*!important$/;function ks(t,e,n){if(Jt(n))n.forEach(n=>ks(t,e,n));else if(null==n&&(n=''),e.startsWith('--'))t.setProperty(e,n);else{const r=function(t,e){const n=As[e];if(n)return n;let r=ie(e);if('filter'!==r&&r in t)return As[e]=r;r=le(r);for(let o=0;o<Fs.length;o++){const n=Fs[o]+r;if(n in t)return As[e]=n}return e}(t,e);Is.test(n)?t.setProperty(ce(r),n.replace(Is,''),'important'):t[r]=n}}const Fs=['Webkit','Moz','ms'],As={};const js='http://www.w3.org/1999/xlink';function Os(t,e,n,r,o,s=Se(e)){r&&e.startsWith('xlink:')?null==n?t.removeAttributeNS(js,e.slice(6,e.length)):t.setAttributeNS(js,e,n):null==n||s&&!Ee(n)?t.removeAttribute(e):t.setAttribute(e,s?'':Zt(n)?String(n):n)}function Ls(t,e,n,r,o){if('innerHTML'===e||'textContent'===e)return void(null!=n&&(t[e]='innerHTML'===e?ms(n):n));const s=t.tagName;if('value'===e&&'PROGRESS'!==s&&!s.includes('-')){const r='OPTION'===s?t.getAttribute('value')||'':t.value,o=null==n?'checkbox'===t.type?'on':'':String(n);return r===o&&'_value'in t||(t.value=o),null==n&&t.removeAttribute(e),void(t._value=n)}let i=!1;if(''===n||null==n){const r=typeof t[e];'boolean'===r?n=Ee(n):null==n&&'string'===r?(n='',i=!0):'number'===r&&(n=0,i=!0)}try{t[e]=n}catch(Di){}i&&t.removeAttribute(o||e)}const Bs=Symbol('_vei');function Rs(t,e,n,r,o=null){const s=t[Bs]||(t[Bs]={}),i=s[e];if(r&&i)i.value=r;else{const[n,a]=function(t){let e;if(Ds.test(t)){let n;for(e={};n=t.match(Ds);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}const n=':'===t[2]?t.slice(3):ce(t.slice(2));return[n,e]}(e);if(r){const i=s[e]=function(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();Yn(function(t,e){if(Jt(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(t=>e=>!e._stopped&&t&&t(e))}return e}(t,n.value),e,5,[t])};return n.value=t,n.attached=Ns(),n}(r,o);!function(t,e,n,r){t.addEventListener(e,n,r)}(t,n,i,a)}else i&&(!function(t,e,n,r){t.removeEventListener(e,n,r)}(t,n,i,a),s[e]=void 0)}}const Ds=/(?:Once|Passive|Capture)$/;let Ms=0;const Ps=Promise.resolve(),Ns=()=>Ms||(Ps.then(()=>Ms=0),Ms=Date.now());const Vs=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123;const Us=Ht({patchProp:(t,e,n,r,o,s)=>{const i='svg'===o;'class'===e?function(t,e,n){const r=t[Ss];r&&(e=(e?[e,...r]:[...r]).join(' ')),null==e?t.removeAttribute('class'):n?t.setAttribute('class',e):t.className=e}(t,r,i):'style'===e?function(t,e,n){const r=t.style,o=Kt(n);let s=!1;if(n&&!o){if(e)if(Kt(e))for(const t of e.split(';')){const e=t.slice(0,t.indexOf(':')).trim();null==n[e]&&ks(r,e,'')}else for(const t in e)null==n[t]&&ks(r,t,'');for(const t in n)'display'===t&&(s=!0),ks(r,t,n[t])}else if(o){if(e!==n){const t=r[Ts];t&&(n+=';'+t),r.cssText=n,s=Cs.test(n)}}else e&&t.removeAttribute('style');Es in t&&(t[Es]=s?r.display:'',t[$s]&&(r.display='none'))}(t,n,r):Ut(e)?zt(e)||Rs(t,e,0,r,s):('.'===e[0]?(e=e.slice(1),1):'^'===e[0]?(e=e.slice(1),0):function(t,e,n,r){if(r)return'innerHTML'===e||'textContent'===e||!!(e in t&&Vs(e)&&Xt(n));if('spellcheck'===e||'draggable'===e||'translate'===e||'autocorrect'===e)return!1;if('form'===e)return!1;if('list'===e&&'INPUT'===t.tagName)return!1;if('type'===e&&'TEXTAREA'===t.tagName)return!1;if('width'===e||'height'===e){const e=t.tagName;if('IMG'===e||'VIDEO'===e||'CANVAS'===e||'SOURCE'===e)return!1}if(Vs(e)&&Kt(n))return!1;return e in t}(t,e,r,i))?(Ls(t,e,r),t.tagName.includes('-')||'value'!==e&&'checked'!==e&&'selected'!==e||Os(t,e,r,i,0,'value'!==e)):!t._isVueCE||!/[A-Z]/.test(e)&&Kt(r)?('true-value'===e?t._trueValue=r:'false-value'===e&&(t._falseValue=r),Os(t,e,r,i)):Ls(t,ie(e),r,0,e)}},xs);let zs;const Hs=(...t)=>{const e=(zs||(zs=yo(Us))).createApp(...t),{mount:n}=e;return e.mount=t=>{const r=function(t){if(Kt(t)){return document.querySelector(t)}return t}(t);if(!r)return;const o=e._component;Xt(o)||o.render||o.template||(o.template=r.innerHTML),1===r.nodeType&&(r.textContent='');const s=n(r,!1,function(t){if(t instanceof SVGElement)return'svg';if('function'==typeof MathMLElement&&t instanceof MathMLElement)return'mathml'}(r));return r instanceof Element&&(r.removeAttribute('v-cloak'),r.setAttribute('data-v-app','')),s},e};const Ws='[ST-VarSystemExtension/reprocessMenuItem]',Gs=Nr({__name:'reprocessMenuItem',setup(e,{expose:n}){n();const r=Gn(null),o=Gn(!1),a=Gn(!1),l=vs(()=>a.value&&o.value);function u(){try{const e=t(),n=e.characters?.[e.characterId];r.value=e.characterId,o.value=Boolean(e.chat&&e.chat.length>0),a.value=n?.data?.extensions?.st_var_system?.enabled??!1}catch(L){console.error(Ws,'更新可见性状态失败:',L),a.value=!1,o.value=!1}}u(),s.on(i.CHAT_CHANGED,u),s.on(i.MESSAGE_RECEIVED,u),s.on(i.MESSAGE_DELETED,u),s.on(i.CHARACTER_SELECTED,u),Wr(()=>{s.removeListener(i.CHAT_CHANGED,u),s.removeListener(i.MESSAGE_RECEIVED,u),s.removeListener(i.MESSAGE_DELETED,u),s.removeListener(i.CHARACTER_SELECTED,u)});const f={MODULE_NAME:Ws,characterId:r,hasChat:o,isEnabled:a,isVisible:l,updateVisibility:u,handleReprocess:async function(){console.log(Ws,'点击重新处理变量按钮');try{const e=t(),n=e.chat;if(!n||0===n.length)return void toastr.warning('当前聊天为空','变量系统');const r=e.characters[e.characterId];if(!(r?.data?.extensions?.st_var_system?.enabled??!1))return void toastr.warning('当前角色未启用变量系统','变量系统');let o=-1;for(let t=n.length-1;t>=0;t--)if(!n[t].is_user){o=t;break}if(-1===o)return void toastr.warning('没有找到 AI 消息','变量系统');const s=n[o],i=s.swipe_id||0,a=s.swipes_info?.[i]?.st_var_system_snapshot_id;a?(console.log(Ws,`清除第 ${o} 层 (swipe ${i}) 的快照标识符:`,a),delete s.swipes_info[i].st_var_system_snapshot_id,await c()):console.log(Ws,`第 ${o} 层 (swipe ${i}) 没有快照标识符，直接重新处理`),toastr.info('开始重新处理变量...','变量系统'),await rt(o),toastr.success('变量重新处理完成','变量系统')}catch(L){console.error(Ws,'重新处理变量失败:',L),toastr.error(`重新处理变量失败：${L.message}`,'变量系统')}}};return Object.defineProperty(f,'__isScriptSetup',{enumerable:!1,value:!0}),f}}),Js={key:0,class:'extension_container'};const qs=((t,e)=>{const n=t.__vccOpts||t;for(const[r,o]of e)n[r]=o;return n})(Gs,[['render',function(t,e,n,r,o,s){return Mo(),Uo(Br,{defer:'',to:'#extensionsMenu'},[r.isVisible?(Mo(),i='div',a=Js,c=[Jo('div',{class:'list-group-item flex-container flexGap5 interactable',tabindex:'0',role:'listitem',onClick:r.handleReprocess},[...e[0]||(e[0]=[Jo('div',{class:'fa-solid fa-rotate extensionsMenuExtensionButton'},null,-1),Jo('span',null,'重新处理变量',-1)])])],Vo(Jo(i,a,c,l,u,f,!0))):Zo('',!0)]);var i,a,c,l,u,f}],['__file','reprocessMenuItem.vue']]);void 0===window._&&(window._=w,console.log('[ST-VarSystemExtension] Lodash 已注入到 window._'));const Xs='[ST-VarSystemExtension]',Ks='st_var_system',Zs='var_system_template_status',Ys={editorController:null,currentCharacterId:null,templateBody:null,draftBody:null,enabled:!1,dirty:!1,hasErrors:!1,loading:!1};let Qs=null,ti=null;const ei={success:'#6ee7b7',error:'#fca5a5',warn:'#fbbf24',info:'var(--SmartThemeBodyColor, #aaa)'};function ni(e){if(!e||Qs)return;Qs={save:e.querySelector('#var_system_template_save'),saveAsGlobal:e.querySelector('#var_system_template_save_as_global'),discard:e.querySelector('#var_system_template_discard'),reload:e.querySelector('#var_system_template_reload'),status:e.querySelector(`#${Zs}`),clear:e.querySelector('#var_system_template_clear'),enableToggle:e.querySelector('#var_system_template_enabled')},Qs.save?.addEventListener('click',()=>{!async function(){if(Ys.hasErrors)return void ri('存在未解决的 JSON 错误，无法保存。','error');const e=await ci();if(!e)return void ri('编辑器尚未准备就绪。','error');const r=e.get(),o=r?.json;if(void 0===o)return void ri('请修复模板中的错误后再保存。','error');const s=t().characterId;if(null==s)return void ri('未选择角色，无法保存模板。','error');Ys.loading=!0,oi(),ri('模板保存中……','info');try{const t={templateBody:o,enabled:Ys.enabled};await n(s,Ks,t),Ys.templateBody=ai(o),Ys.draftBody=ai(o),Ys.dirty=!1,Ys.hasErrors=!1,ri('模板已保存。','success')}catch(L){console.error(Xs,'保存模板失败',L),ri(`保存模板失败：${L?.message??L}`,'error')}finally{Ys.loading=!1,oi()}}()}),Qs.saveAsGlobal?.addEventListener('click',()=>{!async function(){const e=t();if(!e.characterId)return void(await l('请先选择一个角色',u.TEXT,'',{okButton:'确定'}));const n=await ci();if(!n)return void ri('编辑器尚未准备就绪。','error');const r=n.get(),o=r?.json;if(void 0===o||!o)return void(await l('当前模板为空或有错误，无法保存为全局快照',u.TEXT,'',{okButton:'确定'}));const s=e.characters?.[e.characterId],i=s?.name?`${s.name}的模板`:'角色模板',a=await l('请输入全局快照的名称：',u.INPUT,i,{okButton:'保存',cancelButton:'取消'});if(!a)return;try{ri('正在保存为全局快照...','info');const t={name:a,description:`从角色"${s?.name||'未知'}"的模板创建`,tags:['角色模板',s?.name].filter(Boolean),snapshotBody:o};await Ei('/global-snapshots',{method:'POST',body:JSON.stringify(t)}),ri(`已保存为全局快照："${a}"`,'success'),console.log(`${Xs} 角色模板已保存为全局快照:`,a);await l(`全局快照"${a}"已创建成功！\n\n是否切换到全局快照标签页查看？`,u.CONFIRM,'',{okButton:'查看',cancelButton:'留在这里'})&&(document.getElementById('var_system_tab_global')?.click(),await Ii())}catch(L){console.error(`${Xs} 保存为全局快照失败:`,L);let e='保存失败';e=L.message.includes('插件未安装')?'插件未安装或未启用。\n\n全局快照功能需要安装 ST-VarSystemPlugin 插件。':`保存失败: ${L.message}`,ri(e,'error'),await l(e,u.TEXT,'',{okButton:'关闭'})}}()}),Qs.discard?.addEventListener('click',()=>{!async function(){if(!Ys.templateBody)return void ri('没有可恢复的模板版本。','warn');Ys.draftBody=ai(Ys.templateBody),Ys.dirty=!1,Ys.hasErrors=!1;const t=await ci();t&&t.setValue(Ys.draftBody??{},{silent:!0});oi(),ri('已恢复为最后保存的模板。','info')}()}),Qs.reload?.addEventListener('click',()=>{ui(!0)}),Qs.clear?.addEventListener('click',()=>{!async function(){const e=t(),r=e.characterId;if(null==r)return void ri('未选择角色，无法清空模板。','error');if(!Ys.templateBody)return void ri('当前没有保存的模板，无需清空。','info');const o='确定要清空模板吗？这会从角色卡中移除模板字段，但不会改变启用状态。';if(!(window.confirm?.(o)??confirm(o)))return void ri('已取消清空模板。','info');Ys.loading=!0,oi(),ri('正在清空模板……','info');try{const t={enabled:Ys.enabled};await n(r,Ks,t);e.characters;const o=await ci(),s={};Ys.templateBody=null,Ys.draftBody=ai(s),Ys.dirty=!0,Ys.hasErrors=!1,o&&o.setValue(s,{silent:!1}),ri('模板字段已清空，编辑器已恢复默认骨架，请视需要重新保存。','warn')}catch(L){console.error(Xs,'清空模板失败',L),ri(`清空模板失败：${L?.message??L}`,'error')}finally{Ys.loading=!1,oi()}}()}),Qs.enableToggle?.addEventListener('change',e=>{!async function(e){const r=t().characterId;if(null==r)return ri('未选择角色，无法修改启用状态。','error'),void si();if(Ys.loading)return void si();const o=Ys.enabled;Ys.enabled=Boolean(e),Ys.loading=!0,oi(),ri(Ys.enabled?'正在启用变量系统……':'正在停用变量系统……','info');try{const t={enabled:Ys.enabled};Ys.templateBody&&(t.templateBody=ai(Ys.templateBody)),await n(r,Ks,t),ri(Ys.enabled?'变量系统已为该角色启用。':'变量系统已为该角色停用。','success')}catch(L){console.error(Xs,'更新启用状态失败',L),Ys.enabled=o,ri(`更新启用状态失败：${L?.message??L}`,'error')}finally{Ys.loading=!1,si(),oi()}}(Boolean(e.target?.checked))});const r=e.querySelector('#var_system_template_export'),o=e.querySelector('#var_system_template_import'),s=e.querySelector('#var_system_template_strip_schema');r?.addEventListener('click',()=>{!async function(){const e=await ci();if(!e)return void toastr.error('编辑器尚未准备就绪');const n=e.get(),r=n?.json;if(void 0===r)return void toastr.error('请修复模板中的错误后再导出');const o=t(),s=o.characters?.[o.characterId],i=s?.name||'unknown',a=(new Date).toISOString().replace(/[:.]/g,'-').slice(0,19),c=`template_${i}_${a}.json`;bi(r,c),toastr.success(`已导出：${c}`)}()}),o?.addEventListener('click',()=>{!async function(){const t=await xi();if(!t)return;const e=await ci();if(!e)return void toastr.error('编辑器尚未准备就绪');const n=Si(t,!1);e.set({json:n}),Ys.dirty=!0,Ys.draftBody=ai(n),oi(),toastr.success('JSON 已导入到编辑器')}()}),s?.addEventListener('click',()=>{!async function(){const t=await ci();if(!t)return void toastr.error('编辑器尚未准备就绪');const e=t.get(),n=e?.json;if(void 0===n)return void toastr.error('请修复模板中的错误后再分离 Schema');const r=wi(n);t.set({json:r}),Ys.dirty=!0,Ys.draftBody=ai(r),oi(),toastr.success('已移除 MVU Schema 字段')}()}),ri('尚未加载模板','info'),oi()}function ri(t,e='info'){const n=Qs?.status||document.getElementById(Zs);n&&(n.textContent=t??'',n.style.color=ei[e]??ei.info)}function oi(){if(!Qs)return;const t=null!==Ys.templateBody,e=Ys.loading||!Ys.draftBody;Qs.save&&(Qs.save.disabled=e||Ys.hasErrors||!Ys.dirty),Qs.discard&&(Qs.discard.disabled=e||!t||!Ys.dirty),Qs.reload&&(Qs.reload.disabled=Ys.loading),Qs.clear&&(Qs.clear.disabled=Ys.loading||!t),si()}function si(){if(!Qs?.enableToggle)return;const t=Ys.loading||!Ys.currentCharacterId;Qs.enableToggle.disabled=t,Qs.enableToggle.checked=Boolean(Ys.enabled)}function ii(t=!1){null!==ti&&clearTimeout(ti),ti=setTimeout(()=>{ti=null,ui(t)},0)}function ai(t){return null==t?t:'function'==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t))}async function ci({readOnly:t=!1}={}){const e=document.getElementById('var_system_template_editor');if(!e)return null;Ys.editorController?Ys.editorController.setContainer(e):Ys.editorController=I({container:e,initialValue:Ys.draftBody??{},readOnly:t,onChange:li,onFallback:()=>{ri('JSON 编辑器初始化失败，已降级为纯文本模式。','warn'),oi()}});try{await Ys.editorController.ensureReady()}catch(L){return console.error(Xs,'初始化编辑器失败',L),null}return Ys.editorController}function li(t,e,n){console.log('[ST-VarSystemExtension] handleEditorChange:',{hasContent:!!t,hasJson:void 0!==t?.json,jsonType:typeof t?.json,hasContentErrors:!!n?.contentErrors?.length,contentErrors:n?.contentErrors});const r=void 0===t?.json;Ys.hasErrors=r,Ys.dirty=!0,r||(Ys.draftBody=ai(t.json)),oi(),ri(r?'JSON 无法解析，请检查错误。':'模板已修改，尚未保存。',r?'error':'warn')}async function ui(e=!1){const n=t(),r=n.characterId;if(null==r)return Ys.currentCharacterId=null,Ys.templateBody=null,Ys.draftBody=null,Ys.enabled=!1,Ys.dirty=!1,Ys.hasErrors=!1,Ys.loading=!1,Ys.editorController&&Ys.editorController.setValue({},{silent:!0}),ri('请选择角色后再编辑模板。','warn'),void oi();if(e||Ys.currentCharacterId!==r){Ys.loading=!0,oi(),ri('模板加载中……','info');try{const t=await ci(),e=n.characters?.[r],o=e?.data?.extensions?.[Ks]??null,s=Boolean(o?.templateBody),i=s?o.templateBody:{};Ys.currentCharacterId=r,Ys.templateBody=s?ai(i):null,Ys.draftBody=ai(i),Ys.enabled=Boolean(o?.enabled),Ys.dirty=!s,Ys.hasErrors=!1,t&&t.setValue(Ys.draftBody??{},{silent:!0});ri(s?'模板已加载。':'已为该角色准备默认模板，请完善后保存。',s?'info':'warn')}catch(L){console.error(Xs,'加载模板失败',L),ri(`加载模板失败：${L?.message??L}`,'error')}finally{Ys.loading=!1,oi()}}}function fi(){ii(!0)}function pi(t,e){const n=window.EDITOR;if(n?.slideToggle){const e={...n.getSlideToggleOptions?.()??{},onAnimationEnd:t=>{t.closest('.drawer-content')?.classList.remove('resizing')}};return t.classList.add('resizing'),void n.slideToggle(t,e)}const r=$(t);e?r.stop(!0,!0).slideDown(200):r.stop(!0,!0).slideUp(200)}function di(t,e){t.hasClass('openIcon')&&(t.toggleClass('openIcon closedIcon'),e.toggleClass('openDrawer closedDrawer'),pi(e.get(0),!1))}let hi='character';async function vi(t){hi!==t&&(hi=t,document.querySelectorAll('.var-system-tab').forEach(e=>{e.dataset.tab===t?(e.classList.add('active'),e.style.borderBottomColor='var(--SmartThemeQuoteColor, #4a9eff)',e.style.color='var(--SmartThemeQuoteColor, #4a9eff)'):(e.classList.remove('active'),e.style.borderBottomColor='transparent',e.style.color='var(--SmartThemeBodyColor, inherit)')}),document.querySelectorAll('.var-system-tab-content[data-tab]').forEach(e=>{e.dataset.tab===t?e.style.display='flex':e.style.display='none'}),console.log(`${Xs} 切换到标签页: ${t}`),'global'===t?Ii():'functions'===t?console.log(`${Xs} 函数库标签页已激活`):'messages'===t&&console.log(`${Xs} 楼层快照标签页已激活`))}const gi='/api/plugins/var-manager/var-manager',yi={snapshots:[],filteredSnapshots:[],searchQuery:'',selectedTag:'',loading:!1,viewMode:'list',editorController:null,editingSnapshotId:null,draftSnapshot:null};let _i=null,mi=null;function wi(t){if(Array.isArray(t))return t.filter(t=>'$__META_EXTENSIBLE__$'!==t).map(t=>wi(t));if('object'==typeof t&&null!==t&&!(t instanceof Date)){const e={};for(const n in t)n.startsWith('$')||(e[n]=wi(t[n]));return e}return t}function bi(t,e){const n=JSON.stringify(t,null,2),r=new Blob([n],{type:'application/json'}),o=URL.createObjectURL(r),s=document.createElement('a');s.href=o,s.download=e,s.click(),URL.revokeObjectURL(o)}async function xi(){return new Promise(t=>{const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text(),r=JSON.parse(e);t(r)}catch(L){toastr.error(`导入失败：${L.message}`),t(null)}else t(null)},e.click()})}function Si(t,e=!1){if(!t||'object'!=typeof t)return{};if('metadata'in t&&'variables'in t){console.log(`${Xs} 检测到旧格式快照，自动提取 variables 字段`);const n=t.variables||{};return e&&'object'==typeof n?wi(n):n}return e&&'object'==typeof t?wi(t):t}async function Ei(t,e={}){const n=`${gi}${t}`,r={...o(),'Content-Type':'application/json',...e.headers};try{const t=await fetch(n,{...e,headers:r});if(!t.ok){if(404===t.status)throw new Error('插件未安装或未启用');throw new Error(`API 请求失败: ${t.status} ${t.statusText}`)}return 204===t.status?null:await t.json()}catch(L){throw console.error(`${Xs} API 调用失败:`,t,L),L}}function $i(t){if(yi.viewMode===t)return;yi.viewMode=t;const e=document.getElementById('var_system_snapshots_list_view'),n=document.getElementById('var_system_snapshot_editor_view');'list'===t?(e.style.display='flex',n.style.display='none'):(e.style.display='none',n.style.display='flex'),console.log(`${Xs} 快照视图切换到: ${t}`)}async function Ti(){if(yi.editorController)return;const t=document.getElementById('var_system_snapshot_body_editor');if(t)try{yi.editorController=I({container:t,initialValue:{},readOnly:!1,onChange:(t,e,n)=>{const r=void 0===t?.json;!r&&yi.draftSnapshot&&(yi.draftSnapshot.snapshotBody=t.json),Ci(r?'JSON 无法解析，请检查错误。':'已修改，未保存',r?'error':'warn')},onFallback:()=>{console.warn(`${Xs} 快照编辑器 JSON 资源加载失败，已降级为纯文本模式`),Ci('编辑器已降级为纯文本模式','warn')}}),await yi.editorController.ensureReady(),console.log(`${Xs} 快照编辑器已初始化`)}catch(L){console.error(`${Xs} 快照编辑器初始化失败:`,L)}else console.error(`${Xs} 找不到快照编辑器容器`)}function Ci(t,e='info'){const n=document.getElementById('var_system_snapshot_editor_status');n&&(n.textContent=t,n.style.color=ei[e]||ei.info)}async function Ii(){if(yi.loading)console.log(`${Xs} 快照正在加载中，跳过重复请求`);else{yi.loading=!0,Ai('加载中...');try{console.log(`${Xs} 开始加载全局快照...`);const t=await Ei('/global-snapshots');yi.snapshots=t.snapshots||[],console.log(`${Xs} 已加载 ${yi.snapshots.length} 个全局快照`,yi.snapshots),ki(),Fi(),function(){const t=document.getElementById('var_system_snapshot_tag_filter');if(!t)return;const e=new Set;yi.snapshots.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(t=>{t?.trim()&&e.add(t.trim())})});const n=Array.from(e).sort(),r=t.value;t.innerHTML='<option value="" data-i18n="All tags">所有标签</option>',n.forEach(e=>{const n=document.createElement('option');n.value=e,n.textContent=e,t.appendChild(n)}),r&&n.includes(r)&&(t.value=r)}()}catch(L){console.error(`${Xs} 加载全局快照失败:`,L),yi.snapshots=[],yi.filteredSnapshots=[];let e='加载失败';e=L.message.includes('插件未安装')?'插件未安装或未启用<br><br>全局快照功能需要安装 ST-VarSystemPlugin 插件':L.message.includes('Failed to fetch')?'无法连接到插件 API<br><br>请确保 SillyTavern 服务器正在运行':`加载失败: ${L.message}`,Ai(e),Fi()}finally{yi.loading=!1,console.log(`${Xs} 加载全局快照完成，loading = false`)}}}function ki(){let t=[...yi.snapshots];if(yi.searchQuery){const e=yi.searchQuery.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}yi.selectedTag&&(t=t.filter(t=>t.tags?.includes(yi.selectedTag))),yi.filteredSnapshots=t}function Fi(){const e=document.getElementById('var_system_snapshots_list'),n=document.getElementById('var_system_snapshots_empty');if(e){if(e.querySelectorAll('.snapshot-card').forEach(t=>{t.remove()}),0===yi.filteredSnapshots.length)return n.innerHTML='\n      <i class="fa-solid fa-inbox fa-3x" style="margin-bottom: 10px; opacity: 0.5"></i>\n      <p data-i18n="No snapshots yet">暂无全局快照</p>\n      <p style="font-size: 12px" data-i18n="Click New to create one">点击"新建快照"创建第一个快照</p>\n    ',void(n.style.display='block');n.style.display='none',yi.filteredSnapshots.forEach(r=>{const o=function(e){const n=document.createElement('div');n.className='snapshot-card',n.dataset.snapshotId=e.snapshotId,n.style.cssText='\n    border: 1px solid var(--SmartThemeBorderColor, #333);\n    border-radius: 6px;\n    padding: 14px;\n    background: var(--SmartThemeBlurTintColor, rgba(0,0,0,0.2));\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: border-color 0.2s, box-shadow 0.2s;\n  ',n.addEventListener('mouseenter',()=>{n.style.borderColor='var(--SmartThemeQuoteColor, #4a9eff)',n.style.boxShadow='0 2px 8px rgba(74, 158, 255, 0.2)'}),n.addEventListener('mouseleave',()=>{n.style.borderColor='var(--SmartThemeBorderColor, #333)',n.style.boxShadow='none'});const r=document.createElement('h4');if(r.textContent=e.name,r.style.cssText='margin: 0; font-size: 16px; font-weight: 600;',n.appendChild(r),e.description){const t=document.createElement('p');t.textContent=e.description,t.style.cssText='margin: 0; font-size: 13px; color: var(--SmartThemeBodyColor, #aaa); line-height: 1.4;',n.appendChild(t)}if(e.tags&&e.tags.length>0){const t=document.createElement('div');t.style.cssText='display: flex; gap: 6px; flex-wrap: wrap;',e.tags.forEach(e=>{const n=document.createElement('span');n.textContent=e,n.style.cssText='\n        padding: 3px 10px;\n        font-size: 11px;\n        border-radius: 12px;\n        background: var(--SmartThemeQuoteColor, #4a9eff);\n        color: white;\n        font-weight: 500;\n        letter-spacing: 0.3px;\n      ',t.appendChild(n)}),n.appendChild(t)}const o=document.createElement('div');o.style.cssText='font-size: 11px; color: var(--SmartThemeBodyColor, #888);';const s=new Date(e.createdAt).toLocaleString('zh-CN');o.textContent=`创建于 ${s}`,n.appendChild(o);const i=document.createElement('div');i.style.cssText='display: flex; gap: 6px; flex-wrap: wrap; margin-top: 4px;';const a=[{text:'查看/编辑',icon:'fa-pen-to-square',action:()=>async function(t){console.log(`${Xs} 编辑快照:`,t);try{const e=await Ei(`/global-snapshots/${t}`);yi.editingSnapshotId=t,yi.draftSnapshot={...e},$i('editor');const n=document.getElementById('var_system_snapshot_editor_title');n&&(n.textContent=`编辑快照: ${e.name}`),document.getElementById('var_system_snapshot_name').value=e.name||'',document.getElementById('var_system_snapshot_description').value=e.description||'',document.getElementById('var_system_snapshot_tags').value=e.tags?e.tags.join(', '):'',await Ti();const r=Si(e.snapshotBody);yi.editorController?yi.editorController.set({json:r}):console.error(`${Xs} 编辑器未能初始化`),Ci('编辑快照，修改后点击保存','info')}catch(L){console.error(`${Xs} 加载快照失败:`,L),await l(`加载快照失败: ${L.message}`,u.TEXT,'',{okButton:'关闭'})}}(e.snapshotId)},{text:'应用到角色',icon:'fa-download',action:()=>async function(e){if(!t().characterId)return void(await l('请先选择一个角色',u.TEXT,'',{okButton:'确定'}));try{const t=await Ei(`/global-snapshots/${e}`);if(!(await l(`将快照 "${t.name}" 应用到当前角色会覆盖现有模板内容。\n\n是否继续？`,u.CONFIRM,'',{okButton:'应用',cancelButton:'取消'})))return;const n=Si(t.snapshotBody);Ys.draftBody=n,Ys.dirty=!0,Ys.editorController&&Ys.editorController.set({json:Ys.draftBody}),ri(`已加载快照 "${t.name}"，请保存以应用`,'success'),oi(),vi('character'),console.log(`${Xs} 已将快照 ${e} 加载到角色模板`)}catch(L){console.error(`${Xs} 加载快照失败:`,L),await l(`加载快照失败: ${L.message}`,u.TEXT,'',{okButton:'关闭'})}}(e.snapshotId)},{text:'删除',icon:'fa-trash',action:()=>async function(t){const e=yi.snapshots.find(e=>e.snapshotId===t);if(!e)return;const n=await l(`确定要删除快照 "${e.name}" 吗？\n\n此操作不可撤销。`,u.CONFIRM,'',{okButton:'删除',cancelButton:'取消'});if(!n)return;try{await Ei(`/global-snapshots/${t}`,{method:'DELETE'}),console.log(`${Xs} 已删除快照:`,t),yi.snapshots=yi.snapshots.filter(e=>e.snapshotId!==t),ki(),Fi()}catch(L){console.error(`${Xs} 删除快照失败:`,L),await l(`删除失败: ${L.message}`,u.TEXT,'',{okButton:'关闭'})}}(e.snapshotId),danger:!0}];return a.forEach(t=>{const e=document.createElement('button');e.className='menu_button interactable';const n=t.danger?'color: #ff6b6b;':'';e.style.cssText=`padding: 4px 10px; font-size: 12px; white-space: nowrap; ${n}`,e.innerHTML=`<i class="fa-solid ${t.icon} fa-fw"></i> <span>${t.text}</span>`,e.addEventListener('click',t.action),i.appendChild(e)}),n.appendChild(i),n}(r);e.insertBefore(o,n)})}}function Ai(t){const e=document.getElementById('var_system_snapshots_empty');e&&(e.innerHTML=`<p style="text-align: center; padding: 20px;">${t}</p>`,e.style.display='block')}async function ji(){const t=document.getElementById('var_system_snapshot_name').value.trim()!==(yi.draftSnapshot?.name||''),e=document.getElementById('var_system_snapshot_description').value.trim()!==(yi.draftSnapshot?.description||'');if(t||e){if(!(await l('有未保存的修改，确定要放弃吗？',u.CONFIRM,'',{okButton:'放弃',cancelButton:'继续编辑'})))return}yi.editingSnapshotId=null,yi.draftSnapshot=null,$i('list'),Fi()}function Oi(t){t&&!_i&&(_i={search:t.querySelector('#var_system_snapshot_search'),tagFilter:t.querySelector('#var_system_snapshot_tag_filter'),newBtn:t.querySelector('#var_system_snapshot_new'),refreshBtn:t.querySelector('#var_system_snapshot_refresh')},mi={back:t.querySelector('#var_system_snapshot_editor_back'),save:t.querySelector('#var_system_snapshot_editor_save'),cancel:t.querySelector('#var_system_snapshot_editor_cancel'),export:t.querySelector('#var_system_snapshot_editor_export'),import:t.querySelector('#var_system_snapshot_editor_import'),stripSchema:t.querySelector('#var_system_snapshot_editor_strip_schema')},_i.search?.addEventListener('input',t=>{yi.searchQuery=t.target.value,ki(),Fi()}),_i.tagFilter?.addEventListener('change',t=>{yi.selectedTag=t.target.value,ki(),Fi()}),_i.newBtn?.addEventListener('click',()=>{!async function(){console.log(`${Xs} 新建快照`),yi.editingSnapshotId=null,yi.draftSnapshot={name:'',description:'',tags:[],snapshotBody:{}},$i('editor');const t=document.getElementById('var_system_snapshot_editor_title');t&&(t.textContent='新建快照'),document.getElementById('var_system_snapshot_name').value='',document.getElementById('var_system_snapshot_description').value='',document.getElementById('var_system_snapshot_tags').value='',await Ti(),yi.editorController?yi.editorController.set({json:yi.draftSnapshot.snapshotBody}):console.error(`${Xs} 编辑器未能初始化`),Ci('新建快照，填写信息后点击保存','info')}()}),_i.refreshBtn?.addEventListener('click',()=>{Ii()}),mi.back?.addEventListener('click',()=>{ji()}),mi.save?.addEventListener('click',()=>{!async function(){try{const t=document.getElementById('var_system_snapshot_name').value.trim(),e=document.getElementById('var_system_snapshot_description').value.trim(),n=document.getElementById('var_system_snapshot_tags').value.trim();if(!t)return void(await l('请输入快照名称',u.TEXT,'',{okButton:'确定'}));let r=null;if(yi.editorController)try{const t=yi.editorController.get();if(void 0===t?.json)return void(await l('编辑器内容有误，请检查 JSON 格式',u.TEXT,'',{okButton:'确定'}));r=t.json}catch(L){return console.error(`${Xs} 获取编辑器内容失败:`,L),void(await l('编辑器内容有误，请检查 JSON 格式',u.TEXT,'',{okButton:'确定'}))}const o=n?n.split(',').map(t=>t.trim()).filter(t=>t):[],s={snapshotId:yi.editingSnapshotId||void 0,name:t,description:e,tags:o,snapshotBody:r};Ci('保存中...','info'),await Ei('/global-snapshots',{method:'POST',body:JSON.stringify(s)}),console.log(`${Xs} 快照已保存:`,yi.editingSnapshotId||'new'),$i('list'),await Ii()}catch(L){console.error(`${Xs} 保存快照失败:`,L),Ci(`保存失败: ${L.message}`,'error'),await l(`保存失败: ${L.message}`,u.TEXT,'',{okButton:'关闭'})}}()}),mi.cancel?.addEventListener('click',()=>{ji()}),mi.export?.addEventListener('click',()=>{!async function(){if(yi.editorController)try{const t=yi.editorController.get(),e=t?.json;if(void 0===e)return void toastr.error('请修复 JSON 错误后再导出');const n=`global_snapshot_${document.getElementById('var_system_snapshot_name')?.value.trim()||'snapshot'}_${(new Date).toISOString().replace(/[:.]/g,'-').slice(0,19)}.json`;bi(e,n),toastr.success(`已导出：${n}`)}catch(L){console.error(`${Xs} 导出快照失败:`,L),toastr.error(`导出失败：${L.message}`)}else toastr.error('编辑器尚未准备就绪')}()}),mi.import?.addEventListener('click',()=>{!async function(){const t=await xi();if(t)if(yi.editorController)try{const e=Si(t,!1);yi.editorController.set({json:e}),toastr.success('JSON 已导入到编辑器')}catch(L){console.error(`${Xs} 导入快照失败:`,L),toastr.error(`导入失败：${L.message}`)}else toastr.error('编辑器尚未准备就绪')}()}),mi.stripSchema?.addEventListener('click',()=>{!async function(){if(yi.editorController)try{const t=yi.editorController.get(),e=t?.json;if(void 0===e)return void toastr.error('请修复 JSON 错误后再分离 Schema');const n=wi(e);yi.editorController.set({json:n}),toastr.success('已移除 MVU Schema 字段')}catch(L){console.error(`${Xs} 分离 Schema 失败:`,L),toastr.error(`分离 Schema 失败：${L.message}`)}else toastr.error('编辑器尚未准备就绪')}()}))}async function Li(t){if(!t)return;const e=t.querySelector('#var_system_settings_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/settings.html').then(t=>t.text());e.innerHTML=t,await async function(){console.log(Ot,'初始化设置标签页'),$('#var-system-cleanup-snapshots-btn').on('click',Lt)}(),console.log(`${Xs} 设置标签页已加载`)}catch(L){console.error(`${Xs} 加载设置失败:`,L)}else console.warn(`${Xs} 找不到设置容器`)}async function Bi(){let t=$('#var_system_drawer'),e=!1;if(0===t.length){e=!0;let n=null;try{n=await r('third-party/ST-VarSystemExtension/assets/templates','appHeaderVarSystemDrawer')}catch(L){return void console.warn(`${Xs} 模板 appHeaderVarSystemDrawer 加载失败`,L)}if(!n)return void console.warn(`${Xs} 模板 appHeaderVarSystemDrawer 返回空内容`);t=$(n);const o=$('#extensions-settings-button');if(0===o.length)return void console.warn(`${Xs} 找不到扩展设置按钮，无法插入入口`);o.after(t);const s=t.find('#var_system_drawer_icon'),i=t.find('#var_system_drawer_content');i.hide(),t.find('.drawer-toggle').on('click',()=>{s.hasClass('openIcon')?di(s,i):function(t,e){t.hasClass('openIcon')||($('.drawer-icon.openIcon').not(t).each((t,e)=>{const n=$(e),r=n.closest('.drawer').find('.drawer-content').first();di(n,r)}),t.toggleClass('closedIcon openIcon'),e.toggleClass('closedDrawer openDrawer'),pi(e.get(0),!0))}(s,i)})}const n=t.get(0);n?(ni(n),function(t){t.querySelectorAll('.var-system-tab').forEach(t=>{t.addEventListener('click',()=>{vi(t.dataset.tab)})})}(n),Oi(n),await async function(t){if(!t)return;const e=t.querySelector('#var_system_functions_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/functionLibrary.html').then(t=>t.text());e.innerHTML=t;const n=document.createElement('link');n.rel='stylesheet',n.href='/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/phase4.css',document.head.appendChild(n),await yt(),console.log(`${Xs} 函数库标签页已加载`)}catch(L){console.error(`${Xs} 加载函数库失败:`,L)}else console.warn(`${Xs} 找不到函数库容器`)}(n),await async function(t){if(!t)return;const e=t.querySelector('#var_system_messages_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/messageSnapshots.html').then(t=>t.text());e.innerHTML=t,await It(),console.log(`${Xs} 楼层快照标签页已加载`)}catch(L){console.error(`${Xs} 加载楼层快照失败:`,L)}else console.warn(`${Xs} 找不到楼层快照容器`)}(n),await Li(n),ii(!0),console.log(`${Xs} 自定义入口已${e?'注入':'重新初始化'}`)):console.error(`${Xs} 无法获取drawer元素`)}async function Ri(){console.log(`${Xs} (st-var-system) 初始化`),await Bi(),s.on(i.CHAT_CHANGED,fi),s.on(i.CHARACTER_EDITOR_OPENED,fi),console.log(ot,'注册事件监听器'),s.on(i.MESSAGE_RECEIVED,at),s.on(i.MESSAGE_SWIPED,ct),s.on(i.CHAT_CHANGED,lt),s.on(i.MESSAGE_DELETED,ut),s.on(i.CHAT_DELETED,ft),console.log(ot,'事件监听器已注册'),console.log(`${Xs} 事件监听器已注册`);const t=Hs(qs),e=document.createElement('div');document.body.appendChild(e),t.mount(e),console.log(`${Xs} 重新处理变量菜单项已挂载`)}window.STVarSystemExtension={init:Ri,exit:async function(){console.log(`${Xs} 卸载`),s.removeListener(i.CHAT_CHANGED,fi),s.removeListener(i.CHARACTER_EDITOR_OPENED,fi),console.log(ot,'卸载事件监听器'),s.removeListener(i.MESSAGE_RECEIVED,at),s.removeListener(i.MESSAGE_SWIPED,ct),s.removeListener(i.CHAT_CHANGED,lt),s.removeListener(i.MESSAGE_DELETED,ut),s.removeListener(i.CHAT_DELETED,ft),console.log(ot,'事件监听器已卸载'),console.log(`${Xs} 事件监听器已卸载`)}},$(async()=>{try{await Ri()}catch(L){console.error(`${Xs} 初始化失败`,L)}});
//# sourceMappingURL=index.js.map
