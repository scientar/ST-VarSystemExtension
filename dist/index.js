import{extension_settings as t,getContext as e,writeExtensionField as n,renderExtensionTemplateAsync as r}from'../../../../../scripts/extensions.js';import{getRequestHeaders as o,eventSource as s,event_types as i,saveSettingsDebounced as a,saveChat as c}from'../../../../../script.js';import{callGenericPopup as l,POPUP_TYPE as u}from'../../../../../scripts/popup.js';import'../../../../../scripts/i18n.js';var f='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{};function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,'default')?t.default:t}var d,h={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var v,g,y=(d||(d=1,v=h,g=h.exports,function(){var t,e='Expected a function',n='__lodash_hash_undefined__',r='__lodash_placeholder__',o=32,s=128,i=256,a=1/0,c=9007199254740991,l=NaN,u=4294967295,p=[['ary',s],['bind',1],['bindKey',2],['curry',8],['curryRight',16],['flip',512],['partial',o],['partialRight',64],['rearg',i]],d='[object Arguments]',h='[object Array]',y='[object Boolean]',m='[object Date]',w='[object Error]',b='[object Function]',x='[object GeneratorFunction]',S='[object Map]',E='[object Number]',T='[object Object]',C='[object Promise]',I='[object RegExp]',k='[object Set]',F='[object String]',A='[object Symbol]',O='[object WeakMap]',j='[object ArrayBuffer]',L='[object DataView]',B='[object Float32Array]',R='[object Float64Array]',D='[object Int8Array]',N='[object Int16Array]',M='[object Int32Array]',P='[object Uint8Array]',V='[object Uint8ClampedArray]',U='[object Uint16Array]',W='[object Uint32Array]',H=/\b__p \+= '';/g,J=/\b(__p \+=) '' \+/g,G=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,X=/[&<>"']/g,K=RegExp(q.source),Z=RegExp(X.source),Y=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,st=RegExp(ot.source),it=/^\s+/,at=/\s/,ct=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ft=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pt=/[()=,{}\[\]\/\s]/,dt=/\\(\\)?/g,ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,yt=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,wt=/^(?:0|[1-9]\d*)$/,bt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Et='\\ud800-\\udfff',$t='\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff',Tt='\\u2700-\\u27bf',Ct='a-z\\xdf-\\xf6\\xf8-\\xff',It='A-Z\\xc0-\\xd6\\xd8-\\xde',kt='\\ufe0e\\ufe0f',Ft='\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000',At='[\'’]',Ot='['+Et+']',jt='['+Ft+']',Lt='['+$t+']',Bt='\\d+',Rt='['+Tt+']',Dt='['+Ct+']',Nt='[^'+Et+Ft+Bt+Tt+Ct+It+']',Mt='\\ud83c[\\udffb-\\udfff]',Pt='[^'+Et+']',Vt='(?:\\ud83c[\\udde6-\\uddff]){2}',Ut='[\\ud800-\\udbff][\\udc00-\\udfff]',zt='['+It+']',Wt='\\u200d',Ht='(?:'+Dt+'|'+Nt+')',Jt='(?:'+zt+'|'+Nt+')',Gt='(?:[\'’](?:d|ll|m|re|s|t|ve))?',qt='(?:[\'’](?:D|LL|M|RE|S|T|VE))?',Xt='(?:'+Lt+'|'+Mt+')?',Kt='['+kt+']?',Zt=Kt+Xt+'(?:'+Wt+'(?:'+[Pt,Vt,Ut].join('|')+')'+Kt+Xt+')*',Yt='(?:'+[Rt,Vt,Ut].join('|')+')'+Zt,Qt='(?:'+[Pt+Lt+'?',Lt,Vt,Ut,Ot].join('|')+')',te=RegExp(At,'g'),ee=RegExp(Lt,'g'),ne=RegExp(Mt+'(?='+Mt+')|'+Qt+Zt,'g'),re=RegExp([zt+'?'+Dt+'+'+Gt+'(?='+[jt,zt,'$'].join('|')+')',Jt+'+'+qt+'(?='+[jt,zt+Ht,'$'].join('|')+')',zt+'?'+Ht+'+'+Gt,zt+'+'+qt,'\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])','\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])',Bt,Yt].join('|'),'g'),oe=RegExp('['+Wt+Et+$t+kt+']'),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=['Array','Buffer','DataView','Date','Error','Float32Array','Float64Array','Function','Int8Array','Int16Array','Int32Array','Map','Math','Object','Promise','RegExp','Set','String','Symbol','TypeError','Uint8Array','Uint8ClampedArray','Uint16Array','Uint32Array','WeakMap','_','clearTimeout','isFinite','parseInt','setTimeout'],ae=-1,ce={};ce[B]=ce[R]=ce[D]=ce[N]=ce[M]=ce[P]=ce[V]=ce[U]=ce[W]=!0,ce[d]=ce[h]=ce[j]=ce[y]=ce[L]=ce[m]=ce[w]=ce[b]=ce[S]=ce[E]=ce[T]=ce[I]=ce[k]=ce[F]=ce[O]=!1;var le={};le[d]=le[h]=le[j]=le[L]=le[y]=le[m]=le[B]=le[R]=le[D]=le[N]=le[M]=le[S]=le[E]=le[T]=le[I]=le[k]=le[F]=le[A]=le[P]=le[V]=le[U]=le[W]=!0,le[w]=le[b]=le[O]=!1;var ue={'\\':'\\','\'':'\'','\n':'n','\r':'r','\u2028':'u2028','\u2029':'u2029'},fe=parseFloat,pe=parseInt,de='object'==typeof f&&f&&f.Object===Object&&f,he='object'==typeof self&&self&&self.Object===Object&&self,ve=de||he||Function('return this')(),ge=g&&!g.nodeType&&g,ye=ge&&v&&!v.nodeType&&v,_e=ye&&ye.exports===ge,me=_e&&de.process,we=function(){try{var t=ye&&ye.require&&ye.require('util').types;return t||me&&me.binding&&me.binding('util')}catch(e){}}(),be=we&&we.isArrayBuffer,xe=we&&we.isDate,Se=we&&we.isMap,Ee=we&&we.isRegExp,$e=we&&we.isSet,Te=we&&we.isTypedArray;function Ce(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ie(t,e,n,r){for(var o=-1,s=null==t?0:t.length;++o<s;){var i=t[o];e(r,i,n(i),t)}return r}function ke(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Fe(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ae(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Oe(t,e){for(var n=-1,r=null==t?0:t.length,o=0,s=[];++n<r;){var i=t[n];e(i,n,t)&&(s[o++]=i)}return s}function je(t,e){return!(null==t||!t.length)&&ze(t,e,0)>-1}function Le(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1}function Be(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}function Re(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}function De(t,e,n,r){var o=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++o]);++o<s;)n=e(n,t[o],o,t);return n}function Ne(t,e,n,r){var o=null==t?0:t.length;for(r&&o&&(n=t[--o]);o--;)n=e(n,t[o],o,t);return n}function Me(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Pe=Ge('length');function Ve(t,e,n){var r;return n(t,function(t,n,o){if(e(t,n,o))return r=n,!1}),r}function Ue(t,e,n,r){for(var o=t.length,s=n+(r?1:-1);r?s--:++s<o;)if(e(t[s],s,t))return s;return-1}function ze(t,e,n){return e==e?function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}(t,e,n):Ue(t,He,n)}function We(t,e,n,r){for(var o=n-1,s=t.length;++o<s;)if(r(t[o],e))return o;return-1}function He(t){return t!=t}function Je(t,e){var n=null==t?0:t.length;return n?Ke(t,e)/n:l}function Ge(e){return function(n){return null==n?t:n[e]}}function qe(e){return function(n){return null==e?t:e[n]}}function Xe(t,e,n,r,o){return o(t,function(t,o,s){n=r?(r=!1,t):e(n,t,o,s)}),n}function Ke(e,n){for(var r,o=-1,s=e.length;++o<s;){var i=n(e[o]);i!==t&&(r=r===t?i:r+i)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ye(t){return t?t.slice(0,gn(t)+1).replace(it,''):t}function Qe(t){return function(e){return t(e)}}function tn(t,e){return Be(e,function(e){return t[e]})}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&ze(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&ze(e,t[n],0)>-1;);return n}var on=qe({'À':'A','Á':'A','Â':'A','Ã':'A','Ä':'A','Å':'A','à':'a','á':'a','â':'a','ã':'a','ä':'a','å':'a','Ç':'C','ç':'c','Ð':'D','ð':'d','È':'E','É':'E','Ê':'E','Ë':'E','è':'e','é':'e','ê':'e','ë':'e','Ì':'I','Í':'I','Î':'I','Ï':'I','ì':'i','í':'i','î':'i','ï':'i','Ñ':'N','ñ':'n','Ò':'O','Ó':'O','Ô':'O','Õ':'O','Ö':'O','Ø':'O','ò':'o','ó':'o','ô':'o','õ':'o','ö':'o','ø':'o','Ù':'U','Ú':'U','Û':'U','Ü':'U','ù':'u','ú':'u','û':'u','ü':'u','Ý':'Y','ý':'y','ÿ':'y','Æ':'Ae','æ':'ae','Þ':'Th','þ':'th','ß':'ss','Ā':'A','Ă':'A','Ą':'A','ā':'a','ă':'a','ą':'a','Ć':'C','Ĉ':'C','Ċ':'C','Č':'C','ć':'c','ĉ':'c','ċ':'c','č':'c','Ď':'D','Đ':'D','ď':'d','đ':'d','Ē':'E','Ĕ':'E','Ė':'E','Ę':'E','Ě':'E','ē':'e','ĕ':'e','ė':'e','ę':'e','ě':'e','Ĝ':'G','Ğ':'G','Ġ':'G','Ģ':'G','ĝ':'g','ğ':'g','ġ':'g','ģ':'g','Ĥ':'H','Ħ':'H','ĥ':'h','ħ':'h','Ĩ':'I','Ī':'I','Ĭ':'I','Į':'I','İ':'I','ĩ':'i','ī':'i','ĭ':'i','į':'i','ı':'i','Ĵ':'J','ĵ':'j','Ķ':'K','ķ':'k','ĸ':'k','Ĺ':'L','Ļ':'L','Ľ':'L','Ŀ':'L','Ł':'L','ĺ':'l','ļ':'l','ľ':'l','ŀ':'l','ł':'l','Ń':'N','Ņ':'N','Ň':'N','Ŋ':'N','ń':'n','ņ':'n','ň':'n','ŋ':'n','Ō':'O','Ŏ':'O','Ő':'O','ō':'o','ŏ':'o','ő':'o','Ŕ':'R','Ŗ':'R','Ř':'R','ŕ':'r','ŗ':'r','ř':'r','Ś':'S','Ŝ':'S','Ş':'S','Š':'S','ś':'s','ŝ':'s','ş':'s','š':'s','Ţ':'T','Ť':'T','Ŧ':'T','ţ':'t','ť':'t','ŧ':'t','Ũ':'U','Ū':'U','Ŭ':'U','Ů':'U','Ű':'U','Ų':'U','ũ':'u','ū':'u','ŭ':'u','ů':'u','ű':'u','ų':'u','Ŵ':'W','ŵ':'w','Ŷ':'Y','ŷ':'y','Ÿ':'Y','Ź':'Z','Ż':'Z','Ž':'Z','ź':'z','ż':'z','ž':'z','Ĳ':'IJ','ĳ':'ij','Œ':'Oe','œ':'oe','ŉ':'\'n','ſ':'s'}),sn=qe({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'});function an(t){return'\\'+ue[t]}function cn(t){return oe.test(t)}function ln(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function un(t,e){return function(n){return t(e(n))}}function fn(t,e){for(var n=-1,o=t.length,s=0,i=[];++n<o;){var a=t[n];a!==e&&a!==r||(t[n]=r,i[s++]=n)}return i}function pn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function dn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function hn(t){return cn(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Pe(t)}function vn(t){return cn(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split('')}(t)}function gn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var yn=qe({'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#39;':'\''}),_=function f(v){var g=(v=null==v?ve:_.defaults(ve.Object(),v,_.pick(ve,ie))).Array,at=v.Date,Et=v.Error,$t=v.Function,Tt=v.Math,Ct=v.Object,It=v.RegExp,kt=v.String,Ft=v.TypeError,At=g.prototype,Ot=$t.prototype,jt=Ct.prototype,Lt=v['__core-js_shared__'],Bt=Ot.toString,Rt=jt.hasOwnProperty,Dt=0,Nt=function(){var t=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||'');return t?'Symbol(src)_1.'+t:''}(),Mt=jt.toString,Pt=Bt.call(Ct),Vt=ve._,Ut=It('^'+Bt.call(Rt).replace(ot,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),zt=_e?v.Buffer:t,Wt=v.Symbol,Ht=v.Uint8Array,Jt=zt?zt.allocUnsafe:t,Gt=un(Ct.getPrototypeOf,Ct),qt=Ct.create,Xt=jt.propertyIsEnumerable,Kt=At.splice,Zt=Wt?Wt.isConcatSpreadable:t,Yt=Wt?Wt.iterator:t,Qt=Wt?Wt.toStringTag:t,ne=function(){try{var t=ps(Ct,'defineProperty');return t({},'',{}),t}catch(e){}}(),oe=v.clearTimeout!==ve.clearTimeout&&v.clearTimeout,ue=at&&at.now!==ve.Date.now&&at.now,de=v.setTimeout!==ve.setTimeout&&v.setTimeout,he=Tt.ceil,ge=Tt.floor,ye=Ct.getOwnPropertySymbols,me=zt?zt.isBuffer:t,we=v.isFinite,Pe=At.join,qe=un(Ct.keys,Ct),_n=Tt.max,mn=Tt.min,wn=at.now,bn=v.parseInt,xn=Tt.random,Sn=At.reverse,En=ps(v,'DataView'),$n=ps(v,'Map'),Tn=ps(v,'Promise'),Cn=ps(v,'Set'),In=ps(v,'WeakMap'),kn=ps(Ct,'create'),Fn=In&&new In,An={},On=Ns(En),jn=Ns($n),Ln=Ns(Tn),Bn=Ns(Cn),Rn=Ns(In),Dn=Wt?Wt.prototype:t,Nn=Dn?Dn.valueOf:t,Mn=Dn?Dn.toString:t;function Pn(t){if(ea(t)&&!Wi(t)&&!(t instanceof Wn)){if(t instanceof zn)return t;if(Rt.call(t,'__wrapped__'))return Ms(t)}return new zn(t)}var Vn=function(){function e(){}return function(n){if(!ta(n))return{};if(qt)return qt(n);e.prototype=n;var r=new e;return e.prototype=t,r}}();function Un(){}function zn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=t}function Wn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=u,this.__views__=[]}function Hn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Gn;++e<n;)this.add(t[e])}function Xn(t){var e=this.__data__=new Jn(t);this.size=e.size}function Kn(t,e){var n=Wi(t),r=!n&&zi(t),o=!n&&!r&&qi(t),s=!n&&!r&&!o&&la(t),i=n||r||o||s,a=i?Ze(t.length,kt):[],c=a.length;for(var l in t)!e&&!Rt.call(t,l)||i&&('length'==l||o&&('offset'==l||'parent'==l)||s&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||ms(l,c))||a.push(l);return a}function Zn(e){var n=e.length;return n?e[qr(0,n-1)]:t}function Yn(t,e){return Bs(Fo(t),ar(e,0,t.length))}function Qn(t){return Bs(Fo(t))}function tr(e,n,r){(r!==t&&!Pi(e[n],r)||r===t&&!(n in e))&&sr(e,n,r)}function er(e,n,r){var o=e[n];Rt.call(e,n)&&Pi(o,r)&&(r!==t||n in e)||sr(e,n,r)}function nr(t,e){for(var n=t.length;n--;)if(Pi(t[n][0],e))return n;return-1}function rr(t,e,n,r){return pr(t,function(t,o,s){e(r,t,n(t),s)}),r}function or(t,e){return t&&Ao(e,Aa(e),t)}function sr(t,e,n){'__proto__'==e&&ne?ne(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ir(e,n){for(var r=-1,o=n.length,s=g(o),i=null==e;++r<o;)s[r]=i?t:Ta(e,n[r]);return s}function ar(e,n,r){return e==e&&(r!==t&&(e=e<=r?e:r),n!==t&&(e=e>=n?e:n)),e}function cr(e,n,r,o,s,i){var a,c=1&n,l=2&n,u=4&n;if(r&&(a=s?r(e,o,s,i):r(e)),a!==t)return a;if(!ta(e))return e;var f=Wi(e);if(f){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&'string'==typeof t[0]&&Rt.call(t,'index')&&(n.index=t.index,n.input=t.input),n}(e),!c)return Fo(e,a)}else{var p=vs(e),h=p==b||p==x;if(qi(e))return Eo(e,c);if(p==T||p==d||h&&!s){if(a=l||h?{}:ys(e),!c)return l?function(t,e){return Ao(t,hs(t),e)}(e,function(t,e){return t&&Ao(e,Oa(e),t)}(a,e)):function(t,e){return Ao(t,ds(t),e)}(e,or(a,e))}else{if(!le[p])return s?e:{};a=function(t,e,n){var r,o=t.constructor;switch(e){case j:return $o(t);case y:case m:return new o(+t);case L:return function(t,e){var n=e?$o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case B:case R:case D:case N:case M:case P:case V:case U:case W:return To(t,n);case S:return new o;case E:case F:return new o(t);case I:return function(t){var e=new t.constructor(t.source,vt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case k:return new o;case A:return r=t,Nn?Ct(Nn.call(r)):{}}}(e,p,c)}}i||(i=new Xn);var v=i.get(e);if(v)return v;i.set(e,a),ia(e)?e.forEach(function(t){a.add(cr(t,n,r,t,e,i))}):na(e)&&e.forEach(function(t,o){a.set(o,cr(t,n,r,o,e,i))});var g=f?t:(u?l?ss:os:l?Oa:Aa)(e);return ke(g||e,function(t,o){g&&(t=e[o=t]),er(a,o,cr(t,n,r,o,e,i))}),a}function lr(e,n,r){var o=r.length;if(null==e)return!o;for(e=Ct(e);o--;){var s=r[o],i=n[s],a=e[s];if(a===t&&!(s in e)||!i(a))return!1}return!0}function ur(n,r,o){if('function'!=typeof n)throw new Ft(e);return As(function(){n.apply(t,o)},r)}function fr(t,e,n,r){var o=-1,s=je,i=!0,a=t.length,c=[],l=e.length;if(!a)return c;n&&(e=Be(e,Qe(n))),r?(s=Le,i=!1):e.length>=200&&(s=en,i=!1,e=new qn(e));t:for(;++o<a;){var u=t[o],f=null==n?u:n(u);if(u=r||0!==u?u:0,i&&f==f){for(var p=l;p--;)if(e[p]===f)continue t;c.push(u)}else s(e,f,r)||c.push(u)}return c}Pn.templateSettings={escape:Y,evaluate:Q,interpolate:tt,variable:'',imports:{_:Pn}},Pn.prototype=Un.prototype,Pn.prototype.constructor=Pn,zn.prototype=Vn(Un.prototype),zn.prototype.constructor=zn,Wn.prototype=Vn(Un.prototype),Wn.prototype.constructor=Wn,Hn.prototype.clear=function(){this.__data__=kn?kn(null):{},this.size=0},Hn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Hn.prototype.get=function(e){var r=this.__data__;if(kn){var o=r[e];return o===n?t:o}return Rt.call(r,e)?r[e]:t},Hn.prototype.has=function(e){var n=this.__data__;return kn?n[e]!==t:Rt.call(n,e)},Hn.prototype.set=function(e,r){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=kn&&r===t?n:r,this},Jn.prototype.clear=function(){this.__data__=[],this.size=0},Jn.prototype.delete=function(t){var e=this.__data__,n=nr(e,t);return!(n<0||(n==e.length-1?e.pop():Kt.call(e,n,1),--this.size,0))},Jn.prototype.get=function(e){var n=this.__data__,r=nr(n,e);return r<0?t:n[r][1]},Jn.prototype.has=function(t){return nr(this.__data__,t)>-1},Jn.prototype.set=function(t,e){var n=this.__data__,r=nr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Gn.prototype.clear=function(){this.size=0,this.__data__={hash:new Hn,map:new($n||Jn),string:new Hn}},Gn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Gn.prototype.get=function(t){return us(this,t).get(t)},Gn.prototype.has=function(t){return us(this,t).has(t)},Gn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},qn.prototype.add=qn.prototype.push=function(t){return this.__data__.set(t,n),this},qn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.clear=function(){this.__data__=new Jn,this.size=0},Xn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Xn.prototype.get=function(t){return this.__data__.get(t)},Xn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Jn){var r=n.__data__;if(!$n||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Gn(r)}return n.set(t,e),this.size=n.size,this};var pr=Lo(wr),dr=Lo(br,!0);function hr(t,e){var n=!0;return pr(t,function(t,r,o){return n=!!e(t,r,o)}),n}function vr(e,n,r){for(var o=-1,s=e.length;++o<s;){var i=e[o],a=n(i);if(null!=a&&(c===t?a==a&&!ca(a):r(a,c)))var c=a,l=i}return l}function gr(t,e){var n=[];return pr(t,function(t,r,o){e(t,r,o)&&n.push(t)}),n}function yr(t,e,n,r,o){var s=-1,i=t.length;for(n||(n=_s),o||(o=[]);++s<i;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,o):Re(o,a):r||(o[o.length]=a)}return o}var _r=Bo(),mr=Bo(!0);function wr(t,e){return t&&_r(t,e,Aa)}function br(t,e){return t&&mr(t,e,Aa)}function xr(t,e){return Oe(e,function(e){return Zi(t[e])})}function Sr(e,n){for(var r=0,o=(n=wo(n,e)).length;null!=e&&r<o;)e=e[Ds(n[r++])];return r&&r==o?e:t}function Er(t,e,n){var r=e(t);return Wi(t)?r:Re(r,n(t))}function $r(e){return null==e?e===t?'[object Undefined]':'[object Null]':Qt&&Qt in Ct(e)?function(e){var n=Rt.call(e,Qt),r=e[Qt];try{e[Qt]=t;var o=!0}catch(i){}var s=Mt.call(e);return o&&(n?e[Qt]=r:delete e[Qt]),s}(e):function(t){return Mt.call(t)}(e)}function Tr(t,e){return t>e}function Cr(t,e){return null!=t&&Rt.call(t,e)}function Ir(t,e){return null!=t&&e in Ct(t)}function kr(e,n,r){for(var o=r?Le:je,s=e[0].length,i=e.length,a=i,c=g(i),l=1/0,u=[];a--;){var f=e[a];a&&n&&(f=Be(f,Qe(n))),l=mn(f.length,l),c[a]=!r&&(n||s>=120&&f.length>=120)?new qn(a&&f):t}f=e[0];var p=-1,d=c[0];t:for(;++p<s&&u.length<l;){var h=f[p],v=n?n(h):h;if(h=r||0!==h?h:0,!(d?en(d,v):o(u,v,r))){for(a=i;--a;){var y=c[a];if(!(y?en(y,v):o(e[a],v,r)))continue t}d&&d.push(v),u.push(h)}}return u}function Fr(e,n,r){var o=null==(e=Is(e,n=wo(n,e)))?e:e[Ds(Ks(n))];return null==o?t:Ce(o,e,r)}function Ar(t){return ea(t)&&$r(t)==d}function Or(e,n,r,o,s){return e===n||(null==e||null==n||!ea(e)&&!ea(n)?e!=e&&n!=n:function(e,n,r,o,s,i){var a=Wi(e),c=Wi(n),l=a?h:vs(e),u=c?h:vs(n),f=(l=l==d?T:l)==T,p=(u=u==d?T:u)==T,v=l==u;if(v&&qi(e)){if(!qi(n))return!1;a=!0,f=!1}if(v&&!f)return i||(i=new Xn),a||la(e)?ns(e,n,r,o,s,i):function(t,e,n,r,o,s,i){switch(n){case L:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case j:return!(t.byteLength!=e.byteLength||!s(new Ht(t),new Ht(e)));case y:case m:case E:return Pi(+t,+e);case w:return t.name==e.name&&t.message==e.message;case I:case F:return t==e+'';case S:var a=ln;case k:var c=1&r;if(a||(a=pn),t.size!=e.size&&!c)return!1;var l=i.get(t);if(l)return l==e;r|=2,i.set(t,e);var u=ns(a(t),a(e),r,o,s,i);return i.delete(t),u;case A:if(Nn)return Nn.call(t)==Nn.call(e)}return!1}(e,n,l,r,o,s,i);if(!(1&r)){var g=f&&Rt.call(e,'__wrapped__'),b=p&&Rt.call(n,'__wrapped__');if(g||b){var x=g?e.value():e,C=b?n.value():n;return i||(i=new Xn),s(x,C,r,o,i)}}return!!v&&(i||(i=new Xn),function(e,n,r,o,s,i){var a=1&r,c=os(e),l=c.length,u=os(n),f=u.length;if(l!=f&&!a)return!1;for(var p=l;p--;){var d=c[p];if(!(a?d in n:Rt.call(n,d)))return!1}var h=i.get(e),v=i.get(n);if(h&&v)return h==n&&v==e;var g=!0;i.set(e,n),i.set(n,e);for(var y=a;++p<l;){var m=e[d=c[p]],w=n[d];if(o)var b=a?o(w,m,d,n,e,i):o(m,w,d,e,n,i);if(!(b===t?m===w||s(m,w,r,o,i):b)){g=!1;break}y||(y='constructor'==d)}if(g&&!y){var x=e.constructor,S=n.constructor;x==S||!('constructor'in e)||!('constructor'in n)||'function'==typeof x&&x instanceof x&&'function'==typeof S&&S instanceof S||(g=!1)}return i.delete(e),i.delete(n),g}(e,n,r,o,s,i))}(e,n,r,o,Or,s))}function jr(e,n,r,o){var s=r.length,i=s,a=!o;if(null==e)return!i;for(e=Ct(e);s--;){var c=r[s];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<i;){var l=(c=r[s])[0],u=e[l],f=c[1];if(a&&c[2]){if(u===t&&!(l in e))return!1}else{var p=new Xn;if(o)var d=o(u,f,l,e,n,p);if(!(d===t?Or(f,u,3,o,p):d))return!1}}return!0}function Lr(t){return!(!ta(t)||(e=t,Nt&&Nt in e))&&(Zi(t)?Ut:_t).test(Ns(t));var e}function Br(t){return'function'==typeof t?t:null==t?rc:'object'==typeof t?Wi(t)?Vr(t[0],t[1]):Pr(t):pc(t)}function Rr(t){if(!Es(t))return qe(t);var e=[];for(var n in Ct(t))Rt.call(t,n)&&'constructor'!=n&&e.push(n);return e}function Dr(t){if(!ta(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Es(t),n=[];for(var r in t)('constructor'!=r||!e&&Rt.call(t,r))&&n.push(r);return n}function Nr(t,e){return t<e}function Mr(t,e){var n=-1,r=Ji(t)?g(t.length):[];return pr(t,function(t,o,s){r[++n]=e(t,o,s)}),r}function Pr(t){var e=fs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||jr(n,t,e)}}function Vr(e,n){return bs(e)&&$s(n)?Ts(Ds(e),n):function(r){var o=Ta(r,e);return o===t&&o===n?Ca(r,e):Or(n,o,3)}}function Ur(e,n,r,o,s){e!==n&&_r(n,function(i,a){if(s||(s=new Xn),ta(i))!function(e,n,r,o,s,i,a){var c=ks(e,r),l=ks(n,r),u=a.get(l);if(u)tr(e,r,u);else{var f=i?i(c,l,r+'',e,n,a):t,p=f===t;if(p){var d=Wi(l),h=!d&&qi(l),v=!d&&!h&&la(l);f=l,d||h||v?Wi(c)?f=c:Gi(c)?f=Fo(c):h?(p=!1,f=Eo(l,!0)):v?(p=!1,f=To(l,!0)):f=[]:oa(l)||zi(l)?(f=c,zi(c)?f=ya(c):ta(c)&&!Zi(c)||(f=ys(l))):p=!1}p&&(a.set(l,f),s(f,l,o,i,a),a.delete(l)),tr(e,r,f)}}(e,n,a,r,Ur,o,s);else{var c=o?o(ks(e,a),i,a+'',e,n,s):t;c===t&&(c=i),tr(e,a,c)}},Oa)}function zr(e,n){var r=e.length;if(r)return ms(n+=n<0?r:0,r)?e[n]:t}function Wr(t,e,n){e=e.length?Be(e,function(t){return Wi(t)?function(e){return Sr(e,1===t.length?t[0]:t)}:t}):[rc];var r=-1;e=Be(e,Qe(ls()));var o=Mr(t,function(t,n,o){var s=Be(e,function(e){return e(t)});return{criteria:s,index:++r,value:t}});return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(o,function(t,e){return function(t,e,n){for(var r=-1,o=t.criteria,s=e.criteria,i=o.length,a=n.length;++r<i;){var c=Co(o[r],s[r]);if(c)return r>=a?c:c*('desc'==n[r]?-1:1)}return t.index-e.index}(t,e,n)})}function Hr(t,e,n){for(var r=-1,o=e.length,s={};++r<o;){var i=e[r],a=Sr(t,i);n(a,i)&&Qr(s,wo(i,t),a)}return s}function Jr(t,e,n,r){var o=r?We:ze,s=-1,i=e.length,a=t;for(t===e&&(e=Fo(e)),n&&(a=Be(t,Qe(n)));++s<i;)for(var c=0,l=e[s],u=n?n(l):l;(c=o(a,u,c,r))>-1;)a!==t&&Kt.call(a,c,1),Kt.call(t,c,1);return t}function Gr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var o=e[n];if(n==r||o!==s){var s=o;ms(o)?Kt.call(t,o,1):fo(t,o)}}return t}function qr(t,e){return t+ge(xn()*(e-t+1))}function Xr(t,e){var n='';if(!t||e<1||e>c)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t)}while(e);return n}function Kr(t,e){return Os(Cs(t,e,rc),t+'')}function Zr(t){return Zn(Pa(t))}function Yr(t,e){var n=Pa(t);return Bs(n,ar(e,0,n.length))}function Qr(e,n,r,o){if(!ta(e))return e;for(var s=-1,i=(n=wo(n,e)).length,a=i-1,c=e;null!=c&&++s<i;){var l=Ds(n[s]),u=r;if('__proto__'===l||'constructor'===l||'prototype'===l)return e;if(s!=a){var f=c[l];(u=o?o(f,l,c):t)===t&&(u=ta(f)?f:ms(n[s+1])?[]:{})}er(c,l,u),c=c[l]}return e}var to=Fn?function(t,e){return Fn.set(t,e),t}:rc,eo=ne?function(t,e){return ne(t,'toString',{configurable:!0,enumerable:!1,value:tc(e),writable:!0})}:rc;function no(t){return Bs(Pa(t))}function ro(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var s=g(o);++r<o;)s[r]=t[r+e];return s}function oo(t,e){var n;return pr(t,function(t,r,o){return!(n=e(t,r,o))}),!!n}function so(t,e,n){var r=0,o=null==t?r:t.length;if('number'==typeof e&&e==e&&o<=2147483647){for(;r<o;){var s=r+o>>>1,i=t[s];null!==i&&!ca(i)&&(n?i<=e:i<e)?r=s+1:o=s}return o}return io(t,e,rc,n)}function io(e,n,r,o){var s=0,i=null==e?0:e.length;if(0===i)return 0;for(var a=(n=r(n))!=n,c=null===n,l=ca(n),u=n===t;s<i;){var f=ge((s+i)/2),p=r(e[f]),d=p!==t,h=null===p,v=p==p,g=ca(p);if(a)var y=o||v;else y=u?v&&(o||d):c?v&&d&&(o||!h):l?v&&d&&!h&&(o||!g):!h&&!g&&(o?p<=n:p<n);y?s=f+1:i=f}return mn(i,4294967294)}function ao(t,e){for(var n=-1,r=t.length,o=0,s=[];++n<r;){var i=t[n],a=e?e(i):i;if(!n||!Pi(a,c)){var c=a;s[o++]=0===i?0:i}}return s}function co(t){return'number'==typeof t?t:ca(t)?l:+t}function lo(t){if('string'==typeof t)return t;if(Wi(t))return Be(t,lo)+'';if(ca(t))return Mn?Mn.call(t):'';var e=t+'';return'0'==e&&1/t==-1/0?'-0':e}function uo(t,e,n){var r=-1,o=je,s=t.length,i=!0,a=[],c=a;if(n)i=!1,o=Le;else if(s>=200){var l=e?null:Ko(t);if(l)return pn(l);i=!1,o=en,c=new qn}else c=e?[]:a;t:for(;++r<s;){var u=t[r],f=e?e(u):u;if(u=n||0!==u?u:0,i&&f==f){for(var p=c.length;p--;)if(c[p]===f)continue t;e&&c.push(f),a.push(u)}else o(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function fo(t,e){return null==(t=Is(t,e=wo(e,t)))||delete t[Ds(Ks(e))]}function po(t,e,n,r){return Qr(t,e,n(Sr(t,e)),r)}function ho(t,e,n,r){for(var o=t.length,s=r?o:-1;(r?s--:++s<o)&&e(t[s],s,t););return n?ro(t,r?0:s,r?s+1:o):ro(t,r?s+1:0,r?o:s)}function vo(t,e){var n=t;return n instanceof Wn&&(n=n.value()),De(e,function(t,e){return e.func.apply(e.thisArg,Re([t],e.args))},n)}function go(t,e,n){var r=t.length;if(r<2)return r?uo(t[0]):[];for(var o=-1,s=g(r);++o<r;)for(var i=t[o],a=-1;++a<r;)a!=o&&(s[o]=fr(s[o]||i,t[a],e,n));return uo(yr(s,1),e,n)}function yo(e,n,r){for(var o=-1,s=e.length,i=n.length,a={};++o<s;){var c=o<i?n[o]:t;r(a,e[o],c)}return a}function _o(t){return Gi(t)?t:[]}function mo(t){return'function'==typeof t?t:rc}function wo(t,e){return Wi(t)?t:bs(t,e)?[t]:Rs(_a(t))}var bo=Kr;function xo(e,n,r){var o=e.length;return r=r===t?o:r,!n&&r>=o?e:ro(e,n,r)}var So=oe||function(t){return ve.clearTimeout(t)};function Eo(t,e){if(e)return t.slice();var n=t.length,r=Jt?Jt(n):new t.constructor(n);return t.copy(r),r}function $o(t){var e=new t.constructor(t.byteLength);return new Ht(e).set(new Ht(t)),e}function To(t,e){var n=e?$o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Co(e,n){if(e!==n){var r=e!==t,o=null===e,s=e==e,i=ca(e),a=n!==t,c=null===n,l=n==n,u=ca(n);if(!c&&!u&&!i&&e>n||i&&a&&l&&!c&&!u||o&&a&&l||!r&&l||!s)return 1;if(!o&&!i&&!u&&e<n||u&&r&&s&&!o&&!i||c&&r&&s||!a&&s||!l)return-1}return 0}function Io(t,e,n,r){for(var o=-1,s=t.length,i=n.length,a=-1,c=e.length,l=_n(s-i,0),u=g(c+l),f=!r;++a<c;)u[a]=e[a];for(;++o<i;)(f||o<s)&&(u[n[o]]=t[o]);for(;l--;)u[a++]=t[o++];return u}function ko(t,e,n,r){for(var o=-1,s=t.length,i=-1,a=n.length,c=-1,l=e.length,u=_n(s-a,0),f=g(u+l),p=!r;++o<u;)f[o]=t[o];for(var d=o;++c<l;)f[d+c]=e[c];for(;++i<a;)(p||o<s)&&(f[d+n[i]]=t[o++]);return f}function Fo(t,e){var n=-1,r=t.length;for(e||(e=g(r));++n<r;)e[n]=t[n];return e}function Ao(e,n,r,o){var s=!r;r||(r={});for(var i=-1,a=n.length;++i<a;){var c=n[i],l=o?o(r[c],e[c],c,r,e):t;l===t&&(l=e[c]),s?sr(r,c,l):er(r,c,l)}return r}function Oo(t,e){return function(n,r){var o=Wi(n)?Ie:rr,s=e?e():{};return o(n,t,ls(r,2),s)}}function jo(e){return Kr(function(n,r){var o=-1,s=r.length,i=s>1?r[s-1]:t,a=s>2?r[2]:t;for(i=e.length>3&&'function'==typeof i?(s--,i):t,a&&ws(r[0],r[1],a)&&(i=s<3?t:i,s=1),n=Ct(n);++o<s;){var c=r[o];c&&e(n,c,o,i)}return n})}function Lo(t,e){return function(n,r){if(null==n)return n;if(!Ji(n))return t(n,r);for(var o=n.length,s=e?o:-1,i=Ct(n);(e?s--:++s<o)&&!1!==r(i[s],s,i););return n}}function Bo(t){return function(e,n,r){for(var o=-1,s=Ct(e),i=r(e),a=i.length;a--;){var c=i[t?a:++o];if(!1===n(s[c],c,s))break}return e}}function Ro(e){return function(n){var r=cn(n=_a(n))?vn(n):t,o=r?r[0]:n.charAt(0),s=r?xo(r,1).join(''):n.slice(1);return o[e]()+s}}function Do(t){return function(e){return De(Za(za(e).replace(te,'')),t,'')}}function No(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Vn(t.prototype),r=t.apply(n,e);return ta(r)?r:n}}function Mo(e){return function(n,r,o){var s=Ct(n);if(!Ji(n)){var i=ls(r,3);n=Aa(n),r=function(t){return i(s[t],t,s)}}var a=e(n,r,o);return a>-1?s[i?n[a]:a]:t}}function Po(n){return rs(function(r){var o=r.length,s=o,i=zn.prototype.thru;for(n&&r.reverse();s--;){var a=r[s];if('function'!=typeof a)throw new Ft(e);if(i&&!c&&'wrapper'==as(a))var c=new zn([],!0)}for(s=c?s:o;++s<o;){var l=as(a=r[s]),u='wrapper'==l?is(a):t;c=u&&xs(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?c[as(u[0])].apply(c,u[3]):1==a.length&&xs(a)?c[l]():c.thru(a)}return function(){var t=arguments,e=t[0];if(c&&1==t.length&&Wi(e))return c.plant(e).value();for(var n=0,s=o?r[n].apply(this,t):e;++n<o;)s=r[n].call(this,s);return s}})}function Vo(e,n,r,o,i,a,c,l,u,f){var p=n&s,d=1&n,h=2&n,v=24&n,y=512&n,m=h?t:No(e);return function s(){for(var w=arguments.length,b=g(w),x=w;x--;)b[x]=arguments[x];if(v)var S=cs(s),E=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(b,S);if(o&&(b=Io(b,o,i,v)),a&&(b=ko(b,a,c,v)),w-=E,v&&w<f){var T=fn(b,S);return qo(e,n,Vo,s.placeholder,r,b,T,l,u,f-w)}var C=d?r:this,I=h?C[e]:e;return w=b.length,l?b=function(e,n){for(var r=e.length,o=mn(n.length,r),s=Fo(e);o--;){var i=n[o];e[o]=ms(i,r)?s[i]:t}return e}(b,l):y&&w>1&&b.reverse(),p&&u<w&&(b.length=u),this&&this!==ve&&this instanceof s&&(I=m||No(I)),I.apply(C,b)}}function Uo(t,e){return function(n,r){return function(t,e,n,r){return wr(t,function(t,o,s){e(r,n(t),o,s)}),r}(n,t,e(r),{})}}function zo(e,n){return function(r,o){var s;if(r===t&&o===t)return n;if(r!==t&&(s=r),o!==t){if(s===t)return o;'string'==typeof r||'string'==typeof o?(r=lo(r),o=lo(o)):(r=co(r),o=co(o)),s=e(r,o)}return s}}function Wo(t){return rs(function(e){return e=Be(e,Qe(ls())),Kr(function(n){var r=this;return t(e,function(t){return Ce(t,r,n)})})})}function Ho(e,n){var r=(n=n===t?' ':lo(n)).length;if(r<2)return r?Xr(n,e):n;var o=Xr(n,he(e/hn(n)));return cn(n)?xo(vn(o),0,e).join(''):o.slice(0,e)}function Jo(e){return function(n,r,o){return o&&'number'!=typeof o&&ws(n,r,o)&&(r=o=t),n=da(n),r===t?(r=n,n=0):r=da(r),function(t,e,n,r){for(var o=-1,s=_n(he((e-t)/(n||1)),0),i=g(s);s--;)i[r?s:++o]=t,t+=n;return i}(n,r,o=o===t?n<r?1:-1:da(o),e)}}function Go(t){return function(e,n){return'string'==typeof e&&'string'==typeof n||(e=ga(e),n=ga(n)),t(e,n)}}function qo(e,n,r,s,i,a,c,l,u,f){var p=8&n;n|=p?o:64,4&(n&=~(p?64:o))||(n&=-4);var d=[e,n,i,p?a:t,p?c:t,p?t:a,p?t:c,l,u,f],h=r.apply(t,d);return xs(e)&&Fs(h,d),h.placeholder=s,js(h,e,n)}function Xo(t){var e=Tt[t];return function(t,n){if(t=ga(t),(n=null==n?0:mn(ha(n),292))&&we(t)){var r=(_a(t)+'e').split('e');return+((r=(_a(e(r[0]+'e'+(+r[1]+n)))+'e').split('e'))[0]+'e'+(+r[1]-n))}return e(t)}}var Ko=Cn&&1/pn(new Cn([,-0]))[1]==a?function(t){return new Cn(t)}:cc;function Zo(t){return function(e){var n=vs(e);return n==S?ln(e):n==k?dn(e):function(t,e){return Be(e,function(e){return[e,t[e]]})}(e,t(e))}}function Yo(n,a,c,l,u,f,p,d){var h=2&a;if(!h&&'function'!=typeof n)throw new Ft(e);var v=l?l.length:0;if(v||(a&=-97,l=u=t),p=p===t?p:_n(ha(p),0),d=d===t?d:ha(d),v-=u?u.length:0,64&a){var y=l,m=u;l=u=t}var w=h?t:is(n),b=[n,a,c,l,u,y,m,f,p,d];if(w&&function(t,e){var n=t[1],o=e[1],a=n|o,c=a<131,l=o==s&&8==n||o==s&&n==i&&t[7].length<=e[8]||384==o&&e[7].length<=e[8]&&8==n;if(!c&&!l)return t;1&o&&(t[2]=e[2],a|=1&n?0:4);var u=e[3];if(u){var f=t[3];t[3]=f?Io(f,u,e[4]):u,t[4]=f?fn(t[3],r):e[4]}(u=e[5])&&(f=t[5],t[5]=f?ko(f,u,e[6]):u,t[6]=f?fn(t[5],r):e[6]),(u=e[7])&&(t[7]=u),o&s&&(t[8]=null==t[8]?e[8]:mn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=a}(b,w),n=b[0],a=b[1],c=b[2],l=b[3],u=b[4],!(d=b[9]=b[9]===t?h?0:n.length:_n(b[9]-v,0))&&24&a&&(a&=-25),a&&1!=a)x=8==a||16==a?function(e,n,r){var o=No(e);return function s(){for(var i=arguments.length,a=g(i),c=i,l=cs(s);c--;)a[c]=arguments[c];var u=i<3&&a[0]!==l&&a[i-1]!==l?[]:fn(a,l);return(i-=u.length)<r?qo(e,n,Vo,s.placeholder,t,a,u,t,t,r-i):Ce(this&&this!==ve&&this instanceof s?o:e,this,a)}}(n,a,d):a!=o&&33!=a||u.length?Vo.apply(t,b):function(t,e,n,r){var o=1&e,s=No(t);return function e(){for(var i=-1,a=arguments.length,c=-1,l=r.length,u=g(l+a),f=this&&this!==ve&&this instanceof e?s:t;++c<l;)u[c]=r[c];for(;a--;)u[c++]=arguments[++i];return Ce(f,o?n:this,u)}}(n,a,c,l);else var x=function(t,e,n){var r=1&e,o=No(t);return function e(){return(this&&this!==ve&&this instanceof e?o:t).apply(r?n:this,arguments)}}(n,a,c);return js((w?to:Fs)(x,b),n,a)}function Qo(e,n,r,o){return e===t||Pi(e,jt[r])&&!Rt.call(o,r)?n:e}function ts(e,n,r,o,s,i){return ta(e)&&ta(n)&&(i.set(n,e),Ur(e,n,t,ts,i),i.delete(n)),e}function es(e){return oa(e)?t:e}function ns(e,n,r,o,s,i){var a=1&r,c=e.length,l=n.length;if(c!=l&&!(a&&l>c))return!1;var u=i.get(e),f=i.get(n);if(u&&f)return u==n&&f==e;var p=-1,d=!0,h=2&r?new qn:t;for(i.set(e,n),i.set(n,e);++p<c;){var v=e[p],g=n[p];if(o)var y=a?o(g,v,p,n,e,i):o(v,g,p,e,n,i);if(y!==t){if(y)continue;d=!1;break}if(h){if(!Me(n,function(t,e){if(!en(h,e)&&(v===t||s(v,t,r,o,i)))return h.push(e)})){d=!1;break}}else if(v!==g&&!s(v,g,r,o,i)){d=!1;break}}return i.delete(e),i.delete(n),d}function rs(e){return Os(Cs(e,t,Hs),e+'')}function os(t){return Er(t,Aa,ds)}function ss(t){return Er(t,Oa,hs)}var is=Fn?function(t){return Fn.get(t)}:cc;function as(t){for(var e=t.name+'',n=An[e],r=Rt.call(An,e)?n.length:0;r--;){var o=n[r],s=o.func;if(null==s||s==t)return o.name}return e}function cs(t){return(Rt.call(Pn,'placeholder')?Pn:t).placeholder}function ls(){var t=Pn.iteratee||oc;return t=t===oc?Br:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n,r,o=t.__data__;return('string'==(r=typeof(n=e))||'number'==r||'symbol'==r||'boolean'==r?'__proto__'!==n:null===n)?o['string'==typeof e?'string':'hash']:o.map}function fs(t){for(var e=Aa(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,$s(o)]}return e}function ps(e,n){var r=function(e,n){return null==e?t:e[n]}(e,n);return Lr(r)?r:t}var ds=ye?function(t){return null==t?[]:(t=Ct(t),Oe(ye(t),function(e){return Xt.call(t,e)}))}:vc,hs=ye?function(t){for(var e=[];t;)Re(e,ds(t)),t=Gt(t);return e}:vc,vs=$r;function gs(t,e,n){for(var r=-1,o=(e=wo(e,t)).length,s=!1;++r<o;){var i=Ds(e[r]);if(!(s=null!=t&&n(t,i)))break;t=t[i]}return s||++r!=o?s:!!(o=null==t?0:t.length)&&Qi(o)&&ms(i,o)&&(Wi(t)||zi(t))}function ys(t){return'function'!=typeof t.constructor||Es(t)?{}:Vn(Gt(t))}function _s(t){return Wi(t)||zi(t)||!!(Zt&&t&&t[Zt])}function ms(t,e){var n=typeof t;return!!(e=null==e?c:e)&&('number'==n||'symbol'!=n&&wt.test(t))&&t>-1&&t%1==0&&t<e}function ws(t,e,n){if(!ta(n))return!1;var r=typeof e;return!!('number'==r?Ji(n)&&ms(e,n.length):'string'==r&&e in n)&&Pi(n[e],t)}function bs(t,e){if(Wi(t))return!1;var n=typeof t;return!('number'!=n&&'symbol'!=n&&'boolean'!=n&&null!=t&&!ca(t))||nt.test(t)||!et.test(t)||null!=e&&t in Ct(e)}function xs(t){var e=as(t),n=Pn[e];if('function'!=typeof n||!(e in Wn.prototype))return!1;if(t===n)return!0;var r=is(n);return!!r&&t===r[0]}(En&&vs(new En(new ArrayBuffer(1)))!=L||$n&&vs(new $n)!=S||Tn&&vs(Tn.resolve())!=C||Cn&&vs(new Cn)!=k||In&&vs(new In)!=O)&&(vs=function(e){var n=$r(e),r=n==T?e.constructor:t,o=r?Ns(r):'';if(o)switch(o){case On:return L;case jn:return S;case Ln:return C;case Bn:return k;case Rn:return O}return n});var Ss=Lt?Zi:gc;function Es(t){var e=t&&t.constructor;return t===('function'==typeof e&&e.prototype||jt)}function $s(t){return t==t&&!ta(t)}function Ts(e,n){return function(r){return null!=r&&r[e]===n&&(n!==t||e in Ct(r))}}function Cs(e,n,r){return n=_n(n===t?e.length-1:n,0),function(){for(var t=arguments,o=-1,s=_n(t.length-n,0),i=g(s);++o<s;)i[o]=t[n+o];o=-1;for(var a=g(n+1);++o<n;)a[o]=t[o];return a[n]=r(i),Ce(e,this,a)}}function Is(t,e){return e.length<2?t:Sr(t,ro(e,0,-1))}function ks(t,e){if(('constructor'!==e||'function'!=typeof t[e])&&'__proto__'!=e)return t[e]}var Fs=Ls(to),As=de||function(t,e){return ve.setTimeout(t,e)},Os=Ls(eo);function js(t,e,n){var r=e+'';return Os(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?'& ':'')+e[r],e=e.join(n>2?', ':' '),t.replace(ct,'{\n/* [wrapped with '+e+'] */\n')}(r,function(t,e){return ke(p,function(n){var r='_.'+n[0];e&n[1]&&!je(t,r)&&t.push(r)}),t.sort()}(function(t){var e=t.match(lt);return e?e[1].split(ut):[]}(r),n)))}function Ls(e){var n=0,r=0;return function(){var o=wn(),s=16-(o-r);if(r=o,s>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(t,arguments)}}function Bs(e,n){var r=-1,o=e.length,s=o-1;for(n=n===t?o:n;++r<n;){var i=qr(r,s),a=e[i];e[i]=e[r],e[r]=a}return e.length=n,e}var Rs=function(t){var e=Li(t,function(t){return 500===n.size&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(''),t.replace(rt,function(t,n,r,o){e.push(r?o.replace(dt,'$1'):n||t)}),e});function Ds(t){if('string'==typeof t||ca(t))return t;var e=t+'';return'0'==e&&1/t==-1/0?'-0':e}function Ns(t){if(null!=t){try{return Bt.call(t)}catch(e){}try{return t+''}catch(e){}}return''}function Ms(t){if(t instanceof Wn)return t.clone();var e=new zn(t.__wrapped__,t.__chain__);return e.__actions__=Fo(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Ps=Kr(function(t,e){return Gi(t)?fr(t,yr(e,1,Gi,!0)):[]}),Vs=Kr(function(e,n){var r=Ks(n);return Gi(r)&&(r=t),Gi(e)?fr(e,yr(n,1,Gi,!0),ls(r,2)):[]}),Us=Kr(function(e,n){var r=Ks(n);return Gi(r)&&(r=t),Gi(e)?fr(e,yr(n,1,Gi,!0),t,r):[]});function zs(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=null==n?0:ha(n);return o<0&&(o=_n(r+o,0)),Ue(t,ls(e,3),o)}function Ws(e,n,r){var o=null==e?0:e.length;if(!o)return-1;var s=o-1;return r!==t&&(s=ha(r),s=r<0?_n(o+s,0):mn(s,o-1)),Ue(e,ls(n,3),s,!0)}function Hs(t){return null!=t&&t.length?yr(t,1):[]}function Js(e){return e&&e.length?e[0]:t}var Gs=Kr(function(t){var e=Be(t,_o);return e.length&&e[0]===t[0]?kr(e):[]}),qs=Kr(function(e){var n=Ks(e),r=Be(e,_o);return n===Ks(r)?n=t:r.pop(),r.length&&r[0]===e[0]?kr(r,ls(n,2)):[]}),Xs=Kr(function(e){var n=Ks(e),r=Be(e,_o);return(n='function'==typeof n?n:t)&&r.pop(),r.length&&r[0]===e[0]?kr(r,t,n):[]});function Ks(e){var n=null==e?0:e.length;return n?e[n-1]:t}var Zs=Kr(Ys);function Ys(t,e){return t&&t.length&&e&&e.length?Jr(t,e):t}var Qs=rs(function(t,e){var n=null==t?0:t.length,r=ir(t,e);return Gr(t,Be(e,function(t){return ms(t,n)?+t:t}).sort(Co)),r});function ti(t){return null==t?t:Sn.call(t)}var ei=Kr(function(t){return uo(yr(t,1,Gi,!0))}),ni=Kr(function(e){var n=Ks(e);return Gi(n)&&(n=t),uo(yr(e,1,Gi,!0),ls(n,2))}),ri=Kr(function(e){var n=Ks(e);return n='function'==typeof n?n:t,uo(yr(e,1,Gi,!0),t,n)});function oi(t){if(!t||!t.length)return[];var e=0;return t=Oe(t,function(t){if(Gi(t))return e=_n(t.length,e),!0}),Ze(e,function(e){return Be(t,Ge(e))})}function si(e,n){if(!e||!e.length)return[];var r=oi(e);return null==n?r:Be(r,function(e){return Ce(n,t,e)})}var ii=Kr(function(t,e){return Gi(t)?fr(t,e):[]}),ai=Kr(function(t){return go(Oe(t,Gi))}),ci=Kr(function(e){var n=Ks(e);return Gi(n)&&(n=t),go(Oe(e,Gi),ls(n,2))}),li=Kr(function(e){var n=Ks(e);return n='function'==typeof n?n:t,go(Oe(e,Gi),t,n)}),ui=Kr(oi),fi=Kr(function(e){var n=e.length,r=n>1?e[n-1]:t;return r='function'==typeof r?(e.pop(),r):t,si(e,r)});function pi(t){var e=Pn(t);return e.__chain__=!0,e}function di(t,e){return e(t)}var hi=rs(function(e){var n=e.length,r=n?e[0]:0,o=this.__wrapped__,s=function(t){return ir(t,e)};return!(n>1||this.__actions__.length)&&o instanceof Wn&&ms(r)?((o=o.slice(r,+r+(n?1:0))).__actions__.push({func:di,args:[s],thisArg:t}),new zn(o,this.__chain__).thru(function(e){return n&&!e.length&&e.push(t),e})):this.thru(s)}),vi=Oo(function(t,e,n){Rt.call(t,n)?++t[n]:sr(t,n,1)}),gi=Mo(zs),yi=Mo(Ws);function _i(t,e){return(Wi(t)?ke:pr)(t,ls(e,3))}function mi(t,e){return(Wi(t)?Fe:dr)(t,ls(e,3))}var wi=Oo(function(t,e,n){Rt.call(t,n)?t[n].push(e):sr(t,n,[e])}),bi=Kr(function(t,e,n){var r=-1,o='function'==typeof e,s=Ji(t)?g(t.length):[];return pr(t,function(t){s[++r]=o?Ce(e,t,n):Fr(t,e,n)}),s}),xi=Oo(function(t,e,n){sr(t,n,e)});function Si(t,e){return(Wi(t)?Be:Mr)(t,ls(e,3))}var Ei=Oo(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),$i=Kr(function(t,e){if(null==t)return[];var n=e.length;return n>1&&ws(t,e[0],e[1])?e=[]:n>2&&ws(e[0],e[1],e[2])&&(e=[e[0]]),Wr(t,yr(e,1),[])}),Ti=ue||function(){return ve.Date.now()};function Ci(e,n,r){return n=r?t:n,n=e&&null==n?e.length:n,Yo(e,s,t,t,t,t,n)}function Ii(n,r){var o;if('function'!=typeof r)throw new Ft(e);return n=ha(n),function(){return--n>0&&(o=r.apply(this,arguments)),n<=1&&(r=t),o}}var ki=Kr(function(t,e,n){var r=1;if(n.length){var s=fn(n,cs(ki));r|=o}return Yo(t,r,e,n,s)}),Fi=Kr(function(t,e,n){var r=3;if(n.length){var s=fn(n,cs(Fi));r|=o}return Yo(e,r,t,n,s)});function Ai(n,r,o){var s,i,a,c,l,u,f=0,p=!1,d=!1,h=!0;if('function'!=typeof n)throw new Ft(e);function v(e){var r=s,o=i;return s=i=t,f=e,c=n.apply(o,r)}function g(e){var n=e-u;return u===t||n>=r||n<0||d&&e-f>=a}function y(){var t=Ti();if(g(t))return m(t);l=As(y,function(t){var e=r-(t-u);return d?mn(e,a-(t-f)):e}(t))}function m(e){return l=t,h&&s?v(e):(s=i=t,c)}function w(){var e=Ti(),n=g(e);if(s=arguments,i=this,u=e,n){if(l===t)return function(t){return f=t,l=As(y,r),p?v(t):c}(u);if(d)return So(l),l=As(y,r),v(u)}return l===t&&(l=As(y,r)),c}return r=ga(r)||0,ta(o)&&(p=!!o.leading,a=(d='maxWait'in o)?_n(ga(o.maxWait)||0,r):a,h='trailing'in o?!!o.trailing:h),w.cancel=function(){l!==t&&So(l),f=0,s=u=i=l=t},w.flush=function(){return l===t?c:m(Ti())},w}var Oi=Kr(function(t,e){return ur(t,1,e)}),ji=Kr(function(t,e,n){return ur(t,ga(e)||0,n)});function Li(t,n){if('function'!=typeof t||null!=n&&'function'!=typeof n)throw new Ft(e);var r=function(){var e=arguments,o=n?n.apply(this,e):e[0],s=r.cache;if(s.has(o))return s.get(o);var i=t.apply(this,e);return r.cache=s.set(o,i)||s,i};return r.cache=new(Li.Cache||Gn),r}function Bi(t){if('function'!=typeof t)throw new Ft(e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Li.Cache=Gn;var Ri=bo(function(t,e){var n=(e=1==e.length&&Wi(e[0])?Be(e[0],Qe(ls())):Be(yr(e,1),Qe(ls()))).length;return Kr(function(r){for(var o=-1,s=mn(r.length,n);++o<s;)r[o]=e[o].call(this,r[o]);return Ce(t,this,r)})}),Di=Kr(function(e,n){var r=fn(n,cs(Di));return Yo(e,o,t,n,r)}),Ni=Kr(function(e,n){var r=fn(n,cs(Ni));return Yo(e,64,t,n,r)}),Mi=rs(function(e,n){return Yo(e,i,t,t,t,n)});function Pi(t,e){return t===e||t!=t&&e!=e}var Vi=Go(Tr),Ui=Go(function(t,e){return t>=e}),zi=Ar(function(){return arguments}())?Ar:function(t){return ea(t)&&Rt.call(t,'callee')&&!Xt.call(t,'callee')},Wi=g.isArray,Hi=be?Qe(be):function(t){return ea(t)&&$r(t)==j};function Ji(t){return null!=t&&Qi(t.length)&&!Zi(t)}function Gi(t){return ea(t)&&Ji(t)}var qi=me||gc,Xi=xe?Qe(xe):function(t){return ea(t)&&$r(t)==m};function Ki(t){if(!ea(t))return!1;var e=$r(t);return e==w||'[object DOMException]'==e||'string'==typeof t.message&&'string'==typeof t.name&&!oa(t)}function Zi(t){if(!ta(t))return!1;var e=$r(t);return e==b||e==x||'[object AsyncFunction]'==e||'[object Proxy]'==e}function Yi(t){return'number'==typeof t&&t==ha(t)}function Qi(t){return'number'==typeof t&&t>-1&&t%1==0&&t<=c}function ta(t){var e=typeof t;return null!=t&&('object'==e||'function'==e)}function ea(t){return null!=t&&'object'==typeof t}var na=Se?Qe(Se):function(t){return ea(t)&&vs(t)==S};function ra(t){return'number'==typeof t||ea(t)&&$r(t)==E}function oa(t){if(!ea(t)||$r(t)!=T)return!1;var e=Gt(t);if(null===e)return!0;var n=Rt.call(e,'constructor')&&e.constructor;return'function'==typeof n&&n instanceof n&&Bt.call(n)==Pt}var sa=Ee?Qe(Ee):function(t){return ea(t)&&$r(t)==I},ia=$e?Qe($e):function(t){return ea(t)&&vs(t)==k};function aa(t){return'string'==typeof t||!Wi(t)&&ea(t)&&$r(t)==F}function ca(t){return'symbol'==typeof t||ea(t)&&$r(t)==A}var la=Te?Qe(Te):function(t){return ea(t)&&Qi(t.length)&&!!ce[$r(t)]},ua=Go(Nr),fa=Go(function(t,e){return t<=e});function pa(t){if(!t)return[];if(Ji(t))return aa(t)?vn(t):Fo(t);if(Yt&&t[Yt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Yt]());var e=vs(t);return(e==S?ln:e==k?pn:Pa)(t)}function da(t){return t?(t=ga(t))===a||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ha(t){var e=da(t),n=e%1;return e==e?n?e-n:e:0}function va(t){return t?ar(ha(t),0,u):0}function ga(t){if('number'==typeof t)return t;if(ca(t))return l;if(ta(t)){var e='function'==typeof t.valueOf?t.valueOf():t;t=ta(e)?e+'':e}if('string'!=typeof t)return 0===t?t:+t;t=Ye(t);var n=yt.test(t);return n||mt.test(t)?pe(t.slice(2),n?2:8):gt.test(t)?l:+t}function ya(t){return Ao(t,Oa(t))}function _a(t){return null==t?'':lo(t)}var ma=jo(function(t,e){if(Es(e)||Ji(e))Ao(e,Aa(e),t);else for(var n in e)Rt.call(e,n)&&er(t,n,e[n])}),wa=jo(function(t,e){Ao(e,Oa(e),t)}),ba=jo(function(t,e,n,r){Ao(e,Oa(e),t,r)}),xa=jo(function(t,e,n,r){Ao(e,Aa(e),t,r)}),Sa=rs(ir),Ea=Kr(function(e,n){e=Ct(e);var r=-1,o=n.length,s=o>2?n[2]:t;for(s&&ws(n[0],n[1],s)&&(o=1);++r<o;)for(var i=n[r],a=Oa(i),c=-1,l=a.length;++c<l;){var u=a[c],f=e[u];(f===t||Pi(f,jt[u])&&!Rt.call(e,u))&&(e[u]=i[u])}return e}),$a=Kr(function(e){return e.push(t,ts),Ce(La,t,e)});function Ta(e,n,r){var o=null==e?t:Sr(e,n);return o===t?r:o}function Ca(t,e){return null!=t&&gs(t,e,Ir)}var Ia=Uo(function(t,e,n){null!=e&&'function'!=typeof e.toString&&(e=Mt.call(e)),t[e]=n},tc(rc)),ka=Uo(function(t,e,n){null!=e&&'function'!=typeof e.toString&&(e=Mt.call(e)),Rt.call(t,e)?t[e].push(n):t[e]=[n]},ls),Fa=Kr(Fr);function Aa(t){return Ji(t)?Kn(t):Rr(t)}function Oa(t){return Ji(t)?Kn(t,!0):Dr(t)}var ja=jo(function(t,e,n){Ur(t,e,n)}),La=jo(function(t,e,n,r){Ur(t,e,n,r)}),Ba=rs(function(t,e){var n={};if(null==t)return n;var r=!1;e=Be(e,function(e){return e=wo(e,t),r||(r=e.length>1),e}),Ao(t,ss(t),n),r&&(n=cr(n,7,es));for(var o=e.length;o--;)fo(n,e[o]);return n}),Ra=rs(function(t,e){return null==t?{}:function(t,e){return Hr(t,e,function(e,n){return Ca(t,n)})}(t,e)});function Da(t,e){if(null==t)return{};var n=Be(ss(t),function(t){return[t]});return e=ls(e),Hr(t,n,function(t,n){return e(t,n[0])})}var Na=Zo(Aa),Ma=Zo(Oa);function Pa(t){return null==t?[]:tn(t,Aa(t))}var Va=Do(function(t,e,n){return e=e.toLowerCase(),t+(n?Ua(e):e)});function Ua(t){return Ka(_a(t).toLowerCase())}function za(t){return(t=_a(t))&&t.replace(bt,on).replace(ee,'')}var Wa=Do(function(t,e,n){return t+(n?'-':'')+e.toLowerCase()}),Ha=Do(function(t,e,n){return t+(n?' ':'')+e.toLowerCase()}),Ja=Ro('toLowerCase'),Ga=Do(function(t,e,n){return t+(n?'_':'')+e.toLowerCase()}),qa=Do(function(t,e,n){return t+(n?' ':'')+Ka(e)}),Xa=Do(function(t,e,n){return t+(n?' ':'')+e.toUpperCase()}),Ka=Ro('toUpperCase');function Za(e,n,r){return e=_a(e),(n=r?t:n)===t?function(t){return se.test(t)}(e)?function(t){return t.match(re)||[]}(e):function(t){return t.match(ft)||[]}(e):e.match(n)||[]}var Ya=Kr(function(e,n){try{return Ce(e,t,n)}catch(r){return Ki(r)?r:new Et(r)}}),Qa=rs(function(t,e){return ke(e,function(e){e=Ds(e),sr(t,e,ki(t[e],t))}),t});function tc(t){return function(){return t}}var ec=Po(),nc=Po(!0);function rc(t){return t}function oc(t){return Br('function'==typeof t?t:cr(t,1))}var sc=Kr(function(t,e){return function(n){return Fr(n,t,e)}}),ic=Kr(function(t,e){return function(n){return Fr(t,n,e)}});function ac(t,e,n){var r=Aa(e),o=xr(e,r);null!=n||ta(e)&&(o.length||!r.length)||(n=e,e=t,t=this,o=xr(e,Aa(e)));var s=!(ta(n)&&'chain'in n&&!n.chain),i=Zi(t);return ke(o,function(n){var r=e[n];t[n]=r,i&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Fo(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Re([this.value()],arguments))})}),t}function cc(){}var lc=Wo(Be),uc=Wo(Ae),fc=Wo(Me);function pc(t){return bs(t)?Ge(Ds(t)):function(t){return function(e){return Sr(e,t)}}(t)}var dc=Jo(),hc=Jo(!0);function vc(){return[]}function gc(){return!1}var yc,_c=zo(function(t,e){return t+e},0),mc=Xo('ceil'),wc=zo(function(t,e){return t/e},1),bc=Xo('floor'),xc=zo(function(t,e){return t*e},1),Sc=Xo('round'),Ec=zo(function(t,e){return t-e},0);return Pn.after=function(t,n){if('function'!=typeof n)throw new Ft(e);return t=ha(t),function(){if(--t<1)return n.apply(this,arguments)}},Pn.ary=Ci,Pn.assign=ma,Pn.assignIn=wa,Pn.assignInWith=ba,Pn.assignWith=xa,Pn.at=Sa,Pn.before=Ii,Pn.bind=ki,Pn.bindAll=Qa,Pn.bindKey=Fi,Pn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Wi(t)?t:[t]},Pn.chain=pi,Pn.chunk=function(e,n,r){n=(r?ws(e,n,r):n===t)?1:_n(ha(n),0);var o=null==e?0:e.length;if(!o||n<1)return[];for(var s=0,i=0,a=g(he(o/n));s<o;)a[i++]=ro(e,s,s+=n);return a},Pn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,o=[];++e<n;){var s=t[e];s&&(o[r++]=s)}return o},Pn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=g(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Re(Wi(n)?Fo(n):[n],yr(e,1))},Pn.cond=function(t){var n=null==t?0:t.length,r=ls();return t=n?Be(t,function(t){if('function'!=typeof t[1])throw new Ft(e);return[r(t[0]),t[1]]}):[],Kr(function(e){for(var r=-1;++r<n;){var o=t[r];if(Ce(o[0],this,e))return Ce(o[1],this,e)}})},Pn.conforms=function(t){return function(t){var e=Aa(t);return function(n){return lr(n,t,e)}}(cr(t,1))},Pn.constant=tc,Pn.countBy=vi,Pn.create=function(t,e){var n=Vn(t);return null==e?n:or(n,e)},Pn.curry=function e(n,r,o){var s=Yo(n,8,t,t,t,t,t,r=o?t:r);return s.placeholder=e.placeholder,s},Pn.curryRight=function e(n,r,o){var s=Yo(n,16,t,t,t,t,t,r=o?t:r);return s.placeholder=e.placeholder,s},Pn.debounce=Ai,Pn.defaults=Ea,Pn.defaultsDeep=$a,Pn.defer=Oi,Pn.delay=ji,Pn.difference=Ps,Pn.differenceBy=Vs,Pn.differenceWith=Us,Pn.drop=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,(n=r||n===t?1:ha(n))<0?0:n,o):[]},Pn.dropRight=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,0,(n=o-(n=r||n===t?1:ha(n)))<0?0:n):[]},Pn.dropRightWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!0,!0):[]},Pn.dropWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!0):[]},Pn.fill=function(e,n,r,o){var s=null==e?0:e.length;return s?(r&&'number'!=typeof r&&ws(e,n,r)&&(r=0,o=s),function(e,n,r,o){var s=e.length;for((r=ha(r))<0&&(r=-r>s?0:s+r),(o=o===t||o>s?s:ha(o))<0&&(o+=s),o=r>o?0:va(o);r<o;)e[r++]=n;return e}(e,n,r,o)):[]},Pn.filter=function(t,e){return(Wi(t)?Oe:gr)(t,ls(e,3))},Pn.flatMap=function(t,e){return yr(Si(t,e),1)},Pn.flatMapDeep=function(t,e){return yr(Si(t,e),a)},Pn.flatMapDepth=function(e,n,r){return r=r===t?1:ha(r),yr(Si(e,n),r)},Pn.flatten=Hs,Pn.flattenDeep=function(t){return null!=t&&t.length?yr(t,a):[]},Pn.flattenDepth=function(e,n){return null!=e&&e.length?yr(e,n=n===t?1:ha(n)):[]},Pn.flip=function(t){return Yo(t,512)},Pn.flow=ec,Pn.flowRight=nc,Pn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var o=t[e];r[o[0]]=o[1]}return r},Pn.functions=function(t){return null==t?[]:xr(t,Aa(t))},Pn.functionsIn=function(t){return null==t?[]:xr(t,Oa(t))},Pn.groupBy=wi,Pn.initial=function(t){return null!=t&&t.length?ro(t,0,-1):[]},Pn.intersection=Gs,Pn.intersectionBy=qs,Pn.intersectionWith=Xs,Pn.invert=Ia,Pn.invertBy=ka,Pn.invokeMap=bi,Pn.iteratee=oc,Pn.keyBy=xi,Pn.keys=Aa,Pn.keysIn=Oa,Pn.map=Si,Pn.mapKeys=function(t,e){var n={};return e=ls(e,3),wr(t,function(t,r,o){sr(n,e(t,r,o),t)}),n},Pn.mapValues=function(t,e){var n={};return e=ls(e,3),wr(t,function(t,r,o){sr(n,r,e(t,r,o))}),n},Pn.matches=function(t){return Pr(cr(t,1))},Pn.matchesProperty=function(t,e){return Vr(t,cr(e,1))},Pn.memoize=Li,Pn.merge=ja,Pn.mergeWith=La,Pn.method=sc,Pn.methodOf=ic,Pn.mixin=ac,Pn.negate=Bi,Pn.nthArg=function(t){return t=ha(t),Kr(function(e){return zr(e,t)})},Pn.omit=Ba,Pn.omitBy=function(t,e){return Da(t,Bi(ls(e)))},Pn.once=function(t){return Ii(2,t)},Pn.orderBy=function(e,n,r,o){return null==e?[]:(Wi(n)||(n=null==n?[]:[n]),Wi(r=o?t:r)||(r=null==r?[]:[r]),Wr(e,n,r))},Pn.over=lc,Pn.overArgs=Ri,Pn.overEvery=uc,Pn.overSome=fc,Pn.partial=Di,Pn.partialRight=Ni,Pn.partition=Ei,Pn.pick=Ra,Pn.pickBy=Da,Pn.property=pc,Pn.propertyOf=function(e){return function(n){return null==e?t:Sr(e,n)}},Pn.pull=Zs,Pn.pullAll=Ys,Pn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Jr(t,e,ls(n,2)):t},Pn.pullAllWith=function(e,n,r){return e&&e.length&&n&&n.length?Jr(e,n,t,r):e},Pn.pullAt=Qs,Pn.range=dc,Pn.rangeRight=hc,Pn.rearg=Mi,Pn.reject=function(t,e){return(Wi(t)?Oe:gr)(t,Bi(ls(e,3)))},Pn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,o=[],s=t.length;for(e=ls(e,3);++r<s;){var i=t[r];e(i,r,t)&&(n.push(i),o.push(r))}return Gr(t,o),n},Pn.rest=function(n,r){if('function'!=typeof n)throw new Ft(e);return Kr(n,r=r===t?r:ha(r))},Pn.reverse=ti,Pn.sampleSize=function(e,n,r){return n=(r?ws(e,n,r):n===t)?1:ha(n),(Wi(e)?Yn:Yr)(e,n)},Pn.set=function(t,e,n){return null==t?t:Qr(t,e,n)},Pn.setWith=function(e,n,r,o){return o='function'==typeof o?o:t,null==e?e:Qr(e,n,r,o)},Pn.shuffle=function(t){return(Wi(t)?Qn:no)(t)},Pn.slice=function(e,n,r){var o=null==e?0:e.length;return o?(r&&'number'!=typeof r&&ws(e,n,r)?(n=0,r=o):(n=null==n?0:ha(n),r=r===t?o:ha(r)),ro(e,n,r)):[]},Pn.sortBy=$i,Pn.sortedUniq=function(t){return t&&t.length?ao(t):[]},Pn.sortedUniqBy=function(t,e){return t&&t.length?ao(t,ls(e,2)):[]},Pn.split=function(e,n,r){return r&&'number'!=typeof r&&ws(e,n,r)&&(n=r=t),(r=r===t?u:r>>>0)?(e=_a(e))&&('string'==typeof n||null!=n&&!sa(n))&&!(n=lo(n))&&cn(e)?xo(vn(e),0,r):e.split(n,r):[]},Pn.spread=function(t,n){if('function'!=typeof t)throw new Ft(e);return n=null==n?0:_n(ha(n),0),Kr(function(e){var r=e[n],o=xo(e,0,n);return r&&Re(o,r),Ce(t,this,o)})},Pn.tail=function(t){var e=null==t?0:t.length;return e?ro(t,1,e):[]},Pn.take=function(e,n,r){return e&&e.length?ro(e,0,(n=r||n===t?1:ha(n))<0?0:n):[]},Pn.takeRight=function(e,n,r){var o=null==e?0:e.length;return o?ro(e,(n=o-(n=r||n===t?1:ha(n)))<0?0:n,o):[]},Pn.takeRightWhile=function(t,e){return t&&t.length?ho(t,ls(e,3),!1,!0):[]},Pn.takeWhile=function(t,e){return t&&t.length?ho(t,ls(e,3)):[]},Pn.tap=function(t,e){return e(t),t},Pn.throttle=function(t,n,r){var o=!0,s=!0;if('function'!=typeof t)throw new Ft(e);return ta(r)&&(o='leading'in r?!!r.leading:o,s='trailing'in r?!!r.trailing:s),Ai(t,n,{leading:o,maxWait:n,trailing:s})},Pn.thru=di,Pn.toArray=pa,Pn.toPairs=Na,Pn.toPairsIn=Ma,Pn.toPath=function(t){return Wi(t)?Be(t,Ds):ca(t)?[t]:Fo(Rs(_a(t)))},Pn.toPlainObject=ya,Pn.transform=function(t,e,n){var r=Wi(t),o=r||qi(t)||la(t);if(e=ls(e,4),null==n){var s=t&&t.constructor;n=o?r?new s:[]:ta(t)&&Zi(s)?Vn(Gt(t)):{}}return(o?ke:wr)(t,function(t,r,o){return e(n,t,r,o)}),n},Pn.unary=function(t){return Ci(t,1)},Pn.union=ei,Pn.unionBy=ni,Pn.unionWith=ri,Pn.uniq=function(t){return t&&t.length?uo(t):[]},Pn.uniqBy=function(t,e){return t&&t.length?uo(t,ls(e,2)):[]},Pn.uniqWith=function(e,n){return n='function'==typeof n?n:t,e&&e.length?uo(e,t,n):[]},Pn.unset=function(t,e){return null==t||fo(t,e)},Pn.unzip=oi,Pn.unzipWith=si,Pn.update=function(t,e,n){return null==t?t:po(t,e,mo(n))},Pn.updateWith=function(e,n,r,o){return o='function'==typeof o?o:t,null==e?e:po(e,n,mo(r),o)},Pn.values=Pa,Pn.valuesIn=function(t){return null==t?[]:tn(t,Oa(t))},Pn.without=ii,Pn.words=Za,Pn.wrap=function(t,e){return Di(mo(e),t)},Pn.xor=ai,Pn.xorBy=ci,Pn.xorWith=li,Pn.zip=ui,Pn.zipObject=function(t,e){return yo(t||[],e||[],er)},Pn.zipObjectDeep=function(t,e){return yo(t||[],e||[],Qr)},Pn.zipWith=fi,Pn.entries=Na,Pn.entriesIn=Ma,Pn.extend=wa,Pn.extendWith=ba,ac(Pn,Pn),Pn.add=_c,Pn.attempt=Ya,Pn.camelCase=Va,Pn.capitalize=Ua,Pn.ceil=mc,Pn.clamp=function(e,n,r){return r===t&&(r=n,n=t),r!==t&&(r=(r=ga(r))==r?r:0),n!==t&&(n=(n=ga(n))==n?n:0),ar(ga(e),n,r)},Pn.clone=function(t){return cr(t,4)},Pn.cloneDeep=function(t){return cr(t,5)},Pn.cloneDeepWith=function(e,n){return cr(e,5,n='function'==typeof n?n:t)},Pn.cloneWith=function(e,n){return cr(e,4,n='function'==typeof n?n:t)},Pn.conformsTo=function(t,e){return null==e||lr(t,e,Aa(e))},Pn.deburr=za,Pn.defaultTo=function(t,e){return null==t||t!=t?e:t},Pn.divide=wc,Pn.endsWith=function(e,n,r){e=_a(e),n=lo(n);var o=e.length,s=r=r===t?o:ar(ha(r),0,o);return(r-=n.length)>=0&&e.slice(r,s)==n},Pn.eq=Pi,Pn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(X,sn):t},Pn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(ot,'\\$&'):t},Pn.every=function(e,n,r){var o=Wi(e)?Ae:hr;return r&&ws(e,n,r)&&(n=t),o(e,ls(n,3))},Pn.find=gi,Pn.findIndex=zs,Pn.findKey=function(t,e){return Ve(t,ls(e,3),wr)},Pn.findLast=yi,Pn.findLastIndex=Ws,Pn.findLastKey=function(t,e){return Ve(t,ls(e,3),br)},Pn.floor=bc,Pn.forEach=_i,Pn.forEachRight=mi,Pn.forIn=function(t,e){return null==t?t:_r(t,ls(e,3),Oa)},Pn.forInRight=function(t,e){return null==t?t:mr(t,ls(e,3),Oa)},Pn.forOwn=function(t,e){return t&&wr(t,ls(e,3))},Pn.forOwnRight=function(t,e){return t&&br(t,ls(e,3))},Pn.get=Ta,Pn.gt=Vi,Pn.gte=Ui,Pn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Pn.hasIn=Ca,Pn.head=Js,Pn.identity=rc,Pn.includes=function(t,e,n,r){t=Ji(t)?t:Pa(t),n=n&&!r?ha(n):0;var o=t.length;return n<0&&(n=_n(o+n,0)),aa(t)?n<=o&&t.indexOf(e,n)>-1:!!o&&ze(t,e,n)>-1},Pn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=null==n?0:ha(n);return o<0&&(o=_n(r+o,0)),ze(t,e,o)},Pn.inRange=function(e,n,r){return n=da(n),r===t?(r=n,n=0):r=da(r),function(t,e,n){return t>=mn(e,n)&&t<_n(e,n)}(e=ga(e),n,r)},Pn.invoke=Fa,Pn.isArguments=zi,Pn.isArray=Wi,Pn.isArrayBuffer=Hi,Pn.isArrayLike=Ji,Pn.isArrayLikeObject=Gi,Pn.isBoolean=function(t){return!0===t||!1===t||ea(t)&&$r(t)==y},Pn.isBuffer=qi,Pn.isDate=Xi,Pn.isElement=function(t){return ea(t)&&1===t.nodeType&&!oa(t)},Pn.isEmpty=function(t){if(null==t)return!0;if(Ji(t)&&(Wi(t)||'string'==typeof t||'function'==typeof t.splice||qi(t)||la(t)||zi(t)))return!t.length;var e=vs(t);if(e==S||e==k)return!t.size;if(Es(t))return!Rr(t).length;for(var n in t)if(Rt.call(t,n))return!1;return!0},Pn.isEqual=function(t,e){return Or(t,e)},Pn.isEqualWith=function(e,n,r){var o=(r='function'==typeof r?r:t)?r(e,n):t;return o===t?Or(e,n,t,r):!!o},Pn.isError=Ki,Pn.isFinite=function(t){return'number'==typeof t&&we(t)},Pn.isFunction=Zi,Pn.isInteger=Yi,Pn.isLength=Qi,Pn.isMap=na,Pn.isMatch=function(t,e){return t===e||jr(t,e,fs(e))},Pn.isMatchWith=function(e,n,r){return r='function'==typeof r?r:t,jr(e,n,fs(n),r)},Pn.isNaN=function(t){return ra(t)&&t!=+t},Pn.isNative=function(t){if(Ss(t))throw new Et('Unsupported core-js use. Try https://npms.io/search?q=ponyfill.');return Lr(t)},Pn.isNil=function(t){return null==t},Pn.isNull=function(t){return null===t},Pn.isNumber=ra,Pn.isObject=ta,Pn.isObjectLike=ea,Pn.isPlainObject=oa,Pn.isRegExp=sa,Pn.isSafeInteger=function(t){return Yi(t)&&t>=-9007199254740991&&t<=c},Pn.isSet=ia,Pn.isString=aa,Pn.isSymbol=ca,Pn.isTypedArray=la,Pn.isUndefined=function(e){return e===t},Pn.isWeakMap=function(t){return ea(t)&&vs(t)==O},Pn.isWeakSet=function(t){return ea(t)&&'[object WeakSet]'==$r(t)},Pn.join=function(t,e){return null==t?'':Pe.call(t,e)},Pn.kebabCase=Wa,Pn.last=Ks,Pn.lastIndexOf=function(e,n,r){var o=null==e?0:e.length;if(!o)return-1;var s=o;return r!==t&&(s=(s=ha(r))<0?_n(o+s,0):mn(s,o-1)),n==n?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(e,n,s):Ue(e,He,s,!0)},Pn.lowerCase=Ha,Pn.lowerFirst=Ja,Pn.lt=ua,Pn.lte=fa,Pn.max=function(e){return e&&e.length?vr(e,rc,Tr):t},Pn.maxBy=function(e,n){return e&&e.length?vr(e,ls(n,2),Tr):t},Pn.mean=function(t){return Je(t,rc)},Pn.meanBy=function(t,e){return Je(t,ls(e,2))},Pn.min=function(e){return e&&e.length?vr(e,rc,Nr):t},Pn.minBy=function(e,n){return e&&e.length?vr(e,ls(n,2),Nr):t},Pn.stubArray=vc,Pn.stubFalse=gc,Pn.stubObject=function(){return{}},Pn.stubString=function(){return''},Pn.stubTrue=function(){return!0},Pn.multiply=xc,Pn.nth=function(e,n){return e&&e.length?zr(e,ha(n)):t},Pn.noConflict=function(){return ve._===this&&(ve._=Vt),this},Pn.noop=cc,Pn.now=Ti,Pn.pad=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;if(!e||r>=e)return t;var o=(e-r)/2;return Ho(ge(o),n)+t+Ho(he(o),n)},Pn.padEnd=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;return e&&r<e?t+Ho(e-r,n):t},Pn.padStart=function(t,e,n){t=_a(t);var r=(e=ha(e))?hn(t):0;return e&&r<e?Ho(e-r,n)+t:t},Pn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),bn(_a(t).replace(it,''),e||0)},Pn.random=function(e,n,r){if(r&&'boolean'!=typeof r&&ws(e,n,r)&&(n=r=t),r===t&&('boolean'==typeof n?(r=n,n=t):'boolean'==typeof e&&(r=e,e=t)),e===t&&n===t?(e=0,n=1):(e=da(e),n===t?(n=e,e=0):n=da(n)),e>n){var o=e;e=n,n=o}if(r||e%1||n%1){var s=xn();return mn(e+s*(n-e+fe('1e-'+((s+'').length-1))),n)}return qr(e,n)},Pn.reduce=function(t,e,n){var r=Wi(t)?De:Xe,o=arguments.length<3;return r(t,ls(e,4),n,o,pr)},Pn.reduceRight=function(t,e,n){var r=Wi(t)?Ne:Xe,o=arguments.length<3;return r(t,ls(e,4),n,o,dr)},Pn.repeat=function(e,n,r){return n=(r?ws(e,n,r):n===t)?1:ha(n),Xr(_a(e),n)},Pn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Pn.result=function(e,n,r){var o=-1,s=(n=wo(n,e)).length;for(s||(s=1,e=t);++o<s;){var i=null==e?t:e[Ds(n[o])];i===t&&(o=s,i=r),e=Zi(i)?i.call(e):i}return e},Pn.round=Sc,Pn.runInContext=f,Pn.sample=function(t){return(Wi(t)?Zn:Zr)(t)},Pn.size=function(t){if(null==t)return 0;if(Ji(t))return aa(t)?hn(t):t.length;var e=vs(t);return e==S||e==k?t.size:Rr(t).length},Pn.snakeCase=Ga,Pn.some=function(e,n,r){var o=Wi(e)?Me:oo;return r&&ws(e,n,r)&&(n=t),o(e,ls(n,3))},Pn.sortedIndex=function(t,e){return so(t,e)},Pn.sortedIndexBy=function(t,e,n){return io(t,e,ls(n,2))},Pn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=so(t,e);if(r<n&&Pi(t[r],e))return r}return-1},Pn.sortedLastIndex=function(t,e){return so(t,e,!0)},Pn.sortedLastIndexBy=function(t,e,n){return io(t,e,ls(n,2),!0)},Pn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=so(t,e,!0)-1;if(Pi(t[n],e))return n}return-1},Pn.startCase=qa,Pn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:ar(ha(n),0,t.length),e=lo(e),t.slice(n,n+e.length)==e},Pn.subtract=Ec,Pn.sum=function(t){return t&&t.length?Ke(t,rc):0},Pn.sumBy=function(t,e){return t&&t.length?Ke(t,ls(e,2)):0},Pn.template=function(e,n,r){var o=Pn.templateSettings;r&&ws(e,n,r)&&(n=t),e=_a(e),n=ba({},n,o,Qo);var s,i,a=ba({},n.imports,o.imports,Qo),c=Aa(a),l=tn(a,c),u=0,f=n.interpolate||xt,p='__p += \'',d=It((n.escape||xt).source+'|'+f.source+'|'+(f===tt?ht:xt).source+'|'+(n.evaluate||xt).source+'|$','g'),h='//# sourceURL='+(Rt.call(n,'sourceURL')?(n.sourceURL+'').replace(/\s/g,' '):'lodash.templateSources['+ ++ae+']')+'\n';e.replace(d,function(t,n,r,o,a,c){return r||(r=o),p+=e.slice(u,c).replace(St,an),n&&(s=!0,p+='\' +\n__e('+n+') +\n\''),a&&(i=!0,p+='\';\n'+a+';\n__p += \''),r&&(p+='\' +\n((__t = ('+r+')) == null ? \'\' : __t) +\n\''),u=c+t.length,t}),p+='\';\n';var v=Rt.call(n,'variable')&&n.variable;if(v){if(pt.test(v))throw new Et('Invalid `variable` option passed into `_.template`')}else p='with (obj) {\n'+p+'\n}\n';p=(i?p.replace(H,''):p).replace(J,'$1').replace(G,'$1;'),p='function('+(v||'obj')+') {\n'+(v?'':'obj || (obj = {});\n')+'var __t, __p = \'\''+(s?', __e = _.escape':'')+(i?', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, \'\') }\n':';\n')+p+'return __p\n}';var g=Ya(function(){return $t(c,h+'return '+p).apply(t,l)});if(g.source=p,Ki(g))throw g;return g},Pn.times=function(t,e){if((t=ha(t))<1||t>c)return[];var n=u,r=mn(t,u);e=ls(e),t-=u;for(var o=Ze(r,e);++n<t;)e(n);return o},Pn.toFinite=da,Pn.toInteger=ha,Pn.toLength=va,Pn.toLower=function(t){return _a(t).toLowerCase()},Pn.toNumber=ga,Pn.toSafeInteger=function(t){return t?ar(ha(t),-9007199254740991,c):0===t?t:0},Pn.toString=_a,Pn.toUpper=function(t){return _a(t).toUpperCase()},Pn.trim=function(e,n,r){if((e=_a(e))&&(r||n===t))return Ye(e);if(!e||!(n=lo(n)))return e;var o=vn(e),s=vn(n);return xo(o,nn(o,s),rn(o,s)+1).join('')},Pn.trimEnd=function(e,n,r){if((e=_a(e))&&(r||n===t))return e.slice(0,gn(e)+1);if(!e||!(n=lo(n)))return e;var o=vn(e);return xo(o,0,rn(o,vn(n))+1).join('')},Pn.trimStart=function(e,n,r){if((e=_a(e))&&(r||n===t))return e.replace(it,'');if(!e||!(n=lo(n)))return e;var o=vn(e);return xo(o,nn(o,vn(n))).join('')},Pn.truncate=function(e,n){var r=30,o='...';if(ta(n)){var s='separator'in n?n.separator:s;r='length'in n?ha(n.length):r,o='omission'in n?lo(n.omission):o}var i=(e=_a(e)).length;if(cn(e)){var a=vn(e);i=a.length}if(r>=i)return e;var c=r-hn(o);if(c<1)return o;var l=a?xo(a,0,c).join(''):e.slice(0,c);if(s===t)return l+o;if(a&&(c+=l.length-c),sa(s)){if(e.slice(c).search(s)){var u,f=l;for(s.global||(s=It(s.source,_a(vt.exec(s))+'g')),s.lastIndex=0;u=s.exec(f);)var p=u.index;l=l.slice(0,p===t?c:p)}}else if(e.indexOf(lo(s),c)!=c){var d=l.lastIndexOf(s);d>-1&&(l=l.slice(0,d))}return l+o},Pn.unescape=function(t){return(t=_a(t))&&K.test(t)?t.replace(q,yn):t},Pn.uniqueId=function(t){var e=++Dt;return _a(t)+e},Pn.upperCase=Xa,Pn.upperFirst=Ka,Pn.each=_i,Pn.eachRight=mi,Pn.first=Js,ac(Pn,(yc={},wr(Pn,function(t,e){Rt.call(Pn.prototype,e)||(yc[e]=t)}),yc),{chain:!1}),Pn.VERSION='4.17.21',ke(['bind','bindKey','curry','curryRight','partial','partialRight'],function(t){Pn[t].placeholder=Pn}),ke(['drop','take'],function(e,n){Wn.prototype[e]=function(r){r=r===t?1:_n(ha(r),0);var o=this.__filtered__&&!n?new Wn(this):this.clone();return o.__filtered__?o.__takeCount__=mn(r,o.__takeCount__):o.__views__.push({size:mn(r,u),type:e+(o.__dir__<0?'Right':'')}),o},Wn.prototype[e+'Right']=function(t){return this.reverse()[e](t).reverse()}}),ke(['filter','map','takeWhile'],function(t,e){var n=e+1,r=1==n||3==n;Wn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:ls(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),ke(['head','last'],function(t,e){var n='take'+(e?'Right':'');Wn.prototype[t]=function(){return this[n](1).value()[0]}}),ke(['initial','tail'],function(t,e){var n='drop'+(e?'':'Right');Wn.prototype[t]=function(){return this.__filtered__?new Wn(this):this[n](1)}}),Wn.prototype.compact=function(){return this.filter(rc)},Wn.prototype.find=function(t){return this.filter(t).head()},Wn.prototype.findLast=function(t){return this.reverse().find(t)},Wn.prototype.invokeMap=Kr(function(t,e){return'function'==typeof t?new Wn(this):this.map(function(n){return Fr(n,t,e)})}),Wn.prototype.reject=function(t){return this.filter(Bi(ls(t)))},Wn.prototype.slice=function(e,n){e=ha(e);var r=this;return r.__filtered__&&(e>0||n<0)?new Wn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(n=ha(n))<0?r.dropRight(-n):r.take(n-e)),r)},Wn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Wn.prototype.toArray=function(){return this.take(u)},wr(Wn.prototype,function(e,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),o=/^(?:head|last)$/.test(n),s=Pn[o?'take'+('last'==n?'Right':''):n],i=o||/^find/.test(n);s&&(Pn.prototype[n]=function(){var n=this.__wrapped__,a=o?[1]:arguments,c=n instanceof Wn,l=a[0],u=c||Wi(n),f=function(t){var e=s.apply(Pn,Re([t],a));return o&&p?e[0]:e};u&&r&&'function'==typeof l&&1!=l.length&&(c=u=!1);var p=this.__chain__,d=!!this.__actions__.length,h=i&&!p,v=c&&!d;if(!i&&u){n=v?n:new Wn(this);var g=e.apply(n,a);return g.__actions__.push({func:di,args:[f],thisArg:t}),new zn(g,p)}return h&&v?e.apply(this,a):(g=this.thru(f),h?o?g.value()[0]:g.value():g)})}),ke(['pop','push','shift','sort','splice','unshift'],function(t){var e=At[t],n=/^(?:push|sort|unshift)$/.test(t)?'tap':'thru',r=/^(?:pop|shift)$/.test(t);Pn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var o=this.value();return e.apply(Wi(o)?o:[],t)}return this[n](function(n){return e.apply(Wi(n)?n:[],t)})}}),wr(Wn.prototype,function(t,e){var n=Pn[e];if(n){var r=n.name+'';Rt.call(An,r)||(An[r]=[]),An[r].push({name:e,func:n})}}),An[Vo(t,2).name]=[{name:'wrapper',func:t}],Wn.prototype.clone=function(){var t=new Wn(this.__wrapped__);return t.__actions__=Fo(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Fo(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Fo(this.__views__),t},Wn.prototype.reverse=function(){if(this.__filtered__){var t=new Wn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Wn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Wi(t),r=e<0,o=n?t.length:0,s=function(t,e,n){for(var r=-1,o=n.length;++r<o;){var s=n[r],i=s.size;switch(s.type){case'drop':t+=i;break;case'dropRight':e-=i;break;case'take':e=mn(e,t+i);break;case'takeRight':t=_n(t,e-i)}}return{start:t,end:e}}(0,o,this.__views__),i=s.start,a=s.end,c=a-i,l=r?a:i-1,u=this.__iteratees__,f=u.length,p=0,d=mn(c,this.__takeCount__);if(!n||!r&&o==c&&d==c)return vo(t,this.__actions__);var h=[];t:for(;c--&&p<d;){for(var v=-1,g=t[l+=e];++v<f;){var y=u[v],m=y.iteratee,w=y.type,b=m(g);if(2==w)g=b;else if(!b){if(1==w)continue t;break t}}h[p++]=g}return h},Pn.prototype.at=hi,Pn.prototype.chain=function(){return pi(this)},Pn.prototype.commit=function(){return new zn(this.value(),this.__chain__)},Pn.prototype.next=function(){this.__values__===t&&(this.__values__=pa(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?t:this.__values__[this.__index__++]}},Pn.prototype.plant=function(e){for(var n,r=this;r instanceof Un;){var o=Ms(r);o.__index__=0,o.__values__=t,n?s.__wrapped__=o:n=o;var s=o;r=r.__wrapped__}return s.__wrapped__=e,n},Pn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wn){var n=e;return this.__actions__.length&&(n=new Wn(this)),(n=n.reverse()).__actions__.push({func:di,args:[ti],thisArg:t}),new zn(n,this.__chain__)}return this.thru(ti)},Pn.prototype.toJSON=Pn.prototype.valueOf=Pn.prototype.value=function(){return vo(this.__wrapped__,this.__actions__)},Pn.prototype.first=Pn.prototype.head,Yt&&(Pn.prototype[Yt]=function(){return this}),Pn}();ye?((ye.exports=_)._=_,ge._=_):ve._=_}.call(h.exports)),h.exports);const m=p(y),w=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,b=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,x=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function S(t,e){if(!('__proto__'===t||'constructor'===t&&e&&'object'==typeof e&&'prototype'in e))return e;!function(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}(t)}function E(t,e={}){if('string'!=typeof t)return t;if('"'===t[0]&&'"'===t[t.length-1]&&-1===t.indexOf('\\'))return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case'true':return!0;case'false':return!1;case'undefined':return;case'null':return null;case'nan':return Number.NaN;case'infinity':return Number.POSITIVE_INFINITY;case'-infinity':return Number.NEGATIVE_INFINITY}if(!x.test(t)){if(e.strict)throw new SyntaxError('[destr] Invalid JSON');return t}try{if(w.test(t)||b.test(t)){if(e.strict)throw new Error('[destr] Possible prototype pollution');return JSON.parse(t,S)}return JSON.parse(t)}catch(R){if(e.strict)throw R;return t}}function T(t,e={}){return E(t,{...e,strict:!0})}const C=new Map,I=new Map,k=new Map;function F(t={}){const{container:e,containerId:n,initialValue:r,styleUrl:o,scriptUrl:s,readOnly:i=!1,onChange:a,onFallback:c,onReady:l,defaultMode:u=null}=t;let f=m(e,n),p=null,d=null,h=!1,v=w(r??{}),g=null,y=!1;function m(t,e){return t instanceof HTMLElement?t:'string'==typeof t?document.getElementById(t):'string'==typeof e?document.getElementById(e):null}function w(t){if(null==t)return t;if('function'==typeof structuredClone)try{return structuredClone(t)}catch(e){return JSON.parse(JSON.stringify(t))}return JSON.parse(JSON.stringify(t))}function b(t,{silent:e=!1}={}){const n=null==t?{}:t;if(v=w(n),h&&p){e&&(y=!0);try{p.set({json:w(n)})}catch(R){console.error('[VariableBlockEditor] 设置编辑内容失败',R)}e&&(y=!1)}else g=w(n)}return{ensureReady:async function(){if(p)return p;if(f=f||m(e,n),!f)return null;try{await function(t){if(!t)return Promise.resolve();if(C.has(t))return C.get(t);if(document.querySelector(`link[data-jsoneditor-style="${CSS.escape(t)}"]`))return C.set(t,Promise.resolve()),C.get(t);const e=new Promise((e,n)=>{const r=document.createElement('link');r.rel='stylesheet',r.href=t,r.dataset.jsoneditorStyle=t,r.addEventListener('load',()=>e()),r.addEventListener('error',e=>{r.remove(),C.delete(t),n(e)}),document.head.appendChild(r)});return C.set(t,e),e}(o);const t=await function(t){if(!t)return Promise.resolve({createJSONEditor:globalThis.createJSONEditor});if(k.get(t))return Promise.reject(new Error('JSON 编辑器模块加载已失败'));if(I.has(t))return I.get(t);const e=import(t).then(t=>{if(!t?.createJSONEditor&&!globalThis.createJSONEditor)throw new Error('JSON 编辑器模块未提供 createJSONEditor');return t}).catch(e=>{throw I.delete(t),k.set(t,!0),e});return I.set(t,e),e}(s),e=t?.createJSONEditor??globalThis.createJSONEditor;if('function'!=typeof e)throw new Error('JSON 编辑器模块未提供 createJSONEditor');const n=localStorage.getItem('varSystemEditorMode');if(p=e({target:f,props:{content:{json:v??{}},mode:n||u||'text',mainMenuBar:!0,navigationBar:!1,statusBar:!1,readOnly:i,parser:{parse:T,stringify:JSON.stringify},onChange:(t,e,n)=>{if(y)return;let r=t;void 0!==t?.text&&(r=void 0===p.validate()?{json:E(t.text),text:t.text}:{json:void 0,text:t.text}),v=w(r?.json??v??{}),'function'==typeof a&&a(r,e,n)}}}),h=!0,!p||'function'!=typeof p.set)throw new Error('JSON 编辑器实例缺少 set 方法');return p.isFallback=!1,null!==g&&(b(g,{silent:!0}),g=null),'function'==typeof l&&l(p),p}catch(R){return console.error('[VariableBlockEditor] 初始化 JSON 编辑器失败',R),function(){if(f=f||m(e,n),!f)return null;if(d)return d;f.innerHTML='',f.style.display='flex',f.style.flexDirection='column',f.style.alignItems='stretch';const r=document.createElement('div');r.style.fontSize='12px',r.style.padding='6px',r.style.background='rgba(255, 255, 255, 0.05)',r.style.borderBottom='1px solid var(--SmartThemeBorderColor, #333)',r.textContent='JSON 编辑器资源加载失败，已降级为纯文本模式。';const o=document.createElement('textarea');o.style.width='100%',o.style.height='calc(100% - 32px)',o.style.minHeight='220px',o.style.background='transparent',o.style.color='inherit',o.style.border='none',o.style.padding='10px',o.style.resize='vertical',o.style.fontFamily='var(--monospaceFont, monospace)',o.style.fontSize='13px',o.style.lineHeight='1.4',o.style.borderRadius='0',o.readOnly=Boolean(i),f.appendChild(r),f.appendChild(o);const s=()=>{if(y)return;let e;const n=[];if(0===o.value.trim().length)e={};else try{e=JSON.parse(o.value)}catch(t){n.push({message:t?.message??String(t)})}const r=n.length>0?{json:void 0}:{json:e};v=w(r?.json??v??{}),'function'==typeof a&&a(r,null,{contentErrors:n})};o.addEventListener('input',s),d={isFallback:!0,set({json:t}){y=!0;try{const e=null==t?{}:t;o.value=JSON.stringify(e,null,2)}catch(e){o.value='{}'}y=!1},get(){try{return{json:o.value.trim().length?JSON.parse(o.value):{}}}catch(t){return{json:void 0}}},destroy(){o.removeEventListener('input',s),f.innerHTML=''}},p=d,h=!0;const l=null!==g?g:v??{};d.set({json:l}),g=null,'function'==typeof c&&c();return d}()}},setValue:b,getValue:function(){if(!p)return w(v??{});try{const t=p.get();if(void 0!==t?.json)return w(t.json)}catch(R){console.error('[VariableBlockEditor] 读取编辑内容失败',R)}return w(v??{})},set:function(t){if(p&&'function'==typeof p.set)return p.set(t);void 0!==t?.json&&b(t.json)},get:function(){return p&&'function'==typeof p.get?p.get():{json:w(v??{})}},setMode:function(t){p&&'function'==typeof p.updateProps?(localStorage.setItem('varSystemEditorMode',t),p.updateProps({mode:t})):console.warn('[VariableBlockEditor] 编辑器未初始化或不支持 updateProps')},getMode:function(){return localStorage.getItem('varSystemEditorMode')},destroy:function(){if(h){try{p?.destroy?.()}catch(R){console.error('[VariableBlockEditor] 销毁编辑器失败',R)}p=null,d=null,h=!1,f=null}},isFallback:function(){return Boolean(d)},setContainer:function(t){f=m(t,n)}}}const A={},O=function(t,e,n){let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName('link');const t=document.querySelector('meta[property=csp-nonce]'),n=t?.nonce||t?.getAttribute('nonce');o=e.map(t=>{if((t=function(t){return'/'+t}(t))in A)return;A[t]=!0;const e=t.endsWith('.css'),r=e?'[rel="stylesheet"]':'';if(document.querySelector(`link[href="${t}"]${r}`))return;const o=document.createElement('link');return o.rel=e?'stylesheet':'modulepreload',e||(o.as='script'),o.crossOrigin='',o.href=t,n&&o.setAttribute('nonce',n),document.head.appendChild(o),e?new Promise((e,n)=>{o.addEventListener('load',e),o.addEventListener('error',()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}),r=Promise.all(o.map(t=>Promise.resolve(t).then(t=>({status:'fulfilled',value:t}),t=>({status:'rejected',reason:t}))))}var o;function s(t){const e=new Event('vite:preloadError',{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then(e=>{for(const t of e||[])'rejected'===t.status&&s(t.reason);return t().catch(s)})},j='[ST-VarSystemExtension]',L=(...t)=>console.log(j,...t),B=(...t)=>console.warn(j,...t),R=(...t)=>console.error(j,...t),D='[ST-VarSystemExtension]';const N=new class{constructor(){this.safeGlobals={_:window._,Object:Object,Array:Array,String:String,Number:Number,Boolean:Boolean,Math:Math,Date:Date,JSON:JSON,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,console:{log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)}}}compileExecutor(t){try{const e=['snapshot','args','context',...Object.keys(this.safeGlobals)];return new Function(...e,t)}catch(e){return R(`${D} 编译函数失败:`,e),null}}executeFunction(t,e,n=[],r={}){try{const o=this.compileExecutor(t.executor);if(!o)return{success:!1,snapshot:e,error:'函数编译失败'};const s=structuredClone(e),i=o(...[s,n,r,...Object.values(this.safeGlobals)]);return null==i?(B(`${D} 函数 ${t.name} 未返回快照，使用原快照`),{success:!0,snapshot:s}):{success:!0,snapshot:i}}catch(o){return R(`${D} 执行函数 ${t.name} 失败:`,o),{success:!1,snapshot:e,error:o.message||String(o)}}}executeAll(t,e,n,r){let o=JSON.parse(JSON.stringify(t));const s=[];L(`${D} 执行 ${n.before.length} 个前置被动函数`);for(const i of n.before){const t=this.executeFunction(i,o,[],r);t.success?o=t.snapshot:s.push({functionName:i.name,error:t.error||'未知错误'})}L(`${D} 执行 ${e.length} 个主动函数调用`);for(const i of e){const t=this.executeFunction(i.functionDef,o,i.args,r);t.success?o=t.snapshot:s.push({functionName:i.functionDef.name,error:t.error||'未知错误'})}L(`${D} 执行 ${n.after.length} 个后置被动函数`);for(const i of n.after){const t=this.executeFunction(i,o,[],r);t.success?o=t.snapshot:s.push({functionName:i.name,error:t.error||'未知错误'})}return s.length>0&&(B(`${D} 有 ${s.length} 个函数调用失败:`,s),window.toastr&&window.toastr.warning(`本次解析有 ${s.length} 个函数调用失败，请检查控制台日志`,'变量系统')),{snapshot:o,errors:s}}};async function M(t,e){const{functionRegistry:n}=await O(async()=>{const{functionRegistry:t}=await Promise.resolve().then(()=>W);return{functionRegistry:t}},[]),r=n.getPassiveFunctions(),o={timestamp:Date.now()};return N.executeAll(e,t,r,o).snapshot}const P='[ST-VarSystemExtension]';class V{constructor(){this.globalFunctions=new Map,this.localFunctions=new Map}loadGlobalFunctions(t){if(this.globalFunctions.clear(),Array.isArray(t)){for(const n of t)if(this.validateFunction(n)){if('active'===n.type&&n.pattern&&!n._compiledRegex)try{n._compiledRegex=new RegExp(n.pattern,'g')}catch(e){B(`${P} 预编译正则失败:`,n.name,e)}this.globalFunctions.set(n.id,n)}else B(`${P} 跳过无效的全局函数:`,n);L(`${P} 已加载 ${this.globalFunctions.size} 个全局函数`)}else B(`${P} 全局函数库格式错误，应为数组`)}loadLocalFunctions(t){if(this.localFunctions.clear(),Array.isArray(t)){for(const n of t)if(this.validateFunction(n)){if('active'===n.type&&n.pattern&&!n._compiledRegex)try{n._compiledRegex=new RegExp(n.pattern,'g')}catch(e){B(`${P} 预编译正则失败:`,n.name,e)}this.localFunctions.set(n.id,n)}else B(`${P} 跳过无效的本地函数:`,n);L(`${P} 已加载 ${this.localFunctions.size} 个本地函数`)}}validateFunction(t){if(!t||'object'!=typeof t)return!1;if(!t.id||'string'!=typeof t.id)return!1;if(!t.name||'string'!=typeof t.name)return!1;if(!['active','passive'].includes(t.type))return!1;if('boolean'!=typeof t.enabled)return!1;if('number'!=typeof t.order)return!1;if(!t.executor||'string'!=typeof t.executor)return!1;if('active'===t.type){if(!t.pattern||'string'!=typeof t.pattern)return!1;try{new RegExp(t.pattern)}catch(e){return R(`${P} 函数 ${t.name} 的正则表达式无效:`,e),!1}}return!('passive'===t.type&&!['before_active','after_active'].includes(t.timing))}getEnabledFunctions(){const t=new Map;for(const[e,n]of this.globalFunctions)n.enabled&&t.set(e,n);for(const[e,n]of this.localFunctions)n.enabled&&t.set(e,n);return Array.from(t.values())}getActiveFunctions(){return this.getEnabledFunctions().filter(t=>'active'===t.type).sort((t,e)=>t.order-e.order)}getPassiveFunctions(){const t=this.getEnabledFunctions().filter(t=>'passive'===t.type);return{before:t.filter(t=>'before_active'===t.timing).sort((t,e)=>t.order-e.order),after:t.filter(t=>'after_active'===t.timing).sort((t,e)=>t.order-e.order)}}parseFunctionCalls(t){const e=this.getActiveFunctions(),n=[];for(const o of e)try{const e=o._compiledRegex||new RegExp(o.pattern,'g');let r=e.exec(t);for(;null!==r;)n.push({functionDef:o,args:r.slice(1),index:r.index,fullMatch:r[0]}),r=e.exec(t)}catch(r){R(`${P} 函数 ${o.name} 匹配失败:`,r)}return n.sort((t,e)=>t.index-e.index),L(`${P} 从消息中解析到 ${n.length} 个函数调用`),n}getFunction(t){return this.localFunctions.get(t)||this.globalFunctions.get(t)||null}upsertGlobalFunction(t){if(!this.validateFunction(t))throw new Error('函数定义无效');const e=this.globalFunctions.get(t.id);e&&t.builtin&&e.builtin&&(t={...t,enabled:e.enabled}),this.globalFunctions.set(t.id,t)}upsertLocalFunction(t){if(!this.validateFunction(t))throw new Error('函数定义无效');const e=this.localFunctions.get(t.id);e&&t.builtin&&e.builtin&&(t={...t,enabled:e.enabled}),this.localFunctions.set(t.id,t)}deleteFunction(t,e){'global'===e?this.globalFunctions.delete(t):'local'===e&&this.localFunctions.delete(t)}exportGlobalFunctions(){return Array.from(this.globalFunctions.values())}exportLocalFunctions(){return Array.from(this.localFunctions.values())}}const U=new V,W=Object.freeze(Object.defineProperty({__proto__:null,FunctionRegistry:V,functionRegistry:U},Symbol.toStringTag,{value:'Module'}));function H(t){return!!t&&(!1===t.is_user||'assistant'===t.role)}function J(t){return t?t.swipe_id??0:0}const G='st_var_system_snapshot_id';function q(t){if(!t)return null;const e=J(t);if(!Array.isArray(t.swipes_info))return null;const n=t.swipes_info[e];if(!n)return null;const r=n[G];return'string'==typeof r?r:null}async function X(t){if(!t)return console.error('[ST-VarSystemExtension] loadSnapshot: identifier 为空'),null;try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`,{method:'GET',headers:{'Content-Type':'application/json'}});if(!e.ok){if(404===e.status)return console.warn(`[ST-VarSystemExtension] 快照不存在: ${t}`),null;throw new Error(`HTTP ${e.status}: ${e.statusText}`)}return await e.json()}catch(R){return console.error(`[ST-VarSystemExtension] 加载快照失败: ${t}`,R),null}}async function K(t,e,n){try{const r=window.SillyTavern.getContext(),s=r.getCurrentChatId?.()||r.chatId;if(!s)return console.warn('[ST-VarSystemExtension] saveSnapshotToPlugin: 无法获取聊天文件名'),null;const i=r.chat;if(!i||t>=i.length)return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 消息 ID 无效',{messageId:t,chatLength:i?.length}),null;const a=i[t];if(!a)return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 消息不存在',t),null;const c='undefined'!=typeof crypto&&'function'==typeof crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substring(2,15)}`,l=await async function(t){const{chatFile:e,messageId:n,payload:r,identifier:s}=t;if(!e||void 0===n||!r)return console.error('[ST-VarSystemExtension] saveSnapshot: 缺少必要参数',t),null;try{const t=await fetch('/api/plugins/var-manager/var-manager/snapshots',{method:'POST',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({chatFile:e,messageId:String(n),payload:r,identifier:s})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(R){return console.error('[ST-VarSystemExtension] 保存快照失败',t,R),null}}({chatFile:s,messageId:t,payload:n,identifier:c});if(!l)return console.warn('[ST-VarSystemExtension] saveSnapshotToPlugin: 插件保存失败（插件可能不可用）'),null;if(!function(t,e,n=null){if(!t||'string'!=typeof e)return!1;const r=null!==n?n:J(t);return Array.isArray(t.swipes_info)||(t.swipes_info=[]),t.swipes_info[r]||(t.swipes_info[r]={}),t.swipes_info[r][G]=e,!0}(a,c,e))return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin: 写入快照标识符失败',{messageId:t,swipeId:e}),null;const u=null!==e?e:J(a);return console.log(`[ST-VarSystemExtension] 快照已保存: 消息 #${t}, swipe=${u}, ID=${c}`),c}catch(R){return console.error('[ST-VarSystemExtension] saveSnapshotToPlugin 失败:',R),null}}const Z='[ST-VarSystemExtension/variableInjector]';async function Y(t){if(t&&'object'==typeof t)if('undefined'!=typeof window&&window.TavernHelper&&'function'==typeof window.TavernHelper.updateVariablesWith)try{await window.TavernHelper.updateVariablesWith(e=>(e.vs_stat_data=t,e),{type:'chat'}),console.log(Z,'快照已注入到 vs_stat_data 变量')}catch(R){console.error(Z,'注入快照变量时发生错误:',R)}else console.error(Z,'酒馆助手 (JS-Slash-Runner) 未安装或 API 不可用。','变量系统依赖酒馆助手提供的 updateVariablesWith API。','请安装扩展: https://github.com/ShinoKana/JS-Slash-Runner');else console.warn(Z,'快照数据无效，跳过注入:',t)}const Q='[ST-VarSystemExtension/statusPlaceholder]',tt='<VarSystemStatusPlaceholder/>';const et='[ST-VarSystemExtension/processor]';function nt(){try{const t=window.SillyTavern.getContext(),e=t.characters[t.characterId];if(!e?.data?.extensions?.st_var_system)return console.log(et,'角色未配置变量模板'),null;const{enabled:n,templateBody:r}=e.data.extensions.st_var_system;return n?r&&'object'==typeof r?(console.log(et,'使用角色模板作为初始快照:',Object.keys(r)),structuredClone(r)):(console.warn(et,'角色模板格式无效:',r),null):(console.log(et,'角色变量模板未启用'),null)}catch(R){return console.error(et,'读取角色模板时发生错误:',R),null}}async function rt(t){try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`);if(404===e.status)return console.warn(et,`快照不存在: ${t}`),null;if(!e.ok)return console.error(et,`读取快照失败 (${e.status}): ${t}`),null;return(await e.json()).payload}catch(R){return console.error(et,'从插件读取快照时发生错误:',R),null}}async function ot(t,e=null){console.log(et,`开始处理消息 #${t}, swipe=${e??'current'}`);const n=window.SillyTavern.getContext().chat;if(!n||0===n.length)return console.warn(et,'当前无聊天记录'),null;const r=await async function(t,e=null){const n=window.SillyTavern.getContext().chat;if(!n||t>=n.length)return console.error(et,'checkExistingSnapshot: 消息 ID 无效',{messageId:t,chatLength:n?.length}),null;const r=n[t];if(!r)return console.error(et,'checkExistingSnapshot: 消息不存在',t),null;const o=q(r);if(!o)return null;console.log(et,`消息 #${t} swipe=${e??'current'} 已有快照: ${o}`);const s=await rt(o);return s?{snapshotId:o,snapshot:s}:(console.warn(et,`快照 ID 存在但无法从插件读取，将重新生成: ${o}`),null)}(t,e);if(r?.snapshot)return await Y(r.snapshot),console.log(et,'消息已有快照，直接注入'),r.snapshot;const o=await async function(t,e){if(!Array.isArray(e)||t<0||t>=e.length)return console.error('[ST-VarSystemExtension] findSnapshotAnchor: 参数无效',{startMessageId:t,chatLength:e?.length}),null;for(let n=t;n>=0;n--){const t=e[n];if(!H(t))continue;const r=q(t);if(!r)continue;console.log(`[ST-VarSystemExtension] 找到快照锚点: 第 ${n} 层, ID: ${r}`);const o=await X(r);if(o)return{anchorMessageId:n,snapshotId:r,snapshot:o.payload};console.warn(`[ST-VarSystemExtension] 快照标识符存在但数据丢失: ${r}, 将清除该标识符`)}return console.log('[ST-VarSystemExtension] 未找到快照锚点,需要使用角色模板'),null}(t,n);let s,i;o?(console.log(et,`找到快照锚点: 消息 #${o.anchorMessageId}, ID: ${o.snapshotId}`),s=await rt(o.snapshotId),s?i=o.anchorMessageId+1:(console.warn(et,`锚点快照读取失败，将从角色模板重新开始: ${o.snapshotId}`),s=nt()||{},i=0)):(console.log(et,'未找到快照锚点，使用角色模板'),s=nt(),s||(console.warn(et,'无角色模板且无快照锚点，使用空快照'),s={}),i=0);const a=function(t,e,n){if(!Array.isArray(n))return console.error('[ST-VarSystemExtension] getAIMessageRange: chat 不是数组'),[];if(t<0||e>=n.length||t>e)return console.error('[ST-VarSystemExtension] getAIMessageRange: 范围无效',{startId:t,endId:e,chatLength:n.length}),[];const r=[];for(let o=t;o<=e;o++){const t=n[o];if(!H(t))continue;const e=t.swipe_id??0,s=Array.isArray(t.swipes)?t.swipes[e]:t.mes||'';r.push({messageId:o,message:t,content:s})}return r}(i,t,n);if(0===a.length)return console.log(et,'无需处理的 AI 消息，直接使用基础快照'),await Y(s),s;console.log(et,`需要处理 ${a.length} 条 AI 消息`);let c=structuredClone(s);for(let l=0;l<a.length;l++){const t=a[l],n=l===a.length-1;console.log(et,`处理第 ${l+1}/${a.length} 层: 消息 #${t.messageId}`);const r=t.content||t.mes||'',o=U.parseFunctionCalls(r);if(o.length>0){console.log(et,`消息 #${t.messageId} 解析到 ${o.length} 个函数调用`);try{c=await M(o,c),console.log(et,`消息 #${t.messageId} 函数执行完成`)}catch(R){console.error(et,`消息 #${t.messageId} 执行函数时发生错误:`,R)}}else console.log(et,`消息 #${t.messageId} 无函数调用，快照不变`);const s=n?e:t.message?.swipe_id??null,i=await K(t.messageId,s,c);i?console.log(et,`消息 #${t.messageId} 快照已保存，ID: ${i}`):console.warn(et,`消息 #${t.messageId} 保存快照到插件失败（插件可能不可用）`)}return await Y(c),console.log(et,'处理完成，已注入快照变量'),await async function(t){try{const e=window.TavernHelper.getChatMessages(t);if(!e||0===e.length)return console.warn(Q,`消息 #${t} 不存在`),!1;const n=e[0];if('user'===n.role)return console.log(Q,`消息 #${t} 是用户消息，跳过添加占位符`),!1;if(n.message.includes(tt))return console.log(Q,`消息 #${t} 已包含占位符`),!1;const r=n.message+`\n\n${tt}`;return await window.TavernHelper.setChatMessages([{message_id:t,message:r}],{refresh:'affected'}),console.log(Q,`已为消息 #${t} 添加状态栏占位符`),!0}catch(R){return console.error(Q,'添加占位符时发生错误:',R),!1}}(t),c}async function st(t){const e=window.SillyTavern.getContext().chat;if(!e||0===e.length)return void console.warn(et,'当前无聊天记录，无法重新处理');const n=e.length-1;console.log(et,`重新处理消息 #${t} 到 #${n}`);for(let r=t;r<=n;r++){const t=e[r];!1!==t.is_user&&'assistant'!==t.role||await ot(r)}console.log(et,'重新处理完成')}const it='[ST-VarSystemExtension/listeners]';let at=null;function ct(){try{const t=window.SillyTavern.getContext(),e=t.characters?.[t.characterId];return!0===e?.data?.extensions?.st_var_system?.enabled}catch(R){return console.error(it,'检查启用状态时发生错误:',R),!1}}async function lt(t){if(console.log(it,`MESSAGE_RECEIVED: 消息 #${t}`),ct())try{await ot(t);try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}catch(R){console.error(it,'MESSAGE_RECEIVED 处理失败:',R)}else{console.log(it,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}}async function ut(t){if(console.log(it,`MESSAGE_SWIPED: 消息 #${t}`),ct())try{const n=window.SillyTavern.getContext().chat[t],r=n?.swipe_id??null;console.log(it,`当前 swipe ID: ${r}`),await ot(t,r);try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}catch(R){console.error(it,'MESSAGE_SWIPED 处理失败:',R)}else{console.log(it,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}}async function ft(t){console.log(it,`CHAT_CHANGED: ${t}`);try{if(!ct()){console.log(it,'新角色未启用变量系统');try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}return}const t=window.SillyTavern.getContext().chat;if(!t||0===t.length)return void console.log(it,'新聊天无消息');for(let n=t.length-1;n>=0;n--){const r=t[n];if(!1===r.is_user||'assistant'===r.role){console.log(it,`处理最后一条 AI 消息: #${n}`),await ot(n);try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}break}}}catch(R){console.error(it,'CHAT_CHANGED 处理失败:',R)}}async function pt(t){if(console.log(it,`MESSAGE_DELETED: 消息 #${t}`),ct())try{const n=window.SillyTavern.getContext().chat;if(!n||0===n.length)return void console.log(it,'聊天已清空，无需重新处理');console.log(it,`从消息 #${t} 开始重新处理`),await st(t);try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}catch(R){console.error(it,'MESSAGE_DELETED 处理失败:',R)}else{console.log(it,'变量系统未启用，跳过处理');try{const{loadFloorList:t}=await O(async()=>{const{loadFloorList:t}=await Promise.resolve().then(()=>Dt);return{loadFloorList:t}},void 0);await t()}catch(e){console.warn(it,'刷新楼层快照列表失败:',e)}}}async function dt(t){console.log(it,`CHAT_DELETED: ${t}`);try{if(!t)return void console.warn(it,'聊天文件名为空，无法删除快照');const e=await async function(){if(window.token||globalThis.token)return window.token||globalThis.token;if(at)return at;try{const t=await fetch('/csrf-token');if(t.ok){const e=await t.json();return at=e.token,at}}catch(R){console.error(it,'获取 CSRF token 失败:',R)}return null}();if(!e)return void console.warn(it,'无法获取 CSRF Token，跳过插件删除');const n=`/api/plugins/var-manager/var-manager/snapshots/by-chat/${encodeURIComponent(t)}`,r=await fetch(n,{method:'DELETE',headers:{'X-CSRF-Token':e}});if(404===r.status)return void console.log(it,'插件不可用或快照不存在，跳过数据库清理');if(!r.ok)return void console.error(it,`删除聊天快照失败 (${r.status}): ${t}`);const o=await r.json();console.log(it,`已删除聊天 "${t}" 的 ${o.deletedCount??0} 条快照`)}catch(R){console.error(it,'CHAT_DELETED 处理失败:',R)}}class ht{$searchInput;$clearBtn;$typeFilter;$statusFilter;$resultsInfo=null;currentFilters={searchTerm:'',type:'',status:''};onFilterChange;constructor(t){this.$searchInput=$('#var-system-function-search'),this.$clearBtn=$('#var-system-clear-search'),this.$typeFilter=$('#var-system-type-filter'),this.$statusFilter=$('#var-system-status-filter'),this.onFilterChange=t,this.bindEvents()}bindEvents(){this.$searchInput.on('input',()=>{const t=this.$searchInput.val();this.currentFilters.searchTerm=t.trim().toLowerCase(),this.updateClearButton(),this.applyFilters()}),this.$clearBtn.on('click',()=>{this.$searchInput.val(''),this.currentFilters.searchTerm='',this.updateClearButton(),this.applyFilters(),this.$searchInput.focus()}),this.$typeFilter.on('change',()=>{this.currentFilters.type=this.$typeFilter.val(),this.applyFilters()}),this.$statusFilter.on('change',()=>{this.currentFilters.status=this.$statusFilter.val(),this.applyFilters()})}updateClearButton(){this.currentFilters.searchTerm?this.$clearBtn.fadeIn(150):this.$clearBtn.fadeOut(150)}applyFilters(){this.onFilterChange(this.currentFilters)}getFilters(){return{...this.currentFilters}}showResultsInfo(t,e){if(!(this.currentFilters.searchTerm||this.currentFilters.type||this.currentFilters.status)||e===t)return void this.hideResultsInfo();this.$resultsInfo||(this.$resultsInfo=$('<div class="var-system-search-results-info"></div>'),this.$resultsInfo.insertBefore('#var-system-function-list'));let n=`显示 <strong>${e}</strong> / ${t} 个函数`;if(this.currentFilters.searchTerm&&(n+=`，搜索: "${this.currentFilters.searchTerm}"`),this.currentFilters.type){n+=`，类型: ${'active'===this.currentFilters.type?'主动函数':'被动函数'}`}if(this.currentFilters.status){n+=`，状态: ${{enabled:'已启用',disabled:'已禁用',builtin:'内置'}[this.currentFilters.status]}`}this.$resultsInfo.html(n),this.$resultsInfo.show()}hideResultsInfo(){this.$resultsInfo&&this.$resultsInfo.hide()}reset(){this.$searchInput.val(''),this.$typeFilter.val(''),this.$statusFilter.val(''),this.currentFilters={searchTerm:'',type:'',status:''},this.updateClearButton(),this.hideResultsInfo()}}const vt='[ST-VarSystemExtension/FunctionLibrary]',gt='st_var_system';let yt='global',_t=null;async function mt(){console.log(vt,'初始化函数库界面'),await async function(){try{const n=t[gt]?.functions||[];U.loadGlobalFunctions(n);const r=e();if(void 0!==r.characterId){const t=r.characters[r.characterId],e=t?.data?.extensions?.[gt]?.functions||[];U.loadLocalFunctions(e)}}catch(R){console.error(vt,'加载函数失败:',R)}}();const{initBuiltinFunctions:n}=await O(async()=>{const{initBuiltinFunctions:t}=await import('./builtins.CaK7DaWc.chunk.js');return{initBuiltinFunctions:t}},[]);n(U),console.log(vt,'内置函数已注册'),$('input[name="function-scope"]').on('change',async t=>{yt=t.target.value,await wt()}),$('#var-system-new-function-btn').on('click',async()=>{await xt()}),$('#var-system-import-functions-btn').on('click',async()=>{await async function(){const t=$('<input type="file" accept=".json">');t.on('change',async t=>{const e=t.target.files[0];if(e)try{const t=await e.text(),n=JSON.parse(t);if(!n.version||!Array.isArray(n.functions))return void toastr.error('无效的函数库文件格式');let r=0;for(const e of n.functions){const t={...e,id:$t(),enabled:!1};'global'===yt?U.upsertGlobalFunction(t):U.upsertLocalFunction(t),r++}await St(),await wt(),toastr.success(`成功导入 ${r} 个函数到${'global'===yt?'全局函数库':'当前角色的局域函数'}`)}catch(R){console.error(vt,'导入函数失败:',R),toastr.error(`导入失败：${R.message}`)}}),t.trigger('click')}()}),$('#var-system-export-functions-btn').on('click',async()=>{await async function(){const t=('global'===yt?U.exportGlobalFunctions():U.exportLocalFunctions()).filter(t=>t.enabled&&!t.builtin);if(0===t.length)return void toastr.warning(`当前${'global'===yt?'全局':'局域'}作用域没有已启用的非内置函数可导出`);const e=t.map(t=>{const{_compiledRegex:e,...n}=t;return n}),n={version:'1.0',scope:yt,functions:e},r=JSON.stringify(n,null,2),o=new Blob([r],{type:'application/json'}),s=URL.createObjectURL(o),i=$('<a>');i.attr('href',s),i.attr('download',`var-system-functions-${yt}-${Date.now()}.json`),i[0].click(),URL.revokeObjectURL(s),toastr.success(`已导出 ${t.length} 个${'global'===yt?'全局':'局域'}函数`)}()}),$('#var-system-generate-prompt-btn').on('click',async()=>{await async function(){const t=await U.getEnabledFunctions('active');if(!t||0===t.length)return void toastr.warning('没有启用的主动函数');let e='<variable_system_functions>\n你可以使用以下函数来更新游戏状态：\n\n';for(const o of t)if(e+=`${o.name} // ${o.description||'无说明'}\n`,o.pattern){const t=Et(o.pattern,o.name);e+=`示例：${t}\n\n`}e+='</variable_system_functions>';const n=$('#var-system-prompt-generator-template').html(),r=$(n);r.find('#generated-prompt-content').text(e),r.find('#copy-prompt-btn').on('click',()=>{navigator.clipboard.writeText(e),toastr.success('已复制到剪贴板')}),await l(r,u.DISPLAY,'函数调用提示词',{wide:!0})}()}),_t=new ht(t=>{!function(t){const e=$('.var-system-function-card'),n=e.length;if(0===n)return;const{visible:r,hidden:o}=function(t,e){let n=0,r=0;return t.each((_,t)=>{const o=$(t),s=o.find('.var-system-function-name').text().toLowerCase(),i=o.find('.var-system-function-description').text().toLowerCase(),a=o.data('function-type'),c=o.find('.function-enabled-checkbox').is(':checked'),l=!0===o.data('builtin'),u=!e.searchTerm||s.includes(e.searchTerm)||i.includes(e.searchTerm),f=!e.type||a===e.type;let p=!0;e.status&&('enabled'===e.status?p=c:'disabled'===e.status?p=!c:'builtin'===e.status&&(p=l)),u&&f&&p?(o.is(':hidden')&&o.css({opacity:0,display:'block'}).animate({opacity:1},300),n++):(o.is(':visible')&&o.animate({opacity:0},200,function(){$(this).hide()}),r++)}),{visible:n,hidden:r}}(e,t);$('.var-system-no-results').remove(),0===r&&o>0&&function(){const t=$('<div class="var-system-no-results"></div>');t.html('\n    <i class="fa-solid fa-search"></i>\n    <p>没有找到匹配的函数</p>\n    <p class="var-system-hint">尝试调整搜索条件或过滤器</p>\n  '),$('#var-system-function-list').append(t)}(),_t&&_t.showResultsInfo(n,r)}(t)}),await wt()}async function wt(){const t=$('#var-system-function-list');t.empty();const e='global'===yt?U.exportGlobalFunctions():U.exportLocalFunctions();if(!e||0===e.length){const e='global'===yt?'全局':'局域';return void t.html(`\n      <div class="var-system-empty-state">\n        <i class="fa-solid fa-inbox fa-3x"></i>\n        <p>暂无${e}函数</p>\n        <p class="var-system-hint">点击下方按钮创建你的第一个${e}函数</p>\n        <button class="menu_button" onclick="$('#var-system-new-function-btn').click()">\n          <i class="fa-solid fa-plus"></i>\n          <span>立即创建</span>\n        </button>\n      </div>\n    `)}for(const n of e){const e=bt(n);t.append(e)}!function(){const t=$('#var-system-function-list');t.sortable('instance')&&t.sortable('destroy');t.sortable({items:'.var-system-function-card',handle:'.drag-handle',cursor:'move',tolerance:'pointer',placeholder:'var-system-sortable-placeholder',stop:async()=>{await async function(){const t=$('#var-system-function-list .var-system-function-card'),e=[];t.each(function(t){const n=$(this).attr('data-function-id');e.push({id:n,order:t})});const n='global'===yt?U.exportGlobalFunctions():U.exportLocalFunctions(),r=[];for(const o of e){const t=n.find(t=>t.id===o.id);t&&(t.order=o.order,r.push(t))}'global'===yt?U.loadGlobalFunctions(r):U.loadLocalFunctions(r);await St(),console.log(vt,'函数顺序已更新')}()}})}()}function bt(t){const e=$('#var-system-function-card-template').html(),n=$(e);n.attr('data-function-id',t.id),n.attr('data-function-type',t.type),n.attr('data-builtin',t.builtin||!1),n.find('.function-enabled-checkbox').prop('checked',t.enabled),n.find('.function-enabled-checkbox').on('change',async e=>{t.enabled=e.target.checked,await St()}),n.find('.var-system-function-name').text(t.name);const r=n.find('.var-system-badge');if('active'===t.type?r.removeClass('var-system-badge-passive').addClass('var-system-badge-active').text('主动'):r.removeClass('var-system-badge-active').addClass('var-system-badge-passive').text('被动'),n.find('.var-system-function-description').text(t.description||'无说明'),'passive'===t.type){const e='before_active'===t.timing?'主动函数前执行':'主动函数后执行';n.find('.var-system-function-order').text(e)}else n.find('.var-system-function-order').remove();return n.find('.function-edit-btn').on('click',async()=>{await xt(t)}),t.builtin?n.find('.function-delete-btn').hide():n.find('.function-delete-btn').on('click',async()=>{await async function(t){const e=await l(`确定要删除函数"${t.name}"吗？`,u.CONFIRM,'',{okButton:'删除',cancelButton:'取消'});if(e!==Tt.AFFIRMATIVE)return;U.deleteFunction(t.id,yt),await St(),await wt(),toastr.success(`函数"${t.name}"已删除`)}(t)}),n}async function xt(t=null){const e=$('#var-system-function-editor-template').html(),n=$(e);t&&(n.find('#function-name-input').val(t.name),n.find('#function-type-select').val(t.type),n.find('#function-enabled-checkbox').prop('checked',t.enabled),n.find('#function-description-textarea').val(t.description||''),n.find('#function-pattern-input').val(t.pattern||''),n.find('#function-timing-select').val(t.timing||'before_active'),n.find('#function-executor-textarea').val(t.executor||''),t.builtin&&(n.find('input:not(#function-enabled-checkbox), select, textarea').prop('readonly',!0).prop('disabled',!0).css('background-color','#f5f5f5'),n.prepend('\n        <div class="var-system-hint" style="background: #fff3cd; padding: 10px; margin-bottom: 15px; border-left: 4px solid #ffc107;">\n          <i class="fa-solid fa-info-circle"></i>\n          <strong>这是内置函数</strong>，只能查看实现和控制启用状态，不能修改其他内容。\n        </div>\n      ')));const r=()=>{'active'===n.find('#function-type-select').val()?(n.find('.var-system-active-only').show(),n.find('.var-system-passive-only').hide()):(n.find('.var-system-active-only').hide(),n.find('.var-system-passive-only').show())};n.find('#function-type-select').on('change',r),r();const o=await l(n,u.CONFIRM,t?.builtin?'查看内置函数':t?'编辑函数':'新增函数',{okButton:t?.builtin?'关闭':'保存',...!t?.builtin&&{cancelButton:'取消'}});if(t?.builtin)return;if(o!==Tt.AFFIRMATIVE)return;const s={id:t?.id||$t(),name:n.find('#function-name-input').val().trim(),type:n.find('#function-type-select').val(),enabled:n.find('#function-enabled-checkbox').prop('checked'),description:n.find('#function-description-textarea').val().trim(),executor:n.find('#function-executor-textarea').val().trim()};if('active'===s.type?s.pattern=n.find('#function-pattern-input').val().trim():s.timing=n.find('#function-timing-select').val(),s.name)if(s.executor)if('active'!==s.type||s.pattern)try{t?Object.assign(t,s):'global'===yt?U.upsertGlobalFunction(s):U.upsertLocalFunction(s),await St(),await wt(),toastr.success(`函数"${s.name}"已${t?'更新':'创建'}`)}catch(R){console.error('[FunctionLibrary] 保存函数失败:',R),toastr.error(`保存函数失败: ${R.message||'未知错误'}`)}else toastr.error('主动函数需要填写正则表达式');else toastr.error('请填写函数实现代码');else toastr.error('请填写函数名称')}async function St(){try{if('global'===yt)t[gt]||(t[gt]={}),t[gt].functions=U.exportGlobalFunctions(),await a();else{const t=e();if(void 0===t.characterId)return void console.warn(vt,'当前无角色，无法保存局域函数');const r=t.characters[t.characterId];if(!r)return void console.warn(vt,'角色数据不存在');r.data.extensions||(r.data.extensions={}),r.data.extensions[gt]||(r.data.extensions[gt]={}),r.data.extensions[gt].functions=U.exportLocalFunctions(),await n(t.characterId,gt,r.data.extensions[gt])}console.log(vt,`${yt} 函数已保存`)}catch(R){console.error(vt,'保存函数失败:',R),toastr.error(`保存失败：${R.message}`)}}function Et(t,e){return`@.${e}("path.to.var", value);`}function $t(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,t=>{const e=16*Math.random()|0;return('x'===t?e:3&e|8).toString(16)})}const Tt={AFFIRMATIVE:1},Ct='[ST-VarSystemExtension/MessageSnapshots]',It='3.10.0',kt=`https://cdn.jsdelivr.net/npm/vanilla-jsoneditor@${It}/themes/jse-theme-dark.css`,Ft=`https://cdn.jsdelivr.net/npm/vanilla-jsoneditor@${It}/standalone.js`;let At=null;const Ot={currentFloor:null,currentSwipeId:null,currentSnapshotId:null,draftBody:null,dirty:!1,hasErrors:!1};async function jt(){console.log(Ct,'初始化楼层快照界面'),$('#var-system-floor-select').on('change',async t=>{const e=parseInt(t.target.value,10);Number.isNaN(e)||await Bt(e)}),$('#var-system-jump-btn').on('click',async()=>{const t=parseInt($('#var-system-jump-input').val(),10);if(Number.isNaN(t))return void toastr.error('请输入有效的层号');const n=await async function(t){const n=e().chat;if(!n||t>=n.length)return!1;const r=n[t];if(r.is_user)return!1;const o=r.swipe_id||0,s=r.swipes_info?.[o]?.st_var_system_snapshot_id;return!!s}(t);n?$('#var-system-floor-select').val(t).trigger('change'):toastr.error(`第 ${t} 层没有绑定快照`)}),$('#var-system-refresh-snapshot-btn').on('click',async()=>{null!==Ot.currentFloor&&(await Bt(Ot.currentFloor),toastr.info('已刷新快照'))}),$('#var-system-save-snapshot-btn').on('click',async()=>{await async function(){if(Ot.hasErrors)toastr.error('快照数据有错误，无法保存');else if(Ot.dirty)try{const t=At.get();if(void 0===t?.json)return void toastr.error('快照数据格式错误，请检查 JSON');const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${Ot.currentSnapshotId}`,{method:'PUT',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({snapshot:t.json})});if(!e.ok)throw new Error(`更新快照失败 (${e.status})`);Ot.dirty=!1,$('#var-system-save-snapshot-btn').prop('disabled',!0),toastr.success('快照已保存')}catch(R){console.error(Ct,'保存快照失败:',R),toastr.error(`保存失败：${R.message}`)}else toastr.info('快照未修改')}()}),$('#var-system-save-as-global-btn').on('click',async()=>{await async function(){const t=At.get();if(void 0===t?.json)return void toastr.error('快照数据格式错误，请检查 JSON');const e=await l('请输入标签（用逗号分隔）：',u.INPUT,'',{rows:1});if(!e)return;const n=e.split(',').map(t=>t.trim()).filter(t=>t);try{const e=await fetch('/api/plugins/var-manager/var-manager/global-snapshots',{method:'POST',headers:{...o(),'Content-Type':'application/json'},body:JSON.stringify({snapshot:t.json,tags:n})});if(!e.ok)throw new Error(`保存失败 (${e.status})`);toastr.success('已保存为全局快照')}catch(R){console.error(Ct,'保存全局快照失败:',R),toastr.error(`保存失败：${R.message}`)}}()}),$('#var-system-export-snapshot-btn').on('click',async()=>{await async function(){const t=At.get(),e=JSON.stringify(t,null,2),n=new Blob([e],{type:'application/json'}),r=URL.createObjectURL(n),o=$('<a>');o.attr('href',r),o.attr('download',`snapshot-floor-${Ot.currentFloor}-${Date.now()}.json`),o[0].click(),URL.revokeObjectURL(r),toastr.success('快照已导出')}()}),$('#var-system-import-snapshot-btn').on('click',async()=>{await async function(){const t=$('<input>');return t.attr('type','file'),t.attr('accept','.json'),new Promise(e=>{t.on('change',async t=>{const n=t.target.files?.[0];if(n)try{const t=await n.text(),r=JSON.parse(t);At.set(r),Ot.draftBody=r,Ot.dirty=!0,$('#var-system-save-snapshot-btn').prop('disabled',!1),toastr.success('快照已导入（未保存）'),e()}catch(R){console.error(Ct,'导入快照失败:',R),toastr.error(`导入失败：${R.message}`),e()}else e()}),t.click()})}()}),$('#var-system-strip-schema-btn').on('click',async()=>{await async function(){if(At)try{const t=Rt(At.get());At.set(t),Ot.draftBody=t,Ot.dirty=!0,$('#var-system-save-snapshot-btn').prop('disabled',!1),toastr.success('已移除 MVU Schema 字段')}catch(R){console.error(Ct,'分离 Schema 失败:',R),toastr.error(`分离 Schema 失败：${R.message}`)}else toastr.error('编辑器尚未初始化')}()}),await Lt()}async function Lt(){const t=e().chat;if(!t||0===t.length)return void $('#var-system-floor-select').html('<option value="">当前无聊天记录</option>');const n=$('#var-system-floor-select');n.empty();let r=!1,o=-1;for(let e=0;e<t.length;e++){const s=t[e];if(s.is_user)continue;const i=s.swipe_id||0,a=s.swipes_info?.[i]?.st_var_system_snapshot_id;if(a){r=!0,o=e;const t=$('<option>');t.val(e),t.text(`第 ${e} 层 - AI 消息 (Swipe ${i})`),n.append(t)}}r?o>=0&&(n.val(o),await Bt(o)):n.html('<option value="">暂无快照楼层</option>')}async function Bt(t){const n=e().chat;if(!n||t>=n.length)return void toastr.error('无效的楼层号');const r=n[t],s=r.swipe_id||0,i=r.swipes_info?.[s]?.st_var_system_snapshot_id;if(!i)return void toastr.error(`第 ${t} 层没有绑定快照`);const a=await async function(t){try{const e=await fetch(`/api/plugins/var-manager/var-manager/snapshots/${t}`,{method:'GET',headers:{...o(),'Content-Type':'application/json'}});if(!e.ok)return 404===e.status?console.warn(Ct,`快照不存在: ${t}`):console.error(Ct,`读取快照失败 (${e.status}): ${t}`),null;return(await e.json()).payload}catch(R){return console.error(Ct,'从插件读取快照时发生错误:',R),null}}(i);if(!a)return void toastr.error('加载快照失败');Ot.currentFloor=t,Ot.currentSwipeId=s,Ot.currentSnapshotId=i,Ot.draftBody=a,Ot.dirty=!1,Ot.hasErrors=!1,$('#var-system-current-floor-info').show(),$('#current-floor-number').text(t),$('#current-swipe-id').text(s),$('#current-snapshot-id').text(i);const c=r.send_date?new Date(r.send_date).toLocaleString('zh-CN'):'未知';$('#current-message-time').text(c),await async function(t){const e=document.getElementById('var-system-snapshot-editor-container');$(e).find('.var-system-empty-state').remove(),At&&(At.destroy(),At=null);At=F({container:e,styleUrl:kt,scriptUrl:Ft,onChange:(t,e,n)=>{console.log('[MessageSnapshots] Editor change:',{hasContent:!!t,hasJson:void 0!==t?.json,jsonType:typeof t?.json,hasContentErrors:!!n?.contentErrors?.length,contentErrors:n?.contentErrors});const r=void 0===t?.json;Ot.hasErrors=r,Ot.dirty=!0,r||(Ot.draftBody=t.json),$('#var-system-save-snapshot-btn').prop('disabled',r)},onFallback:()=>{console.warn(Ct,'JSON 编辑器资源加载失败，已降级为纯文本模式')}}),await At.ensureReady(),At.set({json:t})}(a),$('#var-system-snapshot-actions').show(),$('#var-system-save-snapshot-btn').prop('disabled',!0)}function Rt(t){if(Array.isArray(t))return t.filter(t=>'$__META_EXTENSIBLE__$'!==t).map(t=>Rt(t));if(_.isObject(t)&&!_.isDate(t)){const e={};for(const n in t)n.startsWith('$')||(e[n]=Rt(t[n]));return e}return t}const Dt=Object.freeze(Object.defineProperty({__proto__:null,initMessageSnapshots:jt,loadFloorList:Lt},Symbol.toStringTag,{value:'Module'})),Nt='[ST-VarSystemExtension/settings]';async function Mt(){console.log(Nt,'开始清理未使用的快照');if(await callGenericPopup('此操作会删除数据库中不对应任何现存聊天记录的快照。\n\n已删除的快照无法恢复，确定要继续吗？',POPUP_TYPE.CONFIRM,'',{okButton:'确定',cancelButton:'取消'})===POPUP_RESULT.AFFIRMATIVE)try{$('#var-system-cleanup-snapshots-btn').prop('disabled',!0),$('#var-system-cleanup-progress').show(),$('#var-system-cleanup-result').hide(),Pt(0,'正在扫描聊天记录文件...');const t=await async function(){try{const t=await fetch('/api/characters/chats',{method:'POST',headers:{'Content-Type':'application/json'}});if(!t.ok)throw new Error(`获取聊天记录失败: ${t.statusText}`);const e=await t.json();console.log(Nt,'聊天记录数据:',e);const n=[];for(const r in e){const t=e[r];if(Array.isArray(t))for(const e of t){const t=e.replace(/\.jsonl$/,'');n.push(t)}}return n}catch(R){throw console.error(Nt,'获取聊天记录文件失败:',R),new Error('无法获取聊天记录列表')}}();console.log(Nt,`找到 ${t.length} 个聊天记录文件`),Pt(50,`找到 ${t.length} 个聊天记录文件，正在清理...`);const e=await async function(t){try{const e=await fetch('/api/plugins/var-manager/var-manager/snapshots/cleanup',{method:'POST',headers:{'Content-Type':'application/json','X-CSRF-Token':await Vt()},body:JSON.stringify({activeChatFiles:t})});if(404===e.status)throw new Error('插件未安装或未启用');if(!e.ok){const t=await e.text();throw new Error(`插件 API 错误: ${e.status} - ${t}`)}return await e.json()}catch(R){throw console.error(Nt,'清理孤立快照失败:',R),R}}(t);Pt(100,'清理完成'),setTimeout(()=>{$('#var-system-cleanup-progress').hide(),function(t){const{deletedCount:e,totalScanned:n,deletedChatFiles:r}=t;if($('#var-system-cleanup-result').show(),0===e)$('#var-system-cleanup-result-summary').html('<strong>未发现需要清理的快照</strong>'),$('#var-system-cleanup-result-details').text(`扫描了 ${n} 个快照，全部关联到现存的聊天记录。`);else{$('#var-system-cleanup-result-summary').html(`<strong>成功清理 ${e} 个孤立快照</strong>`);const t=`扫描了 ${n} 个快照，清理了 ${r.length} 个已删除聊天记录的快照。\n`+(r.length>0?`\n已清理的聊天文件：\n${r.slice(0,5).join('\n')}`+(r.length>5?`\n... 及其他 ${r.length-5} 个文件`:''):'');$('#var-system-cleanup-result-details').text(t)}toastr.success(`清理完成，删除了 ${e} 个孤立快照`,'变量系统')}(e)},500),console.log(Nt,'清理完成',e)}catch(R){console.error(Nt,'清理失败:',R),$('#var-system-cleanup-progress').hide(),toastr.error(`清理失败：${R.message}`,'变量系统')}finally{$('#var-system-cleanup-snapshots-btn').prop('disabled',!1)}}function Pt(t,e){$('#var-system-cleanup-progress-fill').css('width',`${t}%`),$('#var-system-cleanup-progress-text').text(e)}async function Vt(){if(window.token)return window.token;try{const t=await fetch('/csrf-token'),e=await t.json();return window.token=e.token,e.token}catch(R){return console.warn(Nt,'获取 CSRF Token 失败，使用空字符串',R),''}}
/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ut(t){const e=Object.create(null);for(const n of t.split(','))e[n]=1;return t=>t in e}const zt={},Wt=[],Ht=()=>{},Jt=()=>!1,Gt=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),qt=t=>t.startsWith('onUpdate:'),Xt=Object.assign,Kt=Object.prototype.hasOwnProperty,Zt=(t,e)=>Kt.call(t,e),Yt=Array.isArray,Qt=t=>'[object Map]'===ie(t),te=t=>'function'==typeof t,ee=t=>'string'==typeof t,ne=t=>'symbol'==typeof t,re=t=>null!==t&&'object'==typeof t,oe=t=>(re(t)||te(t))&&te(t.then)&&te(t.catch),se=Object.prototype.toString,ie=t=>se.call(t),ae=t=>ee(t)&&'NaN'!==t&&'-'!==t[0]&&''+parseInt(t,10)===t,ce=Ut(',key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted'),le=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},ue=/-\w/g,fe=le(t=>t.replace(ue,t=>t.slice(1).toUpperCase())),pe=/\B([A-Z])/g,de=le(t=>t.replace(pe,'-$1').toLowerCase()),he=le(t=>t.charAt(0).toUpperCase()+t.slice(1)),ve=le(t=>t?`on${he(t)}`:''),ge=(t,e)=>!Object.is(t,e),ye=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},_e=(t,e,n,r=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:r,value:n})},me=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let we;const be=()=>we||(we='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:'undefined'!=typeof window?window:'undefined'!=typeof global?global:{});function xe(t){if(Yt(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],o=ee(r)?Te(r):xe(r);if(o)for(const t in o)e[t]=o[t]}return e}if(ee(t)||re(t))return t}const Se=/;(?![^(]*\))/g,Ee=/:([^]+)/,$e=/\/\*[^]*?\*\//g;function Te(t){const e={};return t.replace($e,'').split(Se).forEach(t=>{if(t){const n=t.split(Ee);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Ce(t){let e='';if(ee(t))e=t;else if(Yt(t))for(let n=0;n<t.length;n++){const r=Ce(t[n]);r&&(e+=r+' ')}else if(re(t))for(const n in t)t[n]&&(e+=n+' ');return e.trim()}const Ie=Ut('itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly');function ke(t){return!!t||''===t}
/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Fe,Ae;class Oe{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Fe,!t&&Fe&&(this.index=(Fe.scopes||(Fe.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let t,e;if(this._isPaused=!0,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){let t,e;if(this._isPaused=!1,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Fe;try{return Fe=this,t()}finally{Fe=e}}}on(){1===++this._on&&(this.prevScope=Fe,Fe=this)}off(){this._on>0&&0===--this._on&&(Fe=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){let e,n;for(this._active=!1,e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(this.effects.length=0,e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0}}}const je=new WeakSet;class Le{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Fe&&Fe.active&&Fe.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,je.has(this)&&(je.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||Ne(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,Ze(this),Ve(this);const t=Ae,e=Ge;Ae=this,Ge=!0;try{return this.fn()}finally{Ue(this),Ae=t,Ge=e,this.flags&=-3}}stop(){if(1&this.flags){for(let t=this.deps;t;t=t.nextDep)He(t);this.deps=this.depsTail=void 0,Ze(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?je.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ze(this)&&this.run()}get dirty(){return ze(this)}}let Be,Re,De=0;function Ne(t,e=!1){if(t.flags|=8,e)return t.next=Re,void(Re=t);t.next=Be,Be=t}function Me(){De++}function Pe(){if(--De>0)return;if(Re){let t=Re;for(Re=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let t;for(;Be;){let n=Be;for(Be=void 0;n;){const r=n.next;if(n.next=void 0,n.flags&=-9,1&n.flags)try{n.trigger()}catch(e){t||(t=e)}n=r}}if(t)throw t}function Ve(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Ue(t){let e,n=t.depsTail,r=n;for(;r;){const t=r.prevDep;-1===r.version?(r===n&&(n=t),He(r),Je(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=t}t.deps=e,t.depsTail=n}function ze(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(We(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function We(t){if(4&t.flags&&!(16&t.flags))return;if(t.flags&=-17,t.globalVersion===Ye)return;if(t.globalVersion=Ye,!t.isSSR&&128&t.flags&&(!t.deps&&!t._dirty||!ze(t)))return;t.flags|=2;const e=t.dep,n=Ae,r=Ge;Ae=t,Ge=!0;try{Ve(t);const n=t.fn(t._value);(0===e.version||ge(n,t._value))&&(t.flags|=128,t._value=n,e.version++)}catch(o){throw e.version++,o}finally{Ae=n,Ge=r,Ue(t),t.flags&=-3}}function He(t,e=!1){const{dep:n,prevSub:r,nextSub:o}=t;if(r&&(r.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=r,t.nextSub=void 0),n.subs===t&&(n.subs=r,!r&&n.computed)){n.computed.flags&=-5;for(let t=n.computed.deps;t;t=t.nextDep)He(t,!0)}e||--n.sc||!n.map||n.map.delete(n.key)}function Je(t){const{prevDep:e,nextDep:n}=t;e&&(e.nextDep=n,t.prevDep=void 0),n&&(n.prevDep=e,t.nextDep=void 0)}let Ge=!0;const qe=[];function Xe(){qe.push(Ge),Ge=!1}function Ke(){const t=qe.pop();Ge=void 0===t||t}function Ze(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const t=Ae;Ae=void 0;try{e()}finally{Ae=t}}}let Ye=0;class Qe{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class tn{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ae||!Ge||Ae===this.computed)return;let e=this.activeLink;if(void 0===e||e.sub!==Ae)e=this.activeLink=new Qe(Ae,this),Ae.deps?(e.prevDep=Ae.depsTail,Ae.depsTail.nextDep=e,Ae.depsTail=e):Ae.deps=Ae.depsTail=e,en(e);else if(-1===e.version&&(e.version=this.version,e.nextDep)){const t=e.nextDep;t.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=t),e.prevDep=Ae.depsTail,e.nextDep=void 0,Ae.depsTail.nextDep=e,Ae.depsTail=e,Ae.deps===e&&(Ae.deps=t)}return e}trigger(t){this.version++,Ye++,this.notify(t)}notify(t){Me();try{0;for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Pe()}}}function en(t){if(t.dep.sc++,4&t.sub.flags){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let t=e.deps;t;t=t.nextDep)en(t)}const n=t.dep.subs;n!==t&&(t.prevSub=n,n&&(n.nextSub=t)),t.dep.subs=t}}const nn=new WeakMap,rn=Symbol(''),on=Symbol(''),sn=Symbol('');function an(t,e,n){if(Ge&&Ae){let e=nn.get(t);e||nn.set(t,e=new Map);let r=e.get(n);r||(e.set(n,r=new tn),r.map=e,r.key=n),r.track()}}function cn(t,e,n,r,o,s){const i=nn.get(t);if(!i)return void Ye++;const a=t=>{t&&t.trigger()};if(Me(),'clear'===e)i.forEach(a);else{const o=Yt(t),s=o&&ae(n);if(o&&'length'===n){const t=Number(r);i.forEach((e,n)=>{('length'===n||n===sn||!ne(n)&&n>=t)&&a(e)})}else switch((void 0!==n||i.has(void 0))&&a(i.get(n)),s&&a(i.get(sn)),e){case'add':o?s&&a(i.get('length')):(a(i.get(rn)),Qt(t)&&a(i.get(on)));break;case'delete':o||(a(i.get(rn)),Qt(t)&&a(i.get(on)));break;case'set':Qt(t)&&a(i.get(rn))}}Pe()}function ln(t){const e=Gn(t);return e===t?e:(an(e,0,sn),Hn(t)?e:e.map(qn))}function un(t){return an(t=Gn(t),0,sn),t}const fn={__proto__:null,[Symbol.iterator](){return pn(this,Symbol.iterator,qn)},concat(...t){return ln(this).concat(...t.map(t=>Yt(t)?ln(t):t))},entries(){return pn(this,'entries',t=>(t[1]=qn(t[1]),t))},every(t,e){return hn(this,'every',t,e,void 0,arguments)},filter(t,e){return hn(this,'filter',t,e,t=>t.map(qn),arguments)},find(t,e){return hn(this,'find',t,e,qn,arguments)},findIndex(t,e){return hn(this,'findIndex',t,e,void 0,arguments)},findLast(t,e){return hn(this,'findLast',t,e,qn,arguments)},findLastIndex(t,e){return hn(this,'findLastIndex',t,e,void 0,arguments)},forEach(t,e){return hn(this,'forEach',t,e,void 0,arguments)},includes(...t){return gn(this,'includes',t)},indexOf(...t){return gn(this,'indexOf',t)},join(t){return ln(this).join(t)},lastIndexOf(...t){return gn(this,'lastIndexOf',t)},map(t,e){return hn(this,'map',t,e,void 0,arguments)},pop(){return yn(this,'pop')},push(...t){return yn(this,'push',t)},reduce(t,...e){return vn(this,'reduce',t,e)},reduceRight(t,...e){return vn(this,'reduceRight',t,e)},shift(){return yn(this,'shift')},some(t,e){return hn(this,'some',t,e,void 0,arguments)},splice(...t){return yn(this,'splice',t)},toReversed(){return ln(this).toReversed()},toSorted(t){return ln(this).toSorted(t)},toSpliced(...t){return ln(this).toSpliced(...t)},unshift(...t){return yn(this,'unshift',t)},values(){return pn(this,'values',qn)}};function pn(t,e,n){const r=un(t),o=r[e]();return r===t||Hn(t)||(o._next=o.next,o.next=()=>{const t=o._next();return t.done||(t.value=n(t.value)),t}),o}const dn=Array.prototype;function hn(t,e,n,r,o,s){const i=un(t),a=i!==t&&!Hn(t),c=i[e];if(c!==dn[e]){const e=c.apply(t,s);return a?qn(e):e}let l=n;i!==t&&(a?l=function(e,r){return n.call(this,qn(e),r,t)}:n.length>2&&(l=function(e,r){return n.call(this,e,r,t)}));const u=c.call(i,l,r);return a&&o?o(u):u}function vn(t,e,n,r){const o=un(t);let s=n;return o!==t&&(Hn(t)?n.length>3&&(s=function(e,r,o){return n.call(this,e,r,o,t)}):s=function(e,r,o){return n.call(this,e,qn(r),o,t)}),o[e](s,...r)}function gn(t,e,n){const r=Gn(t);an(r,0,sn);const o=r[e](...n);return-1!==o&&!1!==o||!Jn(n[0])?o:(n[0]=Gn(n[0]),r[e](...n))}function yn(t,e,n=[]){Xe(),Me();const r=Gn(t)[e].apply(t,n);return Pe(),Ke(),r}const _n=Ut('__proto__,__v_isRef,__isVue'),mn=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>'arguments'!==t&&'caller'!==t).map(t=>Symbol[t]).filter(ne));function wn(t){ne(t)||(t=String(t));const e=Gn(this);return an(e,0,t),e.hasOwnProperty(t)}class bn{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){if('__v_skip'===e)return t.__v_skip;const r=this._isReadonly,o=this._isShallow;if('__v_isReactive'===e)return!r;if('__v_isReadonly'===e)return r;if('__v_isShallow'===e)return o;if('__v_raw'===e)return n===(r?o?Nn:Dn:o?Rn:Bn).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const s=Yt(t);if(!r){let t;if(s&&(t=fn[e]))return t;if('hasOwnProperty'===e)return wn}const i=Reflect.get(t,e,Kn(t)?t:n);if(ne(e)?mn.has(e):_n(e))return i;if(r||an(t,0,e),o)return i;if(Kn(i)){const t=s&&ae(e)?i:i.value;return r&&re(t)?Vn(t):t}return re(i)?r?Vn(i):Pn(i):i}}class xn extends bn{constructor(t=!1){super(!1,t)}set(t,e,n,r){let o=t[e];if(!this._isShallow){const e=Wn(o);if(Hn(n)||Wn(n)||(o=Gn(o),n=Gn(n)),!Yt(t)&&Kn(o)&&!Kn(n))return e||(o.value=n),!0}const s=Yt(t)&&ae(e)?Number(e)<t.length:Zt(t,e),i=Reflect.set(t,e,n,Kn(t)?t:r);return t===Gn(r)&&(s?ge(n,o)&&cn(t,'set',e,n):cn(t,'add',e,n)),i}deleteProperty(t,e){const n=Zt(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&cn(t,'delete',e,void 0),r}has(t,e){const n=Reflect.has(t,e);return ne(e)&&mn.has(e)||an(t,0,e),n}ownKeys(t){return an(t,0,Yt(t)?'length':rn),Reflect.ownKeys(t)}}class Sn extends bn{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const En=new xn,$n=new Sn,Tn=new xn(!0),Cn=t=>t,In=t=>Reflect.getPrototypeOf(t);function kn(t){return function(...e){return'delete'!==t&&('clear'===t?void 0:this)}}function Fn(t,e){const n={get(n){const r=this.__v_raw,o=Gn(r),s=Gn(n);t||(ge(n,s)&&an(o,0,n),an(o,0,s));const{has:i}=In(o),a=e?Cn:t?Xn:qn;return i.call(o,n)?a(r.get(n)):i.call(o,s)?a(r.get(s)):void(r!==o&&r.get(n))},get size(){const e=this.__v_raw;return!t&&an(Gn(e),0,rn),e.size},has(e){const n=this.__v_raw,r=Gn(n),o=Gn(e);return t||(ge(e,o)&&an(r,0,e),an(r,0,o)),e===o?n.has(e):n.has(e)||n.has(o)},forEach(n,r){const o=this,s=o.__v_raw,i=Gn(s),a=e?Cn:t?Xn:qn;return!t&&an(i,0,rn),s.forEach((t,e)=>n.call(r,a(t),a(e),o))}};Xt(n,t?{add:kn('add'),set:kn('set'),delete:kn('delete'),clear:kn('clear')}:{add(t){e||Hn(t)||Wn(t)||(t=Gn(t));const n=Gn(this);return In(n).has.call(n,t)||(n.add(t),cn(n,'add',t,t)),this},set(t,n){e||Hn(n)||Wn(n)||(n=Gn(n));const r=Gn(this),{has:o,get:s}=In(r);let i=o.call(r,t);i||(t=Gn(t),i=o.call(r,t));const a=s.call(r,t);return r.set(t,n),i?ge(n,a)&&cn(r,'set',t,n):cn(r,'add',t,n),this},delete(t){const e=Gn(this),{has:n,get:r}=In(e);let o=n.call(e,t);o||(t=Gn(t),o=n.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return o&&cn(e,'delete',t,void 0),s},clear(){const t=Gn(this),e=0!==t.size,n=t.clear();return e&&cn(t,'clear',void 0,void 0),n}});return['keys','values','entries',Symbol.iterator].forEach(r=>{n[r]=function(t,e,n){return function(...r){const o=this.__v_raw,s=Gn(o),i=Qt(s),a='entries'===t||t===Symbol.iterator&&i,c='keys'===t&&i,l=o[t](...r),u=n?Cn:e?Xn:qn;return!e&&an(s,0,c?on:rn),{next(){const{value:t,done:e}=l.next();return e?{value:t,done:e}:{value:a?[u(t[0]),u(t[1])]:u(t),done:e}},[Symbol.iterator](){return this}}}}(r,t,e)}),n}function An(t,e){const n=Fn(t,e);return(e,r,o)=>'__v_isReactive'===r?!t:'__v_isReadonly'===r?t:'__v_raw'===r?e:Reflect.get(Zt(n,r)&&r in e?n:e,r,o)}const On={get:An(!1,!1)},jn={get:An(!1,!0)},Ln={get:An(!0,!1)},Bn=new WeakMap,Rn=new WeakMap,Dn=new WeakMap,Nn=new WeakMap;function Mn(t){return t.__v_skip||!Object.isExtensible(t)?0:function(t){switch(t){case'Object':case'Array':return 1;case'Map':case'Set':case'WeakMap':case'WeakSet':return 2;default:return 0}}((t=>ie(t).slice(8,-1))(t))}function Pn(t){return Wn(t)?t:Un(t,!1,En,On,Bn)}function Vn(t){return Un(t,!0,$n,Ln,Dn)}function Un(t,e,n,r,o){if(!re(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=Mn(t);if(0===s)return t;const i=o.get(t);if(i)return i;const a=new Proxy(t,2===s?r:n);return o.set(t,a),a}function zn(t){return Wn(t)?zn(t.__v_raw):!(!t||!t.__v_isReactive)}function Wn(t){return!(!t||!t.__v_isReadonly)}function Hn(t){return!(!t||!t.__v_isShallow)}function Jn(t){return!!t&&!!t.__v_raw}function Gn(t){const e=t&&t.__v_raw;return e?Gn(e):t}const qn=t=>re(t)?Pn(t):t,Xn=t=>re(t)?Vn(t):t;function Kn(t){return!!t&&!0===t.__v_isRef}function Zn(t){return function(t,e){if(Kn(t))return t;return new Yn(t,e)}(t,!1)}class Yn{constructor(t,e){this.dep=new tn,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:Gn(t),this._value=e?t:qn(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,n=this.__v_isShallow||Hn(t)||Wn(t);t=n?t:Gn(t),ge(t,e)&&(this._rawValue=t,this._value=n?t:qn(t),this.dep.trigger())}}const Qn={get:(t,e,n)=>{return'__v_raw'===e?t:Kn(r=Reflect.get(t,e,n))?r.value:r;var r},set:(t,e,n,r)=>{const o=t[e];return Kn(o)&&!Kn(n)?(o.value=n,!0):Reflect.set(t,e,n,r)}};function tr(t){return zn(t)?t:new Proxy(t,Qn)}class er{constructor(t,e,n){this.fn=t,this.setter=e,this._value=void 0,this.dep=new tn(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ye-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=n}notify(){if(this.flags|=16,!(8&this.flags)&&Ae!==this)return Ne(this,!0),!0}get value(){const t=this.dep.track();return We(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function nr(t,e,n,r){try{return r?t(...r):t()}catch(o){or(o,e,n)}}function rr(t,e,n,r){if(te(t)){const o=nr(t,e,n,r);return o&&oe(o)&&o.catch(t=>{or(t,e,n)}),o}if(Yt(t)){const o=[];for(let s=0;s<t.length;s++)o.push(rr(t[s],e,n,r));return o}}function or(t,e,n,r=!0){e&&e.vnode;const{errorHandler:o,throwUnhandledErrorInProduction:s}=e&&e.appContext.config||zt;if(e){let r=e.parent;const s=e.proxy,i=`https://vuejs.org/error-reference/#runtime-${n}`;for(;r;){const e=r.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,s,i))return;r=r.parent}if(o)return Xe(),nr(o,null,10,[t,s,i]),void Ke()}!function(t,e,n,r=!0,o=!1){if(o)throw t;console.error(t)}(t,0,0,r,s)}const sr=[];let ir=-1;const ar=[];let cr=null,lr=0;const ur=Promise.resolve();let fr=null;function pr(t){const e=fr||ur;return t?e.then(this?t.bind(this):t):e}function dr(t){if(!(1&t.flags)){const e=yr(t),n=sr[sr.length-1];!n||!(2&t.flags)&&e>=yr(n)?sr.push(t):sr.splice(function(t){let e=ir+1,n=sr.length;for(;e<n;){const r=e+n>>>1,o=sr[r],s=yr(o);s<t||s===t&&2&o.flags?e=r+1:n=r}return e}(e),0,t),t.flags|=1,hr()}}function hr(){fr||(fr=ur.then(_r))}function vr(t,e,n=ir+1){for(;n<sr.length;n++){const e=sr[n];if(e&&2&e.flags){if(t&&e.id!==t.uid)continue;sr.splice(n,1),n--,4&e.flags&&(e.flags&=-2),e(),4&e.flags||(e.flags&=-2)}}}function gr(t){if(ar.length){const t=[...new Set(ar)].sort((t,e)=>yr(t)-yr(e));if(ar.length=0,cr)return void cr.push(...t);for(cr=t,lr=0;lr<cr.length;lr++){const t=cr[lr];4&t.flags&&(t.flags&=-2),8&t.flags||t(),t.flags&=-2}cr=null,lr=0}}const yr=t=>null==t.id?2&t.flags?-1:1/0:t.id;function _r(t){try{for(ir=0;ir<sr.length;ir++){const t=sr[ir];!t||8&t.flags||(4&t.flags&&(t.flags&=-2),nr(t,t.i,t.i?15:14),4&t.flags||(t.flags&=-2))}}finally{for(;ir<sr.length;ir++){const t=sr[ir];t&&(t.flags&=-2)}ir=-1,sr.length=0,gr(),fr=null,(sr.length||ar.length)&&_r()}}let mr,wr=[],br=!1;function xr(t,...e){mr?mr.emit(t,...e):br||wr.push({event:t,args:e})}function Sr(t,e){var n,r;if(mr=t,mr)mr.enabled=!0,wr.forEach(({event:t,args:e})=>mr.emit(t,...e)),wr=[];else if('undefined'!=typeof window&&window.HTMLElement&&!(null==(r=null==(n=window.navigator)?void 0:n.userAgent)?void 0:r.includes('jsdom'))){(e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(t=>{Sr(t,e)}),setTimeout(()=>{mr||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,br=!0,wr=[])},3e3)}else br=!0,wr=[]}const Er=Cr('component:added'),$r=Cr('component:updated'),Tr=Cr('component:removed');function Cr(t){return e=>{xr(t,e.appContext.app,e.uid,e.parent?e.parent.uid:void 0,e)}}let Ir=null,kr=null;function Fr(t){const e=Ir;return Ir=t,kr=t&&t.type.__scopeId||null,e}function Ar(t,e,n,r){const o=t.dirs,s=e&&e.dirs;for(let i=0;i<o.length;i++){const a=o[i];s&&(a.oldValue=s[i].value);let c=a.dir[r];c&&(Xe(),rr(c,n,8,[t.el,a,t,e]),Ke())}}const Or=Symbol('_vte'),jr=t=>t&&(t.disabled||''===t.disabled),Lr=t=>t&&(t.defer||''===t.defer),Br=t=>'undefined'!=typeof SVGElement&&t instanceof SVGElement,Rr=t=>'function'==typeof MathMLElement&&t instanceof MathMLElement,Dr=(t,e)=>{const n=t&&t.to;if(ee(n)){if(e){return e(n)}return null}return n},Nr={name:'Teleport',__isTeleport:!0,process(t,e,n,r,o,s,i,a,c,l){const{mc:u,pc:f,pbc:p,o:{insert:d,querySelector:h,createText:v,createComment:g}}=l,y=jr(e.props);let{shapeFlag:m,children:w,dynamicChildren:b}=e;if(null==t){const t=e.el=v(''),l=e.anchor=v('');d(t,n,r),d(l,n,r);const f=(t,e)=>{16&m&&u(w,t,e,o,s,i,a,c)},p=()=>{const t=e.target=Dr(e.props,h),n=Ur(t,e,v,d);t&&('svg'!==i&&Br(t)?i='svg':'mathml'!==i&&Rr(t)&&(i='mathml'),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(t),y||(f(t,n),Vr(e,!1)))};y&&(f(n,l),Vr(e,!0)),Lr(e.props)?(e.el.__isMounted=!1,bo(()=>{p(),delete e.el.__isMounted},s)):p()}else{if(Lr(e.props)&&!1===t.el.__isMounted)return void bo(()=>{Nr.process(t,e,n,r,o,s,i,a,c,l)},s);e.el=t.el,e.targetStart=t.targetStart;const u=e.anchor=t.anchor,d=e.target=t.target,v=e.targetAnchor=t.targetAnchor,g=jr(t.props),m=g?n:d,w=g?u:v;if('svg'===i||Br(d)?i='svg':('mathml'===i||Rr(d))&&(i='mathml'),b?(p(t.dynamicChildren,b,m,o,s,i,a),$o(t,e,!0)):c||f(t,e,m,w,o,s,i,a,!1),y)g?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Mr(e,n,u,l,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const t=e.target=Dr(e.props,h);t&&Mr(e,t,null,l,0)}else g&&Mr(e,d,v,l,1);Vr(e,y)}},remove(t,e,n,{um:r,o:{remove:o}},s){const{shapeFlag:i,children:a,anchor:c,targetStart:l,targetAnchor:u,target:f,props:p}=t;if(f&&(o(l),o(u)),s&&o(c),16&i){const t=s||!jr(p);for(let o=0;o<a.length;o++){const s=a[o];r(s,e,n,t,!!s.dynamicChildren)}}},move:Mr,hydrate:function(t,e,n,r,o,s,{o:{nextSibling:i,parentNode:a,querySelector:c,insert:l,createText:u}},f){function p(t,e,c,l){e.anchor=f(i(t),e,a(t),n,r,o,s),e.targetStart=c,e.targetAnchor=l}const d=e.target=Dr(e.props,c),h=jr(e.props);if(d){const a=d._lpa||d.firstChild;if(16&e.shapeFlag)if(h)p(t,e,a,a&&i(a));else{e.anchor=i(t);let c=a;for(;c;){if(c&&8===c.nodeType)if('teleport start anchor'===c.data)e.targetStart=c;else if('teleport anchor'===c.data){e.targetAnchor=c,d._lpa=e.targetAnchor&&i(e.targetAnchor);break}c=i(c)}e.targetAnchor||Ur(d,e,u,l),f(a&&i(a),e,d,n,r,o,s)}Vr(e,h)}else h&&16&e.shapeFlag&&p(t,e,t,i(t));return e.anchor&&i(e.anchor)}};function Mr(t,e,n,{o:{insert:r},m:o},s=2){0===s&&r(t.targetAnchor,e,n);const{el:i,anchor:a,shapeFlag:c,children:l,props:u}=t,f=2===s;if(f&&r(i,e,n),(!f||jr(u))&&16&c)for(let p=0;p<l.length;p++)o(l[p],e,n,2);f&&r(a,e,n)}const Pr=Nr;function Vr(t,e){const n=t.ctx;if(n&&n.ut){let r,o;for(e?(r=t.el,o=t.anchor):(r=t.targetStart,o=t.targetAnchor);r&&r!==o;)1===r.nodeType&&r.setAttribute('data-v-owner',n.uid),r=r.nextSibling;n.ut()}}function Ur(t,e,n,r){const o=e.targetStart=n(''),s=e.targetAnchor=n('');return o[Or]=s,t&&(r(o,t),r(s,t)),s}const zr=Symbol('_leaveCb');function Wr(t,e){6&t.shapeFlag&&t.component?(t.transition=e,Wr(t.component.subTree,e)):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Hr(t,e){return te(t)?(()=>Xt({name:t.name},e,{setup:t}))():t}const Jr=new WeakMap;function Gr(t,e,n,r,o=!1){if(Yt(t))return void t.forEach((t,s)=>Gr(t,e&&(Yt(e)?e[s]:e),n,r,o));if(Xr(r)&&!o)return void(512&r.shapeFlag&&r.type.__asyncResolved&&r.component.subTree.component&&Gr(t,e,n,r.component.subTree));const s=4&r.shapeFlag?ms(r.component):r.el,i=o?null:s,{i:a,r:c}=t,l=e&&e.r,u=a.refs===zt?a.refs={}:a.refs,f=a.setupState,p=Gn(f),d=f===zt?Jt:t=>Zt(p,t);if(null!=l&&l!==c)if(qr(e),ee(l))u[l]=null,d(l)&&(f[l]=null);else if(Kn(l)){l.value=null;const t=e;t.k&&(u[t.k]=null)}if(te(c))nr(c,a,12,[i,u]);else{const e=ee(c),r=Kn(c);if(e||r){const a=()=>{if(t.f){const n=e?d(c)?f[c]:u[c]:c.value;if(o)Yt(n)&&((t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)})(n,s);else if(Yt(n))n.includes(s)||n.push(s);else if(e)u[c]=[s],d(c)&&(f[c]=u[c]);else{const e=[s];c.value=e,t.k&&(u[t.k]=e)}}else e?(u[c]=i,d(c)&&(f[c]=i)):r&&(c.value=i,t.k&&(u[t.k]=i))};if(i){const e=()=>{a(),Jr.delete(t)};e.id=-1,Jr.set(t,e),bo(e,n)}else qr(t),a()}}}function qr(t){const e=Jr.get(t);e&&(e.flags|=8,Jr.delete(t))}be().requestIdleCallback,be().cancelIdleCallback;const Xr=t=>!!t.type.__asyncLoader;const Kr=(Zr='um',(t,e=fs)=>{vs&&'sp'!==Zr||function(t,e,n=fs,r=!1){if(n){const o=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...r)=>{Xe();const o=ps(n),s=rr(e,n,t,r);return o(),Ke(),s});r?o.unshift(s):o.push(s)}}(Zr,(...e)=>t(...e),e)});var Zr;const Yr=Symbol.for('v-ndc'),Qr=t=>t?hs(t)?ms(t):Qr(t.parent):null,to=Xt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Qr(t.parent),$root:t=>Qr(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>t.type,$forceUpdate:t=>t.f||(t.f=()=>{dr(t.update)}),$nextTick:t=>t.n||(t.n=pr.bind(t.proxy)),$watch:t=>Ht}),eo=(t,e)=>t!==zt&&!t.__isScriptSetup&&Zt(t,e),no={get({_:t},e){if('__v_skip'===e)return!0;const{ctx:n,setupState:r,data:o,props:s,accessCache:i,type:a,appContext:c}=t;let l;if('$'!==e[0]){const a=i[e];if(void 0!==a)switch(a){case 1:return r[e];case 2:return o[e];case 4:return n[e];case 3:return s[e]}else{if(eo(r,e))return i[e]=1,r[e];if(o!==zt&&Zt(o,e))return i[e]=2,o[e];if((l=t.propsOptions[0])&&Zt(l,e))return i[e]=3,s[e];if(n!==zt&&Zt(n,e))return i[e]=4,n[e];i[e]=0}}const u=to[e];let f,p;return u?('$attrs'===e&&an(t.attrs,0,''),u(t)):(f=a.__cssModules)&&(f=f[e])?f:n!==zt&&Zt(n,e)?(i[e]=4,n[e]):(p=c.config.globalProperties,Zt(p,e)?p[e]:void 0)},set({_:t},e,n){const{data:r,setupState:o,ctx:s}=t;return eo(o,e)?(o[e]=n,!0):r!==zt&&Zt(r,e)?(r[e]=n,!0):!Zt(t.props,e)&&(('$'!==e[0]||!(e.slice(1)in t))&&(s[e]=n,!0))},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:o,propsOptions:s,type:i}},a){let c,l;return!!(n[a]||t!==zt&&'$'!==a[0]&&Zt(t,a)||eo(e,a)||(c=s[0])&&Zt(c,a)||Zt(r,a)||Zt(to,a)||Zt(o.config.globalProperties,a)||(l=i.__cssModules)&&l[a])},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:Zt(n,'value')&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function ro(){return{app:null,config:{isNativeTag:Jt,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let oo=0;function so(t,e){return function(e,n=null){te(e)||(e=Xt({},e)),null==n||re(n)||(n=null);const r=ro(),o=new WeakSet,s=[];let i=!1;const a=r.app={_uid:oo++,_component:e,_props:n,_container:null,_context:r,_instance:null,version:bs,get config(){return r.config},set config(t){},use:(t,...e)=>(o.has(t)||(t&&te(t.install)?(o.add(t),t.install(a,...e)):te(t)&&(o.add(t),t(a,...e))),a),mixin:t=>a,component:(t,e)=>e?(r.components[t]=e,a):r.components[t],directive:(t,e)=>e?(r.directives[t]=e,a):r.directives[t],mount(o,s,c){if(!i){const s=a._ceVNode||Qo(e,n);return s.appContext=r,!0===c?c='svg':!1===c&&(c=void 0),t(s,o,c),i=!0,a._container=o,o.__vue_app__=a,a._instance=s.component,function(t,e){xr('app:init',t,e,{Fragment:Do,Text:No,Comment:Mo,Static:Po})}(a,bs),ms(s.component)}},onUnmount(t){s.push(t)},unmount(){i&&(rr(s,a._instance,16),t(null,a._container),a._instance=null,function(t){xr('app:unmount',t)}(a),delete a._container.__vue_app__)},provide:(t,e)=>(r.provides[t]=e,a),runWithContext(t){try{return t()}finally{}}};return a}}const io={},ao=()=>Object.create(io),co=t=>Object.getPrototypeOf(t)===io;function lo(t,e,n,r=!1){const o={},s=ao();t.propsDefaults=Object.create(null),uo(t,e,o,s);for(const i in t.propsOptions[0])i in o||(o[i]=void 0);n?t.props=r?o:Un(o,!1,Tn,jn,Rn):t.type.props?t.props=o:t.props=s,t.attrs=s}function uo(t,e,n,r){const[o,s]=t.propsOptions;let i,a=!1;if(e)for(let c in e){if(ce(c))continue;const l=e[c];let u;o&&Zt(o,u=fe(c))?s&&s.includes(u)?(i||(i={}))[u]=l:n[u]=l:Ao(t.emitsOptions,c)||c in r&&l===r[c]||(r[c]=l,a=!0)}if(s){const e=Gn(n),r=i||zt;for(let i=0;i<s.length;i++){const a=s[i];n[a]=fo(o,e,a,r[a],t,!Zt(r,a))}}return a}function fo(t,e,n,r,o,s){const i=t[n];if(null!=i){const t=Zt(i,'default');if(t&&void 0===r){const t=i.default;if(i.type!==Function&&!i.skipFactory&&te(t)){const{propsDefaults:s}=o;if(n in s)r=s[n];else{const i=ps(o);r=s[n]=t.call(null,e),i()}}else r=t;o.ce&&o.ce._setProp(n,r)}i[0]&&(s&&!t?r=!1:!i[1]||''!==r&&r!==de(n)||(r=!0))}return r}function po(t,e,n=!1){const r=e.propsCache,o=r.get(t);if(o)return o;const s=t.props,i={},a=[];if(!s)return re(t)&&r.set(t,Wt),Wt;if(Yt(s))for(let l=0;l<s.length;l++){const t=fe(s[l]);ho(t)&&(i[t]=zt)}else if(s)for(const l in s){const t=fe(l);if(ho(t)){const e=s[l],n=i[t]=Yt(e)||te(e)?{type:e}:Xt({},e),r=n.type;let o=!1,c=!0;if(Yt(r))for(let t=0;t<r.length;++t){const e=r[t],n=te(e)&&e.name;if('Boolean'===n){o=!0;break}'String'===n&&(c=!1)}else o=te(r)&&'Boolean'===r.name;n[0]=o,n[1]=c,(o||Zt(n,'default'))&&a.push(t)}}const c=[i,a];return re(t)&&r.set(t,c),c}function ho(t){return'$'!==t[0]&&!ce(t)}const vo=t=>'_'===t||'_ctx'===t||'$stable'===t,go=t=>Yt(t)?t.map(rs):[rs(t)],yo=(t,e,n)=>{if(e._n)return e;const r=function(t,e=Ir){if(!e)return t;if(t._n)return t;const n=(...r)=>{n._d&&Ho(-1);const o=Fr(e);let s;try{s=t(...r)}finally{Fr(o),n._d&&Ho(1)}return $r(e),s};return n._n=!0,n._c=!0,n._d=!0,n}((...t)=>go(e(...t)),n);return r._c=!1,r},_o=(t,e,n)=>{const r=t._ctx;for(const o in t){if(vo(o))continue;const n=t[o];if(te(n))e[o]=yo(0,n,r);else if(null!=n){const t=go(n);e[o]=()=>t}}},mo=(t,e)=>{const n=go(e);t.slots.default=()=>n},wo=(t,e,n)=>{for(const r in e)!n&&vo(r)||(t[r]=e[r])},bo=function(t,e){e&&e.pendingBranch?Yt(t)?e.effects.push(...t):e.effects.push(t):(Yt(n=t)?ar.push(...n):cr&&-1===n.id?cr.splice(lr+1,0,n):1&n.flags||(ar.push(n),n.flags|=1),hr());var n};function xo(t){return function(t){const e=be();e.__VUE__=!0,Sr(e.__VUE_DEVTOOLS_GLOBAL_HOOK__,e);const{insert:n,remove:r,patchProp:o,createElement:s,createText:i,createComment:a,setText:c,setElementText:l,parentNode:u,nextSibling:f,setScopeId:p=Ht,insertStaticContent:d}=t,h=(t,e,n,r=null,o=null,s=null,i=void 0,a=null,c=!!e.dynamicChildren)=>{if(t===e)return;t&&!Xo(t,e)&&(r=H(t),M(t,o,s,!0),t=null),-2===e.patchFlag&&(c=!1,e.dynamicChildren=null);const{type:l,ref:u,shapeFlag:f}=e;switch(l){case No:v(t,e,n,r);break;case Mo:g(t,e,n,r);break;case Po:null==t&&y(e,n,r,i);break;case Do:k(t,e,n,r,o,s,i,a,c);break;default:1&f?b(t,e,n,r,o,s,i,a,c):6&f?F(t,e,n,r,o,s,i,a,c):(64&f||128&f)&&l.process(t,e,n,r,o,s,i,a,c,q)}null!=u&&o?Gr(u,t&&t.ref,s,e||t,!e):null==u&&t&&null!=t.ref&&Gr(t.ref,null,s,t,!0)},v=(t,e,r,o)=>{if(null==t)n(e.el=i(e.children),r,o);else{const n=e.el=t.el;e.children!==t.children&&c(n,e.children)}},g=(t,e,r,o)=>{null==t?n(e.el=a(e.children||''),r,o):e.el=t.el},y=(t,e,n,r)=>{[t.el,t.anchor]=d(t.children,e,n,r,t.el,t.anchor)},m=({el:t,anchor:e},r,o)=>{let s;for(;t&&t!==e;)s=f(t),n(t,r,o),t=s;n(e,r,o)},w=({el:t,anchor:e})=>{let n;for(;t&&t!==e;)n=f(t),r(t),t=n;r(e)},b=(t,e,n,r,o,s,i,a,c)=>{'svg'===e.type?i='svg':'math'===e.type&&(i='mathml'),null==t?x(e,n,r,o,s,i,a,c):T(t,e,o,s,i,a,c)},x=(t,e,r,i,a,c,u,f)=>{let p,d;const{props:h,shapeFlag:v,transition:g,dirs:y}=t;if(p=t.el=s(t.type,c,h&&h.is,h),8&v?l(p,t.children):16&v&&E(t.children,p,null,i,a,So(t,c),u,f),y&&Ar(t,null,i,'created'),S(p,t,t.scopeId,u,i),h){for(const t in h)'value'===t||ce(t)||o(p,t,null,h[t],c,i);'value'in h&&o(p,'value',null,h.value,c),(d=h.onVnodeBeforeMount)&&is(d,i,t)}_e(p,'__vnode',t,!0),_e(p,'__vueParentComponent',i,!0),y&&Ar(t,null,i,'beforeMount');const m=function(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}(a,g);m&&g.beforeEnter(p),n(p,e,r),((d=h&&h.onVnodeMounted)||m||y)&&bo(()=>{d&&is(d,i,t),m&&g.enter(p),y&&Ar(t,null,i,'mounted')},a)},S=(t,e,n,r,o)=>{if(n&&p(t,n),r)for(let s=0;s<r.length;s++)p(t,r[s]);if(o){let n=o.subTree;if(e===n||Ro(n.type)&&(n.ssContent===e||n.ssFallback===e)){const e=o.vnode;S(t,e,e.scopeId,e.slotScopeIds,o.parent)}}},E=(t,e,n,r,o,s,i,a,c=0)=>{for(let l=c;l<t.length;l++){const c=t[l]=a?os(t[l]):rs(t[l]);h(null,c,e,n,r,o,s,i,a)}},T=(t,e,n,r,s,i,a)=>{const c=e.el=t.el;c.__vnode=e;let{patchFlag:u,dynamicChildren:f,dirs:p}=e;u|=16&t.patchFlag;const d=t.props||zt,h=e.props||zt;let v;if(n&&Eo(n,!1),(v=h.onVnodeBeforeUpdate)&&is(v,n,e,t),p&&Ar(e,t,n,'beforeUpdate'),n&&Eo(n,!0),(d.innerHTML&&null==h.innerHTML||d.textContent&&null==h.textContent)&&l(c,''),f?C(t.dynamicChildren,f,c,n,r,So(e,s),i):a||B(t,e,c,null,n,r,So(e,s),i,!1),u>0){if(16&u)I(c,d,h,n,s);else if(2&u&&d.class!==h.class&&o(c,'class',null,h.class,s),4&u&&o(c,'style',d.style,h.style,s),8&u){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const r=t[e],i=d[r],a=h[r];a===i&&'value'!==r||o(c,r,i,a,s,n)}}1&u&&t.children!==e.children&&l(c,e.children)}else a||null!=f||I(c,d,h,n,s);((v=h.onVnodeUpdated)||p)&&bo(()=>{v&&is(v,n,e,t),p&&Ar(e,t,n,'updated')},r)},C=(t,e,n,r,o,s,i)=>{for(let a=0;a<e.length;a++){const c=t[a],l=e[a],f=c.el&&(c.type===Do||!Xo(c,l)||198&c.shapeFlag)?u(c.el):n;h(c,l,f,null,r,o,s,i,!0)}},I=(t,e,n,r,s)=>{if(e!==n){if(e!==zt)for(const i in e)ce(i)||i in n||o(t,i,e[i],null,s,r);for(const i in n){if(ce(i))continue;const a=n[i],c=e[i];a!==c&&'value'!==i&&o(t,i,c,a,s,r)}'value'in n&&o(t,'value',e.value,n.value,s)}},k=(t,e,r,o,s,a,c,l,u)=>{const f=e.el=t?t.el:i(''),p=e.anchor=t?t.anchor:i('');let{patchFlag:d,dynamicChildren:h,slotScopeIds:v}=e;v&&(l=l?l.concat(v):v),null==t?(n(f,r,o),n(p,r,o),E(e.children||[],r,p,s,a,c,l,u)):d>0&&64&d&&h&&t.dynamicChildren?(C(t.dynamicChildren,h,r,s,a,c,l),(null!=e.key||s&&e===s.subTree)&&$o(t,e,!0)):B(t,e,r,p,s,a,c,l,u)},F=(t,e,n,r,o,s,i,a,c)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?o.ctx.activate(e,n,r,i,c):A(e,n,r,o,s,i,c):O(t,e,c)},A=(t,e,n,r,o,s,i)=>{const a=t.component=function(t,e,n){const r=t.type,o=(e?e.appContext:t.appContext)||as,s={uid:cs++,vnode:t,type:r,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Oe(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:['',0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:po(r,o),emitsOptions:Fo(r,o),emit:null,emitted:null,propsDefaults:zt,inheritAttrs:r.inheritAttrs,ctx:zt,data:zt,props:zt,attrs:zt,slots:zt,refs:zt,setupState:zt,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};s.ctx={_:s},s.root=e?e.root:s,s.emit=ko.bind(null,s),t.ce&&t.ce(s);return s}(t,r,o);if(t.type.__isKeepAlive&&(a.ctx.renderer=q),function(t,e=!1,n=!1){e&&us(e);const{props:r,children:o}=t.vnode,s=hs(t);lo(t,r,s,e),((t,e,n)=>{const r=t.slots=ao();if(32&t.vnode.shapeFlag){const t=e._;t?(wo(r,e,n),n&&_e(r,'_',t,!0)):_o(e,r)}else e&&mo(t,e)})(t,o,n||e);const i=s?function(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,no);const{setup:r}=n;if(r){Xe();const n=t.setupContext=r.length>1?function(t){const e=e=>{t.exposed=e||{}};return{attrs:new Proxy(t.attrs,_s),slots:t.slots,emit:t.emit,expose:e}}(t):null,o=ps(t),s=nr(r,t,0,[t.props,n]),i=oe(s);if(Ke(),o(),!i&&!t.sp||Xr(t)||function(t){t.ids=[t.ids[0]+t.ids[2]+++'-',0,0]}(t),i){if(s.then(ds,ds),e)return s.then(e=>{gs(t,e)}).catch(e=>{or(e,t,0)});t.asyncDep=s}else gs(t,s)}else ys(t)}(t,e):void 0;e&&us(!1)}(a,!1,i),a.asyncDep){if(o&&o.registerDep(a,j,i),!t.el){const r=a.subTree=Qo(Mo);g(null,r,e,n),t.placeholder=r.el}}else j(a,t,e,n,o,s,i)},O=(t,e,n)=>{const r=e.component=t.component;if(function(t,e,n){const{props:r,children:o,component:s}=t,{props:i,children:a,patchFlag:c}=e,l=s.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&c>=0))return!(!o&&!a||a&&a.$stable)||r!==i&&(r?!i||Bo(r,i,l):!!i);if(1024&c)return!0;if(16&c)return r?Bo(r,i,l):!!i;if(8&c){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(i[n]!==r[n]&&!Ao(l,n))return!0}}return!1}(t,e,n)){if(r.asyncDep&&!r.asyncResolved)return void L(r,e,n);r.next=e,r.update()}else e.el=t.el,r.vnode=e},j=(t,e,n,r,o,s,i)=>{const a=()=>{if(t.isMounted){let{next:e,bu:n,u:r,parent:c,vnode:l}=t;{const n=To(t);if(n)return e&&(e.el=l.el,L(t,e,i)),void n.asyncDep.then(()=>{t.isUnmounted||a()})}let f,p=e;Eo(t,!1),e?(e.el=l.el,L(t,e,i)):e=l,n&&ye(n),(f=e.props&&e.props.onVnodeBeforeUpdate)&&is(f,c,e,l),Eo(t,!0);const d=Oo(t),v=t.subTree;t.subTree=d,h(v,d,u(v.el),H(v),t,o,s),e.el=d.el,null===p&&function({vnode:t,parent:e},n){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===t&&(r.el=t.el),r!==t)break;(t=e.vnode).el=n,e=e.parent}}(t,d.el),r&&bo(r,o),(f=e.props&&e.props.onVnodeUpdated)&&bo(()=>is(f,c,e,l),o),$r(t)}else{let i;const{el:a,props:c}=e,{bm:l,m:u,parent:f,root:p,type:d}=t,v=Xr(e);Eo(t,!1),l&&ye(l),!v&&(i=c&&c.onVnodeBeforeMount)&&is(i,f,e),Eo(t,!0);{p.ce&&!1!==p.ce._def.shadowRoot&&p.ce._injectChildStyle(d);const i=t.subTree=Oo(t);h(null,i,n,r,t,o,s),e.el=i.el}if(u&&bo(u,o),!v&&(i=c&&c.onVnodeMounted)){const t=e;bo(()=>is(i,f,t),o)}(256&e.shapeFlag||f&&Xr(f.vnode)&&256&f.vnode.shapeFlag)&&t.a&&bo(t.a,o),t.isMounted=!0,Er(t),e=n=r=null}};t.scope.on();const c=t.effect=new Le(a);t.scope.off();const l=t.update=c.run.bind(c),f=t.job=c.runIfDirty.bind(c);f.i=t,f.id=t.uid,c.scheduler=()=>dr(f),Eo(t,!0),l()},L=(t,e,n)=>{e.component=t;const r=t.vnode.props;t.vnode=e,t.next=null,function(t,e,n,r){const{props:o,attrs:s,vnode:{patchFlag:i}}=t,a=Gn(o),[c]=t.propsOptions;let l=!1;if(!(r||i>0)||16&i){let r;uo(t,e,o,s)&&(l=!0);for(const s in a)e&&(Zt(e,s)||(r=de(s))!==s&&Zt(e,r))||(c?!n||void 0===n[s]&&void 0===n[r]||(o[s]=fo(c,a,s,void 0,t,!0)):delete o[s]);if(s!==a)for(const t in s)e&&Zt(e,t)||(delete s[t],l=!0)}else if(8&i){const n=t.vnode.dynamicProps;for(let r=0;r<n.length;r++){let i=n[r];if(Ao(t.emitsOptions,i))continue;const u=e[i];if(c)if(Zt(s,i))u!==s[i]&&(s[i]=u,l=!0);else{const e=fe(i);o[e]=fo(c,a,e,u,t,!1)}else u!==s[i]&&(s[i]=u,l=!0)}}l&&cn(t.attrs,'set','')}(t,e.props,r,n),((t,e,n)=>{const{vnode:r,slots:o}=t;let s=!0,i=zt;if(32&r.shapeFlag){const t=e._;t?n&&1===t?s=!1:wo(o,e,n):(s=!e.$stable,_o(e,o)),i=e}else e&&(mo(t,e),i={default:1});if(s)for(const a in o)vo(a)||null!=i[a]||delete o[a]})(t,e.children,n),Xe(),vr(t),Ke()},B=(t,e,n,r,o,s,i,a,c=!1)=>{const u=t&&t.children,f=t?t.shapeFlag:0,p=e.children,{patchFlag:d,shapeFlag:h}=e;if(d>0){if(128&d)return void D(u,p,n,r,o,s,i,a,c);if(256&d)return void R(u,p,n,r,o,s,i,a,c)}8&h?(16&f&&W(u,o,s),p!==u&&l(n,p)):16&f?16&h?D(u,p,n,r,o,s,i,a,c):W(u,o,s,!0):(8&f&&l(n,''),16&h&&E(p,n,r,o,s,i,a,c))},R=(t,e,n,r,o,s,i,a,c)=>{e=e||Wt;const l=(t=t||Wt).length,u=e.length,f=Math.min(l,u);let p;for(p=0;p<f;p++){const r=e[p]=c?os(e[p]):rs(e[p]);h(t[p],r,n,null,o,s,i,a,c)}l>u?W(t,o,s,!0,!1,f):E(e,n,r,o,s,i,a,c,f)},D=(t,e,n,r,o,s,i,a,c)=>{let l=0;const u=e.length;let f=t.length-1,p=u-1;for(;l<=f&&l<=p;){const r=t[l],u=e[l]=c?os(e[l]):rs(e[l]);if(!Xo(r,u))break;h(r,u,n,null,o,s,i,a,c),l++}for(;l<=f&&l<=p;){const r=t[f],l=e[p]=c?os(e[p]):rs(e[p]);if(!Xo(r,l))break;h(r,l,n,null,o,s,i,a,c),f--,p--}if(l>f){if(l<=p){const t=p+1,f=t<u?e[t].el:r;for(;l<=p;)h(null,e[l]=c?os(e[l]):rs(e[l]),n,f,o,s,i,a,c),l++}}else if(l>p)for(;l<=f;)M(t[l],o,s,!0),l++;else{const d=l,v=l,g=new Map;for(l=v;l<=p;l++){const t=e[l]=c?os(e[l]):rs(e[l]);null!=t.key&&g.set(t.key,l)}let y,m=0;const w=p-v+1;let b=!1,x=0;const S=new Array(w);for(l=0;l<w;l++)S[l]=0;for(l=d;l<=f;l++){const r=t[l];if(m>=w){M(r,o,s,!0);continue}let u;if(null!=r.key)u=g.get(r.key);else for(y=v;y<=p;y++)if(0===S[y-v]&&Xo(r,e[y])){u=y;break}void 0===u?M(r,o,s,!0):(S[u-v]=l+1,u>=x?x=u:b=!0,h(r,e[u],n,null,o,s,i,a,c),m++)}const E=b?function(t){const e=t.slice(),n=[0];let r,o,s,i,a;const c=t.length;for(r=0;r<c;r++){const c=t[r];if(0!==c){if(o=n[n.length-1],t[o]<c){e[r]=o,n.push(r);continue}for(s=0,i=n.length-1;s<i;)a=s+i>>1,t[n[a]]<c?s=a+1:i=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}s=n.length,i=n[s-1];for(;s-- >0;)n[s]=i,i=e[i];return n}(S):Wt;for(y=E.length-1,l=w-1;l>=0;l--){const t=v+l,f=e[t],p=e[t+1],d=t+1<u?p.el||p.placeholder:r;0===S[l]?h(null,f,n,d,o,s,i,a,c):b&&(y<0||l!==E[y]?N(f,n,d,2):y--)}}},N=(t,e,o,s,i=null)=>{const{el:a,type:c,transition:l,children:u,shapeFlag:f}=t;if(6&f)return void N(t.component.subTree,e,o,s);if(128&f)return void t.suspense.move(e,o,s);if(64&f)return void c.move(t,e,o,q);if(c===Do){n(a,e,o);for(let t=0;t<u.length;t++)N(u[t],e,o,s);return void n(t.anchor,e,o)}if(c===Po)return void m(t,e,o);if(2!==s&&1&f&&l)if(0===s)l.beforeEnter(a),n(a,e,o),bo(()=>l.enter(a),i);else{const{leave:s,delayLeave:i,afterLeave:c}=l,u=()=>{t.ctx.isUnmounted?r(a):n(a,e,o)},f=()=>{a._isLeaving&&a[zr](!0),s(a,()=>{u(),c&&c()})};i?i(a,u,f):f()}else n(a,e,o)},M=(t,e,n,r=!1,o=!1)=>{const{type:s,props:i,ref:a,children:c,dynamicChildren:l,shapeFlag:u,patchFlag:f,dirs:p,cacheIndex:d}=t;if(-2===f&&(o=!1),null!=a&&(Xe(),Gr(a,null,n,t,!0),Ke()),null!=d&&(e.renderCache[d]=void 0),256&u)return void e.ctx.deactivate(t);const h=1&u&&p,v=!Xr(t);let g;if(v&&(g=i&&i.onVnodeBeforeUnmount)&&is(g,e,t),6&u)U(t.component,n,r);else{if(128&u)return void t.suspense.unmount(n,r);h&&Ar(t,null,e,'beforeUnmount'),64&u?t.type.remove(t,e,n,q,r):l&&!l.hasOnce&&(s!==Do||f>0&&64&f)?W(l,e,n,!1,!0):(s===Do&&384&f||!o&&16&u)&&W(c,e,n),r&&P(t)}(v&&(g=i&&i.onVnodeUnmounted)||h)&&bo(()=>{g&&is(g,e,t),h&&Ar(t,null,e,'unmounted')},n)},P=t=>{const{type:e,el:n,anchor:o,transition:s}=t;if(e===Do)return void V(n,o);if(e===Po)return void w(t);const i=()=>{r(n),s&&!s.persisted&&s.afterLeave&&s.afterLeave()};if(1&t.shapeFlag&&s&&!s.persisted){const{leave:e,delayLeave:r}=s,o=()=>e(n,i);r?r(t.el,i,o):o()}else i()},V=(t,e)=>{let n;for(;t!==e;)n=f(t),r(t),t=n;r(e)},U=(t,e,n)=>{const{bum:r,scope:o,job:s,subTree:i,um:a,m:c,a:l}=t;var u;Co(c),Co(l),r&&ye(r),o.stop(),s&&(s.flags|=8,M(i,t,e,n)),a&&bo(a,e),bo(()=>{t.isUnmounted=!0},e),u=t,mr&&'function'==typeof mr.cleanupBuffer&&!mr.cleanupBuffer(u)&&Tr(u)},W=(t,e,n,r=!1,o=!1,s=0)=>{for(let i=s;i<t.length;i++)M(t[i],e,n,r,o)},H=t=>{if(6&t.shapeFlag)return H(t.component.subTree);if(128&t.shapeFlag)return t.suspense.next();const e=f(t.anchor||t.el),n=e&&e[Or];return n?f(n):e};let J=!1;const G=(t,e,n)=>{null==t?e._vnode&&M(e._vnode,null,null,!0):h(e._vnode||null,t,e,null,null,null,n),e._vnode=t,J||(J=!0,vr(),gr(),J=!1)},q={p:h,um:M,m:N,r:P,mt:A,mc:E,pc:B,pbc:C,n:H,o:t};let X;return{render:G,hydrate:X,createApp:so(G)}}(t)}function So({type:t,props:e},n){return'svg'===n&&'foreignObject'===t||'mathml'===n&&'annotation-xml'===t&&e&&e.encoding&&e.encoding.includes('html')?void 0:n}function Eo({effect:t,job:e},n){n?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function $o(t,e,n=!1){const r=t.children,o=e.children;if(Yt(r)&&Yt(o))for(let s=0;s<r.length;s++){const t=r[s];let e=o[s];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=o[s]=os(o[s]),e.el=t.el),n||-2===e.patchFlag||$o(t,e)),e.type===No&&-1!==e.patchFlag&&(e.el=t.el),e.type!==Mo||e.el||(e.el=t.el)}}function To(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:To(e)}function Co(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Io=(t,e)=>'modelValue'===e||'model-value'===e?t.modelModifiers:t[`${e}Modifiers`]||t[`${fe(e)}Modifiers`]||t[`${de(e)}Modifiers`];function ko(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||zt;let o=n;const s=e.startsWith('update:'),i=s&&Io(r,e.slice(7));let a;i&&(i.trim&&(o=n.map(t=>ee(t)?t.trim():t)),i.number&&(o=n.map(me))),function(t,e,n){xr('component:emit',t.appContext.app,t,e,n)}(t,e,o);let c=r[a=ve(e)]||r[a=ve(fe(e))];!c&&s&&(c=r[a=ve(de(e))]),c&&rr(c,t,6,o);const l=r[a+'Once'];if(l){if(t.emitted){if(t.emitted[a])return}else t.emitted={};t.emitted[a]=!0,rr(l,t,6,o)}}function Fo(t,e,n=!1){const r=e.emitsCache,o=r.get(t);if(void 0!==o)return o;const s=t.emits;let i={};return s?(Yt(s)?s.forEach(t=>i[t]=null):Xt(i,s),re(t)&&r.set(t,i),i):(re(t)&&r.set(t,null),null)}function Ao(t,e){return!(!t||!Gt(e))&&(e=e.slice(2).replace(/Once$/,''),Zt(t,e[0].toLowerCase()+e.slice(1))||Zt(t,de(e))||Zt(t,e))}function Oo(t){const{type:e,vnode:n,proxy:r,withProxy:o,propsOptions:[s],slots:i,attrs:a,emit:c,render:l,renderCache:u,props:f,data:p,setupState:d,ctx:h,inheritAttrs:v}=t,g=Fr(t);let y,m;try{if(4&n.shapeFlag){const t=o||r,e=t;y=rs(l.call(e,t,u,f,d,p,h)),m=a}else{const t=e;0,y=rs(t.length>1?t(f,{attrs:a,slots:i,emit:c}):t(f,null)),m=e.props?a:jo(a)}}catch(b){Vo.length=0,or(b,t,1),y=Qo(Mo)}let w=y;if(m&&!1!==v){const t=Object.keys(m),{shapeFlag:e}=w;t.length&&7&e&&(s&&t.some(qt)&&(m=Lo(m,s)),w=ts(w,m,!1,!0))}return n.dirs&&(w=ts(w,null,!1,!0),w.dirs=w.dirs?w.dirs.concat(n.dirs):n.dirs),n.transition&&Wr(w,n.transition),y=w,Fr(g),y}const jo=t=>{let e;for(const n in t)('class'===n||'style'===n||Gt(n))&&((e||(e={}))[n]=t[n]);return e},Lo=(t,e)=>{const n={};for(const r in t)qt(r)&&r.slice(9)in e||(n[r]=t[r]);return n};function Bo(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let o=0;o<r.length;o++){const s=r[o];if(e[s]!==t[s]&&!Ao(n,s))return!0}return!1}const Ro=t=>t.__isSuspense;const Do=Symbol.for('v-fgt'),No=Symbol.for('v-txt'),Mo=Symbol.for('v-cmt'),Po=Symbol.for('v-stc'),Vo=[];let Uo=null;function zo(t=!1){Vo.push(Uo=t?null:[])}let Wo=1;function Ho(t,e=!1){Wo+=t,t<0&&Uo&&e&&(Uo.hasOnce=!0)}function Jo(t){return t.dynamicChildren=Wo>0?Uo||Wt:null,Vo.pop(),Uo=Vo[Vo.length-1]||null,Wo>0&&Uo&&Uo.push(t),t}function Go(t,e,n,r,o){return Jo(Qo(t,e,n,r,o,!0))}function qo(t){return!!t&&!0===t.__v_isVNode}function Xo(t,e){return t.type===e.type&&t.key===e.key}const Ko=({key:t})=>null!=t?t:null,Zo=({ref:t,ref_key:e,ref_for:n})=>('number'==typeof t&&(t=''+t),null!=t?ee(t)||Kn(t)||te(t)?{i:Ir,r:t,k:e,f:!!n}:t:null);function Yo(t,e=null,n=null,r=0,o=null,s=(t===Do?0:1),i=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Ko(e),ref:e&&Zo(e),scopeId:kr,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Ir};return a?(ss(c,n),128&s&&t.normalize(c)):n&&(c.shapeFlag|=ee(n)?8:16),Wo>0&&!i&&Uo&&(c.patchFlag>0||6&s)&&32!==c.patchFlag&&Uo.push(c),c}const Qo=function(t,e=null,n=null,r=0,o=null,s=!1){t&&t!==Yr||(t=Mo);if(qo(t)){const r=ts(t,e,!0);return n&&ss(r,n),Wo>0&&!s&&Uo&&(6&r.shapeFlag?Uo[Uo.indexOf(t)]=r:Uo.push(r)),r.patchFlag=-2,r}i=t,te(i)&&'__vccOpts'in i&&(t=t.__vccOpts);var i;if(e){e=function(t){return t?Jn(t)||co(t)?Xt({},t):t:null}(e);let{class:t,style:n}=e;t&&!ee(t)&&(e.class=Ce(t)),re(n)&&(Jn(n)&&!Yt(n)&&(n=Xt({},n)),e.style=xe(n))}const a=ee(t)?1:Ro(t)?128:(t=>t.__isTeleport)(t)?64:re(t)?4:te(t)?2:0;return Yo(t,e,n,r,o,a,s,!0)};function ts(t,e,n=!1,r=!1){const{props:o,ref:s,patchFlag:i,children:a,transition:c}=t,l=e?function(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const t in r)if('class'===t)e.class!==r.class&&(e.class=Ce([e.class,r.class]));else if('style'===t)e.style=xe([e.style,r.style]);else if(Gt(t)){const n=e[t],o=r[t];!o||n===o||Yt(n)&&n.includes(o)||(e[t]=n?[].concat(n,o):o)}else''!==t&&(e[t]=r[t])}return e}(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&Ko(l),ref:e&&e.ref?n&&s?Yt(s)?s.concat(Zo(e)):[s,Zo(e)]:Zo(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Do?-1===i?16:16|i:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:c,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&ts(t.ssContent),ssFallback:t.ssFallback&&ts(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return c&&r&&Wr(u,c.clone(u)),u}function es(t=' ',e=0){return Qo(No,null,t,e)}function ns(t='',e=!1){return e?(zo(),Go(Mo,null,t)):Qo(Mo,null,t)}function rs(t){return null==t||'boolean'==typeof t?Qo(Mo):Yt(t)?Qo(Do,null,t.slice()):qo(t)?os(t):Qo(No,null,String(t))}function os(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:ts(t)}function ss(t,e){let n=0;const{shapeFlag:r}=t;if(null==e)e=null;else if(Yt(e))n=16;else if('object'==typeof e){if(65&r){const n=e.default;return void(n&&(n._c&&(n._d=!1),ss(t,n()),n._c&&(n._d=!0)))}{n=32;const r=e._;r||co(e)?3===r&&Ir&&(1===Ir.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=Ir}}else te(e)?(e={default:e,_ctx:Ir},n=32):(e=String(e),64&r?(n=16,e=[es(e)]):n=8);t.children=e,t.shapeFlag|=n}function is(t,e,n,r=null){rr(t,e,7,[n,r])}const as=ro();let cs=0;let ls,us,fs=null;{const t=be(),e=(e,n)=>{let r;return(r=t[e])||(r=t[e]=[]),r.push(n),t=>{r.length>1?r.forEach(e=>e(t)):r[0](t)}};ls=e('__VUE_INSTANCE_SETTERS__',t=>fs=t),us=e('__VUE_SSR_SETTERS__',t=>vs=t)}const ps=t=>{const e=fs;return ls(t),t.scope.on(),()=>{t.scope.off(),ls(e)}},ds=()=>{fs&&fs.scope.off(),ls(null)};function hs(t){return 4&t.vnode.shapeFlag}let vs=!1;function gs(t,e,n){te(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:re(e)&&(t.devtoolsRawSetupState=e,t.setupState=tr(e)),ys(t)}function ys(t,e,n){const r=t.type;t.render||(t.render=r.render||Ht)}const _s={get:(t,e)=>(an(t,0,''),t[e])};function ms(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(tr((e=t.exposed,!Zt(e,'__v_skip')&&Object.isExtensible(e)&&_e(e,'__v_skip',!0),e)),{get:(e,n)=>n in e?e[n]:n in to?to[n](t):void 0,has:(t,e)=>e in t||e in to})):t.proxy;var e}const ws=(t,e)=>{const n=function(t,e,n=!1){let r,o;return te(t)?r=t:(r=t.get,o=t.set),new er(r,o,n)}
/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/(t,0,vs);return n},bs='3.5.22';
/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
let xs;const Ss='undefined'!=typeof window&&window.trustedTypes;if(Ss)try{xs=Ss.createPolicy('vue',{createHTML:t=>t})}catch(Hi){}const Es=xs?t=>xs.createHTML(t):t=>t,$s='undefined'!=typeof document?document:null,Ts=$s&&$s.createElement('template'),Cs={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const o='svg'===e?$s.createElementNS('http://www.w3.org/2000/svg',t):'mathml'===e?$s.createElementNS('http://www.w3.org/1998/Math/MathML',t):n?$s.createElement(t,{is:n}):$s.createElement(t);return'select'===t&&r&&null!=r.multiple&&o.setAttribute('multiple',r.multiple),o},createText:t=>$s.createTextNode(t),createComment:t=>$s.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>$s.querySelector(t),setScopeId(t,e){t.setAttribute(e,'')},insertStaticContent(t,e,n,r,o,s){const i=n?n.previousSibling:e.lastChild;if(o&&(o===s||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),n),o!==s&&(o=o.nextSibling););else{Ts.innerHTML=Es('svg'===r?`<svg>${t}</svg>`:'mathml'===r?`<math>${t}</math>`:t);const o=Ts.content;if('svg'===r||'mathml'===r){const t=o.firstChild;for(;t.firstChild;)o.appendChild(t.firstChild);o.removeChild(t)}e.insertBefore(o,n)}return[i?i.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},Is=Symbol('_vtc');const ks=Symbol('_vod'),Fs=Symbol('_vsh'),As=Symbol(''),Os=/(?:^|;)\s*display\s*:/;const js=/\s*!important$/;function Ls(t,e,n){if(Yt(n))n.forEach(n=>Ls(t,e,n));else if(null==n&&(n=''),e.startsWith('--'))t.setProperty(e,n);else{const r=function(t,e){const n=Rs[e];if(n)return n;let r=fe(e);if('filter'!==r&&r in t)return Rs[e]=r;r=he(r);for(let o=0;o<Bs.length;o++){const n=Bs[o]+r;if(n in t)return Rs[e]=n}return e}(t,e);js.test(n)?t.setProperty(de(r),n.replace(js,''),'important'):t[r]=n}}const Bs=['Webkit','Moz','ms'],Rs={};const Ds='http://www.w3.org/1999/xlink';function Ns(t,e,n,r,o,s=Ie(e)){r&&e.startsWith('xlink:')?null==n?t.removeAttributeNS(Ds,e.slice(6,e.length)):t.setAttributeNS(Ds,e,n):null==n||s&&!ke(n)?t.removeAttribute(e):t.setAttribute(e,s?'':ne(n)?String(n):n)}function Ms(t,e,n,r,o){if('innerHTML'===e||'textContent'===e)return void(null!=n&&(t[e]='innerHTML'===e?Es(n):n));const s=t.tagName;if('value'===e&&'PROGRESS'!==s&&!s.includes('-')){const r='OPTION'===s?t.getAttribute('value')||'':t.value,o=null==n?'checkbox'===t.type?'on':'':String(n);return r===o&&'_value'in t||(t.value=o),null==n&&t.removeAttribute(e),void(t._value=n)}let i=!1;if(''===n||null==n){const r=typeof t[e];'boolean'===r?n=ke(n):null==n&&'string'===r?(n='',i=!0):'number'===r&&(n=0,i=!0)}try{t[e]=n}catch(Hi){}i&&t.removeAttribute(o||e)}const Ps=Symbol('_vei');function Vs(t,e,n,r,o=null){const s=t[Ps]||(t[Ps]={}),i=s[e];if(r&&i)i.value=r;else{const[n,a]=function(t){let e;if(Us.test(t)){let n;for(e={};n=t.match(Us);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}const n=':'===t[2]?t.slice(3):de(t.slice(2));return[n,e]}(e);if(r){const i=s[e]=function(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();rr(function(t,e){if(Yt(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(t=>e=>!e._stopped&&t&&t(e))}return e}(t,n.value),e,5,[t])};return n.value=t,n.attached=Hs(),n}(r,o);!function(t,e,n,r){t.addEventListener(e,n,r)}(t,n,i,a)}else i&&(!function(t,e,n,r){t.removeEventListener(e,n,r)}(t,n,i,a),s[e]=void 0)}}const Us=/(?:Once|Passive|Capture)$/;let zs=0;const Ws=Promise.resolve(),Hs=()=>zs||(Ws.then(()=>zs=0),zs=Date.now());const Js=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123;const Gs=Xt({patchProp:(t,e,n,r,o,s)=>{const i='svg'===o;'class'===e?function(t,e,n){const r=t[Is];r&&(e=(e?[e,...r]:[...r]).join(' ')),null==e?t.removeAttribute('class'):n?t.setAttribute('class',e):t.className=e}(t,r,i):'style'===e?function(t,e,n){const r=t.style,o=ee(n);let s=!1;if(n&&!o){if(e)if(ee(e))for(const t of e.split(';')){const e=t.slice(0,t.indexOf(':')).trim();null==n[e]&&Ls(r,e,'')}else for(const t in e)null==n[t]&&Ls(r,t,'');for(const t in n)'display'===t&&(s=!0),Ls(r,t,n[t])}else if(o){if(e!==n){const t=r[As];t&&(n+=';'+t),r.cssText=n,s=Os.test(n)}}else e&&t.removeAttribute('style');ks in t&&(t[ks]=s?r.display:'',t[Fs]&&(r.display='none'))}(t,n,r):Gt(e)?qt(e)||Vs(t,e,0,r,s):('.'===e[0]?(e=e.slice(1),1):'^'===e[0]?(e=e.slice(1),0):function(t,e,n,r){if(r)return'innerHTML'===e||'textContent'===e||!!(e in t&&Js(e)&&te(n));if('spellcheck'===e||'draggable'===e||'translate'===e||'autocorrect'===e)return!1;if('form'===e)return!1;if('list'===e&&'INPUT'===t.tagName)return!1;if('type'===e&&'TEXTAREA'===t.tagName)return!1;if('width'===e||'height'===e){const e=t.tagName;if('IMG'===e||'VIDEO'===e||'CANVAS'===e||'SOURCE'===e)return!1}if(Js(e)&&ee(n))return!1;return e in t}(t,e,r,i))?(Ms(t,e,r),t.tagName.includes('-')||'value'!==e&&'checked'!==e&&'selected'!==e||Ns(t,e,r,i,0,'value'!==e)):!t._isVueCE||!/[A-Z]/.test(e)&&ee(r)?('true-value'===e?t._trueValue=r:'false-value'===e&&(t._falseValue=r),Ns(t,e,r,i)):Ms(t,fe(e),r,0,e)}},Cs);let qs;const Xs=(...t)=>{const e=(qs||(qs=xo(Gs))).createApp(...t),{mount:n}=e;return e.mount=t=>{const r=function(t){if(ee(t)){return document.querySelector(t)}return t}(t);if(!r)return;const o=e._component;te(o)||o.render||o.template||(o.template=r.innerHTML),1===r.nodeType&&(r.textContent='');const s=n(r,!1,function(t){if(t instanceof SVGElement)return'svg';if('function'==typeof MathMLElement&&t instanceof MathMLElement)return'mathml'}(r));return r instanceof Element&&(r.removeAttribute('v-cloak'),r.setAttribute('data-v-app','')),s},e};const Ks='[ST-VarSystemExtension/reprocessMenuItem]',Zs=Hr({__name:'reprocessMenuItem',setup(t,{expose:n}){n();const r=Zn(null),o=Zn(!1),a=Zn(!1),l=ws(()=>a.value&&o.value);function u(){try{const t=e(),n=t.characters?.[t.characterId];r.value=t.characterId,o.value=Boolean(t.chat&&t.chat.length>0),a.value=n?.data?.extensions?.st_var_system?.enabled??!1}catch(R){console.error(Ks,'更新可见性状态失败:',R),a.value=!1,o.value=!1}}u(),s.on(i.CHAT_CHANGED,u),s.on(i.MESSAGE_RECEIVED,u),s.on(i.MESSAGE_DELETED,u),s.on(i.CHARACTER_SELECTED,u),Kr(()=>{s.removeListener(i.CHAT_CHANGED,u),s.removeListener(i.MESSAGE_RECEIVED,u),s.removeListener(i.MESSAGE_DELETED,u),s.removeListener(i.CHARACTER_SELECTED,u)});const f={MODULE_NAME:Ks,characterId:r,hasChat:o,isEnabled:a,isVisible:l,updateVisibility:u,handleReprocess:async function(){console.log(Ks,'点击重新处理变量按钮');try{const t=e(),n=t.chat;if(!n||0===n.length)return void toastr.warning('当前聊天为空','变量系统');const r=t.characters[t.characterId];if(!(r?.data?.extensions?.st_var_system?.enabled??!1))return void toastr.warning('当前角色未启用变量系统','变量系统');let o=-1;for(let e=n.length-1;e>=0;e--)if(!n[e].is_user){o=e;break}if(-1===o)return void toastr.warning('没有找到 AI 消息','变量系统');const s=n[o],i=s.swipe_id||0,a=s.swipes_info?.[i]?.st_var_system_snapshot_id;a?(console.log(Ks,`清除第 ${o} 层 (swipe ${i}) 的快照标识符:`,a),delete s.swipes_info[i].st_var_system_snapshot_id,await c()):console.log(Ks,`第 ${o} 层 (swipe ${i}) 没有快照标识符，直接重新处理`),toastr.info('开始重新处理变量...','变量系统'),await st(o),toastr.success('变量重新处理完成','变量系统')}catch(R){console.error(Ks,'重新处理变量失败:',R),toastr.error(`重新处理变量失败：${R.message}`,'变量系统')}}};return Object.defineProperty(f,'__isScriptSetup',{enumerable:!1,value:!0}),f}}),Ys={key:0,class:'extension_container'};const Qs=((t,e)=>{const n=t.__vccOpts||t;for(const[r,o]of e)n[r]=o;return n})(Zs,[['render',function(t,e,n,r,o,s){return zo(),Go(Pr,{defer:'',to:'#extensionsMenu'},[r.isVisible?(zo(),i='div',a=Ys,c=[Yo('div',{class:'list-group-item flex-container flexGap5 interactable',tabindex:'0',role:'listitem',onClick:r.handleReprocess},[...e[0]||(e[0]=[Yo('div',{class:'fa-solid fa-rotate extensionsMenuExtensionButton'},null,-1),Yo('span',null,'重新处理变量',-1)])])],Jo(Yo(i,a,c,l,u,f,!0))):ns('',!0)]);var i,a,c,l,u,f}],['__file','reprocessMenuItem.vue']]);void 0===window._&&(window._=m,console.log('[ST-VarSystemExtension] Lodash 已注入到 window._'));const ti='[ST-VarSystemExtension]',ei='st_var_system',ni='var_system_template_status',ri={editorController:null,currentCharacterId:null,templateBody:null,draftBody:null,enabled:!1,dirty:!1,hasErrors:!1,loading:!1},oi='3.10.0',si=`https://cdn.jsdelivr.net/npm/vanilla-jsoneditor@${oi}/themes/jse-theme-dark.css`,ii=`https://cdn.jsdelivr.net/npm/vanilla-jsoneditor@${oi}/standalone.js`;let ai=null,ci=null;const li={success:'#6ee7b7',error:'#fca5a5',warn:'#fbbf24',info:'var(--SmartThemeBodyColor, #aaa)'};function ui(t){if(!t||ai)return;ai={save:t.querySelector('#var_system_template_save'),saveAsGlobal:t.querySelector('#var_system_template_save_as_global'),discard:t.querySelector('#var_system_template_discard'),reload:t.querySelector('#var_system_template_reload'),status:t.querySelector(`#${ni}`),clear:t.querySelector('#var_system_template_clear'),enableToggle:t.querySelector('#var_system_template_enabled')},ai.save?.addEventListener('click',()=>{!async function(){if(ri.hasErrors)return void fi('存在未解决的 JSON 错误，无法保存。','error');const t=await gi();if(!t)return void fi('编辑器尚未准备就绪。','error');const e=t.get(),r=e?.json;if(void 0===r)return void fi('请修复模板中的错误后再保存。','error');const o=window.SillyTavern.getContext().characterId;if(null==o)return void fi('未选择角色，无法保存模板。','error');ri.loading=!0,pi(),fi('模板保存中……','info');try{const t={templateBody:r,enabled:ri.enabled};await n(o,ei,t),ri.templateBody=vi(r),ri.draftBody=vi(r),ri.dirty=!1,ri.hasErrors=!1,fi('模板已保存。','success')}catch(R){console.error(ti,'保存模板失败',R),fi(`保存模板失败：${R?.message??R}`,'error')}finally{ri.loading=!1,pi()}}()}),ai.saveAsGlobal?.addEventListener('click',()=>{!async function(){const t=window.SillyTavern.getContext();if(!t.characterId)return void(await l('请先选择一个角色',u.TEXT,'',{okButton:'确定'}));const e=await gi();if(!e)return void fi('编辑器尚未准备就绪。','error');const n=e.get(),r=n?.json;if(void 0===r||!r)return void(await l('当前模板为空或有错误，无法保存为全局快照',u.TEXT,'',{okButton:'确定'}));const o=t.characters?.[t.characterId],s=o?.name?`${o.name}的模板`:'角色模板',i=await l('请输入全局快照的名称：',u.INPUT,s,{okButton:'保存',cancelButton:'取消'});if(!i)return;try{fi('正在保存为全局快照...','info');const t={name:i,description:`从角色"${o?.name||'未知'}"的模板创建`,tags:['角色模板',o?.name].filter(Boolean),snapshotBody:r};await Oi('/global-snapshots',{method:'POST',body:JSON.stringify(t)}),fi(`已保存为全局快照："${i}"`,'success'),console.log(`${ti} 角色模板已保存为全局快照:`,i);await l(`全局快照"${i}"已创建成功！\n\n是否切换到全局快照标签页查看？`,u.CONFIRM,'',{okButton:'查看',cancelButton:'留在这里'})&&(document.getElementById('var_system_tab_global')?.click(),await Ri())}catch(R){console.error(`${ti} 保存为全局快照失败:`,R);let e='保存失败';e=R.message.includes('插件未安装')?'插件未安装或未启用。\n\n全局快照功能需要安装 ST-VarSystemPlugin 插件。':`保存失败: ${R.message}`,fi(e,'error'),await l(e,u.TEXT,'',{okButton:'关闭'})}}()}),ai.discard?.addEventListener('click',()=>{!async function(){if(!ri.templateBody)return void fi('没有可恢复的模板版本。','warn');ri.draftBody=vi(ri.templateBody),ri.dirty=!1,ri.hasErrors=!1;const t=await gi();t&&t.setValue(ri.draftBody??{},{silent:!0});pi(),fi('已恢复为最后保存的模板。','info')}()}),ai.reload?.addEventListener('click',()=>{_i(!0)}),ai.clear?.addEventListener('click',()=>{!async function(){const t=window.SillyTavern.getContext(),e=t.characterId;if(null==e)return void fi('未选择角色，无法清空模板。','error');if(!ri.templateBody)return void fi('当前没有保存的模板，无需清空。','info');const r='确定要清空模板吗？这会从角色卡中移除模板字段，但不会改变启用状态。';if(!(window.confirm?.(r)??confirm(r)))return void fi('已取消清空模板。','info');ri.loading=!0,pi(),fi('正在清空模板……','info');try{const r={enabled:ri.enabled};await n(e,ei,r);t.characters;const o=await gi(),s={};ri.templateBody=null,ri.draftBody=vi(s),ri.dirty=!0,ri.hasErrors=!1,o&&o.setValue(s,{silent:!1}),fi('模板字段已清空，编辑器已恢复默认骨架，请视需要重新保存。','warn')}catch(R){console.error(ti,'清空模板失败',R),fi(`清空模板失败：${R?.message??R}`,'error')}finally{ri.loading=!1,pi()}}()}),ai.enableToggle?.addEventListener('change',t=>{!async function(t){const e=window.SillyTavern.getContext().characterId;if(null==e)return fi('未选择角色，无法修改启用状态。','error'),void di();if(ri.loading)return void di();const r=ri.enabled;ri.enabled=Boolean(t),ri.loading=!0,pi(),fi(ri.enabled?'正在启用变量系统……':'正在停用变量系统……','info');try{const t={enabled:ri.enabled};ri.templateBody&&(t.templateBody=vi(ri.templateBody)),await n(e,ei,t),fi(ri.enabled?'变量系统已为该角色启用。':'变量系统已为该角色停用。','success')}catch(R){console.error(ti,'更新启用状态失败',R),ri.enabled=r,fi(`更新启用状态失败：${R?.message??R}`,'error')}finally{ri.loading=!1,di(),pi()}}(Boolean(t.target?.checked))});const e=t.querySelector('#var_system_template_export'),r=t.querySelector('#var_system_template_import'),o=t.querySelector('#var_system_template_strip_schema');e?.addEventListener('click',()=>{!async function(){const t=await gi();if(!t)return void toastr.error('编辑器尚未准备就绪');const e=t.get(),n=e?.json;if(void 0===n)return void toastr.error('请修复模板中的错误后再导出');const r=window.SillyTavern.getContext(),o=r.characters?.[r.characterId],s=o?.name||'unknown',i=(new Date).toISOString().replace(/[:.]/g,'-').slice(0,19),a=`template_${s}_${i}.json`;ki(n,a),toastr.success(`已导出：${a}`)}()}),r?.addEventListener('click',()=>{!async function(){const t=await Fi();if(!t)return;const e=await gi();if(!e)return void toastr.error('编辑器尚未准备就绪');const n=Ai(t,!1);e.set({json:n}),ri.dirty=!0,ri.draftBody=vi(n),pi(),toastr.success('JSON 已导入到编辑器')}()}),o?.addEventListener('click',()=>{!async function(){const t=await gi();if(!t)return void toastr.error('编辑器尚未准备就绪');const e=t.get(),n=e?.json;if(void 0===n)return void toastr.error('请修复模板中的错误后再分离 Schema');const r=Ii(n);t.set({json:r}),ri.dirty=!0,ri.draftBody=vi(r),pi(),toastr.success('已移除 MVU Schema 字段')}()}),fi('尚未加载模板','info'),pi()}function fi(t,e='info'){const n=ai?.status||document.getElementById(ni);n&&(n.textContent=t??'',n.style.color=li[e]??li.info)}function pi(){if(!ai)return;const t=null!==ri.templateBody,e=ri.loading||!ri.draftBody;ai.save&&(ai.save.disabled=e||ri.hasErrors||!ri.dirty),ai.discard&&(ai.discard.disabled=e||!t||!ri.dirty),ai.reload&&(ai.reload.disabled=ri.loading),ai.clear&&(ai.clear.disabled=ri.loading||!t),di()}function di(){if(!ai?.enableToggle)return;const t=ri.loading||!ri.currentCharacterId;ai.enableToggle.disabled=t,ai.enableToggle.checked=Boolean(ri.enabled)}function hi(t=!1){null!==ci&&clearTimeout(ci),ci=setTimeout(()=>{ci=null,_i(t)},0)}function vi(t){return null==t?t:'function'==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t))}async function gi({readOnly:t=!1}={}){const e=document.getElementById('var_system_template_editor');if(!e)return null;ri.editorController?ri.editorController.setContainer(e):ri.editorController=F({container:e,initialValue:ri.draftBody??{},styleUrl:si,scriptUrl:ii,readOnly:t,onChange:yi,onFallback:()=>{fi('JSON 编辑器资源加载失败，已降级为纯文本模式。','warn'),pi()}});try{await ri.editorController.ensureReady()}catch(R){return console.error(ti,'初始化编辑器失败',R),null}return ri.editorController}function yi(t,e,n){console.log('[ST-VarSystemExtension] handleEditorChange:',{hasContent:!!t,hasJson:void 0!==t?.json,jsonType:typeof t?.json,hasContentErrors:!!n?.contentErrors?.length,contentErrors:n?.contentErrors});const r=void 0===t?.json;ri.hasErrors=r,ri.dirty=!0,r||(ri.draftBody=vi(t.json)),pi(),fi(r?'JSON 无法解析，请检查错误。':'模板已修改，尚未保存。',r?'error':'warn')}async function _i(t=!1){const e=window.SillyTavern.getContext(),n=e.characterId;if(null==n)return ri.currentCharacterId=null,ri.templateBody=null,ri.draftBody=null,ri.enabled=!1,ri.dirty=!1,ri.hasErrors=!1,ri.loading=!1,ri.editorController&&ri.editorController.setValue({},{silent:!0}),fi('请选择角色后再编辑模板。','warn'),void pi();if(t||ri.currentCharacterId!==n){ri.loading=!0,pi(),fi('模板加载中……','info');try{const t=await gi(),r=e.characters?.[n],o=r?.data?.extensions?.[ei]??null,s=Boolean(o?.templateBody),i=s?o.templateBody:{};ri.currentCharacterId=n,ri.templateBody=s?vi(i):null,ri.draftBody=vi(i),ri.enabled=Boolean(o?.enabled),ri.dirty=!s,ri.hasErrors=!1,t&&t.setValue(ri.draftBody??{},{silent:!0});fi(s?'模板已加载。':'已为该角色准备默认模板，请完善后保存。',s?'info':'warn')}catch(R){console.error(ti,'加载模板失败',R),fi(`加载模板失败：${R?.message??R}`,'error')}finally{ri.loading=!1,pi()}}}function mi(){hi(!0)}function wi(t,e){const n=window.EDITOR;if(n?.slideToggle){const e={...n.getSlideToggleOptions?.()??{},onAnimationEnd:t=>{t.closest('.drawer-content')?.classList.remove('resizing')}};return t.classList.add('resizing'),void n.slideToggle(t,e)}const r=$(t);e?r.stop(!0,!0).slideDown(200):r.stop(!0,!0).slideUp(200)}function bi(t,e){t.hasClass('openIcon')&&(t.toggleClass('openIcon closedIcon'),e.toggleClass('openDrawer closedDrawer'),wi(e.get(0),!1))}let xi='character';async function Si(t){xi!==t&&(xi=t,document.querySelectorAll('.var-system-tab').forEach(e=>{e.dataset.tab===t?(e.classList.add('active'),e.style.borderBottomColor='var(--SmartThemeQuoteColor, #4a9eff)',e.style.color='var(--SmartThemeQuoteColor, #4a9eff)'):(e.classList.remove('active'),e.style.borderBottomColor='transparent',e.style.color='var(--SmartThemeBodyColor, inherit)')}),document.querySelectorAll('.var-system-tab-content[data-tab]').forEach(e=>{e.dataset.tab===t?e.style.display='flex':e.style.display='none'}),console.log(`${ti} 切换到标签页: ${t}`),'global'===t?Ri():'functions'===t?console.log(`${ti} 函数库标签页已激活`):'messages'===t&&console.log(`${ti} 楼层快照标签页已激活`))}const Ei='/api/plugins/var-manager/var-manager',$i={snapshots:[],filteredSnapshots:[],searchQuery:'',selectedTag:'',loading:!1,viewMode:'list',editorController:null,editingSnapshotId:null,draftSnapshot:null};let Ti=null,Ci=null;function Ii(t){if(Array.isArray(t))return t.filter(t=>'$__META_EXTENSIBLE__$'!==t).map(t=>Ii(t));if('object'==typeof t&&null!==t&&!(t instanceof Date)){const e={};for(const n in t)n.startsWith('$')||(e[n]=Ii(t[n]));return e}return t}function ki(t,e){const n=JSON.stringify(t,null,2),r=new Blob([n],{type:'application/json'}),o=URL.createObjectURL(r),s=document.createElement('a');s.href=o,s.download=e,s.click(),URL.revokeObjectURL(o)}async function Fi(){return new Promise(t=>{const e=document.createElement('input');e.type='file',e.accept='.json',e.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text(),r=JSON.parse(e);t(r)}catch(R){toastr.error(`导入失败：${R.message}`),t(null)}else t(null)},e.click()})}function Ai(t,e=!1){if(!t||'object'!=typeof t)return{};if('metadata'in t&&'variables'in t){console.log(`${ti} 检测到旧格式快照，自动提取 variables 字段`);const n=t.variables||{};return e&&'object'==typeof n?Ii(n):n}return e&&'object'==typeof t?Ii(t):t}async function Oi(t,e={}){const n=`${Ei}${t}`,r={...o(),'Content-Type':'application/json',...e.headers};try{const t=await fetch(n,{...e,headers:r});if(!t.ok){if(404===t.status)throw new Error('插件未安装或未启用');throw new Error(`API 请求失败: ${t.status} ${t.statusText}`)}return 204===t.status?null:await t.json()}catch(R){throw console.error(`${ti} API 调用失败:`,t,R),R}}function ji(t){if($i.viewMode===t)return;$i.viewMode=t;const e=document.getElementById('var_system_snapshots_list_view'),n=document.getElementById('var_system_snapshot_editor_view');'list'===t?(e.style.display='flex',n.style.display='none'):(e.style.display='none',n.style.display='flex'),console.log(`${ti} 快照视图切换到: ${t}`)}async function Li(){if($i.editorController)return;const t=document.getElementById('var_system_snapshot_body_editor');if(t)try{$i.editorController=F({container:t,initialValue:{},styleUrl:si,scriptUrl:ii,readOnly:!1,onChange:()=>{Bi('已修改，未保存','warn')},onFallback:()=>{console.warn(`${ti} 快照编辑器 JSON 资源加载失败，已降级为纯文本模式`),Bi('编辑器已降级为纯文本模式','warn')}}),await $i.editorController.ensureReady(),console.log(`${ti} 快照编辑器已初始化`)}catch(R){console.error(`${ti} 快照编辑器初始化失败:`,R)}else console.error(`${ti} 找不到快照编辑器容器`)}function Bi(t,e='info'){const n=document.getElementById('var_system_snapshot_editor_status');n&&(n.textContent=t,n.style.color=li[e]||li.info)}async function Ri(){if($i.loading)console.log(`${ti} 快照正在加载中，跳过重复请求`);else{$i.loading=!0,Mi('加载中...');try{console.log(`${ti} 开始加载全局快照...`);const t=await Oi('/global-snapshots');$i.snapshots=t.snapshots||[],console.log(`${ti} 已加载 ${$i.snapshots.length} 个全局快照`,$i.snapshots),Di(),Ni(),function(){const t=document.getElementById('var_system_snapshot_tag_filter');if(!t)return;const e=new Set;$i.snapshots.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(t=>{t?.trim()&&e.add(t.trim())})});const n=Array.from(e).sort(),r=t.value;t.innerHTML='<option value="" data-i18n="All tags">所有标签</option>',n.forEach(e=>{const n=document.createElement('option');n.value=e,n.textContent=e,t.appendChild(n)}),r&&n.includes(r)&&(t.value=r)}()}catch(R){console.error(`${ti} 加载全局快照失败:`,R),$i.snapshots=[],$i.filteredSnapshots=[];let e='加载失败';e=R.message.includes('插件未安装')?'插件未安装或未启用<br><br>全局快照功能需要安装 ST-VarSystemPlugin 插件':R.message.includes('Failed to fetch')?'无法连接到插件 API<br><br>请确保 SillyTavern 服务器正在运行':`加载失败: ${R.message}`,Mi(e),Ni()}finally{$i.loading=!1,console.log(`${ti} 加载全局快照完成，loading = false`)}}}function Di(){let t=[...$i.snapshots];if($i.searchQuery){const e=$i.searchQuery.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}$i.selectedTag&&(t=t.filter(t=>t.tags?.includes($i.selectedTag))),$i.filteredSnapshots=t}function Ni(){const t=document.getElementById('var_system_snapshots_list'),e=document.getElementById('var_system_snapshots_empty');if(t){if(t.querySelectorAll('.snapshot-card').forEach(t=>{t.remove()}),0===$i.filteredSnapshots.length)return e.innerHTML='\n      <i class="fa-solid fa-inbox fa-3x" style="margin-bottom: 10px; opacity: 0.5"></i>\n      <p data-i18n="No snapshots yet">暂无全局快照</p>\n      <p style="font-size: 12px" data-i18n="Click New to create one">点击"新建快照"创建第一个快照</p>\n    ',void(e.style.display='block');e.style.display='none',$i.filteredSnapshots.forEach(n=>{const r=function(t){const e=document.createElement('div');e.className='snapshot-card',e.dataset.snapshotId=t.snapshotId,e.style.cssText='\n    border: 1px solid var(--SmartThemeBorderColor, #333);\n    border-radius: 6px;\n    padding: 14px;\n    background: var(--SmartThemeBlurTintColor, rgba(0,0,0,0.2));\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: border-color 0.2s, box-shadow 0.2s;\n  ',e.addEventListener('mouseenter',()=>{e.style.borderColor='var(--SmartThemeQuoteColor, #4a9eff)',e.style.boxShadow='0 2px 8px rgba(74, 158, 255, 0.2)'}),e.addEventListener('mouseleave',()=>{e.style.borderColor='var(--SmartThemeBorderColor, #333)',e.style.boxShadow='none'});const n=document.createElement('h4');if(n.textContent=t.name,n.style.cssText='margin: 0; font-size: 16px; font-weight: 600;',e.appendChild(n),t.description){const n=document.createElement('p');n.textContent=t.description,n.style.cssText='margin: 0; font-size: 13px; color: var(--SmartThemeBodyColor, #aaa); line-height: 1.4;',e.appendChild(n)}if(t.tags&&t.tags.length>0){const n=document.createElement('div');n.style.cssText='display: flex; gap: 6px; flex-wrap: wrap;',t.tags.forEach(t=>{const e=document.createElement('span');e.textContent=t,e.style.cssText='\n        padding: 3px 10px;\n        font-size: 11px;\n        border-radius: 12px;\n        background: var(--SmartThemeQuoteColor, #4a9eff);\n        color: white;\n        font-weight: 500;\n        letter-spacing: 0.3px;\n      ',n.appendChild(e)}),e.appendChild(n)}const r=document.createElement('div');r.style.cssText='font-size: 11px; color: var(--SmartThemeBodyColor, #888);';const o=new Date(t.createdAt).toLocaleString('zh-CN');r.textContent=`创建于 ${o}`,e.appendChild(r);const s=document.createElement('div');s.style.cssText='display: flex; gap: 6px; flex-wrap: wrap; margin-top: 4px;';const i=[{text:'查看/编辑',icon:'fa-pen-to-square',action:()=>async function(t){console.log(`${ti} 编辑快照:`,t);try{const e=await Oi(`/global-snapshots/${t}`);$i.editingSnapshotId=t,$i.draftSnapshot={...e},ji('editor');const n=document.getElementById('var_system_snapshot_editor_title');n&&(n.textContent=`编辑快照: ${e.name}`),document.getElementById('var_system_snapshot_name').value=e.name||'',document.getElementById('var_system_snapshot_description').value=e.description||'',document.getElementById('var_system_snapshot_tags').value=e.tags?e.tags.join(', '):'',await Li();const r=Ai(e.snapshotBody);$i.editorController?$i.editorController.set({json:r}):console.error(`${ti} 编辑器未能初始化`),Bi('编辑快照，修改后点击保存','info')}catch(R){console.error(`${ti} 加载快照失败:`,R),await l(`加载快照失败: ${R.message}`,u.TEXT,'',{okButton:'关闭'})}}(t.snapshotId)},{text:'应用到角色',icon:'fa-download',action:()=>async function(t){if(!window.SillyTavern.getContext().characterId)return void(await l('请先选择一个角色',u.TEXT,'',{okButton:'确定'}));try{const e=await Oi(`/global-snapshots/${t}`);if(!(await l(`将快照 "${e.name}" 应用到当前角色会覆盖现有模板内容。\n\n是否继续？`,u.CONFIRM,'',{okButton:'应用',cancelButton:'取消'})))return;const n=Ai(e.snapshotBody);ri.draftBody=n,ri.dirty=!0,ri.editorController&&ri.editorController.set({json:ri.draftBody}),fi(`已加载快照 "${e.name}"，请保存以应用`,'success'),pi(),Si('character'),console.log(`${ti} 已将快照 ${t} 加载到角色模板`)}catch(R){console.error(`${ti} 加载快照失败:`,R),await l(`加载快照失败: ${R.message}`,u.TEXT,'',{okButton:'关闭'})}}(t.snapshotId)},{text:'删除',icon:'fa-trash',action:()=>async function(t){const e=$i.snapshots.find(e=>e.snapshotId===t);if(!e)return;const n=await l(`确定要删除快照 "${e.name}" 吗？\n\n此操作不可撤销。`,u.CONFIRM,'',{okButton:'删除',cancelButton:'取消'});if(!n)return;try{await Oi(`/global-snapshots/${t}`,{method:'DELETE'}),console.log(`${ti} 已删除快照:`,t),$i.snapshots=$i.snapshots.filter(e=>e.snapshotId!==t),Di(),Ni()}catch(R){console.error(`${ti} 删除快照失败:`,R),await l(`删除失败: ${R.message}`,u.TEXT,'',{okButton:'关闭'})}}(t.snapshotId),danger:!0}];return i.forEach(t=>{const e=document.createElement('button');e.className='menu_button interactable';const n=t.danger?'color: #ff6b6b;':'';e.style.cssText=`padding: 4px 10px; font-size: 12px; white-space: nowrap; ${n}`,e.innerHTML=`<i class="fa-solid ${t.icon} fa-fw"></i> <span>${t.text}</span>`,e.addEventListener('click',t.action),s.appendChild(e)}),e.appendChild(s),e}(n);t.insertBefore(r,e)})}}function Mi(t){const e=document.getElementById('var_system_snapshots_empty');e&&(e.innerHTML=`<p style="text-align: center; padding: 20px;">${t}</p>`,e.style.display='block')}async function Pi(){const t=document.getElementById('var_system_snapshot_name').value.trim()!==($i.draftSnapshot?.name||''),e=document.getElementById('var_system_snapshot_description').value.trim()!==($i.draftSnapshot?.description||'');if(t||e){if(!(await l('有未保存的修改，确定要放弃吗？',u.CONFIRM,'',{okButton:'放弃',cancelButton:'继续编辑'})))return}$i.editingSnapshotId=null,$i.draftSnapshot=null,ji('list'),Ni()}function Vi(t){t&&!Ti&&(Ti={search:t.querySelector('#var_system_snapshot_search'),tagFilter:t.querySelector('#var_system_snapshot_tag_filter'),newBtn:t.querySelector('#var_system_snapshot_new'),refreshBtn:t.querySelector('#var_system_snapshot_refresh')},Ci={back:t.querySelector('#var_system_snapshot_editor_back'),save:t.querySelector('#var_system_snapshot_editor_save'),cancel:t.querySelector('#var_system_snapshot_editor_cancel'),export:t.querySelector('#var_system_snapshot_editor_export'),import:t.querySelector('#var_system_snapshot_editor_import'),stripSchema:t.querySelector('#var_system_snapshot_editor_strip_schema')},Ti.search?.addEventListener('input',t=>{$i.searchQuery=t.target.value,Di(),Ni()}),Ti.tagFilter?.addEventListener('change',t=>{$i.selectedTag=t.target.value,Di(),Ni()}),Ti.newBtn?.addEventListener('click',()=>{!async function(){console.log(`${ti} 新建快照`),$i.editingSnapshotId=null,$i.draftSnapshot={name:'',description:'',tags:[],snapshotBody:{}},ji('editor');const t=document.getElementById('var_system_snapshot_editor_title');t&&(t.textContent='新建快照'),document.getElementById('var_system_snapshot_name').value='',document.getElementById('var_system_snapshot_description').value='',document.getElementById('var_system_snapshot_tags').value='',await Li(),$i.editorController?$i.editorController.set({json:$i.draftSnapshot.snapshotBody}):console.error(`${ti} 编辑器未能初始化`),Bi('新建快照，填写信息后点击保存','info')}()}),Ti.refreshBtn?.addEventListener('click',()=>{Ri()}),Ci.back?.addEventListener('click',()=>{Pi()}),Ci.save?.addEventListener('click',()=>{!async function(){try{const t=document.getElementById('var_system_snapshot_name').value.trim(),e=document.getElementById('var_system_snapshot_description').value.trim(),n=document.getElementById('var_system_snapshot_tags').value.trim();if(!t)return void(await l('请输入快照名称',u.TEXT,'',{okButton:'确定'}));let r=null;if($i.editorController)try{const t=$i.editorController.get();if(void 0===t?.json)return void(await l('编辑器内容有误，请检查 JSON 格式',u.TEXT,'',{okButton:'确定'}));r=t.json}catch(R){return console.error(`${ti} 获取编辑器内容失败:`,R),void(await l('编辑器内容有误，请检查 JSON 格式',u.TEXT,'',{okButton:'确定'}))}const o=n?n.split(',').map(t=>t.trim()).filter(t=>t):[],s={snapshotId:$i.editingSnapshotId||void 0,name:t,description:e,tags:o,snapshotBody:r};Bi('保存中...','info'),await Oi('/global-snapshots',{method:'POST',body:JSON.stringify(s)}),console.log(`${ti} 快照已保存:`,$i.editingSnapshotId||'new'),ji('list'),await Ri()}catch(R){console.error(`${ti} 保存快照失败:`,R),Bi(`保存失败: ${R.message}`,'error'),await l(`保存失败: ${R.message}`,u.TEXT,'',{okButton:'关闭'})}}()}),Ci.cancel?.addEventListener('click',()=>{Pi()}),Ci.export?.addEventListener('click',()=>{!async function(){if($i.editorController)try{const t=$i.editorController.get(),e=t?.json;if(void 0===e)return void toastr.error('请修复 JSON 错误后再导出');const n=`global_snapshot_${document.getElementById('var_system_snapshot_name')?.value.trim()||'snapshot'}_${(new Date).toISOString().replace(/[:.]/g,'-').slice(0,19)}.json`;ki(e,n),toastr.success(`已导出：${n}`)}catch(R){console.error(`${ti} 导出快照失败:`,R),toastr.error(`导出失败：${R.message}`)}else toastr.error('编辑器尚未准备就绪')}()}),Ci.import?.addEventListener('click',()=>{!async function(){const t=await Fi();if(t)if($i.editorController)try{const e=Ai(t,!1);$i.editorController.set({json:e}),toastr.success('JSON 已导入到编辑器')}catch(R){console.error(`${ti} 导入快照失败:`,R),toastr.error(`导入失败：${R.message}`)}else toastr.error('编辑器尚未准备就绪')}()}),Ci.stripSchema?.addEventListener('click',()=>{!async function(){if($i.editorController)try{const t=$i.editorController.get(),e=t?.json;if(void 0===e)return void toastr.error('请修复 JSON 错误后再分离 Schema');const n=Ii(e);$i.editorController.set({json:n}),toastr.success('已移除 MVU Schema 字段')}catch(R){console.error(`${ti} 分离 Schema 失败:`,R),toastr.error(`分离 Schema 失败：${R.message}`)}else toastr.error('编辑器尚未准备就绪')}()}))}async function Ui(t){if(!t)return;const e=t.querySelector('#var_system_settings_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/settings.html').then(t=>t.text());e.innerHTML=t,await async function(){console.log(Nt,'初始化设置标签页'),$('#var-system-cleanup-snapshots-btn').on('click',Mt)}(),console.log(`${ti} 设置标签页已加载`)}catch(R){console.error(`${ti} 加载设置失败:`,R)}else console.warn(`${ti} 找不到设置容器`)}async function zi(){let t=$('#var_system_drawer'),e=!1;if(0===t.length){e=!0;let n=null;try{n=await r('third-party/ST-VarSystemExtension/assets/templates','appHeaderVarSystemDrawer')}catch(R){return void console.warn(`${ti} 模板 appHeaderVarSystemDrawer 加载失败`,R)}if(!n)return void console.warn(`${ti} 模板 appHeaderVarSystemDrawer 返回空内容`);t=$(n);const o=$('#extensions-settings-button');if(0===o.length)return void console.warn(`${ti} 找不到扩展设置按钮，无法插入入口`);o.after(t);const s=t.find('#var_system_drawer_icon'),i=t.find('#var_system_drawer_content');i.hide(),t.find('.drawer-toggle').on('click',()=>{s.hasClass('openIcon')?bi(s,i):function(t,e){t.hasClass('openIcon')||($('.drawer-icon.openIcon').not(t).each((t,e)=>{const n=$(e),r=n.closest('.drawer').find('.drawer-content').first();bi(n,r)}),t.toggleClass('closedIcon openIcon'),e.toggleClass('closedDrawer openDrawer'),wi(e.get(0),!0))}(s,i)})}const n=t.get(0);n?(ui(n),function(t){t.querySelectorAll('.var-system-tab').forEach(t=>{t.addEventListener('click',()=>{Si(t.dataset.tab)})})}(n),Vi(n),await async function(t){if(!t)return;const e=t.querySelector('#var_system_functions_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/functionLibrary.html').then(t=>t.text());e.innerHTML=t;const n=document.createElement('link');n.rel='stylesheet',n.href='/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/phase4.css',document.head.appendChild(n),await mt(),console.log(`${ti} 函数库标签页已加载`)}catch(R){console.error(`${ti} 加载函数库失败:`,R)}else console.warn(`${ti} 找不到函数库容器`)}(n),await async function(t){if(!t)return;const e=t.querySelector('#var_system_messages_section');if(e)try{const t=await fetch('/scripts/extensions/third-party/ST-VarSystemExtension/src/ui/messageSnapshots.html').then(t=>t.text());e.innerHTML=t,await jt(),console.log(`${ti} 楼层快照标签页已加载`)}catch(R){console.error(`${ti} 加载楼层快照失败:`,R)}else console.warn(`${ti} 找不到楼层快照容器`)}(n),await Ui(n),hi(!0),console.log(`${ti} 自定义入口已${e?'注入':'重新初始化'}`)):console.error(`${ti} 无法获取drawer元素`)}async function Wi(){console.log(`${ti} (st-var-system) 初始化`),await zi(),s.on(i.CHAT_CHANGED,mi),s.on(i.CHARACTER_EDITOR_OPENED,mi),console.log(it,'注册事件监听器'),s.on(i.MESSAGE_RECEIVED,lt),s.on(i.MESSAGE_SWIPED,ut),s.on(i.CHAT_CHANGED,ft),s.on(i.MESSAGE_DELETED,pt),s.on(i.CHAT_DELETED,dt),console.log(it,'事件监听器已注册'),console.log(`${ti} 事件监听器已注册`);const t=Xs(Qs),e=document.createElement('div');document.body.appendChild(e),t.mount(e),console.log(`${ti} 重新处理变量菜单项已挂载`)}window.STVarSystemExtension={init:Wi,exit:async function(){console.log(`${ti} 卸载`),s.removeListener(i.CHAT_CHANGED,mi),s.removeListener(i.CHARACTER_EDITOR_OPENED,mi),console.log(it,'卸载事件监听器'),s.removeListener(i.MESSAGE_RECEIVED,lt),s.removeListener(i.MESSAGE_SWIPED,ut),s.removeListener(i.CHAT_CHANGED,ft),s.removeListener(i.MESSAGE_DELETED,pt),s.removeListener(i.CHAT_DELETED,dt),console.log(it,'事件监听器已卸载'),console.log(`${ti} 事件监听器已卸载`)}},$(async()=>{try{await Wi()}catch(R){console.error(`${ti} 初始化失败`,R)}});
//# sourceMappingURL=index.js.map
