function n(){return[{id:'builtin-set',name:'SET',type:'active',enabled:!0,order:10,builtin:!0,description:'SET - 设置变量的值（完全覆盖）\n\n参数：\n- path (字符串): 变量路径，使用点号分隔，如 "player.hp"\n- value (任意类型): 新的值（字符串、数字、对象、数组等）\n\n示例：\n#set("player.name", "Alice")\n#set("player.hp", 100)\n#set("player.stats", {"str": 10, "agi": 8})\n\n注意：此操作会完全覆盖目标变量。如果只想更新对象的部分键，请使用 UPDATE 函数',executor:'\nconst [path, rawValue] = args;\n\n// 如果已经是对象/数组/数字等（parser 已解析），直接使用\nlet value = rawValue;\n\n// 如果是字符串，尝试解析\nif (typeof rawValue === \'string\') {\n  try {\n    value = JSON.parse(rawValue);\n  } catch (e) {\n    // 解析失败，去掉引号作为普通字符串\n    value = rawValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 使用 lodash 的 set 方法\n_.set(snapshot, path, value);\n\nreturn snapshot;\n'},{id:'builtin-update',name:'UPDATE',type:'active',enabled:!0,order:20,builtin:!0,description:'UPDATE - 部分更新对象（只修改指定的键，保留其他键）\n\n参数：\n- path (字符串): 目标对象的路径\n- updates (对象): 要更新的键值对\n\n示例：\n#update("player.stats", {"hp": 100, "mp": 50})\n// 假设原 stats = {hp: 80, mp: 30, exp: 1200}\n// 结果：stats = {hp: 100, mp: 50, exp: 1200}  ← exp 被保留\n\n#update("npc.alice", {"mood": "happy", "relationship": 75})\n\n注意：如果目标路径不存在或不是对象，会初始化为空对象。此函数只做浅合并（一层深度）',executor:'\nconst [path, updates] = args;\n\n// 获取当前对象\nlet currentObj = _.get(snapshot, path);\n\n// 如果不存在或不是对象，初始化为空对象\nif (!currentObj || typeof currentObj !== \'object\' || Array.isArray(currentObj)) {\n  currentObj = {};\n}\n\n// 浅合并（只更新指定的键）\nObject.assign(currentObj, updates);\n_.set(snapshot, path, currentObj);\n\nreturn snapshot;\n'},{id:'builtin-add',name:'ADD',type:'active',enabled:!0,order:30,builtin:!0,description:'ADD - 数值加法或数组追加（智能判断目标类型）\n\n参数：\n- path (字符串): 目标变量的路径\n- value (数字|任意类型): 要添加的值\n\n行为：\n- 如果目标是数组：追加元素到末尾\n- 如果目标是数字：执行加法运算（可传负数当减法用）\n\n示例：\n#add("player.gold", 50)          // 金币 +50\n#add("player.gold", -30)         // 金币 -30（传负数当减法）\n#add("inventory.items", "sword") // 数组追加新物品\n#add("party.members", {"name": "Bob", "level": 5})\n\n注意：可以传负数来实现减法效果，无需单独的 SUB 函数',executor:'\nconst [path, rawValue] = args;\n\n// 获取当前值\nconst currentValue = _.get(snapshot, path);\n\n// 如果是数组，追加元素\nif (Array.isArray(currentValue)) {\n  let value = rawValue;\n\n  // 如果是字符串，尝试解析\n  if (typeof rawValue === \'string\') {\n    try {\n      value = JSON.parse(rawValue);\n    } catch (e) {\n      value = rawValue.replace(/^["\']|["\']$/g, \'\');\n    }\n  }\n\n  currentValue.push(value);\n  _.set(snapshot, path, currentValue);\n  return snapshot;\n}\n\n// 否则作为数值加法\nlet num;\nif (typeof rawValue === \'number\') {\n  num = rawValue;\n} else if (typeof rawValue === \'string\') {\n  num = parseFloat(rawValue);\n} else {\n  num = NaN;\n}\n\nif (isNaN(num)) {\n  console.warn(\'[ST-VarSystem] ADD: 无效的数值参数:\', rawValue);\n  return snapshot;\n}\n\nconst newValue = (parseFloat(currentValue) || 0) + num;\n_.set(snapshot, path, newValue);\n\nreturn snapshot;\n'},{id:'builtin-delete',name:'DELETE',type:'active',enabled:!0,order:40,builtin:!0,description:'DELETE - 删除变量\n\n参数：\n- path (字符串): 要删除的变量路径\n\n示例：\n#delete("temp.battle_data")\n#delete("player.buffs.poison")\n\n注意：删除后该路径将不存在，访问会返回 undefined',executor:'\nconst [path] = args;\n\n_.unset(snapshot, path);\n\nreturn snapshot;\n'},{id:'builtin-select-set',name:'SELECT_SET',type:'active',enabled:!0,order:50,builtin:!0,description:'SELECT_SET - 在数组中查找对象并设置其属性\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- targetKey (字符串): 要修改的键名\n- newValue (任意类型): 新的值\n\n示例：\n#select_set("npcs", "name", "Alice", "hp", 100)\n// 在 npcs 数组中找到 name="Alice" 的对象，设置其 hp=100\n\n#select_set("party", "id", "player1", "status", "ready")\n\n注意：此函数会完全覆盖目标键的值。如果要部分更新对象，使用 SELECT_UPDATE',executor:'\nconst [path, selectorKey, selectorValue, receiverKey, rawNewValue] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_SET: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 解析新值（如果已经是对象/数组/数字等，直接使用）\nlet newValue = rawNewValue;\n\nif (typeof rawNewValue === \'string\') {\n  try {\n    newValue = JSON.parse(rawNewValue);\n  } catch (e) {\n    newValue = rawNewValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (targetObj) {\n  targetObj[receiverKey] = newValue;\n} else {\n  console.warn(`[ST-VarSystem] SELECT_SET: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-select-add',name:'SELECT_ADD',type:'active',enabled:!0,order:60,builtin:!0,description:'SELECT_ADD - 在数组中查找对象并增加其属性值\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- targetKey (字符串): 要修改的键名\n- valueToAdd (数字|任意类型): 要添加的值\n\n行为：\n- 如果目标属性是数组：追加元素\n- 如果目标属性是数字：执行加法（可传负数）\n\n示例：\n#select_add("party", "name", "Alice", "exp", 200)\n// 给 Alice 的经验 +200\n\n#select_add("party", "name", "Alice", "exp", -50)\n// 给 Alice 的经验 -50（传负数）\n\n#select_add("npcs", "id", "merchant_01", "items", "rare_sword")\n// 给商人的物品列表追加新物品\n\n注意：支持传负数来实现减法效果',executor:'\nconst [path, selectorKey, selectorValue, receiverKey, rawValueToAdd] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_ADD: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (!targetObj) {\n  console.warn(`[ST-VarSystem] SELECT_ADD: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n  return snapshot;\n}\n\nconst currentValue = targetObj[receiverKey];\n\n// 如果是数组，追加元素\nif (Array.isArray(currentValue)) {\n  let value = rawValueToAdd;\n\n  // 如果是字符串，尝试解析\n  if (typeof rawValueToAdd === \'string\') {\n    try {\n      value = JSON.parse(rawValueToAdd);\n    } catch (e) {\n      value = rawValueToAdd.replace(/^["\']|["\']$/g, \'\');\n    }\n  }\n\n  currentValue.push(value);\n} else {\n  // 否则作为数值加法\n  let num;\n  if (typeof rawValueToAdd === \'number\') {\n    num = rawValueToAdd;\n  } else if (typeof rawValueToAdd === \'string\') {\n    num = parseFloat(rawValueToAdd);\n  } else {\n    num = NaN;\n  }\n\n  if (isNaN(num)) {\n    console.warn(\'[ST-VarSystem] SELECT_ADD: 无效的数值参数:\', rawValueToAdd);\n    return snapshot;\n  }\n  targetObj[receiverKey] = (parseFloat(currentValue) || 0) + num;\n}\n\nreturn snapshot;\n'},{id:'builtin-select-update',name:'SELECT_UPDATE',type:'active',enabled:!0,order:70,builtin:!0,description:'SELECT_UPDATE - 在数组中查找对象并部分更新其属性\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- updates (对象): 要更新的键值对\n\n示例：\n#select_update("npcs", "name", "Alice", {"hp": 50, "status": "injured", "mood": "angry"})\n// 在 npcs 数组中找到 name="Alice" 的对象，一次性更新多个属性\n\n#select_update("quests", "id", "main_001", {"progress": 75, "step": "find_artifact"})\n\n注意：此函数只更新指定的键，保留对象的其他属性。适合一次性更新多个属性',executor:'\nconst [path, selectorKey, selectorValue, updates] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_UPDATE: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (targetObj) {\n  // 浅合并更新\n  Object.assign(targetObj, updates);\n} else {\n  console.warn(`[ST-VarSystem] SELECT_UPDATE: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-select-del',name:'SELECT_DEL',type:'active',enabled:!0,order:80,builtin:!0,description:'SELECT_DEL - 在数组中查找并删除匹配的对象\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n\n示例：\n#select_del("enemies", "id", "goblin_001")\n// 从 enemies 数组中删除 id="goblin_001" 的对象\n\n#select_del("party", "name", "Bob")\n// 从队伍中移除 name="Bob" 的角色\n\n注意：只删除第一个匹配的对象。如果需要删除数组中所有匹配的值，使用 PULL 函数',executor:'\nconst [path, selectorKey, selectorValue] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_DEL: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配对象的索引\nconst index = arr.findIndex(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (index !== -1) {\n  arr.splice(index, 1);\n} else {\n  console.warn(`[ST-VarSystem] SELECT_DEL: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-push-unique',name:'PUSH_UNIQUE',type:'active',enabled:!0,order:90,builtin:!0,description:'PUSH_UNIQUE - 只在数组中不存在时才追加元素（去重）\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- value (任意类型): 要添加的值\n\n示例：\n#push_unique("achievements", "dragon_slayer")\n// 只有当 "dragon_slayer" 不在数组中时才添加\n\n#push_unique("unlocked_areas", "dark_forest")\n#push_unique("inventory.keys", {"id": "rusty_key", "name": "生锈的钥匙"})\n\n注意：使用深度比较判断是否存在。对于对象，会比较所有字段',executor:'\nconst [path, rawValue] = args;\n\nlet arr = _.get(snapshot, path);\n\n// 如果不存在或不是数组，初始化\nif (!Array.isArray(arr)) {\n  arr = [];\n}\n\n// 解析值\nlet value = rawValue;\nif (typeof rawValue === \'string\') {\n  try {\n    value = JSON.parse(rawValue);\n  } catch (e) {\n    value = rawValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 检查是否已存在（深度比较）\nconst exists = arr.some(item => _.isEqual(item, value));\n\nif (!exists) {\n  arr.push(value);\n  _.set(snapshot, path, arr);\n}\n\nreturn snapshot;\n'},{id:'builtin-pull',name:'PULL',type:'active',enabled:!0,order:100,builtin:!0,description:'PULL - 从数组中移除所有匹配的值（不是索引）\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- value (任意类型): 要移除的值\n\n示例：\n#pull("inventory.consumables", "health_potion")\n// 移除所有 "health_potion"（如果有多个会全部删除）\n\n#pull("player.buffs", "poison")\n// 移除 poison buff\n\n#pull("quest_log", {"id": "quest_001", "status": "completed"})\n// 移除特定对象（深度比较）\n\n注意：这是 SELECT_DEL 的通用版本，可作用于任意类型的数组，不限于对象数组',executor:'\nconst [path, rawValueToRemove] = args;\n\nlet arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] PULL: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 解析要移除的值\nlet valueToRemove = rawValueToRemove;\nif (typeof rawValueToRemove === \'string\') {\n  try {\n    valueToRemove = JSON.parse(rawValueToRemove);\n  } catch (e) {\n    valueToRemove = rawValueToRemove.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 移除所有匹配的值（深度比较）\nconst filtered = arr.filter(item => !_.isEqual(item, valueToRemove));\n_.set(snapshot, path, filtered);\n\nreturn snapshot;\n'}]}function e(n){const e=[{id:'builtin-set',name:'SET',type:'active',enabled:!0,order:10,builtin:!0,description:'SET - 设置变量的值（完全覆盖）\n\n参数：\n- path (字符串): 变量路径，使用点号分隔，如 "player.hp"\n- value (任意类型): 新的值（字符串、数字、对象、数组等）\n\n示例：\n#set("player.name", "Alice")\n#set("player.hp", 100)\n#set("player.stats", {"str": 10, "agi": 8})\n\n注意：此操作会完全覆盖目标变量。如果只想更新对象的部分键，请使用 UPDATE 函数',executor:'\nconst [path, rawValue] = args;\n\n// 如果已经是对象/数组/数字等（parser 已解析），直接使用\nlet value = rawValue;\n\n// 如果是字符串，尝试解析\nif (typeof rawValue === \'string\') {\n  try {\n    value = JSON.parse(rawValue);\n  } catch (e) {\n    // 解析失败，去掉引号作为普通字符串\n    value = rawValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 使用 lodash 的 set 方法\n_.set(snapshot, path, value);\n\nreturn snapshot;\n'},{id:'builtin-update',name:'UPDATE',type:'active',enabled:!0,order:20,builtin:!0,description:'UPDATE - 部分更新对象（只修改指定的键，保留其他键）\n\n参数：\n- path (字符串): 目标对象的路径\n- updates (对象): 要更新的键值对\n\n示例：\n#update("player.stats", {"hp": 100, "mp": 50})\n// 假设原 stats = {hp: 80, mp: 30, exp: 1200}\n// 结果：stats = {hp: 100, mp: 50, exp: 1200}  ← exp 被保留\n\n#update("npc.alice", {"mood": "happy", "relationship": 75})\n\n注意：如果目标路径不存在或不是对象，会初始化为空对象。此函数只做浅合并（一层深度）',executor:'\nconst [path, updates] = args;\n\n// 获取当前对象\nlet currentObj = _.get(snapshot, path);\n\n// 如果不存在或不是对象，初始化为空对象\nif (!currentObj || typeof currentObj !== \'object\' || Array.isArray(currentObj)) {\n  currentObj = {};\n}\n\n// 浅合并（只更新指定的键）\nObject.assign(currentObj, updates);\n_.set(snapshot, path, currentObj);\n\nreturn snapshot;\n'},{id:'builtin-add',name:'ADD',type:'active',enabled:!0,order:30,builtin:!0,description:'ADD - 数值加法或数组追加（智能判断目标类型）\n\n参数：\n- path (字符串): 目标变量的路径\n- value (数字|任意类型): 要添加的值\n\n行为：\n- 如果目标是数组：追加元素到末尾\n- 如果目标是数字：执行加法运算（可传负数当减法用）\n\n示例：\n#add("player.gold", 50)          // 金币 +50\n#add("player.gold", -30)         // 金币 -30（传负数当减法）\n#add("inventory.items", "sword") // 数组追加新物品\n#add("party.members", {"name": "Bob", "level": 5})\n\n注意：可以传负数来实现减法效果，无需单独的 SUB 函数',executor:'\nconst [path, rawValue] = args;\n\n// 获取当前值\nconst currentValue = _.get(snapshot, path);\n\n// 如果是数组，追加元素\nif (Array.isArray(currentValue)) {\n  let value = rawValue;\n\n  // 如果是字符串，尝试解析\n  if (typeof rawValue === \'string\') {\n    try {\n      value = JSON.parse(rawValue);\n    } catch (e) {\n      value = rawValue.replace(/^["\']|["\']$/g, \'\');\n    }\n  }\n\n  currentValue.push(value);\n  _.set(snapshot, path, currentValue);\n  return snapshot;\n}\n\n// 否则作为数值加法\nlet num;\nif (typeof rawValue === \'number\') {\n  num = rawValue;\n} else if (typeof rawValue === \'string\') {\n  num = parseFloat(rawValue);\n} else {\n  num = NaN;\n}\n\nif (isNaN(num)) {\n  console.warn(\'[ST-VarSystem] ADD: 无效的数值参数:\', rawValue);\n  return snapshot;\n}\n\nconst newValue = (parseFloat(currentValue) || 0) + num;\n_.set(snapshot, path, newValue);\n\nreturn snapshot;\n'},{id:'builtin-delete',name:'DELETE',type:'active',enabled:!0,order:40,builtin:!0,description:'DELETE - 删除变量\n\n参数：\n- path (字符串): 要删除的变量路径\n\n示例：\n#delete("temp.battle_data")\n#delete("player.buffs.poison")\n\n注意：删除后该路径将不存在，访问会返回 undefined',executor:'\nconst [path] = args;\n\n_.unset(snapshot, path);\n\nreturn snapshot;\n'},{id:'builtin-select-set',name:'SELECT_SET',type:'active',enabled:!0,order:50,builtin:!0,description:'SELECT_SET - 在数组中查找对象并设置其属性\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- targetKey (字符串): 要修改的键名\n- newValue (任意类型): 新的值\n\n示例：\n#select_set("npcs", "name", "Alice", "hp", 100)\n// 在 npcs 数组中找到 name="Alice" 的对象，设置其 hp=100\n\n#select_set("party", "id", "player1", "status", "ready")\n\n注意：此函数会完全覆盖目标键的值。如果要部分更新对象，使用 SELECT_UPDATE',executor:'\nconst [path, selectorKey, selectorValue, receiverKey, rawNewValue] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_SET: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 解析新值（如果已经是对象/数组/数字等，直接使用）\nlet newValue = rawNewValue;\n\nif (typeof rawNewValue === \'string\') {\n  try {\n    newValue = JSON.parse(rawNewValue);\n  } catch (e) {\n    newValue = rawNewValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (targetObj) {\n  targetObj[receiverKey] = newValue;\n} else {\n  console.warn(`[ST-VarSystem] SELECT_SET: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-select-add',name:'SELECT_ADD',type:'active',enabled:!0,order:60,builtin:!0,description:'SELECT_ADD - 在数组中查找对象并增加其属性值\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- targetKey (字符串): 要修改的键名\n- valueToAdd (数字|任意类型): 要添加的值\n\n行为：\n- 如果目标属性是数组：追加元素\n- 如果目标属性是数字：执行加法（可传负数）\n\n示例：\n#select_add("party", "name", "Alice", "exp", 200)\n// 给 Alice 的经验 +200\n\n#select_add("party", "name", "Alice", "exp", -50)\n// 给 Alice 的经验 -50（传负数）\n\n#select_add("npcs", "id", "merchant_01", "items", "rare_sword")\n// 给商人的物品列表追加新物品\n\n注意：支持传负数来实现减法效果',executor:'\nconst [path, selectorKey, selectorValue, receiverKey, rawValueToAdd] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_ADD: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (!targetObj) {\n  console.warn(`[ST-VarSystem] SELECT_ADD: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n  return snapshot;\n}\n\nconst currentValue = targetObj[receiverKey];\n\n// 如果是数组，追加元素\nif (Array.isArray(currentValue)) {\n  let value = rawValueToAdd;\n\n  // 如果是字符串，尝试解析\n  if (typeof rawValueToAdd === \'string\') {\n    try {\n      value = JSON.parse(rawValueToAdd);\n    } catch (e) {\n      value = rawValueToAdd.replace(/^["\']|["\']$/g, \'\');\n    }\n  }\n\n  currentValue.push(value);\n} else {\n  // 否则作为数值加法\n  let num;\n  if (typeof rawValueToAdd === \'number\') {\n    num = rawValueToAdd;\n  } else if (typeof rawValueToAdd === \'string\') {\n    num = parseFloat(rawValueToAdd);\n  } else {\n    num = NaN;\n  }\n\n  if (isNaN(num)) {\n    console.warn(\'[ST-VarSystem] SELECT_ADD: 无效的数值参数:\', rawValueToAdd);\n    return snapshot;\n  }\n  targetObj[receiverKey] = (parseFloat(currentValue) || 0) + num;\n}\n\nreturn snapshot;\n'},{id:'builtin-select-update',name:'SELECT_UPDATE',type:'active',enabled:!0,order:70,builtin:!0,description:'SELECT_UPDATE - 在数组中查找对象并部分更新其属性\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n- updates (对象): 要更新的键值对\n\n示例：\n#select_update("npcs", "name", "Alice", {"hp": 50, "status": "injured", "mood": "angry"})\n// 在 npcs 数组中找到 name="Alice" 的对象，一次性更新多个属性\n\n#select_update("quests", "id", "main_001", {"progress": 75, "step": "find_artifact"})\n\n注意：此函数只更新指定的键，保留对象的其他属性。适合一次性更新多个属性',executor:'\nconst [path, selectorKey, selectorValue, updates] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_UPDATE: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配的对象\nconst targetObj = arr.find(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (targetObj) {\n  // 浅合并更新\n  Object.assign(targetObj, updates);\n} else {\n  console.warn(`[ST-VarSystem] SELECT_UPDATE: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-select-del',name:'SELECT_DEL',type:'active',enabled:!0,order:80,builtin:!0,description:'SELECT_DEL - 在数组中查找并删除匹配的对象\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- selectorKey (字符串): 用于匹配的键名\n- selectorValue (任意类型): 用于匹配的值\n\n示例：\n#select_del("enemies", "id", "goblin_001")\n// 从 enemies 数组中删除 id="goblin_001" 的对象\n\n#select_del("party", "name", "Bob")\n// 从队伍中移除 name="Bob" 的角色\n\n注意：只删除第一个匹配的对象。如果需要删除数组中所有匹配的值，使用 PULL 函数',executor:'\nconst [path, selectorKey, selectorValue] = args;\n\nconst arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] SELECT_DEL: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 查找匹配对象的索引\nconst index = arr.findIndex(item =>\n  item && typeof item === \'object\' && item[selectorKey] === selectorValue\n);\n\nif (index !== -1) {\n  arr.splice(index, 1);\n} else {\n  console.warn(`[ST-VarSystem] SELECT_DEL: 未找到匹配对象 ${selectorKey}=${selectorValue}`);\n}\n\nreturn snapshot;\n'},{id:'builtin-push-unique',name:'PUSH_UNIQUE',type:'active',enabled:!0,order:90,builtin:!0,description:'PUSH_UNIQUE - 只在数组中不存在时才追加元素（去重）\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- value (任意类型): 要添加的值\n\n示例：\n#push_unique("achievements", "dragon_slayer")\n// 只有当 "dragon_slayer" 不在数组中时才添加\n\n#push_unique("unlocked_areas", "dark_forest")\n#push_unique("inventory.keys", {"id": "rusty_key", "name": "生锈的钥匙"})\n\n注意：使用深度比较判断是否存在。对于对象，会比较所有字段',executor:'\nconst [path, rawValue] = args;\n\nlet arr = _.get(snapshot, path);\n\n// 如果不存在或不是数组，初始化\nif (!Array.isArray(arr)) {\n  arr = [];\n}\n\n// 解析值\nlet value = rawValue;\nif (typeof rawValue === \'string\') {\n  try {\n    value = JSON.parse(rawValue);\n  } catch (e) {\n    value = rawValue.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 检查是否已存在（深度比较）\nconst exists = arr.some(item => _.isEqual(item, value));\n\nif (!exists) {\n  arr.push(value);\n  _.set(snapshot, path, arr);\n}\n\nreturn snapshot;\n'},{id:'builtin-pull',name:'PULL',type:'active',enabled:!0,order:100,builtin:!0,description:'PULL - 从数组中移除所有匹配的值（不是索引）\n\n参数：\n- arrayPath (字符串): 目标数组的路径\n- value (任意类型): 要移除的值\n\n示例：\n#pull("inventory.consumables", "health_potion")\n// 移除所有 "health_potion"（如果有多个会全部删除）\n\n#pull("player.buffs", "poison")\n// 移除 poison buff\n\n#pull("quest_log", {"id": "quest_001", "status": "completed"})\n// 移除特定对象（深度比较）\n\n注意：这是 SELECT_DEL 的通用版本，可作用于任意类型的数组，不限于对象数组',executor:'\nconst [path, rawValueToRemove] = args;\n\nlet arr = _.get(snapshot, path);\nif (!Array.isArray(arr)) {\n  console.warn(\'[ST-VarSystem] PULL: 目标不是数组:\', path);\n  return snapshot;\n}\n\n// 解析要移除的值\nlet valueToRemove = rawValueToRemove;\nif (typeof rawValueToRemove === \'string\') {\n  try {\n    valueToRemove = JSON.parse(rawValueToRemove);\n  } catch (e) {\n    valueToRemove = rawValueToRemove.replace(/^["\']|["\']$/g, \'\');\n  }\n}\n\n// 移除所有匹配的值（深度比较）\nconst filtered = arr.filter(item => !_.isEqual(item, valueToRemove));\n_.set(snapshot, path, filtered);\n\nreturn snapshot;\n'}];for(const a of e)n.upsertGlobalFunction(a);console.log('[ST-VarSystemExtension] 已注册',e.length,'个内置函数'),console.log('[ST-VarSystemExtension] 核心函数: SET, UPDATE, ADD, DELETE'),console.log('[ST-VarSystemExtension] SELECT 系列: SELECT_SET, SELECT_ADD, SELECT_UPDATE, SELECT_DEL'),console.log('[ST-VarSystemExtension] 数组操作: PUSH_UNIQUE, PULL')}export{n as getBuiltinFunctions,e as initBuiltinFunctions};
//# sourceMappingURL=builtins.B2svJUjl.chunk.js.map
